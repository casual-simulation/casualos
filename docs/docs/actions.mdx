---
id: actions
title: Actions
sidebar_label: Actions
description: Actions affect the data in bots and also do things to the outside world.
---

import { 
  TagLink,
  Alert,
  NormalCode,
  ActionLink,
  PossibleValuesTable,
  PossibleValueCode,
  PossibleValue,
} from './components.mdx';

## Data Actions

### `create(...mods)`


Creates a new bot or combination of bots with the given mods. Also triggers <TagLink tag='@onCreate'/> on all the created bots.
By default, bots are created with a unique <TagLink tag='id'/>, <TagLink tag='creator'/> set to the current `bot.id`, and <TagLink tag='space'/> set to `shared`.

If <TagLink tag='creator'/> references a non-existent bot or a bot with a different <TagLink tag='space'/> than the created bot, then <TagLink tag='creator'/> will be set to `null`.

**Each parameter** is a mod that should be applied to the new bot(s).
If no parameters are specified, then the new bot will have its <TagLink tag='creator'/> set to `bot.id` and <TagLink tag='space'/> set to `shared`.
If an array of mods is used for a parameter, then one bot will be created for _each unique combination of mods_.

#### Examples:

1. Create an empty bot:
```typescript
let myNewBot = create();
```

2. Create a red bot:
```typescript
let myRedBot = create({
    color: "red"
});
```

3. Create a parent and a child bot:
```typescript
let myParentBot = create({
    creator: null,
    label: "Parent"
});
let myChildBot = create({
    creator: getID(myParentBot),
    label: "Child"
});
```

4. Create a empty bot in the `tempLocal` space:
```typescript
let myBot = create({ space: "tempLocal" });
```

5. Create a bot from multiple mods:
```typescript
// myBot is placed in the "myDimension" dimension and is colored green
let myBot = create({ myDimension: true }, {
    color: "green"
});
```

6. Create a red bot and a blue bot:
```typescript
let [myRedBot, myBlueBot] = create({ creator: null}, [
    {
        "color": "red"
    },
    {
        "color": "blue"
    }
]);
```

### `destroy(bot)`


Removes the given bot, list of bots, or bot by <TagLink tag='id'/> and triggers <TagLink tag='@onDestroy'/> for each of the destroyed bots.

Note that only destroyable bots will be destroyed.
Bots that have <TagLink tag='destroyable'/> set to `false` will not be destroyed.

Also note that all bots that have <TagLink tag='creator'/> set to the <TagLink tag='id'/> of a destroyed bot will also be destroyed (unless they are not destroyable).
This happens recursively until there are no more bots to destroy.

#### Examples:

1. Destroying a single bot:
```typescript
// Destroy a single bot that has #name set to "bob"
destroy(getBot("#name", "bob"));
```

2. Destroying a list of bots:
```typescript
// Destroy all the bots that have #color set to "red"
destroy(getBots("#color", "red"));
```

3. Destroying a bot by its id
```typescript
// Destroy the bot with the #id: "config"
destroy("config");
```

### `applyMod(bot, ...mods)`


Applies the given mods to the given bot.

The **first parameter** is the bot that the mods should be applied to.

The **other parameters** are the mods that should be applied to the bot. If two mods have the same tag, then the mod that is last in the list will win.

#### Examples

1. Set the "test" tag and "name" tag on a bot.
```typescript
applyMod(bot, {
    test: true,
    name: "bob"
});
```

### `subtractMods(bot, ...mods)`


Removes the tags contained in the given mod(s) from the given bot or mod.

The **first parameter** is the bot or mod that the tags should be removed from.

The **other parameters** are the bots or mods that contain the tags which should be removed from the original bot.

#### Examples:

1. Remove a mod from this bot.
```typescript
const mod = {
    color: 'red',
    name: 'bob'
};

subtractMods(this, mod);
```

2. Remove multiple mods from this bot.
```typescript
subtractMods(this, {
    color: 'red'
}, {
    name: 'bob'
});
```

### `removeTags(bot, tagSection)`


Removes all the tags from the given bot that match the given tag section.

The **first parameter** is the bot or list of bots that should have the tags removed.

The **second parameter** is a string or regex that specifies which tags to remove.
If given a string, then all the tags that start with the given string will be removed.
If given a regex, then all the tags which match the regex will be removed.

#### Examples:

1. Remove tags started with `abc` from the `this` bot.
```typescript
removeTags(this, "abc");
```

2. Remove tags named `hello` using a case-insensitive regex from the `this` bot.
```typescript
removeTags(this, /^hello$/gi)
```

### `renameTag(bot, originalTag, newTag)`

Renames the given original tag on the given bot or list of bots to the given new tag.
If the original tag does not exist on the bot, then no changes will take place.
If the new tag already exists on the bot, then it will be overwritten with the contents of the original tag.

The **first parameter** is the bot or list of bots that should have the tag renamed.

The **second parameter** is the name of the tag that should be renamed.

The **third parameter** is the new name that the tag should have.

#### Examples:

1. Rename the `auxColor` tag to `color`.
```typescript
renameTag(this, "auxColor", "color");
```

### `changeState(bot, stateName, groupName?)`


Changes the state that the given bot occupies in the given group.
If the state was changed, then the <TagLink tag='@[groupName][stateName]OnExit'/> and <TagLink tag='@[groupName][stateName]OnEnter'/> whispers are sent to the `bot`.

The **first parameter** is the bot whose state should be changed.

The **second parameter** is the value that should be set on the bot.

The **third parameter** is the name of the tag that should be changed on the bot. If not specified, then the `#state` tag will be used.

#### Examples:

1. Change the `#state` of the bot to "Running".
```typescript
// Triggers @stateRunningOnEnter
changeState(bot, "Running");
```

2. Change the `#playbackState` of the bot to "Playing".
```typescript
// Triggers @playbackStatePlayingOnEnter
changeState(bot, "Playing", "playbackState");
```

### `getBots(..filters)`


Gets an array of bots that match all of the given filter(s). The returned array is sorted alphabetically by the <TagLink tag='id'/> tag.

**Each parameter** is a [bot filter](#bot-filters). If no filters are specified, then all bots in the story are returned.
If multiple filters are specified, then only the bots that match all of the filters are returned.

#### Examples

1. Find all bots with the "test" tag.
```typescript
let bots = getBots(byTag("#test"));
```

2. Find all bots with `#name` set to "bob" _and_ in the "people" dimension.
```typescript
let bots = getBots(byTag("#name", "bob"), inDimension("people"));
```

### `getBots(tag, value?)`


Gets an array of bots that match the given tag and value. The returned array is sorted alphabetically by the <TagLink tag='id'/> tag.

The **first parameter** is the name of the tag. Bots that have this tag will be included as long as they also match the second parameter.

The **second parameter** is the value the tag should match. If not specified, then all bots with the tag will be included.
If specified, then only bots that have the same tag and value will be included. If you specify a function as the value, then it will be used to match tag values.

<Alert type='info'>
    This function behaves exactly like <ActionLink action='getBots(...filters)'/> with <ActionLink action='byTag(tag, value?)' />
</Alert>

#### Examples

1. Find all the bots with `#name` set to "bob".
```typescript
let bots = getBots("#name", "bob");
```

2. Find all bots with a height larger than 2.
```typescript
let bots = getBots("#height", height => height > 2);
```

3. Find all bots with the "test" tag.
```typescript
let bots = getBots("#test");
```

### `getBot(...filters)`


Get the first bot that matches all of the given filter(s). If multiple bots match the given filter(s), then bots are sorted alphabetically by the <TagLink tag='id'/> tag and the first one is returned. If no bots match the given filter(s), then `undefined` is returned.

**Each parameter** is a [bot filter](#bot-filters). If no filters are specified, then the first bot in the story is returned.
If multiple filters are specified, then the first bot that matches all of the filters is returned.

#### Examples

1. Find a bot with the "test" tag.
```typescript
let foundBot = getBot(byTag("#test"));
```

2. Find a bot with `#name` set to "bob" _and_ in the "people" dimension.
```typescript
let foundBot = getBot(byTag("#name", "bob"), inDimension("people"));
```

### `getBot(tag, filter?)`


Gets the first bot that matches the given tag and value. If multiple bots match the given tag and value, then bots are sorted alphabetically by the <TagLink tag='id'/> tag and the first one is returned. If no bots match the given tag and value, then `undefined` is returned.

The **first parameter** is the name of the tag to search for.

The **second parameter** is the value the tag should match. If not specified, then the first bot with the tag will be returned.
If specified, then the first bot that has the same tag and value will be returned. If you specify a function as the value, then it will be used to match tag values.

<Alert type='info'>
    This function behaves exactly like <ActionLink action='getBot(...filters)'/> with <ActionLink action='byTag(tag, value?)' />
</Alert>

#### Examples

1. Find the first bot with `#name` set to "bob".
```typescript
let foundBot = getBot("#name", "bob");
```

2. Find the first bot with a height larger than 2.
```typescript
let foundBot = getBot("#height", height => height > 2);
```

3. Find the first bot with the "test" tag.
```typescript
let foundBot = getBot("#test");
```

### `getBotTagValues(tag, filter?)`


Gets a list of all the values in the story for the given tag. Optionally accepts a filter for the tag values.

The **first parameter** is the name of the tag to search for.

The **second parameter** is optional and is the filter that the tag values should match. If not specified, then all the tag values are included.
If it is a function, then it will be used to match values. Otherwise, only tags that match the value will be included.

#### Examples:

1. Find the number of bots named bot and print it.
```typescript
const numberOfBobs = getBotTagValues("#name", "bob").length;
player.toast(numberOfBobs);
```

2. Find all the bot ages above `10`.
```typescript
const agesOver10 = getBotTagValues("#age", age => age > 10);
```

### `getID(bot)`


Gets the ID of the given bot.

The **first parameter** is the bot whose ID should be retrieved.
If given a bot ID, then it will be returned. If given `null` or something that is not a bot, then `null` will be returned.

#### Examples

1. Get the ID of the current bot.
```typescript
let id = getID(bot);
```

2. Get the ID of a bot with `#name` set to "bob".
```typescript
let id = getID(getBot("#name", "bob"));
```

### `getJSON(data)`


Gets the [JSON](https://en.wikipedia.org/wiki/JSON) representation of the given data.

The **first parameter** is the data that should be [cloned](https://en.wikipedia.org/wiki/Serialization) into the JSON format.
If given a bot, then the returned JSON will be able to be able to be converted back into a mod via <ActionLink action='getMod(bot)'/>.

#### Examples

1. Store a copy of a bot in a tag.
```typescript
let bob = getBot("#name", "bob");
tags.savedBot = getJSON(bob);
```

### `getMod(bot)`


Gets a mod for the given bot and list of tags. The returned mod will only contain tags that are contained in the given list.

The **first parameter** is the bot or JSON string that should be cloned into a mod.

The **other parameters** are the tags that should be included in the returned mod.
If no other parameters are specified, then all tags are included.
If a parameter is a RegEx ([Regular Expression](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions)), then it will include all the tags that match the expression.

#### Examples

1. Get a mod with the current bot's tags.
```typescript
let mod = getMod(bot);
```

2. Get a mod with only the <TagLink tag='color'/> and <TagLink tag='label'/> tags.
```typescript
let mod = getMod(bot, "color", "label");
```

3. Get a mod with every tag that starts with "on".
```typescript
let mod = getMod(bot, /^on/g);
```

### `webhook(options)`

Sends a webhook using the given options.

Returns a Promise that resolves with the following properties:

```typescript
{
    data: any,
    status: number,
    statusText: string,
    headers: any
}
```

The **first parameter** is an object with the following properties:

```typescript
let options: {
    /**
     * The HTTP Method that the request should use.
     */
    method: string;

    /**
     * The URL that the request should be made to.
     */
    url: string;

    /**
     * The headers to include in the request.
     */
    headers?: {
        [key: string]: string;
    };

    /**
     * The data to send with the request.
     */
    data?: any;

    /**
     * The shout that should be made when the request finishes.
     * This is for legacy code. New code should await the returned promise.
     */
    responseShout?: string;
};
```

#### Examples:

1. Send a HTTP GET request to `https://auxplayer.com` and toast the result.
```typescript
const response = await webhook({
    method: 'GET',
    url: 'https://example.com',
});

player.toast(response);
```

2. Send a HTTP PUT request to `https://example.com` with some data.
```typescript
webhook({
    method: 'PUT',
    url: 'https://example.com',
    data: {
        some: 'data'
    }
});
```

### `webhook.post(url, data?, options?)`

Sends a HTTP POST request using the given options.

Returns a Promise that resolves with the following properties:

```typescript
{
    data: any,
    status: number,
    statusText: string,
    headers: any
}
```

The **first parameter** is the URL that the request should be sent to.

The **second parameter** is the data that should be included in the request.

The **third parameter** is an optional object with the following properties:

```typescript
let options: {
    /**
     * The headers to include in the request.
     */
    headers?: {
        [key: string]: string;
    };

    /**
     * The shout that should be made when the request finishes.
     */
    responseShout?: string;
};
```

#### Examples:

1. Send a HTTP POST request to `https://example.com` and toast the result.
```typescript
const response = await webhook.post('https://example.com', {
    some: 'data'
});

player.toast(response);
```

### `uuid()`

Creates a new UUID. Useful for generating a random identifier that is guaranteed to be unique.

#### Examples:

1. Generate a new UUID and toast it:
```typescript
const id = uuid();

player.toast(id);
```

### `sleep(time)`


Waits the amount of time provided, in ms.

Returns a promise that resolves when the time has been waited.

The **first parameter** is time in ms to wait. 1 second is 1000ms.

#### Examples:

1. Wait 2 seconds before proceeding.
```typescript
player.toast("Stop!");
await sleep(2000);
player.toast("Hammer Time!");
```

## Bot Filters

### `byTag(tag, value?)`


Creates a bot filter that includes bots that have the given tag that matches the given value.

The **first parameter** is the name of the tag. Bots that have this tag will be included as long as they also match the second parameter.

The **second parameter** is the value that the tag should match. If not specified, then all bots with the tag will be included. 
If specified, then only bots that have the same tag value will be included. If you specify a function as the value, then it will be used to match tag values.

#### Examples

1. Find all the bots with `#name` set to "bob".
```typescript
let bots = getBots(byTag("#name", "bob"));
```

2. Find all bots with a height larger than 2.
```typescript
let bots = getBots(byTag("#height", height => height > 2));
```

3. Find all bots with the "test" tag.
```typescript
let bots = getBots(byTag("#test"));
```

### `inDimension(dimension)`


Creates a bot filter that includes bots that are in the given dimension. That is, they have the given tag set to `true`.

The **first parameter** is the name of the dimension.

<Alert type='info'>
    This function behaves exactly like <ActionLink action='byTag(tag, value?)' /> with the `value` parameter set to `true`.
</Alert>

#### Examples

1. Find all the bots in the "test" dimension.
```typescript
let bots = getBots(inDimension("test"));
```

### `atPosition(dimension, x, y)`

Creates a bot filter that includes bots that are in the given dimension and at the given X and Y position.

When this filter is used with <ActionLink action='getBots(...filters)'/>, the returned bots are sorted in the same order that they are stacked.
This means that the first bot in the array is at the bottom of the stack and the last bot is at the top of the stack (assuming they're stackable).

The **first parameter** is the name of the dimension.

The **second parameter** is the X position. That is, the left-right position of the bots in the dimension.

The **third parameter** is the Y position. That is, the forward-backward position of the bots in the dimension.

#### Examples

1. Find all the bots at (1, 2) in the "test" dimension.
```typescript
let bots = getBots(atPosition("test", 1, 2));
```

### `inStack(bot, dimension)`

Creates a bot filter that includes bots in the same stack as the given bot. The given bot will always be included by this filter as long the given bot is in the given dimension.

When this filter is used with <ActionLink action='getBots(...filters)'/>, the returned bots are sorted in the same order that they are stacked.
This means that the first bot in the array is at the bottom of the stack and the last bot is at the top of the stack (assuming they're stackable).

The **first parameter** is the bot that other bots should be in the same stack with.

The **second parameter** is the name of the dimension.

#### Examples

1. Find all bots in the same stack as `this` in the "test" dimension.
```typescript
let bots = getBots(inStack(this, "test"));
```

### `byCreator(bot)`


Creates a bot filter that includes bots created by the given bot. That is, they have <TagLink tag='creator' /> set to the <TagLink tag='id' /> of the given bot.

The **first parameter** is the bot that created the other bots.

<Alert type='info'>
    This function behaves exactly like <NormalCode>byTag("creator", getID(bot))</NormalCode>.
</Alert>

#### Examples

1. Find all the bots created by this bot.
```typescript
let bots = getBots(byCreator(this));
```

### `bySpace(space)`


Creates a bot filter that includes bots in the given space. That is, they have <TagLink tag='space'/> set to the given value.

The **first parameter** is the space that the bots are in.

<Alert type='info'>
    This function behaves exactly like <NormalCode>byTag("space", space)</NormalCode>.
</Alert>

#### Examples

1. Find all bots in the `tempLocal` space.
```typescript
let bots = getBots(bySpace("tempLocal"));
```

### `byMod(mod)`


Creates a bot filter that includes bots that match the given mod.

The **first parameter** is the bot or mod that the other bots should match.

#### Examples:

1. Find all the bots with `#height` set to `1` and `#color` set to `red`.
```typescript
const bots = getBots(byMod({
    height: 1,
    color: "red"
}));
```

### `neighboring(bot, dimension, direction)`


Creates a bot filter that includes bots which are neighboring the given bot.
Optionally takes a direction that the neighboring bots must be in.

The **first parameter** is the bot that the other bots need to be neighboring.

The **second parameter** is the dimension that the other bots need to be in.

The **third parameter** is optional and is the neighboring direction to check. If not specified, then all of the supported directions will be checked.
Currently, the supported directions are `front`, `right`, `back`, and `left`. If an unsupported direction is specified, then no bots will be included.

#### Examples:

1. Find all bots in front of `this` bot in the `test` dimension.
```typescript
const bots = getBots(neighboring(this, "test", "front"));
```

1. Find all bots around `this` bot in the `test` dimension.
```typescript
const bots = getBots(neighboring(this, "test"));
```

### `either(...filters)`

Creates a bot filter that includes bots which match any (i.e. one or more) of the given filters.

**Each parameter** is a bot filter.

#### Examples:

1. Find all bots with the `#name` `bob` or a `#height` of 2.
```typescript
const bots = getBots(
    either(
        byTag("#name", "bob"),
        byTag("height", 2)
    )
);
```

### `not(filter)`

Creates a function that includes bots which _do not_ match the given filter.

The **first parameter** is the bot filter whose results should be negated.

#### Examples.

1. Find all bots that are not in the `test` dimension.
```typescript
const bots = getBots(not(inDimension("test")));
```

## Event Actions

### `shout(name, arg?)`


Sends a shout to all bots that are <TagLink tag='listening'/> and have a [listen tag][listen-tag] for the specified name. Optionally includes a custom `that` argument.
Also triggers <TagLink tag='@onListen'/> and <TagLink tag='@onAnyListen'/>.

The **first parameter** is the name of the shout. e.g. Using `onClick` for the name will trigger all <TagLink tag='@onClick'/> listeners.

The **second parameter** is the `that` argument to send with the shout. You do not need to specify this parameter if you do not want to.

#### Examples:

1. Send a `@reset` event to all bots:
```typescript
shout("reset");
```

2. Send a `@hello` event with your name:
```typescript
shout("hello", "Bob");
```

### `whisper(bot, name, arg?)`


Sends a whisper to the specified bot(s) that are <TagLink tag='listening'/> and have a [listen tag][listen-tag] for the given name. Optionally includes a custom `that` argument.
Also triggers <TagLink tag='@onListen'/> and <TagLink tag='@onAnyListen'/>.

The **first parameter** is the bot, array of bots, bot <TagLink tag='id'/>, or array of bot <TagLink tag='id'/> that the whisper should be sent to.

The **second parameter** is the name of the whisper. e.g. Using `onClick` for the name will trigger the <TagLink tag='@onClick'/> listener for the specified bots.

The **third parameter** is the `that` argument to send with the shout. You do not need to specify this parameter if you do not want to.

#### Examples:

1. Send a `@reset` event to all bots named `Bob`:
```typescript
let bots = getBots("#name", "Bob");
whisper(bots, "reset");
```

2. Send a `@setColor` event to ourself:
```typescript
whisper(this, "setColor", "red");
```

### `superShout(name, arg?)`


Sends a shout to all of the other stories that are loaded.

The **first parameter** is the name of the shout. e.g. Using `onClick` for the name will trigger all the <TagLink tag='@onClick'/> listeners.

The **second parameter** is the optional `that` argument to include with the shout.

#### Examples:

1. Send a `hello` super shout to all the loaded stories.
```typescript
superShout("hello");
```

### `remote(action, target?)`


Sends the given action to another player.

In CasualOS, all actions are messages which are placed in a queue and processed one at at time.

For example, the <ActionLink action='player.toast(message, duration?)'/> action queues a message which, when processed, will show a toast message.
However, before any action is performed, it is run through the <TagLink tag='@onStoryAction'/> listener which can decide whether reject an action using <ActionLink action='action.reject(action)'/>.
This lets you write rules for what actions each player is allowed to take.

There are a couple special cases. First, when you send/receive an action from someone else (i.e. they sent an action to you using the <ActionLink action='remote(action)'/> function), it won't run by default.
Instead it is wrapped as a `device` action and sent to <TagLink tag='@onStoryAction'/> for processing. This lets you decide whether to allow players to send messages to each other and what the effect of those messages are.
If you want to perform the action, you can use <ActionLink action='action.perform(action)'/> on the inner device action to queue it for execution.

The **first parameter** is the action to send.

The **second parameter** is optional and is a object specifing which player to send the action to. If not specified, then the action is sent to the server player.
If specified, then the action is sent to all players that match the given values. If given a string, then the action is sent to the player with the matching ID.

#### Examples:

1. Send a toast message to another player.
```typescript
// TODO: Get the bot ID of the other player.
const otherPlayerBotId = 'otherPlayerBotId';

// Create a toast action
const toastAction = player.toast('My message!');

// Send the action to the other player
// The toastAction will not be performed locally because
// it is being sent to another player.
remote(toastAction, otherPlayerBotId);
```

### `remoteWhisper(playerId, name, arg?)`

Sends a <TagLink tag='@onRemoteWhisper'/> shout to the player with the given ID or players if given a list of IDs.
This is useful for sending arbitrary messages to specific players.

The **first parameter** is the player ID or list of player IDs that the shout should be sent to.

The **second parameter** is the name of the event that is being sent. This is useful for telling the difference between different messages.

The **third parameter** is optional and is the `that` argument to send with the shout. You do not need to specify this parameter if you do not want to.

#### Examples:

1. Send a "custom" message to another player.
```typescript
const otherPlayerBotId = "otherPlayerBotId";

// The other player will receive a @onRemoteWhisper with 
// that.name === "custom" and that.that === "Hello"
remoteWhisper(otherPlayerBotId, "custom", "Hello");
```

2. Send a message to all other players.
```typescript
const players = await server.players();
const playerId = getID(player.getBot());
const otherPlayers = players.filter(id => id !== playerId);

// All other players will receive a @onRemoteWhisper with
// that.name === "custom" and that.that === "Hello"
remoteWhisper(otherPlayers, "custom", "Hello");
```

### `remoteShout(name, arg?)`

Sends a <TagLink tag='@onRemoteWhisper'/> shout to all the players in the current story.
The listener will be triggered on all players connected to the story, including the local player.

The **first parameter** is the name of the message that is being sent. This is useful for telling the difference between different messages.

The **second parameter** is optional and is the `that` argument to send with the shout. You do not need to specify this parameter if you do not want to.

#### Examples:

1. Send a message to all players.
```typescript
// All players will receive a @onRemoteWhisper with
// that.name === "custom" and that.that === "Hello"
remoteShout("custom", "Hello");
```

### `action.perform(action)`


Queues the given action to be performed at a later time.

The **first parameter** is the action that should be performed.

#### Examples:

1. Perform a toast message by manually queuing it.
```typescript
action.perform({
    type: 'show_toast',
    message: 'My toast message!',
    duration: 2000 // 2 seconds in miliseconds
});
```

### `action.reject(action)`


Prevents a previous action from being performed.

This is especially useful when used in a <TagLink tag='@onStoryAction'/> listener since it lets you reject actions before they are performed.

The **first parameter** is the action that should be prevented/rejected.

1. Prevent a toast message from being performed.
```typescript
const toastAction = player.toast("my message");
action.reject(toastAction);
```

## Player Actions

### `player.checkout(options)`


Shows a payment screen modal that lets the player purchase something.
Triggers the <TagLink tag='@onCheckout'/> shout on the server inside the given processing story.

The **first parameter** is the options to use to setup the checkout screen.

<Alert type='warning'>
    Note that while this is functional, it is not recommended be used due to potential security issues.
</Alert>

#### Examples:

1. Show a checkout box for 10 cookies.
```typescript
player.checkout({
    publishableKey: 'YOUR_PUBLISHABLE_API_KEY',
    productId: '10_cookies',
    title: '10 Cookies',
    description: '$5.00',
    processingStory: 'cookies_checkout'
});
```

### `player.downloadBots(bots, filename)`


Downloads the given array of bots as a `.aux` file with the given filename.
Useful for quickly backing up a set of bots.

The **first parameter** is the array of bots that should be downloaded.

The **second parameter** is the name of the file that the bots should be stored in.
`.aux` will automatically be added to the end of the filename.

#### Examples:

1. Download all the bots in the "abc" dimension as "abcBots.aux".
```typescript
player.downloadBots(getBots(inDimension("abc")), "abcBots");
```

2. Download the current bot as "currentBot.aux".
```typescript
player.downloadBots([bot], "currentBot");
```

### `player.run(script)`


Runs the given script.
The script will be executed in a separate environment with no `bot`, `tags`, `this`, `data`, and `that` variables.
This means that you need to use the <ActionLink action='getBot(...filters)'/> or <ActionLink action='getBots(...filters)'/> functions to read bot data.

Returns a promise that resolves with the returned script value after it has been executed.

The **first parameter** is the script that should be executed.

#### Examples:

1. Run a script that says "hello".
```typescript
player.run("player.toast('hello');");
```

2. Run a script from the `#script` tag on the current bot.
```typescript
player.run(tags.script);
```

3. Run a script and toast the result.
```typescript
const result = await player.run("return 594 + 391");
player.toast(result);
```

### `player.replaceDragBot(botOrMod)`


Replaces the bot that the user is dragging with the given bot or mod.
Only works if called from inside a <TagLink tag='@onDrag'/> or <TagLink tag='@onAnyBotDrag'/> listen tag.

The **first parameter** is the bot or mod that should be dragged. 
If given a bot, then that bot's <TagLink tag='@onDrag'/> will be skippped but <TagLink tag='@onDrop'/> will be called.

#### Examples:

1. Drag a clone of this bot.
```typescript
let clone = create(this);
player.replaceDragBot(clone);
```

2. Drag a mod that makes other bots red.
```typescript
player.replaceDragBot({
    "color": "red"
});
```

### `player.showChat(placeholder?)`


Shows the "chat bar" at the top of the screen in auxPlayer, optionally using the given text as the placeholder.
Typing in the chat bar will send <TagLink tag="@onChatTyping"/> shouts and pressing Enter will send a <TagLink tag="@onChat"/> shout and clear the chat bar.

The **first parameter** is the text that the chat bar should show as the placeholder.

#### Examples:

1. Show the chat bar.
```typescript
player.showChat();
```

2. Show the chat bar with some placeholder text.
```typescript
player.showChat("hello");
```

### `player.showChat(options)`


Shows the "chat bar" at the top of the screen in auxPlayer, using the given options.
Typing in the chat bar will send <TagLink tag="@onChatTyping"/> shouts and pressing Enter will send a <TagLink tag="@onChat"/> shout and clear the chat bar.

The **first parameter** is an object with the options that the chat bar should use.
It should be an object with the following properties:
- `placeholder` - The text that should be shown as a placeholder. (optional)
- `prefill` - The text that should be filled into the chat bar. If the chat bar already has text in it, then setting this property does nothing.

#### Examples:

1. Show the chat bar with a placeholder.
```typescript
player.showChat({
    placeholder: "hello"
});
```

2. Show the chat bar with some prefilled text.
```typescript
player.showChat({
    prefill: "this is prefilled"
});
```

3. Show the chat bar with some prefilled text and a placeholder.
```typescript
player.showChat({
    prefill: "this is prefilled",
    placeholder: "hello"
});
```

### `player.hideChat()`


Hides the "chat bar" at the top of the screen in auxPlayer.

#### Examples:

1. Hide the chat bar.
```typescript
player.hideChat();
```

### `player.showHtml(html)`


Shows some HTML to the player in a popup modal. This can be useful for loading a separate webpage or providing some formatted text.

The **first parameter** is the HTML that should be shown to the user.

#### Examples:

1. Show a header with some text.
```typescript
player.showHtml(`
  <h1>This is some text!</h1>
`);
```

2. Show a YouTube video.
```typescript
player.showHtml(`
  <iframe
      width="560" 
      height="315"
      src="https://www.youtube.com/embed/BHACKCNDMW8"
      frameborder="0"
      allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
      allowfullscreen>
  </iframe>
`);
```

### `player.hideHtml()`


Closes the HTML popup modal.

#### Examples:

1. Hide the HTML popup.
```typescript
player.hideHtml();
```

### `player.share(options)`


Shares the given URL or text via the device's social share capabilities.
Returns a [Promise](https://web.dev/promises/) that resolves when sharing has succeeded or failed.

The **first parameter** is an object with at least one the following properties:
-   `url` - The URL that should be shared. (optional)
-   `text` - The text that should be shared. (optional)
-   `title` - The title of the document that is being shared. (optional)

#### Examples:

1. Share a URL.
```typescript
player.share({
    url: 'https://example.com'
});
```

2. Share some text.
```typescript
player.share({
    text: 'abcdefghijklmnopqrstuvwxyz'
});
```

### `player.toast(message, duration?)`


Shows a temporary "toast" notification to the player at the bottom of the screen with the given message.
Optionally accepts a duration parameter which is the number of seconds that the message should be on the screen.

The **first parameter** is the text that the toast message should show.

The **second parameter** is optional and is the number of seconds that the message should be on the screen. (Default is 2)

#### Examples:

1. Show a "Hello!" toast message.
```typescript
player.toast("Hello!");
```

2. Show the player a code for 5 seconds.
```typescript
player.toast("this is the code", 5);
```

### `player.tweenTo(bot, zoomValue?, rotX?, rotY?, duration?)`


Smoothly moves the player's view to center on the given bot. Optionally accepts target values for the zoom, rotation X, and rotation Y.
Additionally, a duration can be specified for the length of the tween. If the target bot is in the page portal, then the page portal view will be moved. 
If the bot is in the inventory portal, then the inventory portal view will be moved. If the target bot is not in either portal, then nothing happens.

The **first parameter** is the bot or bot ID that the player's view should be moved to.

The **second parameter** is optional and is the zoom value that the camera should be transitioned to. Possible values are between `0` and `Infinity`. `1` is the default.
If no value is specified, then the zoom will remain at its current value.

The **third parameter** is optional and is the X rotation value that the camera should be transitioned to.

The **fourth parameter** is optional and is the Y rotation value that the camera should be transitioned to.

The **fifth parameter** is optional and is the amount of time in seconds that the transition should take to finish.

#### Examples:

1. Transition the player's view to show a bot named bob.
```typescript
player.tweenTo(getBot("#name", "bob"))
```

### `player.moveTo(bot, zoomValue?, rotX?, rotY?)`


Instantly moves the player's view to center on the given bot. Optionally accepts target values for the zoom, rotation X, and rotation Y.
If the target bot is in the page portal, then the page portal view will be moved. If the bot is in the inventory portal, then the inventory portal view will be moved.
If the target bot is not in either portal, then nothing happens.

The **first parameter** is the bot or bot ID that the player's view should be moved to.

The **second parameter** is optional and is the zoom value that the camera should be transitioned to. Possible values are between `0` and `Infinity`. `1` is the default.
If no value is specified, then the zoom will remain at its current value.

The **third parameter** is optional and is the X rotation value that the camera should be transitioned to.
If no value is specified, then the X rotation will remain at its current value.

The **fourth parameter** is optional and is the Y rotation value that the camera should be transitioned to.
If no value is specified, then the Y rotation will remain at its current value.

#### Examples:

1. Move the player's view to show a bot named bob.
```typescript
player.moveTo(getBot("#name", "bob"))
```

### `player.openQRCodeScanner(camera?)`


Opens the [QR Code](https://en.wikipedia.org/wiki/QR_code) scanner. While open, each scanned QR Code will send a <TagLink tag='@onQRCodeScanned'/> shout.
Optionally accepts which camera to use for scanning. (front/back)

The **first parameter** is optional and is a string specifing which camera to use. Defaults to 'rear'.
If the given camera type is not available, then the default camera will be used.
Possible values are:

<PossibleValuesTable>
  <PossibleValueCode value='rear'>
    The rear-facing camera. (Default)
  </PossibleValueCode>
  <PossibleValueCode value='front'>
    The front-facing camera.
  </PossibleValueCode>
</PossibleValuesTable>

#### Examples:

1. Open the QR Code scanner.
```typescript
player.openQRCodeScanner();
```

2. Open the QR Code scanner for the front-facing camera.
```typescript
player.openQRCodeScanner("front");
```

### `player.closeQRCodeScanner(camera?)`


Closes the QR Code scanner.

#### Examples:

1. Close the QR Code scanner.
```typescript
player.closeQRCodeScanner();
```

### `player.showQRCode(code)`


Shows a [QR Code](https://en.wikipedia.org/wiki/QR_code) for the given data.

The **first parameter** is the text or data that the generated QR Code should represent.

#### Examples:

1. Show a QR Code that contains the data "hello".
```typescript
player.showQRCode("hello");
```

### `player.hideQRCode()`


Closes the QR Code popup modal.

#### Examples:

1. Hides the QR Code popup modal.
```typescript
player.hideQRCode();
```

### `player.showJoinCode(story?, dimension?)`


Shows a [QR Code](https://en.wikipedia.org/wiki/QR_code) with a link to join the given story and dimension.
If the story and dimension are omitted, then the current story and dimension will be used.

The **first parameter** is the story that the code should be shown for.

The **second parameter** is the dimension that the code should be shown for.

#### Examples:

1. Show a join QR Code.
```typescript
player.showJoinCode();
```

2. Show a join QR Code for a story and dimension.
```typescript
player.showJoinCode("story", "dimension");
```

### `player.openBarcodeScanner(camera?)`


Opens the [Barcode](https://en.wikipedia.org/wiki/Barcode) scanner. While open, each scanned Barcode will send a <TagLink tag='@onBarcodeScanned'/> shout.
Optionally accepts which camera to use for scanning. (front/back)

The **first parameter** is optional and is a string specifing which camera to use. Defaults to 'rear'.
If the given camera type is not available, then the default camera will be used.
Possible values are:

<PossibleValuesTable>
  <PossibleValueCode value='rear'>
    The rear-facing camera. (Default)
  </PossibleValueCode>
  <PossibleValueCode value='front'>
    The front-facing camera.
  </PossibleValueCode>
</PossibleValuesTable>

#### Examples:

1. Open the Barcode scanner.
```typescript
player.openBarcodeScanner();
```

2. Open the Barcode scanner for the front-facing camera.
```typescript
player.openBarcodeScanner("front");
```

### `player.closeBarcodeScanner(camera?)`


Closes the Barcode scanner.

#### Examples:

1. Close the Barcode scanner.
```typescript
player.closeBarcodeScanner();
```

### `player.showBarcode(code, format?)`


Shows a [Barcode](https://en.wikipedia.org/wiki/Barcode) for the given data. Optionally accepts the format that the barcode should be displayed in.

The **first parameter** is the text or data that the generated Barcode should represent.

The **second parameter** is optional and is the format that the barcode should be displayed in.
Possible values are:
<PossibleValuesTable>
  <PossibleValueCode value='code128'>
    The <a href="https://en.wikipedia.org/wiki/Code_128">Code 128</a> barcode format. (Default)
  </PossibleValueCode>
  <PossibleValueCode value='code39'>
    The <a href="https://en.wikipedia.org/wiki/Code_39">Code 39</a> barcode format.
  </PossibleValueCode>
  <PossibleValueCode value='ean13'>
    The <a href="https://en.wikipedia.org/wiki/International_Article_Number">EAN-13</a> barcode format.
  </PossibleValueCode>
  <PossibleValueCode value='ean8'>
    The <a href="https://en.wikipedia.org/wiki/International_Article_Number">EAN-8</a> barcode format.
  </PossibleValueCode>
  <PossibleValueCode value='upc'>
    The <a href="https://en.wikipedia.org/wiki/Universal_Product_Code">UPC</a> barcode format.
  </PossibleValueCode>
  <PossibleValueCode value='itf14'>
    The <a href="https://en.wikipedia.org/wiki/ITF-14">IFT-14</a> barcode format.
  </PossibleValueCode>
  <PossibleValueCode value='msi'>
    The <a href="https://en.wikipedia.org/wiki/MSI_Barcode">MSI</a> barcode format.
  </PossibleValueCode>
  <PossibleValueCode value='pharmacode'>
    The <a href="https://en.wikipedia.org/wiki/Pharmacode">Pharmacode</a> barcode format.
  </PossibleValueCode>
  <PossibleValueCode value='codabar'>
    The <a href="https://en.wikipedia.org/wiki/Codabar">Codabar</a> barcode format.
  </PossibleValueCode>
</PossibleValuesTable>

#### Examples:

1. Show a Barcode that contains the data "hello".
```typescript
player.showBarcode("hello");
```

1. Show a UPC Barcode that contains the data "123456".
```typescript
player.showBarcode("123456", 'upc');
```

### `player.hideBarcode()`


Closes the Barcode popup modal.

#### Examples:

1. Hides the Barcode popup modal.
```typescript
player.hideBarcode();
```

### `player.showInput(value?, options?)`


Shows an input modal with the given value and options.
When shown, the player will be able to change the value.

Returns a [Promise](https://web.dev/promises/) that resolves with the final value when the user is finished editing.
This function is similar to <ActionLink action='player.showInputForTag(bot, tag, options?)'/> except it doesn't require a bot and a tag.

The **first parameter** is optional  and is the value that should be shown in the input modal,

The **third parameter** is optional and is the possible cusomization options for the input modal.

#### Examples:

1. Show a basic text input modal and displays a toast message with the input value.
```typescript
const value = await player.showInput();
player.toast(value);
```

2. Show a text input modal with a placeholder.
```typescript
const name = await player.showInput(null, {
    placeholder: 'Enter a name'
});
player.toast(name);
```

3. Show a input modal with a custom title.
```typescript
const name = await player.showInput('My Name', {
    title: 'Edit name'
});
player.toast(name);
```

4. Show a color input modal with a custom title.
```typescript
const color = await player.showInput('green', {
    type: 'color',
    title: 'Enter a custom color'
});
player.toast(name);
```

### `player.showInputForTag(bot, tag, options?)`


Shows an input modal for the given bot and tag with the given options.
When shown, the player will be able to change the value stored in the given tag.
Triggers the <TagLink tag='@onSaveInput'/> whisper when the modal is closed with saving and the <TagLink tag='@onCloseInput'/> whisper when the modal is closed without saving.

The **first parameter** is the bot or bot ID that the input should be shown for,

The **second parameter** is the tag that should be edited on the bot.

The **third parameter** is optional and is the possible cusomization options for the input modal.

#### Examples:

1. Show a basic text input modal for the `#name` tag on this bot.
```typescript
player.showInputForTag(this, "name");
```

2. Show a text input modal with a placeholder for the `#name` tag.
```typescript
player.showInputForTag(this, "name", {
    placeholder: 'Enter a name'
});
```

3. Show a input modal with a custom title.
```typescript
player.showInputForTag(this, "name", {
    title: 'Edit name'
});
```

4. Show a color input modal with a custom title.
```typescript
player.showInputForTag(this, "color", {
    type: 'color',
    title: 'Enter a custom color'
});
```

### `player.setClipboard(text)`


Copies the given text to the player's clipboard. On Chrome and Firefox, this will act like a `Ctrl+C`/`Cmd+C`. 
On Safari and all iOS browsers this will open a popup which prompts the player to copy the text.

The **first parameter** is the text that should be copied to the player's clipboard.

#### Examples:

1. Copy "hello" to the player's clipboard.
```typescript
player.setClipboard("hello");
```

### `player.showUploadAuxFile()`


Shows the "Upload AUX File" dialog which lets the user select a `.aux` file to upload to the story.

#### Examples:

1. Show the "Upload AUX File" dialog.
```typescript
player.showUploadAuxFile();
```

### `player.loadStory(story)`


Loads the given univese into the current browser tab. When the story is loaded, the <TagLink tag='@onStorySubscribed'/> shout will be triggered.

Note that separate stories cannot interact directly. They must instead interact via super shouts.

The **first parameter** is the name of the story to load.

#### Examples:

1. Load the `fun` story.
```typescript
player.loadStory("fun");
```

### `player.unloadStory()`

Unloads the given story from the current browser tab. When the story is unloaded, the <TagLink tag='@onStoryUnsubscribed'/> shout will be triggered.

The **first parameter** is the name of the story to unload.

#### Examples:

1. Unload the `fun` story.
```typescript
player.unloadStory('fun');
```

### `player.downloadStory()`


Downloads all of the shared bots into a `.aux` file on the player's computer.
The file will have the same name as the story.

Note that this function is almost exactly the same as <ActionLink action='player.downloadBots(bots, filename)'/>.
The only difference is that all bots in the shared space are included and the file is named for you automatically.

#### Examples:

1. Download the entire story.
```typescript
player.downloadStory();
```

### `player.enableAR()`


Enables augmented reality on the device.

#### Examples:

1. Enable AR.
```typescript
player.enableAR();
```

### `player.disableAR()`


Disables augmented reality on the device.

#### Examples:

1. Disable AR.
```typescript
player.disableAR();
```

### `player.enableVR()`


Enables virtual reality on the device.

#### Examples:

1. Enable VR.
```typescript
player.enableVR();
```

### `player.disableVR()`


Disables virtual reality on the device.

#### Examples:

1. Disable VR.
```typescript
player.disableVR();
```

### `player.getCurrentStory()`


Gets the story that the player is in.

#### Examples:

1. Show a message of the current story.
```typescript
const story = player.getCurrentStory();
player.toast(story);
```

### `player.getCurrentDimension()`


Gets the dimension that is loaded into the <TagLink tag='pagePortal'/> portal.

<Alert type='info'>
    This function behaves exactly like <ActionLink action='player.getPortalDimension(portal)'/> when given "pagePortal".
</Alert>

#### Examples:

1. Show a message of the dimension that is currently in the <TagLink tag='pagePortal'/> portal.
```typescript
const dimension = player.getCurrentDimension();
player.toast(dimension);
```

### `player.getMenuDimension()`


Gets the dimension that is loaded into the <TagLink tag='menuPortal'/> portal.

<Alert type='info'>
    This function behaves exactly like <ActionLink action='player.getPortalDimension(portal)'/> when given "menuPortal".
</Alert>

#### Examples:

1. Show a message of the dimension that is currently in the <TagLink tag='menuPortal'/> portal.
```typescript
const dimension = player.getMenuDimension();
player.toast(dimension);
```

### `player.getInventoryDimension()`


Gets the dimension that is loaded into the <TagLink tag='inventoryPortal'/> portal.

<Alert type='info'>
    This function behaves exactly like <ActionLink action='player.getPortalDimension(portal)'/> when given "inventoryPortal".
</Alert>

#### Examples:

1. Show a message of the dimension that is currently in the <TagLink tag='inventoryPortal'/> portal.
```typescript
const dimension = player.getInventoryDimension();
player.toast(dimension);
```

### `player.hasBotInInventory(bot)`


Determines if the given bot is in the dimension that is currently loaded into the <TagLink tag='inventoryPortal'/> portal.

The **first parameter** is the bot that should be checked.

#### Examples:

1. Show a message if a bot named bob is in the inventory.
```typescript
const bob = getBot("#name", "bob");
if (player.hasBotInInventory(bob)) {
    player.toast("bob is in the inventory!");
}
```

### `player.getPortalDimension(portal)`


Gets the dimension that is loaded into the given portal.

The **first parameter** is the portal that the dimension should be retrieved for. 
Possible values are:

<PossibleValuesTable>
  <PossibleValueCode value='page'>
    The <TagLink tag='pagePortal'/>.
  </PossibleValueCode>
  <PossibleValueCode value='sheet'>
    The <TagLink tag='sheetPortal'/>.
  </PossibleValueCode>
  <PossibleValueCode value='inventory'>
    The <TagLink tag='inventoryPortal'/>.
  </PossibleValueCode>
  <PossibleValueCode value='menu'>
      The <TagLink tag='menuPortal'/>.
  </PossibleValueCode>
</PossibleValuesTable>

#### Examples:

1. Get the dimension that is currently showing in the <TagLink tag='pagePortal'/>.
```typescript
const dimension = player.getPortalDimension('page');
```

2. Get the dimension that is currently showing in the <TagLink tag='inventoryPortal'/>.
```typescript
const dimension = player.getPortalDimension('inventory');
```

3. Get the dimension that is currently showing in the `#auxCustomPortal` tag.
```typescript
const dimension = player.getPortalDimension('auxCustomPortal');
```

### `player.getDimensionalDepth(dimension)`


Gets the distance that the player bot is from the given dimension.

The **first parameter** is the dimension that should be searched for.

Possible return values are:

<PossibleValuesTable>
  <PossibleValueCode value='-1'>
    The player bot cannot access the given dimension.
  </PossibleValueCode>
  <PossibleValueCode value='0'>
    The player bot is in the given dimension. (dimension tag is true)
  </PossibleValueCode>
  <PossibleValueCode value='1'>
    The player bot is viewing the given dimension through a portal. (a portal tag is set to the dimension)
  </PossibleValueCode>
</PossibleValuesTable>

#### Examples:

1. Get the distance to the "fun" dimension.
```typescript
const distance = player.getDimensionalDepth("fun");
if (distance === 0) {
    player.toast("Player is in the fun dimension");
} else if(distance === 1) {
    player.toast("Player is viewing the fun dimension");
} else {
    player.toast("Player cannot access the fun dimension");
}
```

### `player.getBot()`


Gets the player bot. This is the bot that represents the player's browser tab.

#### Examples:

1. Get the player bot and set a username on it.
```typescript
const playerBot = player.getBot();
playerBot.tags.username = "bob";
```

2. Open the sheet to "testDimension".
```typescript
const playerBot = player.getBot();
playerBot.tags.sheetPortal = "testDimension";
```

### `player.getCameraPosition(portal?)`

Gets the 3D position that the player's camera is at in the given portal.

The **first parameter** is optional and is the portal that the camera position should be retrieved for.
Possible values are:

<PossibleValuesTable>
  <PossibleValueCode value='page'>
    The camera position in the page portal. (Default)
  </PossibleValueCode>
  <PossibleValueCode value='inventory'>
    The camera position in the inventory portal.
  </PossibleValueCode>
</PossibleValuesTable>

#### Examples:

1. Get the position of the player in the page portal.
```typescript
const position = player.getCameraPosition("page");
```

2. Get the position of the player in the inventory portal.
```typescript
const position = player.getCameraPosition("inventory");
```

### `player.getCameraRotation(portal?)`

Gets the 3D rotation that the player's camera is at in the given portal.

The **first parameter** is optional and is the portal that the camera rotation should be retrieved for.
Possible values are:

<PossibleValuesTable>
  <PossibleValueCode value='page'>
    The camera rotation in the page portal. (Default)
  </PossibleValueCode>
  <PossibleValueCode value='inventory'>
    The camera rotation in the inventory portal.
  </PossibleValueCode>
</PossibleValuesTable>

#### Examples:

1. Get the rotation of the player in the page portal.
```typescript
const rotation = player.getCameraRotation("page");
```

2. Get the rotation of the player in the inventory portal.
```typescript
const rotation = player.getCameraRotation("inventory");
```

### `player.getPointerPosition(pointer?)`

Gets the position that the given pointer is at.

The **first parameter** is optional and is the pointer that the position should be retrieved for.
Possible values are:

<PossibleValuesTable>
  <PossibleValueCode value='mouse'>
    The position of the mouse pointer. (Default)
  </PossibleValueCode>
  <PossibleValueCode value='left'>
    The position of the left pointer.
  </PossibleValueCode>
  <PossibleValueCode value='right'>
    The position of the right pointer.
  </PossibleValueCode>
</PossibleValuesTable>

#### Examples:

1. Get the position of the mouse pointer.
```typescript
const position = player.getPointerPosition("mouse");
```

2. Get the position of the left pointer.
```typescript
const position = player.getPointerPosition("left");
```

### `player.getPointerRotation(pointer?)`

Gets the rotation that the given pointer is at.

The **first parameter** is optional and is the pointer that the rotation should be retrieved for.
Possible values are:

<PossibleValuesTable>
  <PossibleValueCode value='mouse'>
    The rotation of the mouse pointer. (Default)
  </PossibleValueCode>
  <PossibleValueCode value='left'>
    The rotation of the left pointer.
  </PossibleValueCode>
  <PossibleValueCode value='right'>
    The rotation of the right pointer.
  </PossibleValueCode>
</PossibleValuesTable>

#### Examples:

1. Get the rotation of the mouse pointer.
```typescript
const rotation = player.getPointerRotation("mouse");
```

2. Get the rotation of the left pointer.
```typescript
const rotation = player.getPointerRotation("left");
```

### `player.getInputState(controller, button)`

Gets the state of the given button on the given controller.

The **first parameter** is the name of the controller that the button state should be retrieved from.
Possible values are:

<PossibleValuesTable>
  <PossibleValueCode value='mousePointer'>
    The mouse.
  </PossibleValueCode>
  <PossibleValueCode value='leftPointer'>
    The left controller. Sometimes available in VR.
  </PossibleValueCode>
  <PossibleValueCode value='rightPointer'>
    The right controller. Sometimes available in VR.
  </PossibleValueCode>
  <PossibleValueCode value='keyboard'>
    The keyboard.
  </PossibleValueCode>
  <PossibleValueCode value='touch'>
    The touchscreen.
  </PossibleValueCode>
</PossibleValuesTable>

The **second parameter** is the name of the button that you want to get the state of.
Possible values are:

<PossibleValuesTable>
  <PossibleValueCode value='left'>
    The left mouse button. Only available on the mouse pointer.
    On mobile devices this will also be the state of the first touch.
  </PossibleValueCode>
  <PossibleValueCode value='right'>
    The right mouse button. Only available on the mouse pointer.
  </PossibleValueCode>
  <PossibleValueCode value='middle'>
    The middle mouse button. Only available on the mouse pointer.
  </PossibleValueCode>
  <PossibleValueCode value='primary'>
    The primary controller button. Only available on the left and right pointers.
  </PossibleValueCode>
  <PossibleValueCode value='squeeze'>
    The squeeze controller button. Only available on the left and right pointers.
  </PossibleValueCode>
  <PossibleValue value='Any Key'>
    The button for the given key. Only available on the keyboard.
  </PossibleValue>
  <PossibleValueCode value='0'>
    The first touch. Only available on the touchscreen.
  </PossibleValueCode>
  <PossibleValueCode value='1'>
    The second touch. Only available on the touchscreen.
  </PossibleValueCode>
  <PossibleValueCode value='2'>
    The third touch. Only available on the touchscreen.
  </PossibleValueCode>
  <PossibleValueCode value='3'>
    The fourth touch. Only available on the touchscreen.
  </PossibleValueCode>
  <PossibleValueCode value='5'>
    The fifth touch. Only available on the touchscreen.
  </PossibleValueCode>
</PossibleValuesTable>

#### Examples:

1. Send a toast if the left mouse button is clicked.
```typescript
const state = player.getInputState("mousePointer", "left");
if (state) {
    player.toast("Left mouse button is down!");
}
```

2. Send a toast if the shift key is down.
```typescript
const state = player.getInputState("keyboard", "Shift");
if (state) {
    player.toast("Shift is down!");
}
```

### `player.getInputList()`

Gets the list of supported inputs. The returned strings can be used for the `controller` property in <ActionLink action='player.getInputState(controller, button)'/> calls.

#### Examples:

1. Get a list of inputs and toast them.
```typescript
const state = player.getInputList();
player.toast(state);
```

### `player.goToDimension(dimension)`


Loads the given dimension into the <TagLink tag='pagePortal'/> portal.
Triggers the <TagLink tag='@onPlayerPortalChanged'/> shout.

The **first parameter** is the dimension that should be loaded.

#### Examples:

1. Load the `abc` dimension.
```typescript
player.goToDimension('abc');
```

### `player.goToURL(url)`


Redirects the current tab to the given URL. Useful for sending the player to another webpage or ambient experience.

The **first parameter** is the [URL](https://en.wikipedia.org/wiki/URL) that the player should be sent to. Usually this is a website like `https://example.com`.

#### Examples:

1. Send the player to `https://example.com`.
```typescript
player.goToURL("https://example.com");
```

### `player.openURL(url)`


Opens a new tab with the given URL. Useful for opening another webpage without redirecting the current tab.

The **first parameter** is the [URL](https://en.wikipedia.org/wiki/URL) that should be loaded. Usually this is a website like `https://example.com`.

#### Examples:

1. Open `https://example.com` in a new tab.
```typescript
player.openURL("https://example.com");
```

### `player.openDevConsole()`


Opens the developer console which contains a list of errors that scripts have issued.

#### Examples:

1. Open the developer console.
```typescript
player.openDevConsole();
```

### `player.playSound(url)`


Loads and plays the audio (MP3, WAV, etc.) from the given URL.

The **first parameter** is the [URL](https://en.wikipedia.org/wiki/URL) of the audio/music/sound clip that should be played.

#### Examples:

1. Play a MP3 file from another website.
```typescript
player.playSound("https://www.testsounds.com/track06.mp3");
```

### `player.isInDimension(dimension)`


Gets whether the given dimension is loaded into the <TagLink tag='pagePortal'/> portal.

The **first parameter** is the dimension to check for.

#### Examples:

1. Show a toast if the player is viewing the `abc` dimension.
```typescript
if (player.isInDimension("abc")) {
    player.toast("In the dimension!");
}
```

### `player.inSheet()`


Gets whether the player is in the sheet dimension.

#### Examples:

1. Show a toast if the player is viewing the sheet.
```typescript
if (player.inSheet()) {
    player.toast("You are in the sheet!");
}
```

### `player.importAUX(urlOrJSON)`


Imports an AUX file from the given string.

If the string contains JSON, then the JSON will be imported as if it was a .aux file.
If the string is a [URL](https://en.wikipedia.org/wiki/URL), then it will be downloaded and imported.

This is useful to quickly download a AUX file and load it into the current story from a site such as https://gist.github.com/.

The **first parameter** is the JSON or URL that the AUX file should be imported from.

#### Examples:

1. Import an AUX file from a file.
```typescript
const path = '/drives/myFile.aux';
player.importAUX(path);
```

2. Import an AUX file from JSON.
```typescript
player.importAUX(`{
    "version": 1,
    "state": {
        "079847e4-6a58-423d-9a86-8d4ef8be5970": {
            "id": "079847e4-6a58-423d-9a86-8d4ef8be5970",
            "tags": {
                "color": "red"
            }
        }
    }
}`);
```

### `player.version()`


Gets information about the version of auxPlayer.

The returned value is an object with the following properties:

```typescript
const returned: {
    hash: string;
    version: string;
    major: number;
    minor: number;
    patch: number;
};
```

#### Examples:

1. Get the current version and popup a message with it.
```typescript
const info = player.version();
player.toast(info.version);
```

### `player.device()`


Gets information about the device that the player is using.

The returned value is an object with the following properties:

```typescript
const returned: {
    supportsAR: boolean;
    supportsVR: boolean;
};
```

#### Examples:

1. Get the device info and popup a message with it.
```typescript
const info = player.device();
player.toast(info);
```

### `player.requestFullscreenMode()`


Attempts to enter fullscreen mode. Depending on which web browser the player is using, this might ask for permission to go fullscreen.

Note that iPhones currently don't support fullscreen mode.

#### Examples:

1. Enter fullscreen mode.
```typescript
player.requestFullscreenMode();
```

### `player.exitFullscreenMode()`


Exists fullscreen mode.

#### Examples:

1. Exit fullscreen mode.
```typescript
player.exitFullscreenMode();
```

## Server Actions

### `server.backupToGithub(auth)`


Saves all the stories to GitHub as a private Gist using the given authentication token.

Just like <ActionLink action='server.shell(script)'/>, you need 

The **first parameter** is the Github Personal Access Token that should be used to grant access to your Github account.
See https://help.github.com/en/articles/creating-a-personal-access-token-for-the-command-line

<Alert type='info'>
    By default, backing up to GitHub is disabled on a story.
    To enable it, you have to write a custom <TagLink tag='@onStoryAction'/> listener on the config bot and run an <ActionLink action='action.perform(action)'/>.
</Alert>

#### Examples:

1. Backup all the stories to a Github Gist.
```typescript
server.backupToGithub('your auth token');
```

### `server.backupAsDownload(target)`


Saves all the stories to a zip file and downloads it to the session matching the given target.

The **first parameter** is an object that indicates which session the zip file should be downloaded to.

<Alert type='info'>
    By default, backing up as a download is disabled on a story.
    To enable it, you have to write a custom <TagLink tag='@onStoryAction'/> listener on the config bot and run an <ActionLink action='action.perform(action)'/>.
</Alert>

#### Examples:

1. Backup and download to this tab.
```typescript
server.backupAsDownload({
    session: getID(player.getBot())
});
```

### `server.finishCheckout(options)`

Finishes the checkout process by charging payment to the player.
Best used during the <TagLink tag='@onCheckout'/> shout.

The **first parameter** are the options needed to finish the checkout process.

#### Examples:

1. Finish the checkout process.
```typescript
server.finishCheckout({
    secretKey: 'YOUR_SECRET_API_KEY',
    
    token: 'token from onCheckout',

    // 1000 cents == $10.00
    amount: 1000,
    currency: 'usd',
    description: 'Description for purchase'
});
```

### `server.setupStory(story, botOrMod?)`


Sends an action to the server that will create the given story if it does not exist and places a clone of the given bot or mod in it.
The new bot will only be added to the story if the story did not exist.
The action is only executed if <TagLink tag='@onStoryAction'/> has been configured to perform events in `device` actions.

Returns a promise that resolves when the story has been setup.

The **first parameter** is the ID of the story that should be setup.

The **second parameter** is optional and is the bot or mod that should be cloned into the new story. After the bot is created, <TagLink tag='@onCreate'/> will be triggered.

#### Examples:

Before `server.setupStory()` will work, you need to setup the <TagLink tag='@onStoryAction'/> tag to execute events from remote devices.
This is because when you run `server.setupStory()` from a PC or phone (a.k.a. A "remote device"), it needs to send an event to the server to actually create the new story.
By default, AUX does not perform actions that are received from a remote device. You must instruct AUX to execute these yourself.

Ensure that <TagLink tag='@onStoryAction'/> is setup properly.
The following script will execute `setup_story` events that were sent from other devices:
```typescript
// Device actions are actions that were sent to this computer from another device
if (that.action.type === 'device') {

    // The setup_story action is the action that is created
    // from server.setupStory()
    if (that.action.event.type === 'setup_story') {

        // Execute the setup_story action
        action.perform(that.action.event);
    }
}
```

1. Create the "test" story:
```typescript
await server.setupStory("test");
```

2. Create the "test" story with a bot inside it:
```typescript
await server.setupStory("test", {
    "name": "bob",
    "color": "red"
});
```

3. Create the "test" story with a bot that places a bot in the "abc" dimension:
```typescript
await server.setupStory("test", {
    "onCreate": `@
        create({
            creator: null,
            label: "This is in the dimension!",
            color: "blue",
            abc: true
        });

        destroy(this);
    `
});
```

### `server.exportGpio(pin, mode)`


This exports a GPIO pin (BCM) on the physical server so that you can access them as inputs or outputs.
The action is only executed if <TagLink tag='@onStoryAction'/> has been configured to perform events in `device` actions.

Returns a promise that resolves when the pin has been exported.

The **first parameter** is the pin (BCM) on the physical server.

The **second parameter** is 'in' or 'out' to set the pin (BCM) as an input pin or an output pin.

#### Examples:

1. Export pin 17 as output.
```typescript
let led_pin = 17;

server.exportGpio(led_pin, 'out');
```

### `server.unexportGpio(pin, mode)`


This unexports a GPIO pin (BCM) on the physical server so that it's freed up once you're done with it.
The action is only executed if <TagLink tag='@onStoryAction'/> has been configured to perform events in `device` actions.

Returns a promise that resolves when the pin has been unexported.

The **first parameter** is the pin (BCM) on the physical server.

#### Examples:

1. Unexport pin 17.
```typescript
let led_pin = 17;

server.exportGpio(led_pin, 'out');

server.unexportGpio(led_pin);
```

### `server.setGpio(pin, value)`


This sets a GPIO pin (BCM) on the physical server to either HIGH (1) or LOW (0).
The action is only executed if <TagLink tag='@onStoryAction'/> has been configured to perform events in `device` actions.

Returns a promise that resolves when the pin has been set.

The **first parameter** is the pin (BCM) on the physical server.

The **second parameter** is '0' or '1' to set the pin (BCM) as an HIGH or LOW.

#### Examples:

1. Set pin 17 to LOW or 0.
```typescript
let led_pin = 17;

server.exportGpio(led_pin, 'out');
server.setGpio(led_pin, 0);
```

### `server.getGpio(pin)`


This reads a given GPIO pin (BCM) and returns the state/value of the pin.
The action is only executed if <TagLink tag='@onStoryAction'/> has been configured to perform events in `device` actions.

Returns a promise that resolves when the pin has been read.

The **first parameter** is the pin (BCM) on the physical server.

#### Examples:

1. Shouts the state of pin 17.
```typescript
let led_pin = 17;

server.exportGpio(led_pin, 'out');
let state = await server.getGpio(led_pin);
player.shout(state);

```

### `server.rpioInit(options)`


Initialise the bcm2835 library. This will be called automatically by `.open()` using the default option values if not called explicitly.  
The action is only executed if <TagLink tag='@onStoryAction'/> has been configured to perform events in `device` actions.

Returns a promise that resolves when rpio has been initialized.

The **first parameter** is an object with the settings to initialize with.

**gpiomem** can be either `true` or `false`.
**mapping** can be either `gpio` or `physical`.
**mock** can be any of `raspi-b-r1` or `raspi-a` or `raspi-b` or `raspi-a+` or `raspi-b+` or `raspi-2` or `raspi-3` or `raspi-zero` or `raspi-zero-w`.
**close_on_exit** can be `true` or `false`. It is recommended to always be `true`.


#### Examples:

1. Initialize rpio with the default options explicitly stated.
```typescript
let options = {
        gpiomem: true,          /* Use /dev/gpiomem */
        mapping: 'physical',    /* Use the P1-P40 numbering scheme */
        mock: undefined,        /* Emulate specific hardware in mock mode */
        close_on_exit: true,    /* On node process exit automatically close rpio */
}

server.rpioInit(options);
```

### `server.rpioExit()`


Shuts down the rpio library, unmapping and clearing all memory maps. By default this will happen automatically.
The action is only executed if <TagLink tag='@onStoryAction'/> has been configured to perform events in `device` actions.

Returns a promise that resolves when rpio has been exited.

#### Examples:

1. Manually cleanup rpio.
```typescript
server.rpioExit();
```

### `server.rpioOpen(pin, mode, options)`


Open a pin for input or output.
For input pins, `options` can be used to configure the internal pullup or pulldown resistors.
For output pins, `options` defines the initial state of the pin, rather than having to issue a separate `.write()` call. 
The action is only executed if <TagLink tag='@onStoryAction'/> has been configured to perform events in `device` actions.

Returns a promise that resolves when the pin has been configured.

The **first parameter** is the pin on the physical server.

The **second parameter** is 'INPUT', 'OUTPUT', or 'PWM' to set the pin as an input pin, an output pin, or for use with PWM.

The **third parameter** is optional and either 'HIGH', 'LOW', 'PULL_OFF', 'PULL_DOWN', or 'PULL_UP' to set the pin state.

#### Examples:

1. Configure pin 11 as output.
```typescript
let led_pin = 11;
server.rpioOpen(led_pin, 'OUTPUT');
```

2. Configure pin 11 as output and initialize the pin as 'LOW'.
```typescript
let led_pin = 11;
server.rpioOpen(led_pin, 'OUTPUT', 'LOW');
```

3. Configure pin 11 as input and initialize the pin as 'PULL_DOWN'.
```typescript
let led_pin = 11;
server.rpioOpen(led_pin, 'INPUT', 'PULL_DOWN');
```

### `server.rpioMode(pin, mode, options)`


Switch a pin that has already been opened in one mode to a different mode. 
This is provided primarily for performance reasons, as it avoids some of the setup work done by `.open()`. 
The action is only executed if <TagLink tag='@onStoryAction'/> has been configured to perform events in `device` actions.

Returns a promise that resolves when the pin has been configured.

The **first parameter** is the pin on the physical server.

The **second parameter** is 'INPUT', 'OUTPUT', or 'PWM' to set the pin as an input pin, an output pin, or for use with PWM.

The **third parameter** is optional and either 'HIGH', 'LOW', 'PULL_OFF', 'PULL_DOWN', or 'PULL_UP' to set the pin state.

#### Examples:

1. Change pin 11 mode to output and initialize the pin as 'LOW'.
```typescript
let led_pin = 11;
server.rpioOpen(led_pin, 'INPUT');
server.rpioMode(led_pin, 'OUTPUT', 'LOW');
```

2. Change pin 11 mode to input and initialize the pin as 'PULL_DOWN'.
```typescript
let led_pin = 11;
server.rpioOpen(led_pin, 'OUTPUT');
server.rpioMode(led_pin, 'INPUT', 'PULL_DOWN');
```

### `server.rpioRead(pin)`


Read the current value of pin, returning either `1` (high) or `0` (low).
The action is only executed if <TagLink tag='@onStoryAction'/> has been configured to perform events in `device` actions.

Returns a promise that resolves when the pin has been read.

The **first parameter** is the pin on the physical server.

#### Examples:

1. Shout the state of pin 11.
```typescript
var led_pin = 11;

server.rpioOpen(led_pin, 'OUTPUT');
let state = await server.rpioRead(led_pin);

player.shout(state);

```

### `server.rpioReadSequence(pin, length)`

Read length bits from pin into buffer as fast as possible.
This is useful for devices which send out information faster than the JavaScript function call overhead can handle, e.g. if you need microsecond accuracy. 
The action is only executed if <TagLink tag='@onStoryAction'/> has been configured to perform events in `device` actions.

Returns a promise that resolves when the pin has been read.

The **first parameter** is the pin on the physical server.

The **second parameter** is the length of the buffer to read.

#### Examples:

1. Read the value of Pin 16 10 times in a row
```typescript
server.rpioReadSequence(16, 10);
```

### `server.rpioWrite(pin, value)`


Set the specified pin either high or low.
The action is only executed if <TagLink tag='@onStoryAction'/> has been configured to perform events in `device` actions.

Returns a promise that resolves when the pin has been set.

The **first parameter** is the pin on the physical server.

The **second parameter** is 'HIGH' or 'LOW' to set the pin as an HIGH or LOW.

#### Examples:

1. Set pin 11 to HIGH.
```typescript
var led_pin = 11;

server.rpioOpen(led_pin, 'OUTPUT', 'LOW');
server.rpioWrite(led_pin, 'HIGH');
```

### `server.rpioWriteSequence(pin, buffer)`


Write length bits to pin from buffer as fast as possible.
The action is only executed if <TagLink tag='@onStoryAction'/> has been configured to perform events in `device` actions.

Returns a promise that resolves when the pin has been written to.

The **first parameter** is the pin on the physical server.

The **second parameter** is array of numbers.

#### Examples:

1. Write a sequence of numbers to Pin 13 
```typescript

server.rpioWriteSequence(13, [10, 10]);

```

### `server.rpioClose(pin, options)`


Indicate that the pin will no longer be used, and clear any poll events associated with it.
The action is only executed if <TagLink tag='@onStoryAction'/> has been configured to perform events in `device` actions.

Returns a promise that resolves when the pin has been closed.

The **first parameter** is the pin on the physical server.

The **second parameter** is 'PIN_RESET' or 'PIN_PRESERVE' and can be used to configure the state that pin will be left in after close.

#### Examples:

1. Close pin 11 and let the state reset by default.
```typescript
var led_pin = 11;
server.rpioOpen(led_pin, 'OUTPUT', 'LOW');
server.rpioClose(led_pin);
```

2. Close pin 11 and preserve the state.
```typescript
var led_pin = 11;
server.rpioOpen(led_pin, 'OUTPUT', 'LOW');
server.rpioClose(led_pin, 'PIN_PRESERVE');
```

### `server.rpioPWMSetClockDivider()`

Set the PWM refresh rate.
This is a power-of-two divisor of the base 19.2MHz rate, with a maximum value of 4096 (4.6875kHz).
The action is only executed if <TagLink tag='@onStoryAction'/> has been configured to perform events in `device` actions.

Returns a promise that resolves when rpio has been exited.

#### Examples:

1. Set PWM refresh rate to 300kHz
```typescript
server.rpioOpen(12, 'PWM');
server.rpioPWMSetClockDivider(64);
```

### `server.rpioPWMSetRange()`

Set the PWM range for a pin.
This determines the maximum pulse width.
The action is only executed if <TagLink tag='@onStoryAction'/> has been configured to perform events in `device` actions.

Returns a promise that resolves when rpio has been exited.

#### Examples:

1. Set the max width to 1024.
```typescript
server.rpioOpen(12, 'PWM');
server.rpioPWMSetRange(12, 1024);
```

### `server.rpioPWMSetData()`

Set the PWM width for a pin.
The action is only executed if <TagLink tag='@onStoryAction'/> has been configured to perform events in `device` actions.

Returns a promise that resolves when rpio has been exited.

#### Examples:

1. Set the current width to 512.
```typescript
server.rpioOpen(12, 'PWM');
server.rpioPWMSetData(12, 512);
```

### `server.rpioSPIBegin()`

Initiate SPI mode.
Once SPI is enabled, the SPI pins are unavailable for GPIO use until `server.rpioSPIEnd()` is called.
SPI requires `gpiomem: false` and root privileges. 
`server.rpioSPIBegin()` will call `server.rpioInit()` with the appropriate values if you do not explicitly call it yourself.
The action is only executed if <TagLink tag='@onStoryAction'/> has been configured to perform events in `device` actions.

Returns a promise that resolves when SPI mode has been initiated.

#### Examples:

1. Initiate SPI mode.
```typescript
server.rpioSPIBegin();
```

### `server.rpioSPIChipSelect()`

Choose which of the chip select / chip enable pins to control.
Value | Pin
------|---------------------
  0   | SPI_CE0 (24 / GPIO8)
  1   | SPI_CE1 (26 / GPIO7)
  2   | Both
The action is only executed if <TagLink tag='@onStoryAction'/> has been configured to perform events in `device` actions.

Returns a promise that resolves when SPI pin(s) have been enabled.

#### Examples:

1. Enable SPI_CE0.
```typescript
server.rpioSPIChipSelect(0);
```

### `server.rpioSPISetCSPolarity()`

If your device's CE pin is active high, use this to change the polarity.

Value | Pin
------|---------------------
  0   | SPI_CE0 (24 / GPIO8)
  1   | SPI_CE1 (26 / GPIO7)
  2   | Both

Setting the polarity to 'HIGH' means it will activate on 'HIGH'.
Setting the polarity to 'LOW' means it will activate on 'LOW'.
The action is only executed if <TagLink tag='@onStoryAction'/> has been configured to perform events in `device` actions.

Returns a promise that resolves when polarity has been set.

#### Examples:

1. Set SPI_CE0 HIGH to activate.
```typescript
server.rpioSPISetCSPolarity(0, 'HIGH');
```

### `server.rpioSPISetClockDivider()`

Set the SPI clock speed.
The rate is an even divisor of the base 250MHz rate ranging between 0 and 65536.
The action is only executed if <TagLink tag='@onStoryAction'/> has been configured to perform events in `device` actions.

Returns a promise that resolves when the clock speed has been set.

#### Examples:

1. Set SPI speed to 1.95MHz
```typescript
server.rpioSPISetClockDivider(128);
```

### `server.rpioSPISetDataMode()`

Set the SPI Data Mode.

Mode | CPOL | CPHA
-----|------|-----
  0  |  0   |  0
  1  |  0   |  1
  2  |  1   |  0
  3  |  1   |  1

The action is only executed if <TagLink tag='@onStoryAction'/> has been configured to perform events in `device` actions.

Returns a promise that resolves when a data mode has been set.

#### Examples:

1. Set the data mode to 0.
```typescript
server.rpioSPISetDataMode(0);
```

### `server.rpioSPITransfer()`

Send and recieve data via SPI. 
The action is only executed if <TagLink tag='@onStoryAction'/> has been configured to perform events in `device` actions.

Returns a buffer the same size as the buffer sent.

#### Examples:

1. Send the bytes [0x01, 0x01] and recieve the response from the server.
```typescript
server.rpioSPITransfer([1,1]);
```

### `server.rpioSPIWrite()`

Send data via SPI.
The action is only executed if <TagLink tag='@onStoryAction'/> has been configured to perform events in `device` actions.

Returns a promise that resolves when the buffer has been sent.

#### Examples:

1. Send the bytes [0x01, 0x01].
```typescript
server.rpioSPIWrite([1,1]);
```

### `server.rpioSPIEnd()`

Release the pins back to general purpose use.
The action is only executed if <TagLink tag='@onStoryAction'/> has been configured to perform events in `device` actions.

Returns a promise that resolves when the clock speed has been set.

#### Examples:

1. Release the pins back to general purpose use.
```typescript
server.rpioSPIEnd();
```

### `server.browseHistory()`


Loads the `history` space into the current story.
The `history` space is read-only and contains all the marks that have been created for the story.
Each mark is a bot that is placed in the `#history` dimension.

Returns a promise that resolves when the history bots are loaded.

#### Examples:

1. Load the `history` space.
```typescript
await server.browseHistory();
```

### `server.markHistory(options)`


Marks the current state as a save point in history. This save point can be restored by using the <ActionLink action='server.restoreHistoryMark(mark)'/> action.
Note that this only saves bots in the `shared` space. `local` and `tempLocal` bots are unaffected.

Returns a promise that resolves when the history mark has been created.

The **first parameter** are the options that should be used to mark the history point.
It should be an object with the following properties:
- `message` - The message that the new mark should have. Use this as a way to communicate what was special about this save point.

#### Examples:

1. Save the current state of the `shared` space.
```typescript
await server.markHistory({
    message: 'First Version of my AUX'
});
```

### `server.restoreHistoryMark(mark)`


Restores the current state to the state that was saved by the given mark.
This will create a new mark with any unsaved changes and another mark with the state that was saved by the given mark.

Returns a promise that resolves when the history mark has been restored.

The **first parameter** is the bot or bot ID of the mark that should be restored. You can find available marks in the current story by using the <ActionLink action='server.browseHistory()'/> action.

#### Examples:

1. Restore the state to a given mark.
```typescript
// Find a random mark that was loaded by server.browseHistory()
let mark = getBot(byTag("#history", true));

// Restore the current state to the given mark.
await server.restoreHistoryMark(mark);
```

### `server.restoreHistoryMarkToStory(mark, story)`


Restores the state in the given story to the state that was saved by the given mark.
This will create a new mark with any unsaved changes in the story and another mark with the state that was saved by the given mark.

Returns a promise that resolves when the history mark has been restored.

The **first parameter** is the bot or bot ID of the mark that should be restored. You can find available marks in the current story by using the <ActionLink action='server.browseHistory()'/> action.

The **second parameter** is the story that the state should be restored to. If `null` or an empty string, then the current story will be restored.

#### Examples:

1. Restore the state of the `test` story to a given mark.
```typescript
// Find a random mark that was loaded by server.browseHistory()
let mark = getBot(byTag("#history", true));

// Restore the current state to the given mark.
await server.restoreHistoryMarkToStory(mark, "test");
```

### `server.shell(script)`


Executes the given script on the server.

The **first parameter** is the shell script that should be executed.

<Alert type='info'>
    By default, shell scripts are disabled on a story.
    To enable them, you have to write a custom <TagLink tag='@onStoryAction'/> listener on the config bot and run an <ActionLink action='action.perform(action)'/>.
</Alert>

### `server.loadFile(path, options?)`


Loads a file from the server at the given path.

Note that on a Raspberry PI, all USB storage devices are mapped into the `/drives` directory based on the port they were plugged into.
Loading a file from a USB drive is as simple as specifying the file name.
If multiple USB drives are plugged in and have files with the same name, then the file from the USB drive in the smallest numbered port is used.

Returns a promise that resolves with the data in the file.

The **first parameter** is the path that the file should be loaded from. This is usually just the full name of the file to load. (name + file extension)

The **second parameter** are the options that should be used for loading the file.

<Alert type='info'>
    By default, loading files is disabled on a story.
    To enable it, you have to write a custom <TagLink tag='@onStoryAction'/> listener on the config bot and run an <ActionLink action='action.perform(action)'/>.
</Alert>

#### Examples:

1. Load a file named "book.txt" and trigger a `@onBookLoaded` shout when it is loaded.
```typescript
server.loadFile('book.txt', {
    callbackShout: 'onBookLoaded'
});
```

2. Load a file named "book.txt" from drive `2` and trigger a `@onBookLoaded` shout when it is loaded.
```typescript
server.loadFile('/2/book.txt', {
    callbackShout: 'onBookLoaded'
});
```

3. Load a file named "book.txt" and toast the contents.
```typescript
const result = await server.loadFile('book.txt');
player.toast(result.data);
```

### `server.saveFile(path, data, options?)`


Saves a file at the given path with the given data.
If the file already exists, then the options are used to determine if the file should be overwritten. By default the file will not be overwritten.

Note that on a Raspberry PI, all USB storage devices are mapped into the `/drives` directory based on the port they were plugged into.
Saving a file to a USB drive is as simple as specifying the file name.
If multiple USB drives are plugged in and a drive is not specified, then the file will be saved to the first drive.

Returns a promise that resolves when the file has been saved.

The **first parameter** is the path that the file should be saved to. This is usually just the full name of the file to save. (name + file extension)

The **second parameter** is the data that should be saved into the file.

The **third parameter** are the options that should be used for saving the file.

<Alert type='info'>
    By default, saving files is disabled on a story.
    To enable it, you have to write a custom <TagLink tag='@onStoryAction'/> listener on the config bot and run an <ActionLink action='action.perform(action)'/>.
</Alert>

#### Examples:

1. Save a file named "book.txt" and trigger a `@onBookSaved` shout when it is saved.
```typescript
server.saveFile('book.txt', 'My memoirs', {
    callbackShout: 'onBookSaved'
});
```

2. Save a file named "book.txt" to drive `2` and trigger a `@onBookSaved` shout when it is loaded.
```typescript
server.saveFile('/2/book.txt', 'My memoirs', {
    callbackShout: 'onBookSaved',
    overwriteExistingFile: true
});
```

3. Save a file named "book.txt" and send a toast when it is finished.
```typescript
await server.saveFile('/2/book.txt', 'My memoirs', {
    overwriteExistingFile: true
});

player.toast("File Saved!");
```

### `server.loadErrors(bot, tag)`

Loads the errors for the given bot and tag.
Note that the bots don't load immediately. They will automatically be added to the story state once they have been loaded.

Can be called multiple times for the same bot/tag combination to load errors that have been created since the last time they were loaded.

Finds bots by searching the error space for bots with the following tags:

-   `error` must be set to true.
-   `errorBot` must be the ID of the bot that was specified.
-   `errorTag` must be the tag that was specified.

Returns a promise that resolves with the list of bots that were loaded.

The **first parameter** is the Bot or Bot ID that the errors should be loaded for.

The **second parameter** is the name of the tag that the errors should be loaded for.

#### Examples:

1. Load all errors that have occurred for this script:
```typescript
let bots = await server.loadErrors(this, tagName);
```

### `server.destroyErrors()`

Destroys all the error bots.

Returns a promise that resolves once the bots are destroyed.

#### Examples:

1. Destroy all the error bots in this story:
```typescript
server.destroyErrors();
```

### `server.storyPlayerCount(story?)`

Gets the number of players that are viewing the current story.
Optionally takes a parameter which is the story that the number of players should be retrieved for. If omitted, then the current story will be checked.
Returns a promise that resolves with the number of active players.

The **first parameter** is optional and is the name of the story that the number of players should be retrieved for.
If not specified, then the current story <ActionLink action="player.getCurrentStory()">current story</ActionLink> will be used.

#### Examples

1. Get the number of players in the current story.
```typescript
const numberOfPlayers = await server.storyPlayerCount();

player.toast("Number of Players: " + numberOfPlayers);
```

2. Get the number of players in the `test` story.
```typescript
const numberOfPlayers = await server.storyPlayerCount('test');

player.toast("Number of Players: " + numberOfPlayers);
```

### `server.totalPlayerCount()`

Gets the number of players that are connected to the server.
Returns a promise that resolves with the number of active players.

#### Examples

1. Get the number of players on the server.
```typescript
const numberOfPlayers = await server.totalPlayerCount();

player.toast("Number of Players: " + numberOfPlayers);
```

### `server.stories()`

Gets the list of stories that are stored on the server.
Returns a promise that resolves with the list of story names.

#### Examples

1. Get the list of stories on the server.
```typescript
const stories = await server.stories();

player.toast("Stories " + stories.join(','));
```

### `server.storyStatuses()`

Gets the list of stories that are stored on the server along with the last time that they were updated.
Returns a promise that resolves with the list of stories.

The resolved list is sorted by the most recently updated first and the least recently updated last.

#### Examples

1. Get the list of stories on the server along with their status.
```typescript
const stories = await server.storyStatuses();

player.toast("Stories " + getJSON(stories));
```

### `server.players()`

Gets the list of player IDs that are connected to the current story.
Returns a promise that resolves with the list of player IDs.

The resolved list will always have at least one value that represents the current player.

#### Examples

1. Get the list of player IDs.
```typescript
const players = await server.players();

player.toast("Players " + players.join(','));
```

## Utility Actions

### `setTag(bot, tag, value)`


Sets the given tag to the given value on the given bot, list of bots, or mod.

The **first parameter** is the bot, list of bots, or mod that the tag should be set on.

The **second parameter** is the tag that should be changed.

The **third parameter** is the value that should be placed into the tag(s).

#### Examples:

1. Set a bot's <TagLink tag='color'/> to `green`.
```typescript
setTag(this, "#color", "green");
```

### `getTag(bot, tag)`


Gets the given tag value from the given bot.

The **first parameter** is the bot that the tag should be retrieved from.

The **second parameter** is the tag that should be retrieved.

#### Examples:

1. Get the <TagLink tag='color'/> tag from `this` bot.
```typescript
const color = getTag(this, "#color");
```

## Math Actions

### `math.sum(list)`


Calculates the numerical sum of the given values.

The **first parameter** is the list of values that should be summed up.
If any value in the list is not a number, it will be converted to one.
If the list is not actually a list, then it will be converted to a number and returned.

#### Examples:

1. Calculate the sum of a list of numbers.
```typescript
const total = math.sum([92, 123, 21]);
```

2. Calculate the total `#age` of all the bots.
```typescript
const totalAge = math.sum(getBotTagValues('#age'));
```

### `math.avg(list)`


Calculates the arithmetic mean of the given list of values.
That is, the sum of the values divided by the number of values.

The **first parameter** is the list of values that average should be calculated for.

#### Examples:

1. Calculate the average of a list of numbers.
```typescript
const average = math.avg([4, 54.2, 31]);
```

2. Calculate the average `#age` of all the bots.
```typescript
const averageAge = math.avg(getBotTagValues('#age'));
```

### `math.sqrt(value)`


Calculates the square root of the given value.

The **first parameter** is the value that the square root should be calculated for.

#### Examples:

1. Calculate the square root of `4`.
```typescript
const rootOf4 = math.sqrt(4);
```

### `math.abs(number)`


Calculates the absolute value of the given number.

The **first parameter** is the number that the absolute value should be calculated for.

#### Examples:

1. Calculate the absolute value for the number `-42`.
```typescript
const _42 = math.abs(-42);
```

### `math.stdDev(list)`


Calculates the [standard deviation](https://en.wikipedia.org/wiki/Standard_deviation) for the given list of values.

The **first parameter** is the list of values that the standard deviation should be calculated for.

#### Examples:

1. Calculate the standard deviation of a list of numbers.
```typescript
const standardDeviation = math.stdDev([2, 97, 745]);
```

2. Calculate the standard deviation of the `#age` of all the bots.
```typescript
const ageDeviation = math.stdDev(getBotTagValues('#age'));
```

### `math.randomInt(min, max)`


Generates a random integer number between the given minimum and maximum values.

The **first parameter** is the smallest allowed value that can be generated.

The **second parameter** is the largest allowed value that can be generated.

#### Examples:

1. Generate a random number between `5` and `10`.
```typescript
const number = math.randomInt(5, 10);
```

### `math.random(min, max)`


Generates a random number between the given minimum and maximum values.

The **first parameter** is the smallest allowed value that can be generated.

The **second parameter** is the largest allowed value that can be generated.

#### Examples:

1. Generate a random number between `0` and `Math.PI`.
```typescript
const number = math.random(0, Math.PI);
```

## Crypto Actions

### `crypto.sha256(...data)`

Calculates the [SHA-256](https://en.wikipedia.org/wiki/SHA-2) [hash](https://en.wikipedia.org/wiki/Cryptographic_hash_function) of the given data.
Returns a [hexadecimal](https://en.wikipedia.org/wiki/Hexadecimal) string that represents the computed hash.

Hashes are generally useful for validating that a piece of data did not change or for checking to see if two values are the same thing.

Supports calculating hashes of strings, numbers, booleans, objects, arrays, and bots.

**Each parameter** is a piece of data that should be included in the hash. If multiple pieces of data are included, they will be concatenated.

#### Examples

1. Calculate the hash of a string.
```typescript
const hash = crypto.sha256("hello, world");
player.toast(hash);
```

2. Calculate the hash of an object.
```typescript
const hash = crypto.sha256({
    abc: "def"
});
player.toast(hash);
```

### `crypto.sha512(...data)`

Calculates the [SHA-512](https://en.wikipedia.org/wiki/SHA-2) [hash](https://en.wikipedia.org/wiki/Cryptographic_hash_function) of the given data.
Returns a [hexadecimal](https://en.wikipedia.org/wiki/Hexadecimal) string that represents the computed hash.

Hashes are generally useful for validating that a piece of data did not change or for checking to see if two values are the same thing.

Supports calculating hashes of strings, numbers, booleans, objects, arrays, and bots.

**Each parameter** is a piece of data that should be included in the hash. If multiple pieces of data are included, they will be concatenated.

#### Examples

1. Calculate the hash of a string.
```typescript
const hash = crypto.sha512("hello, world");
player.toast(hash);
```

2. Calculate the hash of an object.
```typescript
const hash = crypto.sha512({
    abc: "def"
});
player.toast(hash);
```

### `crypto.hmacSha256(key, ...data)`

Calculates the [HMAC](https://en.wikipedia.org/wiki/HMAC) [SHA-256](https://en.wikipedia.org/wiki/SHA-2) [hash](https://en.wikipedia.org/wiki/Cryptographic_hash_function) of the given data.
Returns a [hexadecimal](https://en.wikipedia.org/wiki/Hexadecimal) string that represents the computed hash.

HMAC hashes are generally useful for validating that a piece of data was sent from someone else who has a particular password.

Supports calculating hashes of strings, numbers, booleans, objects, arrays, and bots.

The **first parameter** is the password that should be used to create the HMAC.

The **other parameters** are the data that should be included in the hash. If multiple pieces of data are included, they will be concatenated.

#### Examples

1. Calculate the HMAC of a string with a key.
```typescript
const hash = crypto.hmacSha256("key", "hello, world");
player.toast(hash);
```

2. Calculate the HMAC of an object.
```typescript
const hash = crypto.hmacSha256("key", {
    abc: "def"
});
player.toast(hash);
```

### `crypto.hmacSha512(key, ...data)`

Calculates the [HMAC](https://en.wikipedia.org/wiki/HMAC) [SHA-512](https://en.wikipedia.org/wiki/SHA-2) [hash](https://en.wikipedia.org/wiki/Cryptographic_hash_function) of the given data.
Returns a [hexadecimal](https://en.wikipedia.org/wiki/Hexadecimal) string that represents the computed hash.

HMAC hashes are generally useful for validating that a piece of data was sent from someone else who has a particular password.

Supports calculating hashes of strings, numbers, booleans, objects, arrays, and bots.

The **first parameter** is the password that should be used to create the HMAC.

The **other parameters** are the data that should be included in the hash. If multiple pieces of data are included, they will be concatenated.

#### Examples

1. Calculate the HMAC of a string with a key.
```typescript
const hash = crypto.hmacSha512("key", "hello, world");
player.toast(hash);
```

2. Calculate the HMAC of an object.
```typescript
const hash = crypto.hmacSha512("key", {
    abc: "def"
});
player.toast(hash);
```

### `crypto.encrypt(password, data)`

[Encrypts](https://en.wikipedia.org/wiki/Encryption) the given data using the given password and returns the result.

Use the <ActionLink action='crypto.decrypt(password, data)'/> function to decrypt the data.

_Always use a strong and unique password._ Use a password manager such as LastPass or 1Password to help you create and keep track of them.

Assuming a strong password, this method will return a string of encrypted data that is _confidential_ (unreadable without the password),
_reliable_ (the encrypted data cannot be changed without making it unreadable), and _authentic_ (decryptability proves that the password was used to encrypt the data).

As a consequence, encrypting the same data with the same password will produce different results.
This is to ensure that an attacker cannot correlate different pieces of data to potentially deduce the original plaintext.

Encrypts the given data using an authenticated encryption mechanism 
based on [XSalsa20](https://libsodium.gitbook.io/doc/advanced/stream_ciphers/xsalsa20) (An encryption cipher) and [Poly1305](https://en.wikipedia.org/wiki/Poly1305) (A message authentication code).
Additionally uses [scrypt](https://en.wikipedia.org/wiki/Scrypt) for [password-based key derivation](https://en.wikipedia.org/wiki/Key_derivation_function). 

The **first parameter** is the password that should be used to encrypt the data. Use a strong an unique password for maximum security.

The **second parameter** is the string data that should be encrypted.

#### Examples

1. Encrypt the given data and toast it.
```typescript
const encrypted = crypto.encrypt("key", "hello, world");
player.toast(encrypted);
```

### `crypto.decrypt(password, data)`

[Decrypts](https://en.wikipedia.org/wiki/Encryption) the given data using the given password and returns the result.

Use the <ActionLink action='crypto.encrypt(password, data)'/> function to encrypt the data.

The **first parameter** is the password that should be used to decrypt the data. This should be the same password that was used to encrypt the data.

The **second parameter** is the data from <ActionLink action='crypto.encrypt(password, data)'/> that should be decrypted.

#### Examples

1. Decrypt the given data and toast it.
```typescript
const decrypted = crypto.decrypt("key", "v1.vWUhsdfiKkxXi9Rt+BBNbcP/TiHZpxUL.iikPvWN6rNncY3j045gM0268MoRi0NNf.IpWYgzXQmjRea4MNLDXB1GmrinWLSSOMw+NfqeE=");
player.toast(decrypted);
```

### `crypto.keypair(password)`

Creates a keypair that can be used to [digitially sign](https://en.wikipedia.org/wiki/Digital_signature) and verify data.

Use <ActionLink action='crypto.sign(keypair, password, data)'/> and <ActionLink action='crypto.verify(keypair, signature, data)'/> to sign and verify the data.

Keypairs are made up of a private key and a public key.
The private key is a special value that can be used to create digital signatures and
the public key is a related value that can be used to verify that a digitital signature was created by the private key.

The private key is called "private" because it is encrypted using the given password
while the public key is called "public" because it is not encrypted so anyone can use it if they have access to it.

Note that both the private and public keys are randomly generated, so while the public is unencrypted, it won't be able to be used by someone else unless
they have access to it.

The **first parameter** is the password that should be used to encrypt the private key of the keypair.

#### Examples:

1. Create a keypair and toast it.
```typescript
const keypair = crypto.keypair("password");
player.toast(keypair);
```

### `crypt.sign(keypair, password, data)`

Calculates the digital signature for the given data using the given keypair and password.

Use <ActionLink action='crypto.keypair(password)'/> to create a keypair that can be used to create signatures.

Use <ActionLink action='crypto.verify(keypair, signature, data)'/> to validate signatures.

Digital signatures are used to verifying the authenticity and integrity of data.

This works by leveraging asymetric encryption but in reverse.

If we can encrypt some data such that only the public key of a keypair can decrypt it, then we can prove that
the data was encrypted (i.e. signed) by the corresponding private key.

And since the public key is available to everyone but the private
key is only usable when you have the password, we can use this to prove that a particular piece of data was signed by whoever knows the password.

Note that because of how digital signatures work, signing the same data with the same keypair will produce the same signature.

The **first parameter** is the keypair that should be used to sign the data.

The **second parameter** is the password that was used to encrypt the private key of the keypair.

The **third parameter** is the string data that should be signed.

#### Examples:

1. Create a signature for the string `"hello"`.
```typescript
// Returned from crypto.keypair()
const keypair = "vK1.qaG7S8rjXL5G03lbCwMsYybi/M6xFHEo6TDpofyx2Uc=.djEuRWp5TGZjRVNmTXNGZ2Q4SXArcjRSbXNVRXdTK2ZzK2wuZHhNM0RiM2VPNWgwNk5FQitVVW91YStWS1RyRkVLSzEuTkVjZDZtd0hGNDltT0hGWC9OODQxb2JqbWs0QU1yNndTWWxsSGlMS0M1UEs4ZW9vem83WVFieUxVcGJJcW4vcUZDbTVWZWhpdmRteHF0enlmQjNEeEQraklRVFRKcU1aaFpkYkZtdFFnZ2M9";

const signature = crypto.sign(keypair, "password", "hello");
player.toast(signature);
```

### `crypto.verify(keypair, signature, data)`

Validates that the given signature was created by the given keypair for the given data.
Returns true if the signature is valid. Returns false otherwise.

Use <ActionLink action='crypto.keypair(password)'/> to create a keypair that can be used to create signatures.

Use <ActionLink action='crypto.sign(keypair, password, data)'/> to create signatures.

The **first parameter** is the keypair that was used to create the signature.

The **second parameter** is the signature that was returned from <ActionLink action='crypto.sign(keypair, password, data)'/>.

The **third parameter** is the data that was used in the call to <ActionLink action='crypto.sign(keypair, password, data)'/>.

#### Examples:

1. Validate a signature.
```typescript
// Returned from crypto.keypair()
const keypair = "vK1.qaG7S8rjXL5G03lbCwMsYybi/M6xFHEo6TDpofyx2Uc=.djEuRWp5TGZjRVNmTXNGZ2Q4SXArcjRSbXNVRXdTK2ZzK2wuZHhNM0RiM2VPNWgwNk5FQitVVW91YStWS1RyRkVLSzEuTkVjZDZtd0hGNDltT0hGWC9OODQxb2JqbWs0QU1yNndTWWxsSGlMS0M1UEs4ZW9vem83WVFieUxVcGJJcW4vcUZDbTVWZWhpdmRteHF0enlmQjNEeEQraklRVFRKcU1aaFpkYkZtdFFnZ2M9";

// Returned from crypto.sign()
const signature = "vS1./su0SXu8r9PvsVgELmKPCdfYr9GlLCChAfITsqt40PXEr74H/MMwcO5oaZCLXtZHOiSy9AHZiRYqLPFPiaRkDg==";

const valid = crypto.verify(keypair, signature, "hello");
player.toast(valid);
```

### `crypto.createCertificate(certificate, password, keypair)`

Creates a new certified bot (also known as a certificate) from the given keypair that is signed by the given certified bot using the given password.
Returns a promise that resolves with the new bot.

Certificates are useful for creating signatures for tag values that CasualOS is aware of and will validate for you.

Certificates are similar to keypairs except that they themselves are signed by another certificate.
This creates a [chain of trust](https://en.wikipedia.org/wiki/Chain_of_trust) that can be used to establish the validity of any arbitrary certificate.
The certificate that created the signature is called the "signing/signer certificate" and the certificate that recieved the signature is called the "signee certificate".

Each certificate contains the following information:

- A keypair.
- A reference to the signing certificate.
- A signature from the signing certificate.

In CasualOS, there are two types of certificates:

1. Root certificates.
2. Non-root certificates.

_Root certificates_ are certificates that are both signee and signer. This means that the certificate used its own keypair to create the signature.
As such, the validity of the certificate cannot be checked apart from simply trusting it. Only one root certificate is allowed per story on a first-come first-serve basis.
Once a root certificate is created for a story, another cannot be created.

_Non-root certificates_ are certificates that are signed by another certificate. This means that another certificate's keypair was used to create the signature.
As such, the validity of the certificate can be checked by following the chain of trust back to the root certificate.
If the chain does not end at the root certificate for the story, then the certificate is invalid and any signatures created by it will also be invalid.

Use <ActionLink action='crypto.keypair(password)'/> to create a keypair that can be used to create signatures.

Use <ActionLink action='crypto.signTag(certificate, password, bot, tag)'/> to create signatures for a certificate.

The **first parameter** is the certified bot that should be used to sign the new certificate. If given null, then the new bot will be self-signed.

The **second parameter** is the password that should be used to decrypt the private key. If the first parameter is null, then this should be the password for the keypair.

The **third parameter** is the keypair that the new certificate should have.

#### Examples:

1. Create a root certificate and toast the Bot ID:
```typescript
const keypair = await crypto.keypair('passwordForRootCert');
const cert = await crypto.createCertificate(null, 'passwordForRootCert', keypair);

player.toast(getID(cert));
```

2. Create a non-root certificate and toast the Bot ID:
```typescript
const rootKeypair = getBot('id', rootCertID);

const nonRootKeypair = await crypto.keypair('passwordForNonRootCert');
const nonRoot = await crypto.createCertificate(rootCert, 'passwordForRootCert', nonRootKeypair);

player.toast(getID(nonRoot));
```

### `crypto.signTag(certificate, password, bot, tag)`

Creates a signature for the given bot, tag, and current value using the given certificate and password.
Returns a promise that resolves once the tag value has been signed.

When a signature is created for a tag value, the value is considered valid until it is changed or the certificate is revoked.

The **first parameter** is the certificate bot that should be used to create the signature.

The **second parameter** is the password used to decrypt the private key of the certificate.

The **third parameter** is the bot whose tag value should be signed.

The **fourth parameter** is the tag whose value should be signed.

Use <ActionLink action='crypto.createCertificate(certificate, password, keypair)'/> to create certificates that can be used with this function.

Use <ActionLink action='crypto.verifyTag(bot, tag)'/> to verify that a tag has a valid signature.

#### Examples:

1. Sign the `@onClick` script on a bot.
```typescript
const cert = getBot('id', certID);
await crypto.signTag(cert, 'passwordForCert', bot, 'onClick');
```

### `crypto.verifyTag(bot, tag)`

Validates that the tag value stored in the given tag on the given bot has been signed by a valid certificate.
Returns true if the tag value is valid. Returns false otherwise.

The **first parameter** is the bot whose tag value should be checked.

The **second parameter** is the tag whose value should be checked.

#### Examples:

1. Check if the `@onClick` script is signed.
```typescript
const valid = crypto.verifyTag(bot, 'onClick');

if (valid) {
    player.toast('onClick is valid!');
} else {
    player.toast('onClick is not valid.');
}
```

### `crypto.revokeCertificate(certificate, password, signer?)`

Revokes the given certificate and any signatures that it has created.
In effect, this deletes the certificate bot from the story.
Additionally, any tags signed with the given certificate will no longer be verified.

Returns a promise that resolves when the certificate has been revoked.

Revoking a certificate works by creating another record (called a revocation) that is signed by either the original certificate 
or an ancestor of the original certificate. This record is then stored in the shared space and lets everyone see that the certificate is no longer valid.

The **first parameter** is the certificate that should be revoked.

The **second parameter** is the password that should be used to decrypt the corresponding certificate's private key.
If the signer parameter is specified, then this is the password for the signer certificate.
If the signer parameter is omitted, then this is the password for the certificate that is being revoked.

The **third parameter** is optional and is the certificate that should be used to perform the revocation process.
If not specified, then the revocation will be signed by the revoked certificate (self-signed revocation).
If specified, then the revocation will be signed using the given certificate.
Note that any certificate that is specified must either be the original certificate or an ancestor of the original certificate.

#### Examples:

1. Revoke a certificate with itself.
```typescript
const cert = getBot('id', certificateId);
await crypto.revokeCertificate(cert, 'passwordForCert');

player.toast('Certificate revoked!');
```

2. Revoke a certificate using another certificate.
```typescript
const certToRevoke = getBot('id', certToRevokeId);
const signingCert = getBot('id', signingCertId);

await crypto.revokeCertificate(certToRevoke, 'passwordForSigningCert', signingCert);

player.toast('Certificate revoked!');
```

## Admin Actions

### `adminSpace.unlock(password)`

Unlocks the admin space using the given password.
Returns a Promise that resolves once the space is unlocked.
The promise will be rejected if the space was unable to be unlocked.

If given the correct password, admin space will be unlocked and become editable.

The **first parameter** is the password that should be used to unlock admin space.

#### Examples

1. Unlock admin space.
```typescript
try {
    await adminSpace.unlock("my-password");
    player.toast("Admin Space Unlocked!");
} catch(err) {
    player.toast("Failed to unlock admin space " + err);
}
```

### `adminSpace.setPassword(oldPassword, newPassword)`

Sets the password that should be used to unlock admin space.
Returns a Promise that resolves once the password is changed.

If given the correct password, admin space will use the new password.

The **first parameter** is the password that is currently used to unlock admin space.

The **second parameter** is the password that should be used to unlock admin space.

#### Examples

1. Change the admin space password.
```typescript
try {
    await adminSpace.setPassword("old-password", "new-password");
    player.toast("Admin Space Password Changed!");
} catch(err) {
    player.toast("Failed to change the password " + err);
}
```

## Experimental Actions

### `experiment.localFormAnimation(bot, animation)`

Locally plays the given animation on the given bot.

If an animation is already playing, it will be interrupted.
When the given animation is finished playing, the interrupted animation will be restored.

The **first parameter** is the Bot or Bot ID that the animation should be played on.

The **second parameter** is the name or index of the animation that should be played.

#### Examples

1. Play the "jump" animation on this bot.
```typescript
experiment.localFormAnimation(this, "jump");
```

[listen-tag]: docs/listen-tags