// Case where the tag "402ccb16-d402-4404-b1ad-7ad73cc29772".tags.ResizeHandle
// misses a tag update so the CasualOS script state is different from the YJS state.
export const case1 = [
    'ATX2yNuzDwAnAQRib3RzJDY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNwEnAPbI27MPAAZzeXN0ZW0CBAD2yNuzDwENYWIuY29yZS5sZWFybicA9sjbsw8ABGFiSUQCBAD2yNuzDw8FbGVhcm4nAPbI27MPAARmb3JtAgQA9sjbsw8VB25vdGhpbmcnAPbI27MPAAZhYkJvb3QCBAD2yNuzDx3SH0AvKioKKiBNSVQgTGljZW5zZQoqCiogQ29weXJpZ2h0IChjKSAyMDE5IENhc3VhbCBTaW11bGF0aW9uLCBJbmMuCioKKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5Ciogb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwKKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCiogdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbAoqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcwoqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CioKKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGwKKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoqCiogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKKiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCiogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKKiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRQoqIFNPRlRXQVJFLgoqIEBsaWNlbnNlIE1JVAoqLwoKLy9pbnN0IG1vZGUgKHBsYXllciBvciBidWlsZGVyKQpsZXQgaW5zdE1vZGVDaGVjayA9IGF3YWl0IG9zLnZlcnNpb24oKS5wbGF5ZXJNb2RlOwovL2NoZWNrIHNlbGYgZm9yIGluaXRpYWwgYm9vdCBkYXRhCmxldCBpbml0aWFsQm9vdCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuaW5pdGlhbEJvb3QgPyB0cnVlIDogZmFsc2U7Ci8vY2hlY2sgdXJsIGZvciBwb3NzaWJsZSBhYidzIHRvIGxvYWQKbGV0IGJvb3RGbGFnID0gY29uZmlnQm90LnRhZ3MucGF0dGVybiA/IGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4gOiBjb25maWdCb3QudGFncy5hYjsKLy9jaGVjayBmb3IgYXNrCmxldCBhc2sgPSBjb25maWdCb3QudGFncy5hc2s7Ci8vbG9naW4KbGV0IHN0YXR1cyA9IGF3YWl0IHRoaXNCb3QubG9hZGluZ1N0YXR1cygpOwovL3NlZWQgKG5vdCBhY3RpdmVseSB1c2VkIGhlcmUpCmxldCBzZWVkID0gY29uZmlnQm90LnRhZ3Muc2VlZDsKLy9wcm9tcHQKbGV0IHByb21wdCA9IGNvbmZpZ0JvdC50YWdzLnByb21wdDsKLy9yZXF1ZXN0IGF1dGggYm90CmF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7CgovL3JlZGlyZWN0IGlmIGluIFVSTAppZiAoY29uZmlnQm90LnRhZ3Muam9pbkNvZGUpCnsKICAgIHRoaXNCb3QuYWJKb2luSG9zdCh7dGV4dDogY29uZmlnQm90LnRhZ3Muam9pbkNvZGV9KTsKfQoKLy9zdGF0dXMgY2xlYW4gdXAKZGVzdHJveShzdGF0dXMpOwoKLy9pZiBubyBzdHVkaW8sIHNldCBzdHVkaW8KaWYgKGF1dGhCb3QgJiYgIWNvbmZpZ0JvdC50YWdzLnN0dWRpbykKewogICAgY29uZmlnQm90LnRhZ3Muc3R1ZGlvID0gYXV0aEJvdC5pZDsKfQoKaWYgKGF1dGhCb3QpCnsKICAgIHRoaXNCb3QuYWJMb2FkU3R1ZGlvcygpOwp9CgovL2luaXRpYWxpemUgcmVtZW1iZXIgZ2xvYmFscwpnbG9iYWxUaGlzLmFiSW5zdE1lbW9yeSA9IGxpbmtzLnJlbWVtYmVyOwpnbG9iYWxUaGlzLmFiUmVtZW1iZXIgPSBsaW5rcy5yZW1lbWJlcjsKCi8vVGhpcyBjaGVja3MgZm9yIHRoZSBhcHByb3ByaWF0ZSBhcnJheSBvZiBza2lsbHMgYW5kIGluaXRpYWxpemVzIHRoZW0KYXdhaXQgdGhpc0JvdC5hYlNraWxsSW5pdGlhbGl6YXRpb24oaW5zdE1vZGVDaGVjayk7CgovL2luaXRpYWxpemluZyBvZiBnbG9iYWwgdmFyaWFibGVzCmdsb2JhbFRoaXMuYnVpbGRlclZlcnNpb24gPSBpbnN0TW9kZUNoZWNrID09ICJidWlsZGVyIiA/IHRydWUgOiBmYWxzZTsKZ2xvYmFsVGhpcy5hYkxvbmdUZXJtTWVtb3J5U2VhcmNoID0gbGlua3Muc2VhcmNoOwpnbG9iYWxUaGlzLmFiU2VhcmNoID0gbGlua3Muc2VhcmNoOwpnbG9iYWxUaGlzLmFiUHVibGlzaCA9IGxpbmtzLnN0b3JlOwpnbG9iYWxUaGlzLmFiU3RvcmUgPSBsaW5rcy5zdG9yZTsKZ2xvYmFsVGhpcy5hYiA9IHRoaXNCb3Q7CgovL3BvcHVsYXRlIGJvb3RmbGFnIGFiCmlmIChpbml0aWFsQm9vdCAmJiBib290RmxhZykKewogICAgYXdhaXQgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBib290RmxhZywgaW5pdGlhbEJvb3Q6IHRydWUsIGF1dG9IYXRjaDogdHJ1ZX0pOwp9Cgpjb25zdCBwbGF5U3Vic2NyaXB0aW9uID0gIWF1dGhCb3QgPyB0cnVlIDogYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gIkZyZWVQbGF5IiA/IHRydWUgOiBmYWxzZTsKCi8vbG9va3VwIGFza0lEIGlmIGF2YWlsYWJsZQppZiAoaW5pdGlhbEJvb3QgJiYgYXNrKQp7CiAgICBhd2FpdCB0aGlzQm90LmFiQWRhcHQoImFiQWN0aW9uIik7CgogICAgbGlua3MuYXNrLmFiQ29yZU1lbnVBY3Rpb24oYXNrKTsKfQoKLy9jaGVjayBmb3IgYXJ0aWZhY3QKaWYgKGNvbmZpZ0JvdC50YWdzLmFydGlmYWN0ICYmIGluaXRpYWxCb290ICYmICFhc2sgJiYgIWJvb3RGbGFnKQp7CiAgICBjb25zdCBhcnRpZmFjdCA9IGNvbmZpZ0JvdC50YWdzLmFydGlmYWN0OwogICAgY29uc3QgcG9zc2libGVBc2tJbmRleCA9IGFydGlmYWN0LmluZGV4T2YoIl9hcnRfIikgKyA1OwogICAgY29uc3QgcG9zc2libGVFbmRJbmRleCA9IHBvc3NpYmxlQXNrSW5kZXggKyBhcnRpZmFjdC5zdWJzdHJpbmcocG9zc2libGVBc2tJbmRleCArIDEpLmluZGV4T2YoIl8iKSArIDE7CiAgICBjb25zdCBwb3NzaWJsZUFzayA9IGFydGlmYWN0LnN1YnN0cmluZyhwb3NzaWJsZUFza0luZGV4LCBwb3NzaWJsZUVuZEluZGV4KTsKCiAgICBhd2FpdCB0aGlzQm90LmFiQWRhcHQoImFiQWN0aW9uIik7CgogICAgbGlua3MuYXNrLmFiQ29yZU1lbnVBY3Rpb24ocG9zc2libGVBc2spOwp9CgovL3dha2UgdXAgYnVpbGRlciBpZiBzdWJzY3JpcHRpb24gaXMgcmlnaHQKaWYgKChpbml0aWFsQm9vdCAmJiAhYm9vdEZsYWcgJiYgIXBsYXlTdWJzY3JpcHRpb24gJiYgIWFzaykgfHwgbGlua3MucmVtZW1iZXIudGFncy5hYkJ1aWxkZXJJZGVudGl0eSA9PSAiYWItMSIpCnsKICAgIGxpbmtzLmlucHV0Lm9uQ2hhdCh7bWVzc2FnZTogIi4uIn0pOwp9CgovL3NldCBpbml0aWFsIGJvb3QgZGF0YQppZiAoaW5pdGlhbEJvb3QpCnsKICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaW5pdGlhbEJvb3QgPSBmYWxzZTsKfQoKLy9jbGVhbiB1cCBVUkwgd2l0aCB0YWdQb3J0YWwKaWYgKGNvbmZpZ0JvdC50YWdzLnRhZ1BvcnRhbCAmJiAhY29uZmlnQm90LnRhZ3MudGFnUG9ydGFsQW5jaG9yUG9pbnQgJiYgYnVpbGRlclZlcnNpb24pCnsKICAgIGNvbmZpZ0JvdC50YWdzLnRhZ1BvcnRhbCA9IG51bGw7CiAgICBjb25maWdCb3QudGFncy50YWdQb3J0YWxTcGFjZSA9IG51bGw7Cn0KCi8vcGF1c2UgZm9yIGFiIGxvYWRpbmcKYXdhaXQgb3Muc2xlZXAoNTAwKTsKCi8vaW5pdGlhbGl6ZSB0aW1lIGJvdAp0aGlzQm90LmFiVGltZXIoKTsKCi8vaW5pdGlhbGl6YXRpb24gc2hvdXQKc3VwZXJTaG91dCgib25BQkluaXRpYWxpemVkIiwgdGFncy5hYkluc3QpOygA9sjbsw8ABmFiQ29yZQF4JwD2yNuzDwAHYWJBZGFwdAIEAPbI27MP8R+1BkAvL25hbWUgb2YgdGhlIHNraWxsCmNvbnN0IHN5c3RlbUlEID0gdGhhdDsKLy9ib290c3RyYXAgdXJsCmNvbnN0IGJvb3RTdHJhcCA9IG9zLmdldEFCMUJvb3RzdHJhcFVSTCgpCi8vY29uc3RydWN0ZWQgdXJsCmNvbnN0IHNraWxsRmlsZSA9IGJvb3RTdHJhcC5zbGljZSgwLCBib290U3RyYXAubGVuZ3RoLTcpICsgc3lzdGVtSUQgKyIuYXV4IjsKCi8vd2ViaG9vayB0byBkb3dubG9hZCB0aGUgc2tpbGwgdXBkYXRlCnRyeQp7CiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHdlYmhvb2soewogICAgICAgIG1ldGhvZDogIkdFVCIsCiAgICAgICAgdXJsOiBza2lsbEZpbGUKICAgIH0pOwoKICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkgewogICAgICAgIGNvbnNvbGUubG9nKCdbYWIgYm9vdHN0cmFwXSBDb3VsZCBub3QgZG93bmxvYWQgc2tpbGwuJyk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IHVwZGF0ZXMgPSByZXNwb25zZS5kYXRhLnVwZGF0ZXM7CiAgICBjb25zdCBzdGF0ZSA9IGF3YWl0IG9zLmdldEluc3RTdGF0ZUZyb21VcGRhdGVzKHVwZGF0ZXMpOwogICAgY29uc3QgaWRzID0gT2JqZWN0LmtleXMoc3RhdGUpOwogICAgCiAgICBjb25zb2xlLmxvZygidXBkYXRlIiwgdXBkYXRlcyk7CgogICAgYXdhaXQgb3MuYXBwbHlVcGRhdGVzVG9JbnN0KHVwZGF0ZXMpOwoKICAgIHdoaXNwZXIoaWRzLCB0YWdOYW1lLCBjb25maWdCb3QudGFncy5pbnN0KTsKCiAgICByZXR1cm4gdHJ1ZTsKfQpjYXRjaAp7CiAgICBjb25zb2xlLmxvZygnW2FiIGJvb3RzdHJhcF0gQ291bGQgbm90IGRvd25sb2FkIHNraWxsLicpOwp9JwD2yNuzDwALZGVzY3JpcHRpb24CBAD2yNuzD6cmT1RoaXMgc2tpbGwgaXMgZGVzaWduZWQgdG8gaGFuZGxlIGJvdGggcmVjb25maWd1cmF0aW9uIG9mIGFiIGFuZCBpbml0aWFsaXphdGlvbi4nAPbI27MPAApvbkJvdEFkZGVkAgQA9sjbsw/3JvMBQC8vaW5pdGlhbGl6aW5nIHBhdXNlIHRvIGVuc3VyZSBhbGwgdGVtcExvY2FsIHVzZXIgYm90cyBhcmUgZnVsbHkgYWRkZWQKaWYgKCFsaW5rcy5yZW1lbWJlcikKewogICAgYXdhaXQgdGhpc0JvdC5hYkFkYXB0KCJhYkNvbmZpZyIpOwp9CgpzZXRUaW1lb3V0KCgpID0+IHRoaXNCb3QuYWJCb290KCksIDUwMCk7Cgpjb25zb2xlLmxvZyhsaW5rcy5yZW1lbWJlci50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIlNUQVJUIFVQIik7JwD2yNuzDwAIcmVtZW1iZXICBAD2yNuzD+soKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAPbI27MPAANsb2cCBAD2yNuzD5IpbEAvL3Bhc3MgdGhyb3VnaCBsb2cgZGF0YQppZiAobGlua3MuY29uc29sZSkKewogICAgbGlua3MuY29uc29sZS5sb2codGhhdCk7Cn0KZWxzZQp7CiAgICBjb25zb2xlLmxvZyh0aGF0KTsKfScA9sjbsw8ADW1hbmlmZXN0YXRpb24CBAD2yNuzD/8pKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAPbI27MPAAxhYkNyZWF0ZUhvc3QCBAD2yNuzD6Yq0whALy90aGlzIGZ1bmN0aW9uIGhhbmRsZXMgY3JlYXRpbmcgYSBmaWxlIGZvciBqb2luIGNvZGVzCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRCkKewogICAgb3MudG9hc3QoImNvZGUgY29waWVkIHRvIGNsaXBib2FyZCIpOwoKICAgIG9zLnNldENsaXBib2FyZChsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRC5zdWJzdHJpbmcoMCwzKSArICItIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElELnN1YnN0cmluZygzKSk7CgogICAgcmV0dXJuOwp9CgppZiAoIWF1dGhCb3QpCnsKICAgIGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90KCk7Cn0KCmlmICghYXV0aEJvdCkKewogICAgb3MudG9hc3QoInBsZWFzZSBsb2cgaW4gdG8gZ2VuZXJhdGUgYSBqb2luIGNvZGUiKTsKCiAgICByZXR1cm47Cn0KCmNvbnN0IG5ld0hvc3RJRCA9IHV1aWQoKS5yZXBsYWNlQWxsKCItIiwgIiIpLnN1YnN0cmluZygwLDYpOwpjb25zdCBkYXRlID0gRGF0ZVRpbWUubm93KCkudG9NaWxsaXMoKTsKY29uc3QgcmVjb3JkS2V5ID0gbGlua3MucmVtZW1iZXIudGFncy5hYlJlY29yZEtleTsKY29uc3QgcmVjb3JkRGF0YSA9IGF3YWl0IG9zLnJlY29yZERhdGEocmVjb3JkS2V5LCBuZXdIb3N0SUQsIHt1cmw6IGNvbmZpZ0JvdC50YWdzLnVybCwgZGF0ZTogZGF0ZSwgbWFya2VyczogWyJwdWJsaWNSZWFkIl19KTsKCmlmIChyZWNvcmREYXRhLnN1Y2Nlc3MpCnsKICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEID0gbmV3SG9zdElELnN1YnN0cmluZygwLDMpICsgIi0iICsgbmV3SG9zdElELnN1YnN0cmluZygzKTsKCiAgICBvcy5zZXRDbGlwYm9hcmQobGlua3MucmVtZW1iZXIudGFncy5ob3N0SUQpOwoKICAgIHRoYXQudGFncy5sYWJlbCA9ICJqb2luIGNvZGU6ICIgKyBuZXdIb3N0SUQuc3Vic3RyaW5nKDAsMykgKyAiLSIgKyBuZXdIb3N0SUQuc3Vic3RyaW5nKDMpOwoKICAgIG9zLnRvYXN0KCJob3N0IGdlbmVyYXRlZCwgY29kZSBjb3BpZWQgdG8gY2xpcGJvYXJkOiAiICsgbmV3SG9zdElEKTsKfQplbHNlCnsKICAgIG9zLnRvYXN0KCJzb21ldGhpbmcgd2VudCB3cm9uZywgcGxlYXNlIHRyeSBhZ2FpbiIpOwoKICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cn0nAPbI27MPAAphYkpvaW5Ib3N0AgQA9sjbsw/6MvgGQC8vbG9naWMgZm9yIHVzaW5nIGEgam9pbiBjb2RlIChjaGVja3MgZm9yIGV4aXN0aW5nIGZpbGVzKQpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKbGV0IGdldFJlY29yZDsKCmlmICh0aGF0LmRhdGEpCnsKICAgIGdldFJlY29yZCA9IHtzdWNjZXNzOiB0cnVlLCBkYXRhOiB0aGF0LmRhdGF9Owp9CmVsc2UKewogICAgY29uc3Qgam9pbkNvZGUgPSB0aGF0LnRleHQucmVwbGFjZUFsbCgiLSIsICIiKTsKICAgIGNvbnN0IHJlY29yZEtleSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSZWNvcmRLZXk7CiAgICBjb25zb2xlLmxvZygiSk9JTkNPREUiLCBqb2luQ29kZSkKICAgIGdldFJlY29yZCA9IGF3YWl0IG9zLmdldERhdGEocmVjb3JkS2V5LCBqb2luQ29kZSk7Cn0KCmlmIChnZXRSZWNvcmQuc3VjY2VzcykKewogICAgY29uc3QgZGF0ZSA9IERhdGVUaW1lLm5vdygpOwogICAgbGV0IGNyZWF0ZURhdGUgPSBEYXRlVGltZS5mcm9tTWlsbGlzKGdldFJlY29yZC5kYXRhLmRhdGUpOwogICAgbGV0IGRpZmZlcmVuY2UgPSBkYXRlLmRpZmYoY3JlYXRlRGF0ZSwgImRheXMiKS50b09iamVjdCgpOwoKICAgIGRpZmZlcmVuY2UgPSBNYXRoLmZsb29yKGRpZmZlcmVuY2UuZGF5cyk7CgogICAgaWYgKGRpZmZlcmVuY2UgPCA4KQogICAgewogICAgICAgIG9zLnRvYXN0KCJqb2luaW5nIGhvc3Qgbm93Iik7CiAgICAKICAgICAgICBvcy5nb1RvVVJMKGdldFJlY29yZC5kYXRhLnVybCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgb3MudG9hc3QoImpvaW4gY29kZSBvdXQgb2YgZGF0ZSwgcGxlYXNlIGdlbmVyYXRlIGEgbmV3IGpvaW4gY29kZSIpOwogICAgfQp9CmVsc2UKewogICAgb3MudG9hc3QoImNvZGUvYWIgaW52YWxpZCwgcGxlYXNlIHRyeSBhZ2FpbiIpOwp9JwD2yNuzDwAGc2VhcmNoAgQA9sjbsw/zOSjwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwD2yNuzDwAIYWJJZ25vcmUCBAD2yNuzD5o6BHRydWUoAPbI27MPAAxhYkJvdFZlcnNpb24BfbsBJwD2yNuzDwAEbWVudQIEAPbI27MPoDoo8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicA9sjbsw8AFWFiU2tpbGxJbml0aWFsaXphdGlvbgIEAPbI27MPxzrQAUAvL0ZpbmQgdGhlIGFwcHJvcHJpYXRlIGFycmF5IGFuZCBwb3B1bGF0ZSBza2lsbHMKbGV0IHNraWxsQXJyYXkgPSBsaW5rcy5yZW1lbWJlci50YWdzW3RoYXQgKyAiU2tpbGxBcnJheSJdOwoKZm9yIChsZXQgaSA9IDA7IGkgPCBza2lsbEFycmF5Lmxlbmd0aDsgaSsrKQp7CiAgICBhd2FpdCB0aGlzQm90LmFiQWRhcHQoc2tpbGxBcnJheVtpXSk7Cn0KCnJldHVybjsnAPbI27MPAAZiYW5uZXICBAD2yNuzD5g8KPCflJdiNTUyZWFmOS1hOWQ2LTQxYzgtODUxNS1jYmQyYWJlYWFlNzMnAPbI27MPAAVpbnB1dAIEAPbI27MPvzwo8J+Ul2Y4NjAyODc4LWMyZWYtNDhiZC04NWEwLThkNjM1MWViNDEyMCcA9sjbsw8ADWxvYWRpbmdTdGF0dXMCBAD2yNuzD+Y8wgdAY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAibG9hZFN0YXR1cyI7CgpsZXQgc3RhdHVzQm90ID0ge307CgpzdGF0dXNCb3Quc3BhY2UgPSAidGVtcExvY2FsIjsKc3RhdHVzQm90LmxhYmVsID0gInZlcmlmeWluZyBhdXRoQm90IjsKc3RhdHVzQm90LmxhYmVsQ29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwpzdGF0dXNCb3QubG9hZFN0YXR1cyA9IHRydWU7CnN0YXR1c0JvdC5tZW51SXRlbVN0eWxlID0geyJiYWNrZ3JvdW5kIjoibm9uZSJ9OwpzdGF0dXNCb3QudHJhY2tOdW0gPSAwOwpzdGF0dXNCb3Qub25DcmVhdGUgPSBgQAogICAgaWYgKHRhZ3MudHJhY2tOdW0gPT0gMikKICAgIHsKICAgICAgICB0YWdzLnRyYWNrTnVtID0gMDsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICB0YWdzLnRyYWNrTnVtKys7CiAgICB9CgogICAgdGFncy5sYWJlbCA9IHRhZ3NbImxhYmVsIit0YWdzLnRyYWNrTnVtXTsKICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSB0YWdzWyJmb3JtIit0YWdzLnRyYWNrTnVtXTsKCiAgICBzZXRUaW1lb3V0KCgpID0+IHdoaXNwZXIodGhpc0JvdCwgIm9uQ3JlYXRlIiksIDUwMCk7YDsKc3RhdHVzQm90LmxhYmVsMCA9ICJ2ZXJpZnlpbmcgYXV0aEJvdC4iOwpzdGF0dXNCb3QubGFiZWwxID0gInZlcmlmeWluZyBhdXRoQm90Li4iOwpzdGF0dXNCb3QubGFiZWwyID0gInZlcmlmeWluZyBhdXRoQm90Li4uIjsKc3RhdHVzQm90LmZvcm0wID0gImhvdXJnbGFzc19ib3R0b20iOwpzdGF0dXNCb3QuZm9ybTEgPSAiaG91cmdsYXNzX3RvcCI7CnN0YXR1c0JvdC5mb3JtMiA9ICJob3VyZ2xhc3NfYm90dG9tIjsKc3RhdHVzQm90Lm9uRGVzdHJveSA9ICJAIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsiOwoKbGV0IGNyZWF0ZWRTdGF0dXNCb3QgPSBjcmVhdGUoc3RhdHVzQm90KTsKCnJldHVybiBjcmVhdGVkU3RhdHVzQm90OycA9sjbsw8AA2FzawIEAPbI27MPqUQo8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycA9sjbsw8ADWFiTG9hZFN0dWRpb3MCBAD2yNuzD9BEYEBjb25zdCB1c2VyU3R1ZGlvcyA9IGF3YWl0IG9zLmxpc3RVc2VyU3R1ZGlvcygpOwogICAgCmNvbmZpZ0JvdC50YWdzLnVzZXJfc3R1ZGlvcyA9IHVzZXJTdHVkaW9zOycA9sjbsw8AB2FiVGltZXICBAD2yNuzD7FFhgZAaWYgKGdldEJvdCgiYWJUaW1lciIsIHRydWUpKQp7CiAgICByZXR1cm47Cn0KCmlmICghdGFncy5hYlhQKQp7CiAgICBzZXRUYWdNYXNrKHRoaXNCb3QsICJhYlhQIiwgIjAiLCAibG9jYWwiKTsKfQoKbGV0IHRpbWVyQm90ID0ge307Cgp0aW1lckJvdC5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwp0aW1lckJvdC5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsKdGltZXJCb3Qub25DcmVhdGUgPSAiQG1hc2tzLml0ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB0aGlzQm90Lm9uVGltZUNoZWNrKCksIDYwMDAwKTsiOwp0aW1lckJvdC5hYlRpbWVyID0gdHJ1ZTsKdGltZXJCb3Qub25UaW1lQ2hlY2sgPSBgQGlmICh0YWdzLm5vdElkbGUpCnsKICAgIHRhZ3Mubm90SWRsZSA9IGZhbHNlOwoKICAgIC8vY29uc29sZS5sb2coIlhQIiwgbGlua3MubWFuYWdlci50YWdzLmFiWFApOwoKICAgIGNvbnN0IHRvdGFsWFAgPSBsaW5rcy5tYW5hZ2VyLnRhZ3MuYWJYUCArIDE7CgogICAgc2V0VGFnTWFzayhsaW5rcy5tYW5hZ2VyLCAiYWJYUCIsIHRvdGFsWFAsICJsb2NhbCIpOwp9YDsKdGltZXJCb3Qubm90SWRsZSA9IGZhbHNlOwp0aW1lckJvdC5vbkFueUFjdGlvbiA9IGBAaWYgKCF0YWdzLm5vdElkbGUpCnsKICAgIGlmICh0aGF0LmFjdGlvbi5pZCA9PSBncmlkUG9ydGFsQm90LmlkKQogICAgewogICAgICAgIHRhZ3Mubm90SWRsZSA9IHRydWU7CiAgICB9Cn1gOwoKbGV0IGFiVGltZXIgPSBjcmVhdGUodGltZXJCb3QpOwoKZ2xvYmFsVGhpcy5hYlRpbWVyID0gYWJUaW1lcjsnAPbI27MPAAVzdG9yZQIEAPbI27MPuEso8J+Ulzc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZicA9sjbsw8ADG9uSW5zdEpvaW5lZAIEAPbI27MP30viAUBpZiAoIXRhZ3MuYWJJbnN0KQp7CiAgICBjb25zdCBhbGxJbnN0cyA9IGNvbmZpZ0JvdC50YWdzLmluc3Q7CgogICAgbGV0IGFjdGl2ZUluc3QgPSB0aGF0Lmluc3Q7CgogICAgaWYgKEFycmF5LmlzQXJyYXkoYWxsSW5zdHMpKQogICAgewogICAgICAgIGFjdGl2ZUluc3QgPSBhbGxJbnN0c1thbGxJbnN0cy5sZW5ndGggLSAxXTsKICAgIH0KCiAgICB0YWdzLmFiSW5zdCA9IGFjdGl2ZUluc3Q7Cn0nAPbI27MPAAdjb25zb2xlAgQA9sjbsw/CTSjwn5SXNDAyY2NiMTYtZDQwMi00NDA0LWIxYWQtN2FkNzNjYzI5NzcyAA==',
    'AQLJrdmmCwAnAPbI27MPAAZhYkluc3QCBADJrdmmCwAUZXF1aXZhbGVudC1iZWlnZS1ib2EA',
    'ASvyjdfMCgAnAQRib3RzJGU1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNwEnAPKN18wKAAZzeXN0ZW0CBADyjdfMCgESYWIuY29uZmlnLnJlbWVtYmVyJwDyjdfMCgAEZm9ybQIEAPKN18wKFAdub3RoaW5nJwDyjdfMCgALZGVzY3JpcHRpb24CBADyjdfMChwrVGhpcyBpcyBtZWFudCB0byBiZSB0aGUgbG9jYWwgc3RhdGUgaG9sZGVyLicA8o3XzAoAC2FiUmVjb3JkS2V5AgQA8o3XzApILnZSSzEuWVdJdE1RPT0uTkhac1VHdG9ObUZHWTNGSmRqSlRNbXMxTkZscVVUMDknAPKN18wKABFhYkFjdGl2ZURpbWVuc2lvbgIEAPKN18wKdwRob21lJwDyjdfMCgALYWJCYXNlQ29sb3ICBADyjdfMCnwFY2xlYXIoAPKN18wKAA9hYkdyaWRTbmFwU3RhdGUBeCgA8o3XzAoADmFiQm90U25hcFN0YXRlAXgnAPKN18wKAA1hYk1lbnVSZWZyZXNoAgQA8o3XzAqEATNALy9jbGVhciB0ZW1wb3JhcnkgdmFpYWJsZXMKY2xlYXJUYWdNYXNrcyh0aGlzQm90KTsnAPKN18wKAAphYkVuZHBvaW50AgQA8o3XzAq4ARVodHRwczovL3B1YmxpY29zLmxpbmsnAPKN18wKAAhhYklnbm9yZQIEAPKN18wKzgEEdHJ1ZScA8o3XzAoADWFiQ29yZVZlcnNpb24CBADyjdfMCtMBATkoAPKN18wKAAxhYkJvdFZlcnNpb24BfYQBKADyjdfMCgAPYWJDb3JlSXRlcmF0aW9uAX2AAScA8o3XzAoAGWFiTGlzdGVuaW5nRm9yRmlsZVVwbG9hZHMCBADyjdfMCtcBBHRydWUnAPKN18wKABBwbGF5ZXJTa2lsbEFycmF5AgQA8o3XzArcAQ/wn6esWyJhYlNoZWxsIl0nAPKN18wKABFidWlsZGVyU2tpbGxBcnJheQIEAPKN18wK6gFC8J+nrFsiYWJTaGVsbCIsICJhYkludGVyZmFjZSIsICJhYkFjdGlvbiIsICJhYkZhY3RvcnkiLCAiYWJUZXN0cyJdJwDyjdfMCgARYWJCdWlsZGVySWRlbnRpdHkCBADyjdfMCqsCBGFiLTEnAPKN18wKABNpbW1lcnNpdmVTa2lsbEFycmF5AgQA8o3XzAqwAhPwn6esWyJhYkltbWVyc2l2ZSJdKADyjdfMCgAMYWJBd2FrZVN0YXRlAXknAPKN18wKAAZiYXNlQUICBADyjdfMCsMCJDQ4NTBjZjlhLTliYzYtNDlmNS05ZjU3LWQyYWFhMmVkNGM5ZCgA8o3XzAoAC2luaXRpYWxCb290AXgnAPKN18wKAAhhYkNvbmZpZwIEAPKN18wK6QIEdHJ1ZScA8o3XzAoAEWFiQmFzZVN0cm9rZUNvbG9yAgQA8o3XzAruAgcjOTA4QkZDAA==',
    'AcUB3t+DxQUAJwEEYm90cyQwMjgzNjVhNC0wMzZmLTQxZDAtOWFmMS03MTVhZDRmMmFhN2EBJwDe34PFBQAGc3lzdGVtAgQA3t+DxQUBEWFiLnNoZWxsLnJlZ3VsYXRlJwDe34PFBQAEZm9ybQIEAN7fg8UFEwdub3RoaW5nJwDe34PFBQAMb25BbnlCb3REcmFnAgQA3t+DxQUbuwFALy9jb250cm9scyBncmlkIHNuYXAKaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlKQp7CiAgICBvcy5hZGREcm9wU25hcCgiZ3JpZCIpOwp9CgovL2NvbnRyb2xzIGJvdCBzbmFwCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlKQp7CiAgICBvcy5hZGREcm9wU25hcCgiZmFjZSIpOwp9JwDe34PFBQAIcmVtZW1iZXICBADe34PFBdcBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAN7fg8UFAAhhYklnbm9yZQIEAN7fg8UF/gEEdHJ1ZSgA3t+DxQUADGFiQm90VmVyc2lvbgF9uQInAN7fg8UFAAdhYlNoZWxsAgQA3t+DxQWEAgR0cnVlJwEEYm90cyQzNGMzYzIxMC01YmYxLTQ5Y2YtYjE1MS1lZTJkMDdmMGU2NzMBJwDe34PFBYkCBnN5c3RlbQIEAN7fg8UFigIPYWIuc2hlbGwuY3JlYXRlJwDe34PFBYkCBGZvcm0CBADe34PFBZoCB25vdGhpbmcnAN7fg8UFiQILZGVzY3JpcHRpb24CBADe34PFBaICPUJvdCB1c2VkIHRvIGNyZWF0ZS9tYW5pZmVzdCBib3RzIGludG8gYW4gYWN0dWFsIHNjZW5lL3BvcnRhbC4nAN7fg8UFiQIMYWJDcmVhdGVCb3RzAgQA3t+DxQXgAqQfQC8vREVWIE5PVEU6IE5FRUQgVE8gVU5ERVJTVEFORCBXSEFUIFRPIERPIElGIEFOIEFSUkFZIElTIEdJVkVOCgovL2NoZWNrcyBmb3IgaW5pdGlhbCBib290IGJvb2xlYW4KbGV0IGluaXRpYWxCb290ID0gdGhhdC5pbml0aWFsQm9vdDsKLy9ib3RzIHRvIGJlIGdlbmVyYXRlZApsZXQgYm90RGF0YSA9IHRoYXQuYm90czsKLy93aGVyZSBkaWQgdGhlIGRhdGEgY29tZSBmcm9tIChvcHRpb25hbCkKbGV0IG9yaWdpbiA9IHRoYXQub3JpZ2luOwovL3doYXQgc3R1ZGlvIGlzIHRoaXMgZGF0YSBmcm9tIChvcHRpb25hbCkKY29uc3Qgc3R1ZGlvID0gdGhhdC5zdHVkaW8KLy92ZXJzaW9uIG9mIHRoZSBkYXRhIChvcHRpb25hbCkKbGV0IHZlcnNpb24gPSB0aGF0LnZlcnNpb247Ci8vaWRNYXAgYW5kIG5ld0JvdHMgYXJlIHVzZWQgdG8gbWFuYWdlIHRoZSBpbmNvbWluZyBib3QgZGF0YQpsZXQgaWRNYXAgPSBuZXcgTWFwKCk7CmxldCBuZXdCb3RzID0gW107CgovL3RoaXMgbG9vcCBjcmVhdGVzIHRoZSBuZXcgYm90cyBhbmQgdGhlbiBwYWNrYWdlcyB0aGVtIGZvciBhZGRpdGlvbmFsIHByb2Nlc3NpbmcsIHdoaWxlIGFkZGluZyBhbnkgbmVlZGVkIGFkZGl0aW9uYWwgdGFncwpmb3IgKGNvbnN0IHByb3BlcnR5IGluIGJvdERhdGEpCnsKICAgIGNvbnN0IG5ld0JvdCA9IGJvdERhdGFbcHJvcGVydHldOwogICAgY29uc3QgYm90VG90YWwgPSBPYmplY3Qua2V5cyhib3REYXRhKS5sZW5ndGg7CiAgICBjb25zdCBhYklET3JpZ2luID0ge2FiSURPcmlnaW46IG9yaWdpbiwgYWJJRFN0dWRpbzogdGhhdC5zdHVkaW99OwogICAgY29uc3QgYWJHcmlkRm9jdXMgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzOwoKICAgIGlmIChuZXdCb3QudGFncykgCiAgICB7CiAgICAgICAgaWYgKG5ld0JvdC50YWdzLmNyZWF0b3IpIAogICAgICAgIHsKICAgICAgICAgICAgYWJJRE9yaWdpbi5vbGRDcmVhdG9yID0gbmV3Qm90LnRhZ3MuY3JlYXRvcjsKICAgICAgICB9CgogICAgICAgIGxldCB0YXJnZXRQb3NpdGlvbjsKCiAgICAgICAgdHJ5IAogICAgICAgIHsKICAgICAgICAgICAgaWYgKChib3RUb3RhbCA8IDIgfHwgYm90VG90YWwgPCAzICYmIGJvdERhdGEuYWJYUEJvdCAhPSBudWxsKSAmJiBhYkdyaWRGb2N1cykgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxldCB0YXJnZXREaW1lbnNpb24gPSBhYkdyaWRGb2N1cy5kaW1lbnNpb247CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRhcmdldFBvc2l0aW9uID0geyBbdGFyZ2V0RGltZW5zaW9uXTogdHJ1ZSwgW3RhcmdldERpbWVuc2lvbiArICJYIl06IGFiR3JpZEZvY3VzLnBvc2l0aW9uLngsIFt0YXJnZXREaW1lbnNpb24gKyAiWSJdOiBhYkdyaWRGb2N1cy5wb3NpdGlvbi55IH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCBiID0gY3JlYXRlKG5ld0JvdC50YWdzLCB0YXJnZXRQb3NpdGlvbiwgYWJJRE9yaWdpbik7CgogICAgICAgICAgICBpZE1hcC5zZXQoYm90RGF0YVtwcm9wZXJ0eV0uaWQsIGIuaWQpOwogICAgICAgICAgICBuZXdCb3RzLnB1c2goYik7CgogICAgICAgICAgICBpZiAoYi50YWdzLmNyZWF0b3IgPT0gdGhpc0JvdC5pZCkgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGIudGFncy5jcmVhdG9yID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjYXRjaCAoZXJyb3IpIAogICAgICAgIHsKICAgICAgICAgICAgY29uc29sZS5sb2coImludmFsaWQgYm90IiwgZXJyb3IpOwogICAgICAgIH0KICAgIH0KICAgIGVsc2UgCiAgICB7CiAgICAgICAgY29uc29sZS5sb2coInNraXBwZWQgYm90OiAiICsgbmV3Qm90KTsKICAgIH0KfQoKLy9hcnJheSBvZiB0YWcgcmVsYXRpb25zaGlwcyB0byBiZSBwcmVzZXJ2ZWQKbGV0IGxpbmtUYWdzID0gWyJsaW5rIiwgImNyZWF0b3IiLCAiY29uZmlnQm90IiwgImxpbmVUbyIsICJ0cmFuc2Zvcm1lciJdOwoKLy90aGlzIGxvb3AgY29udGFpbnMgdGhlIGxvZ2ljIGZvciBwcmVzZXJ2aW5nIHRoZSBsaW5rVGFncwpmb3IgKGxldCBuZXdCb3Qgb2YgbmV3Qm90cykgCnsKICAgIGZvciAobGV0IHRhZyBvZiBsaW5rVGFncykgCiAgICB7CiAgICAgICAgbGV0IHZhbHVlID0gbmV3Qm90LnRhZ3NbdGFnXTsKCiAgICAgICAgaWYgKHRhZyA9PSAiY3JlYXRvciIpIAogICAgICAgIHsKICAgICAgICAgICAgdmFsdWUgPSBuZXdCb3QudGFncy5vbGRDcmVhdG9yOwogICAgICAgICAgICBuZXdCb3QudGFncy5vbGRDcmVhdG9yID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIHVwZGF0ZUJvdExpbmtzKG5ld0JvdCwgaWRNYXApOwoKICAgICAgICBpZiAodmFsdWUpIAogICAgICAgIHsKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGV0IG5ld1ZhbHVlID0gdmFsdWUubWFwKGlkID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaWRNYXAuZ2V0KGlkKSB8fCBpZDsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgbmV3Qm90LnJhd1t0YWddID0gbmV3VmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29uc3QgbmV3SUQgPSBpZE1hcC5nZXQodmFsdWUpOwoKICAgICAgICAgICAgICAgIGlmIChuZXdJRCkgCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbmV3Qm90LnJhd1t0YWddID0gbmV3SUQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCi8vdG9hc3RzIGZvciBoYXRjaGVzLCBidXQgb25seSBvbiBidWlsZGVyCmlmIChjb25maWdCb3QudGFncy5hYlNpbGVudE1vZGUgPT0gbnVsbCAmJiAhY29uZmlnQm90LnRhZ3MucGggJiYgYnVpbGRlclZlcnNpb24gPT0gImJ1aWxkZXIiKSAKewogICAgb3MudG9hc3QoImhhdGNoZWQgIiArIG9yaWdpbiArICIgdiIgKyB2ZXJzaW9uKTsKfQoKaWYgKG9yaWdpbikKewogICAgbGV0IGFiQXJ0aWZhY3QgPSB7fTsKCiAgICBhYkFydGlmYWN0LmFiID0gdHJ1ZTsKICAgIGFiQXJ0aWZhY3QuYWJBcnRpZmFjdCA9IHRydWU7CiAgICAvL2FiQXJ0aWZhY3Quc3BhY2UgPSAibG9jYWwiOwogICAgYWJBcnRpZmFjdC5hYklnbm9yZSA9IHRydWU7CiAgICBhYkFydGlmYWN0Lm9yaWdpbl9hYiA9IG9yaWdpbjsKICAgIGFiQXJ0aWZhY3Qub3JpZ2luX3ZlcnNpb24gPSB2ZXJzaW9uOwogICAgYWJBcnRpZmFjdC5vcmlnaW5fcmVjb3JkID0gdGhhdC5yZWNvcmQ7CiAgICBhYkFydGlmYWN0LmZvcm0gPSAiZWdnIjsKICAgIGFiQXJ0aWZhY3QubGFiZWwgPSBvcmlnaW4gKyAiIHYiICsgdmVyc2lvbjsKICAgIGFiQXJ0aWZhY3QuYWJYID0gZ2V0Qm90cygiYWIiKS5sZW5ndGggKiAxLjU7CgogICAgY3JlYXRlKGFiQXJ0aWZhY3QpOwp9CgovL2FkZGl0aW9uYWwgaGF0Y2ggZGF0YQpjb25maWdCb3QudGFncy5sYXN0RWdnSGF0Y2hlZCA9IG9yaWdpbjsKCi8vaW5pdGlhbCBib290IGxvZ2ljCmlmIChpbml0aWFsQm9vdCkgCnsKICAgIGxldCBwcmVoYXRjaCA9IGF3YWl0IHNob3V0KCJvblByZUhhdGNoIiwgeyBhYjogb3JpZ2luIH0pWzBdOwoKICAgIGlmICghcHJlaGF0Y2gpIAogICAgewogICAgICAgIGFiSW5zdE1lbW9yeS50YWdzLmJhc2VBQiA9IG9yaWdpbjsKICAgIH0KICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCID0gb3JpZ2luOwp9CgovL29uRWdnSGF0Y2ggZm9yIGFsbCBqdXN0IGhhdGNoZWQgYm90cwp3aGlzcGVyKG5ld0JvdHMsICJvbkVnZ0hhdGNoIiwge2FiOiBvcmlnaW4sIHZlcnNpb246IHZlcnNpb24sIGluc3Q6IGFiLnRhZ3MuYWJJbnN0LCBlZ2dQYXJhbWV0ZXJzOiB0aGF0LmVnZ1BhcmFtZXRlcnN9KTsKCi8vb25BYkFkZGVkIGZvciBhbGwgYm90cyBpbiB0aGUgZXhwZXJpZW5jZQpzdXBlclNob3V0KCJvbkFiQWRkZWQiLCB7YWI6IG9yaWdpbiwgdmVyc2lvbjogdmVyc2lvbiwgaW5zdDogYWIudGFncy5hYkluc3R9KTsnAN7fg8UFiQIIcmVtZW1iZXICBADe34PFBYUiKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAN7fg8UFiQIJb25BYkFkZGVkAgQA3t+DxQWsIpQBQC8vc2hvdXQoIm9uQWJBZGRlZCIsIHthYjogb3JpZ2luLCB2ZXJzaW9uOiB2ZXJzaW9ufSk7Cgpjb25zb2xlLmxvZyhhYlJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiAiICsgdGhhdC5hYiwgInZlcnNpb246ICIgKyB0aGF0LnZlcnNpb24pOycA3t+DxQWJAghhYklnbm9yZQIEAN7fg8UFwSMEdHJ1ZSgA3t+DxQWJAgxhYkJvdFZlcnNpb24BfbkCJwDe34PFBYkCB2FiU2hlbGwCBADe34PFBccjBHRydWUnAQRib3RzJDQwMmNjYjE2LWQ0MDItNDQwNC1iMWFkLTdhZDczY2MyOTc3MgEnAN7fg8UFzCMHQXBwLmNzcwIEAN7fg8UFzSOdEDpyb290IHsKICAtLWJhY2tncm91bmQ6ICNmOGY5ZmE7CiAgLS1vbi1iYWNrZ3JvdW5kOiAjMjEyNTI5Owp9Ci8qIERhcmsgbW9kZSBzdXBwb3J0ICovCkBtZWRpYSAocHJlZmVycy1jb2xvci1zY2hlbWU6IGRhcmspIHsKICA6cm9vdCB7CiAgICAtLWJhY2tncm91bmQ6ICMyMTI1Mjk7CiAgICAtLW9uLWJhY2tncm91bmQ6ICNmOGY5ZmE7CiAgfQp9CgouYWItY29uc29sZSB7CiAgd2lkdGg6IDEwMCU7CiAgaGVpZ2h0OiB2YXIoLS1hcHAtaGVpZ2h0KTsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgcGFkZGluZzogMCAxcmVtOwogIGNvbG9yOiB2YXIoLS1vbi1iYWNrZ3JvdW5kKTsKICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsKICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoMTBweCkgYnJpZ2h0bmVzcygyMDAlKTsKICBhbmltYXRpb24tbmFtZTogc2xpZGUtYXBwLWluOwogIGFuaW1hdGlvbi1kdXJhdGlvbjogMC41czsKICBvdmVyZmxvdy15OiBoaWRkZW47CiAgei1pbmRleDogMTsKfQoKLmFiLWNvbnNvbGU6OmFmdGVyIHsKICBjb250ZW50OiAiIjsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1iYWNrZ3JvdW5kKTsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgdG9wOiAwOwogIGxlZnQ6IDA7CiAgcmlnaHQ6IDA7CiAgYm90dG9tOiAwOwogIG9wYWNpdHk6IDAuOTsKICB6LWluZGV4OiAwOwp9CgpAa2V5ZnJhbWVzIHNsaWRlLWFwcC1pbiB7CiAgZnJvbSB7CiAgICBhbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBjdWJpYy1iZXppZXIoLjYsMCwuNzksMS4wMyk7CiAgICAvKiB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMTEwJSk7ICovCiAgICBoZWlnaHQ6IDBweDsKICAgIG1pbi1oZWlnaHQ6IDBweDsKICB9CgogIHRvIHsKICAgIGhlaWdodDogdmFyKC0tYXBwLWhlaWdodCk7CiAgICBtaW4taGVpZ2h0OiB2YXIoLS1hcHAtaGVpZ2h0KTsKICB9Cn0KCi5hYi1jb25zb2xlID4gZGl2IHsKICB6LWluZGV4OiAxOwogIHBvc2l0aW9uOiByZWxhdGl2ZQp9CgouYWItY29uc29sZS1sb2cgewogIG92ZXJmbG93LXk6IGF1dG87CiAgZmxleC1ncm93OiAxOwogIGRpc3BsYXk6IGZsZXg7CiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbi1yZXZlcnNlOwp9CgouYWItY29uc29sZS1tZXNzYWdlIHsKICBtYXJnaW4tYm90dG9tOiAxcmVtOwogIGJvcmRlci1yYWRpdXM6IDAuMjVyZW07CiAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYmFja2dyb3VuZCk7CiAgY29sb3I6IHZhcigtLW9uLWJhY2tncm91bmQpOwogIHBhZGRpbmc6IDAuNXJlbSAxcmVtOwp9CgouYWItY29uc29sZS10aW1lc3RhbXAgewogIG9wYWNpdHk6IDAuNjsKfQoKLmFiLWNvbnNvbGUtaW5wdXQgewogIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWJhY2tncm91bmQpOwogIGNvbG9yOiB2YXIoLS1vbi1iYWNrZ3JvdW5kKTsKICB3aWR0aDogMTAwJTsKICByZXNpemU6IHZlcnRpY2FsOwogIGJvcmRlci1yYWRpdXM6IDJweDsKICBwYWRkaW5nOiAwIDAuNXJlbTsKICBsaW5lLWhlaWdodDogMS44cmVtOwoKICAvKiBSZXNldCB0ZXh0YXJlYSBzdHlsZXMgKi8KICBib3JkZXI6IG5vbmU7CiAgb3V0bGluZTogbm9uZTsKICAtd2Via2l0LWFwcGVhcmFuY2U6IG5vbmU7CiAgLXdlYmtpdC1ib3gtc2hhZG93OiBub25lOwogIC1tb3otYm94LXNoYWRvdzogbm9uZTsKICBib3gtc2hhZG93OiBub25lOwp9CgouYWItY29uc29sZS1pbnB1dDpmb2N1cyB7CiAgYm9yZGVyLWJvdHRvbS13aWR0aDogMnB4ICFpbXBvcnRhbnQ7CiAgYm9yZGVyLWJvdHRvbS1jb2xvcjogIzNlODJmOCAhaW1wb3J0YW50OwogIGJvcmRlci1ib3R0b20tc3R5bGU6IHNvbGlkOwp9CgouY29uc29sZS1zZW5kLWJ0biB7CiAgY29sb3I6IHZhcigtLW9uLWJhY2tncm91bmQpOwogIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWJhY2tncm91bmQpOwoJYm9yZGVyOiBub25lOwoJZm9udDogaW5oZXJpdDsKCWN1cnNvcjogcG9pbnRlcjsKCW91dGxpbmU6IGluaGVyaXQ7CiAgcGFkZGluZzogMCAxcmVtOwp9CgouY29uc29sZS1zZW5kLWJ0biA+IHNwYW4gewogIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgzcHgpCn0nAN7fg8UFzCMMUmVzaXplSGFuZGxlAgQA3t+DxQXrM7MNQGNvbnN0IHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSwgdXNlUmVmIH0gPSBvcy5hcHBIb29rcwpjb25zdCBvZmZzZXQgPSA4CmNvbnN0IGluaXRpYWxIZWlnaHQgPSAyNTYKY29uc3QgZHJhZ0ludGVydmFsID0gMjUKCmNvbnN0IFJlc2l6ZUhhbmRsZSA9ICgpID0+IHsKICAgIGNvbnN0IFtoZWlnaHQsIHNldEhlaWdodF0gPSB1c2VTdGF0ZShpbml0aWFsSGVpZ2h0ICsgb2Zmc2V0KQogICAgY29uc3QgW2xpc3RlbmluZywgc2V0TGlzdGVuaW5nXSA9IHVzZVN0YXRlKGZhbHNlKQoKICAgIGNvbnN0IHVwZGF0ZUhlaWdodCA9ICgpID0+IHsKICAgICAgICBpZiAobGlzdGVuaW5nKSB7CiAgICAgICAgICAgIHNldEhlaWdodChncmlkUG9ydGFsQm90LnRhZ3MucG9pbnRlclBpeGVsWSArIDYgKyBNYXRoLnJhbmRvbSgpLzEwMDApOwoKICAgICAgICAgICAgaWYoaGVpZ2h0ID4gZ3JpZFBvcnRhbEJvdC50YWdzLnBpeGVsSGVpZ2h0IC8gMikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgc2V0SGVpZ2h0KChncmlkUG9ydGFsQm90LnRhZ3MucGl4ZWxIZWlnaHQgLyAyKSAtIDYpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgaWYgKGxpc3RlbmluZykgewogICAgICAgICAgICB1cGRhdGVIZWlnaHQoKQogICAgICAgIH0KICAgIH0sIFtsaXN0ZW5pbmddKQoKICAgIHVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgaWYgKCFsaXN0ZW5pbmcpIHJldHVybjsKCiAgICAgICAgaWYgKGhlaWdodCA8IDgwKSB7CiAgICAgICAgICAgIHNldExpc3RlbmluZyhmYWxzZSk7CiAgICAgICAgICAgIGdyaWRQb3J0YWxCb3QudGFncy5wb3J0YWxab29tYWJsZSA9IHRydWU7CiAgICAgICAgICAgIHNob3V0KCdoaWRlQ29uc29sZScpOwogICAgICAgICAgICBtYXNrcy5vcGVuID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGdyaWRQb3J0YWxCb3QudGFncy5wb2ludGVyUGl4ZWxZICsgNyA+PSBncmlkUG9ydGFsQm90LnRhZ3MucGl4ZWxIZWlnaHQgLyAyKXsKICAgICAgICAgICBzZXRMaXN0ZW5pbmcoZmFsc2UpOwogICAgICAgIH0KCiAgICAgICAgb3Muc2xlZXAoZHJhZ0ludGVydmFsKS50aGVuKCgpID0+IHsKICAgICAgICAgICAgdXBkYXRlSGVpZ2h0KCk7CiAgICAgICAgfSkKICAgIH0sIFtoZWlnaHRdKQoKCiAgICByZXR1cm4gKDw+CiAgICAgICAgPHN0eWxlPntgOnJvb3Qgey0tYXBwLWhlaWdodDogJHtoZWlnaHR9cHh9YH08L3N0eWxlPgogICAgICAgIDxkaXYKICAgICAgICAgICAgb25Qb2ludGVyRG93bj17KCkgPT4gc2V0TGlzdGVuaW5nKHRydWUpfQogICAgICAgICAgICBvblBvaW50ZXJVcD17KCkgPT4gc2V0TGlzdGVuaW5nKGZhbHNlKX0KICAgICAgICAgICAgc3R5bGU9e3sKICAgICAgICAgICAgICAgIHdpZHRoOiAnMTAwJScsCiAgICAgICAgICAgICAgICBoZWlnaHQ6ICcyNHB4JywKICAgICAgICAgICAgICAgIGZvbnRTaXplOiAnMjRweCcsCiAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0OiAnMjJweCcsCiAgICAgICAgICAgICAgICB0ZXh0QWxpZ246ICdjZW50ZXInLAogICAgICAgICAgICAgICAgY3Vyc29yOiAnZ3JhYicsCiAgICAgICAgICAgICAgICB1c2VyU2VsZWN0OiAnbm9uZScsCiAgICAgICAgICAgIH19CiAgICAgICAgPgogICAgICAgICAgICDigJQKICAgICAgICA8L2Rpdj4KICAgIDwvPikKfQoKcmV0dXJuIFJlc2l6ZUhhbmRsZQonAN7fg8UFzCMKYWJJRE9yaWdpbgIEAN7fg8UFnUEHYWJMb2dWMicA3t+DxQXMIwZnZXRBcHACBADe34PFBaVB6QtAY29uc3QgeyB1c2VFZmZlY3QsIHVzZVN0YXRlIH0gPSBvcy5hcHBIb29rcwpjb25zdCBSZXNpemVIYW5kbGUgPSB0aGlzQm90LlJlc2l6ZUhhbmRsZSgpCgpjb25zdCBNZXNzYWdlID0gKHt0aW1lc3RhbXAsIG1lc3NhZ2V9KSA9PiB7CiAgICByZXR1cm4gKAogICAgICAgIDxkaXYgY2xhc3NOYW1lPSJhYi1jb25zb2xlLW1lc3NhZ2UiPgogICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYWItY29uc29sZS10aW1lc3RhbXAiPgogICAgICAgICAgICAgICAge3RpbWVzdGFtcC50b0xvY2FsZVN0cmluZygnZW4tVVMnLCB7IHRpbWVTdHlsZTogJ21lZGl1bScgfSl9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYWItY29uc29sZS1jb250ZW50Ij57bWVzc2FnZX08L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICkKfQoKY29uc3QgQXBwID0gKHsgIH0pID0+IHsKICAgIGNvbnN0IFtjb25zb2xlTG9nLCBzZXRDb25zb2xlTG9nXSA9IHVzZVN0YXRlKHRoaXNCb3QubWFza3MuaGlzdG9yeSkKCiAgICBjb25zdCB1cGRhdGVMb2cgPSAoKSA9PiB7CiAgICAgICAgc2V0Q29uc29sZUxvZyhbIC4uLnRoaXNCb3QubWFza3MuaGlzdG9yeSBdKQogICAgfQoKICAgIHVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgdGhpc0JvdC52YXJzLnVwZGF0ZUxvZyA9IHVwZGF0ZUxvZwogICAgICAgIHJldHVybiAoKCkgPT4gewogICAgICAgICAgICB0aGlzQm90LnZhcnMudXBkYXRlTG9nID0gbnVsbAogICAgICAgIH0pCiAgICB9LCBbXSkKCiAgICByZXR1cm4gKDw+CiAgICAgICAgPHN0eWxlPnt0YWdzWydBcHAuY3NzJ119PC9zdHlsZT4KCiAgICAgICAgPGRpdgogICAgICAgICAgICBpZD0iYWItY29uc29sZSIKICAgICAgICAgICAgY2xhc3NOYW1lPSJhYi1jb25zb2xlIgogICAgICAgICAgICBvblBvaW50ZXJFbnRlcj17KCkgPT4gZ3JpZFBvcnRhbEJvdC50YWdzLnBvcnRhbFpvb21hYmxlID0gZmFsc2V9CiAgICAgICAgICAgIG9uUG9pbnRlckxlYXZlPXsoZSkgPT4gewogICAgICAgICAgICAgICAgaWYgKGUuY3VycmVudFRhcmdldC5pZCA9PSAiYWItY29uc29sZSIpewogICAgICAgICAgICAgICAgICAgIGdyaWRQb3J0YWxCb3QudGFncy5wb3J0YWxab29tYWJsZSA9IHRydWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfX0KICAgICAgICA+CgogICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYWItY29uc29sZS1sb2ciPgogICAgICAgICAgICAgICAgey8qIE1lc3NhZ2UgaGlzdG9yeSAqLyBBcnJheS5pc0FycmF5KGNvbnNvbGVMb2cpCiAgICAgICAgICAgICAgICA/IGNvbnNvbGVMb2cubWFwKG0gPT4KICAgICAgICAgICAgICAgICAgICA8TWVzc2FnZSB0aW1lc3RhbXA9e20udGltZXN0YW1wfSBtZXNzYWdlPXttLm1lc3NhZ2V9IC8+KQogICAgICAgICAgICAgICAgOiA8PjwvPn0KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICA8UmVzaXplSGFuZGxlIC8+CiAgICAgICAgPC9kaXY+CiAgICA8Lz4pCn0KCnJldHVybiBBcHAKJwDe34PFBcwjC2hpZGVDb25zb2xlAgQA3t+DxQWPTV5AdmFyIGN1cnJlbnRWZXIgPSBtYXNrcy5jb25zb2xlVmVyc2lvbiA/PyAwCmF3YWl0IG9zLnVucmVnaXN0ZXJBcHAoYGFiLWNvbnNvbGUtJHtjdXJyZW50VmVyfWApJwDe34PFBcwjA2xvZwIEAN7fg8UF7k3KA0Bjb25zdCBtZXNzYWdlID0gdGhhdAoKLy8gQ3JlYXRlIGxvY2FsIGNvcHkgb2YgaGlzdG9yeSBtYXNrCnZhciBfaGlzdG9yeSA9IHRoaXNCb3QubWFza3MuaGlzdG9yeQoKLy8gUHVzaCBtZXNzYWdlIGlmIHRoZSBtYXNrIGV4aXN0ZWQKaWYgKCBBcnJheS5pc0FycmF5KF9oaXN0b3J5KSApIHsKICAgIF9oaXN0b3J5LnVuc2hpZnQoewogICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSwKICAgICAgICBtZXNzYWdlCiAgICB9KQoKLy8gSW5pdGlhbGl6ZSB0aGUgYXJyYXkgaWYgaXQgZGlkbid0Cn0gZWxzZSB7CiAgICBfaGlzdG9yeSA9IFt7CiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLAogICAgICAgIG1lc3NhZ2UKICAgIH1dCn0KCnRoaXNCb3QubWFza3MuaGlzdG9yeSA9IFsgLi4uX2hpc3RvcnkgXQppZiAodGhpc0JvdC52YXJzLnVwZGF0ZUxvZykgdGhpc0JvdC52YXJzLnVwZGF0ZUxvZygpJwDe34PFBcwjC3Nob3dDb25zb2xlAgQA3t+DxQW5UbQDQGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWwgPSBudWxsCmNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWxTcGFjZSA9IG51bGwKCi8vIFVucmVnaXN0ZXIgaW4gY2FzZSBpdCB3YXMgYWxyZWFkeSBvcGVuCnZhciBjdXJyZW50VmVyID0gbWFza3MuY29uc29sZVZlcnNpb24gPz8gMAphd2FpdCBvcy51bnJlZ2lzdGVyQXBwKGBhYi1jb25zb2xlLSR7Y3VycmVudFZlcn1gKQoKY3VycmVudFZlciArPSAxCm1hc2tzLmNvbnNvbGVWZXJzaW9uID0gY3VycmVudFZlcgovLyBHZXQsIHJlZ2lzdGVyLCBhbmQgY29tcGlsZSB0aGUgYXBwCmNvbnN0IEFwcCA9IHRoaXNCb3QuZ2V0QXBwKCkKYXdhaXQgb3MucmVnaXN0ZXJBcHAoYGFiLWNvbnNvbGUtJHtjdXJyZW50VmVyfWAsIHRoaXNCb3QpCm9zLmNvbXBpbGVBcHAoYGFiLWNvbnNvbGUtJHtjdXJyZW50VmVyfWAsIDxBcHAgLz4pCicA3t+DxQXMIwZzeXN0ZW0CBADe34PFBe5UEGFiLnNoZWxsLmNvbnNvbGUoAN7fg8UFzCMIYWJJZ25vcmUBeCcA3t+DxQXMIw10b2dnbGVDb25zb2xlAgQA3t+DxQWAVZYBQGlmIChtYXNrcy5vcGVuKSB7CiAgICB3aGlzcGVyKHRoaXNCb3QsICJoaWRlQ29uc29sZSIpOwogICAgbWFza3Mub3BlbiA9IGZhbHNlOwp9IGVsc2UgewogICAgd2hpc3Blcih0aGlzQm90LCAic2hvd0NvbnNvbGUiKTsKICAgIG1hc2tzLm9wZW4gPSB0cnVlOwp9KADe34PFBcwjDGFiQm90VmVyc2lvbgF9BycA3t+DxQXMIwRmb3JtAgQA3t+DxQWYVgdub3RoaW5nJwDe34PFBcwjB2FiU2hlbGwCBADe34PFBaBWBHRydWUnAQRib3RzJDc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZgEnAN7fg8UFpVYGc3lzdGVtAgQA3t+DxQWmVg5hYi5zaGVsbC5zdG9yZScA3t+DxQWlVgRmb3JtAgQA3t+DxQW1Vgdub3RoaW5nJwDe34PFBaVWC2Rlc2NyaXB0aW9uAgQA3t+DxQW9Vj9UaGlzIHNraWxsIGlzIG1lYW50IHRvIGJlIGEgY29uZmlndXJhYmxlIG1lYW5zIHRvIHB1Ymxpc2ggZGF0YS4nAN7fg8UFpVYPYWJQdWJsaXNoUmVjb3JkAgQA3t+DxQX9VrIGQGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90KCk7CgpsZXQgcHVibGljRmFjaW5nID0gdGhhdC5wdWJsaWNGYWNpbmc7CmxldCByZWNvcmREYXRhID0gdGhhdC5kYXRhOwpsZXQgcmVjb3JkTmFtZSA9IHRoYXQucmVjb3JkTmFtZTsKbGV0IGVuZHBvaW50ID0gdGhhdC5lbmRwb2ludCA/IHRoYXQuZW5kcG9pbnQgOiBsaW5rcy5yZW1lbWJlci50YWdzLmFiRW5kcG9pbnQ7CmxldCB1c2VyUmVjb3JkID0gY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQgPz8gYXV0aEJvdC5pZDsKCmlmICghcmVjb3JkRGF0YSkKewogICAgcmV0dXJuICJubyBkYXRhIHN1cHBsaWVkIjsKfQoKaWYgKHB1YmxpY0ZhY2luZykKewogICAgcmVjb3JkRGF0YSA9IGF3YWl0IG9zLnJlY29yZERhdGEodXNlclJlY29yZCwgcmVjb3JkTmFtZSwgcmVjb3JkRGF0YSwge2VuZHBvaW50OiBlbmRwb2ludCwgbWFya2VyczogWyJwdWJsaWNSZWFkIl19KTsKfQplbHNlCnsgICAgCiAgICByZWNvcmREYXRhID0gYXdhaXQgb3MucmVjb3JkRGF0YSh1c2VyUmVjb3JkLCByZWNvcmROYW1lLCByZWNvcmREYXRhLCB7ZW5kcG9pbnQ6IGVuZHBvaW50LCBtYXJrZXJzOiBbcmVjb3JkTmFtZV19KTsKfQoKaWYgKHJlY29yZERhdGEuc3VjY2VzcykKewogICAgYWIubG9nKGFiUmVtZW1iZXIudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IGRhdGEgcmVjb3JkZWQgdG8gIiArIHVzZXJSZWNvcmQpOwp9CmVsc2UKewogICAgYWIubG9nKGFiUmVtZW1iZXIudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IGRhdGEgZmFpbGVkIHRvIHJlY29yZCIpOwp9CgpyZXR1cm4gcmVjb3JkRGF0YTsnAN7fg8UFpVYNYWJQdWJsaXNoRmlsZQIEAN7fg8UFsF3ZBUBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwoKbGV0IGZpbGUgPSB0aGF0LmZpbGU7CmxldCBmaWxlTmFtZSA9IHRoYXQuZmlsZU5hbWU7CmxldCBtaW1lVHlwZSA9IHRoYXQubWltZVR5cGU7CmxldCB1c2VyUmVjb3JkID0gY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQgPz8gYXV0aEJvdC5pZDsKCmlmICghZmlsZSkKewogICAgcmV0dXJuICJubyBmaWxlIHN1cHBsaWVkIjsKfQoKbGV0IGZpbGVVcGxvYWQgPSBhd2FpdCBvcy5yZWNvcmRGaWxlKHVzZXJSZWNvcmQsIGZpbGUsIHtkZXNjcmlwdGlvbjogZmlsZU5hbWUsIG1pbWVUeXBlOiBtaW1lVHlwZX0pOwogICAgCmlmICghZmlsZVVwbG9hZC5zdWNjZXNzKSAKewogICAgYXdhaXQgb3MuZ3JhbnRJbnN0QWRtaW5QZXJtaXNzaW9uKHVzZXJSZWNvcmQpOwoKICAgIGZpbGVVcGxvYWQgPSBhd2FpdCBvcy5yZWNvcmRGaWxlKHVzZXJSZWNvcmQsIGZpbGUsIHtkZXNjcmlwdGlvbjogZmlsZU5hbWUsIG1pbWVUeXBlOiBtaW1lVHlwZX0pOwp9CgppZiAoZmlsZVVwbG9hZC5zdWNjZXNzKQp7CiAgICBhYi5sb2coYWJSZW1lbWJlci50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogZmlsZSByZWNvcmRlZCB0byAiICsgdXNlclJlY29yZCk7Cn0KZWxzZQp7CiAgICBhYi5sb2coYWJSZW1lbWJlci50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogZmlsZSBmYWlsZWQgdG8gcmVjb3JkIik7Cn0KCnJldHVybiBmaWxlVXBsb2FkOycA3t+DxQWlVhBhYkNvcmVNZW51QWN0aW9uAgQA3t+DxQWKY01AYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsKCi8vc2V0IHVwIHRoZSBwdWJsaXNoIG1lbnUKdGhpc0JvdC5vblN0b3JlTWVudSgpOycA3t+DxQWlVgtvblN0b3JlTWVudQIEAN7fg8UF2GOyXkBsZXQgcG9zc2libGVQdWJsaXNoQm90ID0gbGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1czsKCnNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGlua3MubWVudS5tYXNrcy5vbkdyaWRDbGljayA9ICJAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOyI7Cgpjb25zdCB1dWFiID0gbGlua3MucmVtZW1iZXIudGFncy51dWFiID8gdHJ1ZSA6IGZhbHNlOwoKCmNvbnN0IGRlZmF1bHRzID0gewogICAgYWJNZW51OiB0cnVlLAogICAgYWJNZW51UmVmcmVzaDogIkAgZGVzdHJveSh0aGlzQm90KTsiLAogICAgY29sb3I6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3IsCiAgICBtYW5hZ2VyOiAi8J+UlyIgKyB0aGlzQm90LmlkLAogICAgbWFuaWZlc3RhdGlvbjogdGFncy5tYW5pZmVzdGF0aW9uLAogICAgbWVudUl0ZW1TdHlsZTogYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjBweCIsICJtYXJnaW4tdG9wIjogIjBweCJ9YAp9OwoKLy8gQ3JlYXRlIGRvd25sb2FkIGJ1dHRvbgpsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbih7CiAgICAuLi5kZWZhdWx0cywKICAgIGFiTWVudVNvcnRPcmRlcjogOSwKICAgIGxhYmVsOiAiZG93bmxvYWQiLAogICAgbWVudUl0ZW1TdHlsZTogYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggOXB4IDlweCIsICJtYXJnaW4tdG9wIjogIjNweCJ9YCwKICAgIGZvcm1BZGRyZXNzOiAiZ2V0X2FwcCIsCiAgICBvbkNsaWNrOiBgQCBsaW5rcy5tYW5hZ2VyLmFiRG93bmxvYWQoKTtgCn0pOwoKaWYgKCFhdXRoQm90KQp7CiAgICAvLyBDcmVhdGUgbG9naW4gbWVzc2FnZQogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oewogICAgICAgIC4uLmRlZmF1bHRzLAogICAgICAgIGFiTWVudVNvcnRPcmRlcjogOSwKICAgICAgICBsYWJlbDogInBsZWFzZSBzaWduIGluIHRvIGFjY2VzcyBzaGFyZSBmZWF0dXJlcyIsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJsb2NrIiwKICAgICAgICBvbkNsaWNrOiBgQCBvcy5yZXF1ZXN0QXV0aEJvdCgpYAogICAgfSk7CgogICAgcmV0dXJuOwp9CmVsc2UgaWYgKGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09ICJGcmVlUGxheSIpCnsKICAgIC8vIENyZWF0ZSB1cGdyYWRlIHN1YnNjcmlwdGlvbiBidXR0b24KICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHsKICAgICAgICAuLi5kZWZhdWx0cywKICAgICAgICBsYWJlbDogInBsZWFzZSB1cGdyYWRlIHlvdXIgc3Vic2NyaXB0aW9uIHRvIGFjY2VzcyBzaGFyZSBmZWF0dXJlcyIsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJsb2NrIgogICAgfSk7CgogICAgcmV0dXJuOwp9CgppZiAoIXV1YWIpCnsKICAgIGxldCB1c2VyU3R1ZGlvcyA9IGNvbmZpZ0JvdC50YWdzLnVzZXJfc3R1ZGlvczsKCiAgICBpZiAoIXVzZXJTdHVkaW9zKQogICAgewogICAgICAgIHVzZXJTdHVkaW9zID0gYXdhaXQgb3MubGlzdFVzZXJTdHVkaW9zKCk7CiAgICB9CiAgICAKICAgIGlmICh1c2VyU3R1ZGlvcy5zdWNjZXNzKQogICAgewogICAgICAgIGNvbnN0IGFjdGl2ZVN0dWRpbyA9IHVzZXJTdHVkaW9zLnN0dWRpb3MuZmluZEluZGV4KHN0dWRpbyA9PiBzdHVkaW8uc3R1ZGlvSWQgPT0gY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQpOwogICAgICAgIGxldCBiYXNlU3R1ZGlvID0gYXV0aEJvdC5pZDsKCiAgICAgICAgaWYgKGJhc2VTdHVkaW8gPT0gYXV0aEJvdC5pZCkKICAgICAgICB7CiAgICAgICAgICAgIGJhc2VTdHVkaW8gPSAicGxheWVyIjsKICAgICAgICB9CgogICAgICAgIGlmIChhY3RpdmVTdHVkaW8gPT0gLTEgJiYgYmFzZVN0dWRpbyAhPSAicGxheWVyIikKICAgICAgICB7CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnNlbGVjdGVkX3N0dWRpb0lEID0gYmFzZVN0dWRpbzsKICAgICAgICB9CgogICAgICAgIGlmIChjb25maWdCb3QudGFncy5zdHVkaW8gJiYgIWFjdGl2ZVN0dWRpbykKICAgICAgICB7CiAgICAgICAgICAgIGNvbnN0IHN0dWRpb01hdGNoID0gdXNlclN0dWRpb3Muc3R1ZGlvcy5maW5kSW5kZXgoc3R1ZGlvID0+IHN0dWRpby5zdHVkaW9JZCA9PSBjb25maWdCb3QudGFncy5zdHVkaW8pCgogICAgICAgICAgICBpZiAoc3R1ZGlvTWF0Y2ggIT0gLTEpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGJhc2VTdHVkaW8gPSBiYXNlU3R1ZGlvOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBjb25zdCBzdHVkaW9MYWJlbCA9IGFjdGl2ZVN0dWRpbyA9PSAtMSA/IGJhc2VTdHVkaW8gOiB1c2VyU3R1ZGlvcy5zdHVkaW9zW2FjdGl2ZVN0dWRpb10uZGlzcGxheU5hbWU7CgogICAgICAgIC8vIENyZWF0ZSBzdHVkaW8gc2VsZWN0IGJ1dHRvbgogICAgICAgIGNvbnN0IHN0dWRpb0Rpc3BsYXlCdXR0b24gPSBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbih7CiAgICAgICAgICAgIC4uLmRlZmF1bHRzLAogICAgICAgICAgICBsYWJlbDogInN0dWRpbz0iICsgc3R1ZGlvTGFiZWwsCiAgICAgICAgICAgIGFiTWVudVNvcnRPcmRlcjogMS41LAogICAgICAgICAgICBzdHVkaW9JbmZvcm1hdGlvbjogdXNlclN0dWRpb3MsCiAgICAgICAgICAgIGZvcm1BZGRyZXNzOiAiaW52ZW50b3J5XzIiLAogICAgICAgICAgICBvbkNsaWNrOiBgQCBsaW5rcy5tYW5hZ2VyLnN0dWRpb1NlbGVjdCh0YWdzLnN0dWRpb0luZm9ybWF0aW9uKTtgCiAgICAgICAgfSk7CgogICAgICAgIG1hc2tzLnN0dWRpb1NlbGVjdEJ1dHRvbiA9IGdldExpbmsoc3R1ZGlvRGlzcGxheUJ1dHRvbik7CiAgICB9CgogICAgLy8gQ3JlYXRlIHB1Ymxpc2ggbGFiZWwgYnV0dG9uCiAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbih7CiAgICAgICAgLi4uZGVmYXVsdHMsCiAgICAgICAgbGFiZWw6ICJwdWJsaXNoIHBhdHRlcm4iLAogICAgICAgIGFiTWVudVNvcnRPcmRlcjogMSwKICAgICAgICBsYWJlbEFsaWdubWVudDogImNlbnRlciIsCiAgICAgICAgZm9ybUFkZHJlc3M6IG51bGwsCiAgICAgICAgbWVudUl0ZW1TdHlsZTogYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggMHB4IDBweCIsICJtYXJnaW4tdG9wIjogIjZweCJ9YCwKICAgICAgICBwb2ludGFibGU6IGZhbHNlLAogICAgICAgIHNjYWxlWTogMC43NQogICAgfSk7CiAgICAKICAgIC8vIENyZWF0ZSBlbmNyeXB0IGJ1dHRvbgogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oewogICAgICAgIC4uLmRlZmF1bHRzLAogICAgICAgIGFiTWVudVNvcnRPcmRlcjogMiwKICAgICAgICBsYWJlbDogImVuY3J5cHQiLAogICAgICAgIGZvcm1BZGRyZXNzOiAiY2hlY2tfYm94X291dGxpbmVfYmxhbmsiLAogICAgICAgIGVuY3J5cHRTdGF0ZTogZmFsc2UsCiAgICAgICAgb25DbGljazogYEAgaWYodGFncy5lbmNyeXB0U3RhdGUpCiAgICAgICAgewogICAgICAgICAgICB0YWdzLmVuY3J5cHRTdGF0ZSA9IGZhbHNlOwogICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MuZW5jcnlwdGlvbiA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIHRhZ3MuZW5jcnlwdFN0YXRlID0gdHJ1ZTsKICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3gnOwogICAgICAgICAgICBjb25maWdCb3QudGFncy5lbmNyeXB0aW9uID0gdHJ1ZTsKICAgICAgICB9YAogICAgfSk7CgogICAgLy8gQ3JlYXRlIHB1YmxpYyBidXR0b24KICAgIGlmIChhdXRoQm90LnRhZ3MucHJpdmFjeUZlYXR1cmVzLmFsbG93UHVibGljRGF0YSkKICAgIHsKICAgICAgICBjb25maWdCb3QudGFncy5wdWJsaWNGYWNpbmcgPSBmYWxzZTsKICAgICAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbih7CiAgICAgICAgICAgIC4uLmRlZmF1bHRzLAogICAgICAgICAgICBhYk1lbnVTb3J0T3JkZXI6IDIsCiAgICAgICAgICAgIGxhYmVsOiAiaXNQdWJsaWMiLAogICAgICAgICAgICBsYWJlbEFsaWdubWVudDogImxlZnQiLAogICAgICAgICAgICBmb3JtQWRkcmVzczogImNoZWNrX2JveF9vdXRsaW5lX2JsYW5rIiwKICAgICAgICAgICAgcHVibGljU3RhdGU6IGZhbHNlLAogICAgICAgICAgICBvbkNsaWNrOiBgQCBpZih0YWdzLnB1YmxpY1N0YXRlKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0YWdzLnB1YmxpY1N0YXRlID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsKICAgICAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnB1YmxpY0ZhY2luZyA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0YWdzLnB1YmxpY1N0YXRlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94JzsKICAgICAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnB1YmxpY0ZhY2luZyA9IHRydWU7CiAgICAgICAgICAgIH1gCiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gQ3JlYXRlIGN1cnJlbnQgdmVyc2lvbiBidXR0b24KICAgIGNvbmZpZ0JvdC50YWdzLnZlcnNpb25EZWZpbmVkID0gbnVsbDsKICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHsKICAgICAgICAuLi5kZWZhdWx0cywKICAgICAgICBhYk1lbnU6IG51bGwsCiAgICAgICAgbWVudUl0ZW1TdHlsZTogYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggMHB4IDBweCIsICJtYXJnaW4tdG9wIjogIjZweCJ9YCwKICAgICAgICBkaW1lbnNpb246ICJhYk1lbnUiLAogICAgICAgIG9uS2V5RG93bjogYEAgaWYgKHRoYXQua2V5c1swXSA9PSAiU2hpZnQiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IHRydWU7CiAgICAgICAgICAgIH1gLAogICAgICAgIG9uS2V5VXA6IGBAIGlmICh0aGF0LmtleXNbMF0gPT0gIlNoaWZ0IikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSBmYWxzZTsKICAgICAgICAgICAgfWAsCiAgICAgICAgYWJNZW51U29ydE9yZGVyOiAtNiwKICAgICAgICBmb3JtQWRkcmVzczogImNoZWNrX2JveCIsCiAgICAgICAgbGFiZWw6ICJjdXJyZW50IHZlcnNpb24iLAogICAgICAgIG90aGVyT3B0aW9uQ2xpY2s6IGBAIGlmICh0aGF0ID09IHRoaXNCb3QuaWQpe3JldHVybjt9CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgICAgIGAsCiAgICAgICAgb25DbGljazogYEAKICAgICAgICAgICAgdGFncy5sYWJlbCA9ICdjdXJyZW50IHZlcnNpb24nOwogICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveCc7CgogICAgICAgICAgICBjb25maWdCb3QudGFncy52ZXJzaW9uRGVmaW5lZCA9IG51bGw7CgogICAgICAgICAgICBzaG91dCgib3RoZXJPcHRpb25DbGljayIsIHRoaXNCb3QuaWQpOwogICAgICAgIGAKICAgIH0pOwoKICAgIC8vIENyZWF0ZSBmZWVkYmFjayB2ZXJzaW9uIGJ1dHRvbgogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oewogICAgICAgIC4uLmRlZmF1bHRzLAogICAgICAgIGFiTWVudTogbnVsbCwKICAgICAgICBkaW1lbnNpb246ICJhYk1lbnUiLAogICAgICAgIGJ1dHRvblN0YXRlOiBudWxsLAogICAgICAgIG9uS2V5RG93bjogYEAgaWYgKHRoYXQua2V5c1swXSA9PSAiU2hpZnQiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IHRydWU7CiAgICAgICAgICAgIH1gLAogICAgICAgIG9uS2V5VXA6IGBAIGlmICh0aGF0LmtleXNbMF0gPT0gIlNoaWZ0IikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSBmYWxzZTsKICAgICAgICAgICAgfWAsCiAgICAgICAgYWJNZW51U29ydE9yZGVyOiAtNSwKICAgICAgICBmb3JtQWRkcmVzczogImNoZWNrX2JveF9vdXRsaW5lX2JsYW5rIiwKICAgICAgICBsYWJlbDogImZlZWRiYWNrIHZlcnNpb24iLAogICAgICAgIG90aGVyT3B0aW9uQ2xpY2s6IGBAIGlmICh0aGF0ID09IHRoaXNCb3QuaWQpe3JldHVybjt9CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgICAgIGAsCiAgICAgICAgb25DbGljazogYEAKICAgICAgICAgICAgdGFncy5sYWJlbCA9ICdmZWVkYmFjayB2ZXJzaW9uJzsKICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3gnOwoKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MudmVyc2lvbkRlZmluZWQgPSAiZmVlZGJhY2siOwoKICAgICAgICAgICAgc2hvdXQoIm90aGVyT3B0aW9uQ2xpY2siLCB0aGlzQm90LmlkKTsKICAgICAgICBgCiAgICB9KTsKCiAgICAvLyBDcmVhdGUgc3RhYmxlIHZlcnNpb24gYnV0dG9uCiAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbih7CiAgICAgICAgLi4uZGVmYXVsdHMsCiAgICAgICAgYWJNZW51OiBudWxsLAogICAgICAgIGRpbWVuc2lvbjogImFiTWVudSIsCiAgICAgICAgbWVudUl0ZW1TdHlsZTogYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjBweCAwcHggOHB4IDhweCIsICJtYXJnaW4tdG9wIjogIjBweCJ9YCwKICAgICAgICBidXR0b25TdGF0ZTogbnVsbCwKICAgICAgICBvbktleURvd246IGBAIGlmICh0aGF0LmtleXNbMF0gPT0gIlNoaWZ0IikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSB0cnVlOwogICAgICAgICAgICB9YCwKICAgICAgICBvbktleVVwOiBgQCBpZiAodGhhdC5rZXlzWzBdID09ICJTaGlmdCIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gZmFsc2U7CiAgICAgICAgICAgIH1gLAogICAgICAgIGFiTWVudVNvcnRPcmRlcjogLTQsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJjaGVja19ib3hfb3V0bGluZV9ibGFuayIsCiAgICAgICAgbGFiZWw6ICJzdGFibGUgdmVyc2lvbiIsCiAgICAgICAgb3RoZXJPcHRpb25DbGljazogYEAgaWYgKHRoYXQgPT0gdGhpc0JvdC5pZCl7cmV0dXJuO30KICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7CiAgICAgICAgYCwKICAgICAgICBvbkNsaWNrOiBgQAogICAgICAgICAgICB0YWdzLmxhYmVsID0gJ3N0YWJsZSB2ZXJzaW9uJzsKICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3gnOwoKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MudmVyc2lvbkRlZmluZWQgPSAic3RhYmxlIjsKCiAgICAgICAgICAgIHNob3V0KCJvdGhlck9wdGlvbkNsaWNrIiwgdGhpc0JvdC5pZCk7CiAgICAgICAgYAogICAgfSk7Cn0KCgppZiAodXVhYikKewogICAgLy8gQ3JlYXRlIHB1Ymxpc2ggYnV0dG9uCiAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbih7CiAgICAgICAgLi4uZGVmYXVsdHMsCiAgICAgICAgYWJNZW51U29ydE9yZGVyOiA0LAogICAgICAgIGZvcm1BZGRyZXNzOiAicXJfY29kZV9zY2FubmVyIiwKICAgICAgICBsYWJlbDogInB1Ymxpc2ggYWIiLAogICAgICAgIG9uQ2xpY2s6IGBACiAgICAgICAgICAgIHRyeQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb25maWdCb3QudGFncy51dWFiU2NhbiA9IHRydWU7CiAgICAgICAgICAgICAgICBvcy5vcGVuUVJDb2RlU2Nhbm5lcigpOwogICAgICAgICAgICAgICAgb3MudG9hc3QoInBsZWFzZSBzY2FuIHlvdXIgcHJhY3RpY2UgcGVybWl0Iik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2gKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgb3MudG9hc3QoInFyIGNvZGUgc2NhbiBub3Qgc3VwcG9ydGVkIG9uIHRoaXMgZGV2aWNlIik7CiAgICAgICAgICAgICAgICBjb25maWdCb3QudGFncy51dWFiU2NhbiA9IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7CiAgICAgICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwogICAgICAgIGAKICAgIH0pOwp9CmVsc2UKewogICAgLy8gQ3JlYXRlIHB1Ymxpc2ggYnV0dG9uCiAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbih7CiAgICAgICAgLi4uZGVmYXVsdHMsCiAgICAgICAgYWJNZW51U29ydE9yZGVyOiA0LAogICAgICAgIGZvcm1BZGRyZXNzOiAiZWdnIiwKICAgICAgICBtZW51SXRlbVN0eWxlOiBg8J+nrCB7ImJvcmRlci1yYWRpdXMiOiAiMHB4IDBweCA5cHggOXB4IiwgIm1hcmdpbi10b3AiOiAiMHB4In1gLAogICAgICAgIGZvcm06ICJpbnB1dCIsCiAgICAgICAgbWVudUl0ZW1TaG93U3VibWl0V2hlbkVtcHR5OiB0cnVlLAogICAgICAgIHRhcmdldEJveDogZ2V0TGluayhwb3NzaWJsZVB1Ymxpc2hCb3QpLAogICAgICAgIG1lbnVJdGVtVGV4dDogIWxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXMKICAgICAgICAgICAgICAgICAgICAgID8gbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIKICAgICAgICAgICAgICAgICAgICAgIDogbGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1cy5pZCwKICAgICAgICBvblN1Ym1pdDogYEAKICAgICAgICAgICAgaWYgKHRoYXQudGV4dCA9PSBudWxsICYmIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCICYmICFsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0aGF0LnRleHQgPSBsaW5rcy5yZW1lbWJlci50YWdzLmJhc2VBQjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgdGFyZ2V0U3R1ZGlvID0gY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQgPz8gYXV0aEJvdC5pZDsKICAgICAgICAgICAgY29uc3QgY29uZmlybVB1c2ggPSBhd2FpdCBvcy5zaG93Q29uZmlybSh7CiAgICAgICAgICAgICAgICB0aXRsZTogImNvbmZpcm0gcHVibGlzaCIsCiAgICAgICAgICAgICAgICBjb250ZW50OiAicHVibGlzaCAiICsgdGhhdC50ZXh0ICsgIiB0byAiICsgdGFyZ2V0U3R1ZGlvICsgIj8iLAogICAgICAgICAgICAgICAgY29uZmlybVRleHQ6ICJwdWJsaXNoIiwKICAgICAgICAgICAgICAgIGNhbmNlbFRleHQ6ICJjYW5jZWwiCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKCFjb25maXJtUHVzaCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25maWdCb3QudGFncy5tYW51YWxQdWJsaXNoID0gdHJ1ZTsKCiAgICAgICAgICAgIGlmICh0aGF0LnRleHQpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxpbmtzLm1hbmFnZXIuYWJQdWJsaXNoQUIoe2FiOiB0aGF0LnRleHQsIG1hbnVhbFB1Ymxpc2g6IHRydWUsIGJvdDogbGlua3MudGFyZ2V0Qm90fSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBvcy50b2FzdCgiYWIgbm90IHNwZWNpZmllZCIpOwogICAgICAgICAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKICAgICAgICAgICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwogICAgICAgICAgICB9CiAgICAgICAgYAogICAgfSk7Cn0KCgppZiAobGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1cykKewogICAgLy8gQ3JlYXRlIGNvcHkgdG8gY2xpcGJvYXJkIGJ1dHRvbgogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oewogICAgICAgIC4uLmRlZmF1bHRzLAogICAgICAgIGFiTWVudVNvcnRPcmRlcjogOCwKICAgICAgICBtZW51SXRlbVN0eWxlOiBg8J+nrCB7ImJvcmRlci1yYWRpdXMiOiAiOXB4IDlweCA5cHggOXB4IiwgIm1hcmdpbi10b3AiOiAiNnB4In1gLAogICAgICAgIGxhYmVsOiAiY29weSB0byBjbGlwYm9hcmQiLAogICAgICAgIGZvcm1BZGRyZXNzOiAiZmlsZV9jb3B5IiwKICAgICAgICB0YXJnZXRCb3Q6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RGb2N1cywKICAgICAgICBvbkNsaWNrOiBgQCBsZXQgc2VsZWN0ZWRCb3QgPSBsaW5rcy50YXJnZXRCb3Q7CiAgICAgICAgICAgIGxldCBwcmVwcGVkQm90ID0gSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRCb3QpOwogICAgICAgICAgICBsZXQgc3RhdGUgPSB7fQoKICAgICAgICAgICAgc3RhdGVbYWJJbnN0TWVtb3J5LnRhZ3MuYWJGb2N1c0RhdGFdID0gc2VsZWN0ZWRCb3Q7CgogICAgICAgICAgICBsZXQgbmV3RmlsZSA9IHt9CiAgICAgICAgICAgIG5ld0ZpbGUudmVyc2lvbiA9IDE7CiAgICAgICAgICAgIG5ld0ZpbGUuc3RhdGUgPSBzdGF0ZTsKCiAgICAgICAgICAgIHZhciBmb3JtYXR0ZWRGaWxlID0gSlNPTi5zdHJpbmdpZnkobmV3RmlsZSk7CiAgICAgICAgICAgIG9zLnNldENsaXBib2FyZChmb3JtYXR0ZWRGaWxlKTsKCiAgICAgICAgICAgIG9zLnRvYXN0KCJib3QgY29waWVkIHRvIGNsaXBib2FyZCIpOwoKICAgICAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKICAgICAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CiAgICAgICAgYAogICAgfSk7Cn0KZWxzZSBpZiAoIXV1YWIpCnsKICAgIC8vIENyZWF0ZSBzY2FuIGJ1dHRvbgogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oewogICAgICAgIC4uLmRlZmF1bHRzLAogICAgICAgIGFiTWVudVNvcnRPcmRlcjogMTAsCiAgICAgICAgbWVudUl0ZW1TdHlsZTogYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggOXB4IDlweCIsICJtYXJnaW4tdG9wIjogIjNweCJ9YCwKICAgICAgICBsYWJlbDogInNjYW4iLAogICAgICAgIGZvcm1BZGRyZXNzOiAicXJfY29kZV9zY2FubmVyIiwKICAgICAgICBvbkNsaWNrOiBgQCBjb25maWdCb3QudGFncy5wdWJsaXNoU2NhbiA9IHRydWU7IG9zLm9wZW5RUkNvZGVTY2FubmVyKCk7YAogICAgfSk7CgogICAgLy9ORUVEIFRPIFVQREFURQogICAgaWYgKGNvbmZpZ0JvdC50YWdzLmdpZykKICAgIHsKICAgICAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbih7CiAgICAgICAgICAgIC4uLmRlZmF1bHRzLAogICAgICAgICAgICBhYk1lbnVTb3J0T3JkZXI6IC01LAogICAgICAgICAgICBtZW51SXRlbVN0eWxlOiBg8J+nrCB7ImJvcmRlci1yYWRpdXMiOiAiOXB4IDlweCA5cHggOXB4IiwgIm1hcmdpbi10b3AiOiAiM3B4In1gLAogICAgICAgICAgICBsYWJlbDogInN1Ym1pdCBnaWciLAogICAgICAgICAgICBmb3JtQWRkcmVzczogInNlbmQiLAogICAgICAgICAgICBvbkNsaWNrOiBgQHNob3V0KCJhYkNvbGxhYlN1Ym1pdCIpYAogICAgICAgIH0pOwogICAgfQp9CgpsZXQgaG9zdEJ1dHRvbiA9IHsKICAgIGFiTWVudTogdHJ1ZSwKICAgIGFiTWVudVNvcnRPcmRlcjogNTAsCiAgICBhYk1lbnVSZWZyZXNoOiAiQCBkZXN0cm95KHRoaXNCb3QpOyIsCiAgICBmb3JtQWRkcmVzczogImdyb3VwX2FkZCIsCiAgICBjb2xvcjogbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvciwKICAgIGxlYXJuOiB0YWdzLmxlYXJuLAogICAgcmVtZW1iZXI6IHRhZ3MucmVtZW1iZXIsCiAgICBvbkNsaWNrOiBgQCBsaW5rcy5sZWFybi5hYkNyZWF0ZUhvc3QodGhpc0JvdCk7CiAgICBpZiAoIWxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEKQogICAgewogICAgICAgIHRhZ3MubGFiZWwgPSAnZ2VuZXJhdGluZyBjb2RlIG5vdyc7CiAgICB9YAp9OwoKaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEKQp7CiAgICBob3N0QnV0dG9uLmxhYmVsID0gImpvaW4gY29kZTogIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElELnN1YnN0cmluZygwLDMpICsgIi0iICsgbGlua3MucmVtZW1iZXIudGFncy5ob3N0SUQuc3Vic3RyaW5nKDMpOwp9CmVsc2UKewogICAgaG9zdEJ1dHRvbi5sYWJlbCA9ICJnZW5lcmF0ZSBqb2luIGNvZGUiOwp9CgpsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihob3N0QnV0dG9uKTsvL2dlbmVyYXRlIGEgaG9zdCBidXR0b24nAN7fg8UFpVYOYWJDb3JlTWVudUljb24CBADe34PFBffBAQlpb3Nfc2hhcmUnAN7fg8UFpVYPYWJDb3JlTWVudUxhYmVsAgQA3t+DxQWBwgEFc2hhcmUnAN7fg8UFpVYTYWJDb3JlTWVudVNvcnRPcmRlcgIEAN7fg8UFh8IBATMnAN7fg8UFpVYIcmVtZW1iZXICBADe34PFBYnCASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwDe34PFBaVWC2FiUHVibGlzaEFCAgQA3t+DxQWwwgH7J0AvL3Nob3V0KCJhYlB1Ymxpc2hBQiIsIHthYjogIiIsIGtleTogIiIsIHRhcmdldDogIiJ9KTsKYWIubG9nKGFiUmVtZW1iZXIudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IHB1Ymxpc2hpbmcgIiArIHRoYXQuYWIpOwoKbGV0IHByb2dyZXNzQnV0dG9uOwoKc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCi8vY2xlYXIgYWIgYnVpbGRlcgppZiAobGlua3MubWFuaWZlc3RhdGlvbikKewogICAgaWYgKGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpCiAgICB7CiAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgIH0KfQoKLy9wcm9ncmVzcyBiYXIgZm9yIG1hbnVhbCBwdWJsaXNoaW5nIGNvbmZpcm1hdGlvbgppZiAoY29uZmlnQm90LnRhZ3MubWFudWFsUHVibGlzaCkKewogICAgcHJvZ3Jlc3NCdXR0b24gPSBhd2FpdCBsaW5rcy5pbnB1dC5hYlByb2dyZXNzQmFyKGB1cGxvYWRpbmcgJHt0aGF0LmFifWApOwp9CgovL2FiIHZhcmlhYmxlcwpsZXQgYWJJRCA9IHRoYXQuYWI7CmxldCBrZXkgPSB0aGF0LmtleTsKbGV0IHRhcmdldCA9IHRoYXQudGFyZ2V0ID8gdGhhdC50YXJnZXQgOiB0aGF0LmJvdDsKbGV0IHJldHVyblR5cGUgPSB0aGF0LnJldHVyblR5cGU7CmxldCBwdWJsaWNGYWNpbmcgPSB0aGF0LnB1YmxpY0ZhY2luZyA/PyBjb25maWdCb3QudGFncy5wdWJsaWNGYWNpbmc7CmxldCBzdGF0ZSA9IHt9OwpsZXQgZm9ybWF0dGVkRmlsZSA9IHt9OwoKY29uZmlnQm90LnRhZ3MucHVibGljRmFjaW5nID0gbnVsbDsKCi8vdGhpcyBsb2dpYyBmb3JtYXRzIHRoZSBzcGVjaWZpZWQgYm90cyBhbmQgcGFja2FnZXMgdGhlbSBmb3IgcHVibGlzaGluZwppZiAoIUFycmF5LmlzQXJyYXkodGFyZ2V0KSAmJiB0YXJnZXQgIT0gbnVsbCAmJiB0YXJnZXQgIT0gdW5kZWZpbmVkKQp7Cgp9CmVsc2UgaWYgKCF0YXJnZXQgfHwgdGFyZ2V0Lmxlbmd0aCA8IDEpCnsKICAgIHRhcmdldCA9IGdldEJvdHMoYnlNb2Qoe3NwYWNlOiAic2hhcmVkIiwgYWJJZ25vcmU6IG51bGx9KSk7CgogICAgaWYgKHRhcmdldC5sZW5ndGggPCAxKQogICAgewogICAgICAgIG9zLnRvYXN0KCJObyBib3RzIGZvdW5kIHRvIHB1Ymxpc2giKTsKCiAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CgogICAgICAgIHJldHVybjsKICAgIH0KfQoKLy90aGlzIGxvZ2ljIGhhbmRsZXMgZ2VuZXJhdGluZyBhIGtleSBmb3IgZW5jcnlwdGlvbiAob3B0aW9uYWwpCmlmIChjb25maWdCb3QudGFncy5lbmNyeXB0aW9uKQp7CiAgICBsZXQga2V5Q2hlY2s7CgogICAgY29uZmlnQm90LnRhZ3MuZW5jcnlwdGlvbiA9IG51bGw7CgogICAga2V5ID0gYXdhaXQgb3Muc2hvd0lucHV0KCIiLCB7CiAgICAgICAgdHlwZTogJ3NlY3JldCcsCiAgICAgICAgdGl0bGU6ICdlbnRlciBhIHNlY3JldCBrZXknCiAgICB9KTsKCiAgICBpZiAoa2V5KQogICAgewogICAgICAgIGtleUNoZWNrID0gYXdhaXQgb3Muc2hvd0lucHV0KCIiLCB7CiAgICAgICAgICAgIHR5cGU6ICdzZWNyZXQnLAogICAgICAgICAgICB0aXRsZTogJ2NvbmZpcm0gc2VjcmV0IGtleScKICAgICAgICB9KTsKICAgIH0KCiAgICBpZiAoa2V5ICE9IGtleUNoZWNrKSB7CiAgICAgICAgaWYgKCFrZXlDaGVjaykKICAgICAgICB7CiAgICAgICAgICAgIG9zLnRvYXN0KCJubyBrZXkgZW50ZXJlZCIpOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBvcy50b2FzdCgia2V5cyBkbyBub3QgbWF0Y2giKTsKICAgICAgICB9CgogICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwoKICAgICAgICByZXR1cm47CiAgICB9Cn0KCi8vZm9ybWF0dGluZyBib3RzIGZvciBmaWxlIHN0b3JhZ2UKaWYgKEFycmF5LmlzQXJyYXkodGFyZ2V0KSkgCnsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGFyZ2V0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IGN1cnJlbnRCb3RJRCA9IHRhcmdldFtpXS5pZDsKICAgICAgICBsZXQgY3VycmVudEJvdCA9IHRhcmdldFtpXTsKICAgICAgICAKICAgICAgICBzdGF0ZVtjdXJyZW50Qm90SURdID0gY3VycmVudEJvdDsKICAgIH0KfQplbHNlIAp7CiAgICBzdGF0ZVt0YXJnZXQuaWRdID0gdGFyZ2V0Owp9CgovL2NoZWNrcyBmb3IgcHJldmlvdXMgZWdncyBhbmQgcmV0dXJucyBkYXRhIGZvciBwcmV2aW91c2x5IHB1Ymxpc2hlZCBhYidzCmxldCBlZ2dDaGVjayA9IGF3YWl0IHRoaXNCb3QuYWJQcmV2aW91c0VnZ0NoZWNrKHthYklEOiBhYklEfSk7CgovL2FkZCB4cCBib3QgaGVyZQpjb25zdCB4cFZlcnNpb25Cb3QgPSB7fTsKCnhwVmVyc2lvbkJvdC5zcGFjZSA9ICJzaGFyZWQiOwp4cFZlcnNpb25Cb3QuaWQgPSAiYWJYUEJvdCI7CnhwVmVyc2lvbkJvdC50YWdzID0ge307CnhwVmVyc2lvbkJvdC50YWdzLmZvcm0gPSAibm90aGluZyI7CnhwVmVyc2lvbkJvdC50YWdzLnN5c3RlbSA9ICJhYi5wYXR0ZXJuLmFiWFBCb3QiOwp4cFZlcnNpb25Cb3QudGFncy5hdXRob3JJRCA9IGF1dGhCb3QuaWQ7CnhwVmVyc2lvbkJvdC50YWdzLnZlcnNpb24gPSBlZ2dDaGVjay5lZ2dEYXRhLm1heFZlcnNpb247CnhwVmVyc2lvbkJvdC50YWdzLnhwID0gbGlua3MubGVhcm4udGFncy5hYlhQOwp4cFZlcnNpb25Cb3QudGFncy5zaWduYXR1cmUgPSBlZ2dDaGVjay5zaWduYXR1cmU7CnhwVmVyc2lvbkJvdC50YWdzLmFiSWdub3JlID0gdHJ1ZTsKCnN0YXRlLmFiWFBCb3QgPSB4cFZlcnNpb25Cb3Q7CgovL2FkZGl0aW9uYWwgZmlsZSBkYXRhCmZvcm1hdHRlZEZpbGUudmVyc2lvbiA9IDE7CmZvcm1hdHRlZEZpbGUuc2lnbmF0dXJlID0gZWdnQ2hlY2suc2lnbmF0dXJlOwpmb3JtYXR0ZWRGaWxlLnN0YXRlID0gc3RhdGU7CgovL2FjdHVhbCBlbmNyeXB0aW9uIGlmIGNob3NlbgppZiAoa2V5KSAKewogICAgZm9ybWF0dGVkRmlsZSA9IEpTT04uc3RyaW5naWZ5KGZvcm1hdHRlZEZpbGUpOwoKICAgIGZvcm1hdHRlZEZpbGUgPSBjcnlwdG8uZW5jcnlwdChrZXksIGZvcm1hdHRlZEZpbGUpOwp9CgovL3B1Ymxpc2ggdGhlIGZpbGUKbGV0IHB1Ymxpc2hGaWxlID0gYXdhaXQgdGhpc0JvdC5hYlB1Ymxpc2hGaWxlKHtmaWxlOiBmb3JtYXR0ZWRGaWxlLCBmaWxlTmFtZTogYWJJRH0pOwoKLy9nYXRoZXIgYWRkaW9uYWwgZWdnIGRhdGEKZWdnQ2hlY2suZWdnRGF0YS5lZ2dWZXJzaW9uSGlzdG9yeS5wdXNoKHB1Ymxpc2hGaWxlLnVybCk7CmVnZ0NoZWNrLmVnZ0RhdGEubWF4VmVyc2lvbiA9IGVnZ0NoZWNrLmVnZ0RhdGEuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RoOwplZ2dDaGVjay5lZ2dEYXRhLnRhcmdldFZlcnNpb24gPSBlZ2dDaGVjay5lZ2dEYXRhLmVnZ1ZlcnNpb25IaXN0b3J5Lmxlbmd0aDsKCi8vcHVibGlzaCBlZ2cvYWIgcmVjb3JkCmxldCBwdWJsaXNoUmVjb3JkID0gYXdhaXQgdGhpc0JvdC5hYlB1Ymxpc2hSZWNvcmQoe2RhdGE6IGVnZ0NoZWNrLmVnZ0RhdGEsIHJlY29yZE5hbWU6IGFiSUQsIHB1YmxpY0ZhY2luZzogcHVibGljRmFjaW5nfSk7CmxldCBzaXRlT3JpZ2luID0gbmV3IFVSTChjb25maWdCb3QudGFncy51cmwpLm9yaWdpbjsKCi8vcHVibGlzaGluZyBzaG91dApzdXBlclNob3V0KCJvbkFCUHVibGlzaGVkIiwge3N1Y2Nlc3M6IHB1Ymxpc2hGaWxlLnN1Y2Nlc3MsIGFiOiBhYklELCBmaWxlQWRkcmVzczogcHVibGlzaEZpbGUudXJsfSk7Cgpjb25zdCBzdHVkaW9MaW5rID0gY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQgPz8gYXV0aEJvdC5pZDsKCi8vc2VuZCBkYXRhIGFuZCBmb3JtYXQgdXJsIGlmIGRhdGEgc3VjY2Vzc2Z1bGx5IHNlbnQKaWYgKHB1Ymxpc2hSZWNvcmQuc3VjY2VzcykKewogICAgY29uc3QgYmlvcyA9IHB1YmxpY0ZhY2luZyA/ICJmcmVlJTIwaW5zdCIgOiAibG9jYWwlMjBpbnN0IjsKICAgIGNvbnN0IGluc3RUeXBlID0gcHVibGljRmFjaW5nID8gImZyZWUiIDogImxvY2FsIgoKICAgIHNldFRhZ01hc2sobGlua3MubGVhcm4sICJhYlhQIiwgIjAiLCAibG9jYWwiKTsKCiAgICBpZiAoa2V5ICYmIGNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2gpIAogICAgewogICAgICAgIG9zLnNldENsaXBib2FyZChzaXRlT3JpZ2luICsgIi8/cGF0dGVybj0iICsgYWJJRCArICIma2V5PSIgKyBrZXkgKyAiJnN0dWRpbz0iICsgc3R1ZGlvTGluayArICImYmlvcz0iICsgYmlvcyk7CiAgICAgICAgCiAgICAgICAgb3MudG9hc3QoYGVuY3J5cHRlZCBkYXRhIHdpdGggYSAke2luc3RUeXBlfSBpbnN0IHVybCBjb3BpZWQgdG8gY2xpcGJvYXJkYCk7CiAgICB9CiAgICBlbHNlIGlmIChjb25maWdCb3QudGFncy5tYW51YWxQdWJsaXNoKQogICAgewogICAgICAgIG9zLnNldENsaXBib2FyZChzaXRlT3JpZ2luICsgIi8/cGF0dGVybj0iICsgYWJJRCArICImc3R1ZGlvPSIgKyBzdHVkaW9MaW5rICsgIiZiaW9zPSIgKyBiaW9zKTsKCiAgICAgICAgb3MudG9hc3QoYCR7aW5zdFR5cGV9IGluc3QgdXJsIGNvcGllZCB0byBjbGlwYm9hcmRgKTsKICAgIH0KCiAgICB0cnkgCiAgICB7CiAgICAgICAgYXdhaXQgYW5hbHl0aWNzLnJlY29yZEV2ZW50KCdhYl9lZ2dfcHVibGlzaCcsIHsgYWI6IGFiSUQsIHZlcnNpb246IGVnZ0NoZWNrLmVnZ0RhdGEuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RoIH0pOwogICAgfQogICAgY2F0Y2ggKGUpIAogICAgewogICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgfQp9CmVsc2UKewogICAgaWYgKCFjb25maWdCb3QudGFncy5hYlNpbGVudE1vZGUpCiAgICB7CiAgICAgICAgb3MudG9hc3QoInB1Ymxpc2hpbmcgZmFpbGVkLCBwbGVhc2UgdHJ5IGFnYWluIik7CiAgICB9CgogICAgYWIubG9nKGFiUmVtZW1iZXIudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IHB1Ymxpc2hpbmcgZmFpbGVkIik7CiAgICAKICAgIGNvbnNvbGUubG9nKHB1Ymxpc2hSZWNvcmQpOwp9CgovL2NsZWFyIHByb2dyZXNzIGJhcgppZiAocHJvZ3Jlc3NCdXR0b24pCnsKICAgIGRlc3Ryb3kocHJvZ3Jlc3NCdXR0b24pOwp9Cgpjb25maWdCb3QudGFncy5tYW51YWxQdWJsaXNoID0gbnVsbDsKCnJldHVybiBwdWJsaXNoUmVjb3JkOycA3t+DxQWlVghhYklnbm9yZQIEAN7fg8UFrOoBBHRydWUnAN7fg8UFpVYKYWJEb3dubG9hZAIEAN7fg8UFseoB3gRALy9kb3dubG9hZCBib3RzIChlaXRoZXIgc2VsZWN0ZWQgb3IgYWxsIGV4cGVyaWVuY2UpCmxldCBkb3dubG9hZEJvdHM7CgppZiAobGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1cykKewogICAgZG93bmxvYWRCb3RzID0gW2xpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXNdOwoKICAgIGFiLmxvZyhhYlJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBkb3dubG9hZGluZyBib3QiKTsKfQplbHNlCnsKICAgIGRvd25sb2FkQm90cyA9IGdldEJvdHMoYnlNb2QoeyJhYklnbm9yZSI6IG51bGwsICJzcGFjZSI6ICJzaGFyZWQifSkpOwoKICAgIGFiLmxvZyhhYlJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBkb3dubG9hZGluZyBpbnN0Iik7Cn0KCmlmICghQXJyYXkuaXNBcnJheShkb3dubG9hZEJvdHMpKQp7CiAgICBkb3dubG9hZEJvdHMgPSBbZG93bmxvYWRCb3RzXTsKfQoKbGV0IGN1cnJlbnRJbnN0ID0gb3MuZ2V0Q3VycmVudEluc3QoKTsKCm9zLmRvd25sb2FkQm90cyhkb3dubG9hZEJvdHMsIGN1cnJlbnRJbnN0KTsKCnNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgpsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsnAN7fg8UFpVYNbWFuaWZlc3RhdGlvbgIEAN7fg8UFkO8BKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAN7fg8UFpVYEbWVudQIEAN7fg8UFt+8BKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAN7fg8UFpVYSYWJQcmV2aW91c0VnZ0NoZWNrAgQA3t+DxQXe7wHZD0AvL3RoaXMgZnVuY3Rpb24gY2hlY2tzIGZvciBwcmV2aW91cyBlZ2dzIGF0IGEgc3BlY2lmaWVkIGFiLCByZXR1cm5pbmcgYW55IGRhdGEgdGhhdCBpdCBmaW5kcwpjb25zdCBhYklEID0gdGhhdC5hYklEOwoKYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsKCmxldCBlZ2dIaXN0b3J5OwpsZXQgZWdnSUQ7CmxldCB0YXJnZXRWZXJzaW9uTnVtOwpsZXQgbGFzdEhhc2g7CmxldCBtYXhWZXJzaW9uTnVtOwpsZXQgc3RhYmxlVmVyc2lvbjsKbGV0IGZlZWRiYWNrVmVyc2lvbjsKbGV0IHByZXZpb3VzWFA7CmxldCB1c2VyUmVjb3JkID0gY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQgPyBjb25maWdCb3QudGFncy5zZWxlY3RlZF9zdHVkaW9JRCA6IGNvbmZpZ0JvdC50YWdzLnN0dWRpbyA/IGNvbmZpZ0JvdC50YWdzLnN0dWRpbyA6IGF1dGhCb3QuaWQ7CmxldCByZWNvcmRMb29rdXAgPSBhd2FpdCBvcy5nZXREYXRhKHVzZXJSZWNvcmQsIGFiSUQpLmNhdGNoKGUgPT4ge30pOwoKaWYgKHJlY29yZExvb2t1cC5zdWNjZXNzKSAKewogICAgZWdnSGlzdG9yeSA9IHJlY29yZExvb2t1cC5kYXRhLmVnZ1ZlcnNpb25IaXN0b3J5OwogICAgZWdnSUQgPSByZWNvcmRMb29rdXAuZGF0YS5lZ2dJRDsKICAgIHByZXZpb3VzWFAgPSByZWNvcmRMb29rdXAuZGF0YS54cCA/PyAwOwogICAgdGFyZ2V0VmVyc2lvbk51bSA9IGVnZ0hpc3RvcnkubGVuZ3RoICsgMTsKICAgIGxhc3RIYXNoID0gZWdnSGlzdG9yeVt0YXJnZXRWZXJzaW9uTnVtIC0gMV07CiAgICBzdGFibGVWZXJzaW9uID0gcmVjb3JkTG9va3VwLmRhdGEuc3RhYmxlVmVyc2lvbjsKICAgIGZlZWRiYWNrVmVyc2lvbiA9IHJlY29yZExvb2t1cC5kYXRhLmZlZWRiYWNrVmVyc2lvbjsKICAgIG1heFZlcnNpb25OdW0gPSBlZ2dIaXN0b3J5Lmxlbmd0aCArIDE7Cn0gCmVsc2UgCnsKICAgIGVnZ0hpc3RvcnkgPSBbXTsKICAgIGVnZ0lEID0gdXVpZCgpOwogICAgdGFyZ2V0VmVyc2lvbk51bSA9IDE7CiAgICBsYXN0SGFzaCA9ICJub25lIjsKICAgIG1heFZlcnNpb25OdW0gPSAxOwogICAgcHJldmlvdXNYUCA9IDA7Cn0KCmlmIChjb25maWdCb3QudGFncy52ZXJzaW9uRGVmaW5lZCA9PSAiZmVlZGJhY2siKSAKewogICAgZmVlZGJhY2tWZXJzaW9uID0gZWdnSGlzdG9yeS5sZW5ndGggKyAxOwp9CmVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnZlcnNpb25EZWZpbmVkID09ICJzdGFibGUiKQp7CiAgICBzdGFibGVWZXJzaW9uID0gZWdnSGlzdG9yeS5sZW5ndGggKyAxOwp9Cgpjb25maWdCb3QudGFncy52ZXJzaW9uRGVmaW5lZCA9IG51bGw7CgpsZXQgZWdnID0ge307CgplZ2cuZWdnVmVyc2lvbkhpc3RvcnkgPSBlZ2dIaXN0b3J5OwplZ2cuZWdnRm9ybWF0VmVyc2lvbiA9IGVnZ0lEOwplZ2cudGFyZ2V0VmVyc2lvbiA9IHRhcmdldFZlcnNpb25OdW07CmVnZy5tYXhWZXJzaW9uID0gbWF4VmVyc2lvbk51bTsKZWdnLmxhYmVsID0gInYiK3RhcmdldFZlcnNpb25OdW07CmVnZy5zdGFibGVWZXJzaW9uID0gc3RhYmxlVmVyc2lvbjsKZWdnLmZlZWRiYWNrVmVyc2lvbiA9IGZlZWRiYWNrVmVyc2lvbjsKZWdnLmFiSUQgPSBhYklEOwplZ2cueHAgPSBsaW5rcy5sZWFybi50YWdzLmFiWFA7CgpsZXQgc2lnbmF0dXJlID0ge307CmxldCBkYXRlID0gbmV3IERhdGUoKTsKbGV0IHRpbWUgPSBkYXRlLmdldFRpbWUoKTsKCnNpZ25hdHVyZS5wcmV2aW91c0hhc2ggPSBsYXN0SGFzaDsKc2lnbmF0dXJlLmFiVmVyc2lvbiA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJDb3JlVmVyc2lvbisiLiIrbGlua3MucmVtZW1iZXIudGFncy5hYkNvcmVJdGVyYXRpb247CnNpZ25hdHVyZS5lZ2dWZXJzaW9uID0gdGFncy5lZ2dVVUlEOwpzaWduYXR1cmUuZWdnVmVyc2lvbk51bSA9IHRhZ3Mub3ZvVmVyc2lvbjsKc2lnbmF0dXJlLnRpbWVTdGFtcCA9IHRpbWU7CnNpZ25hdHVyZS5jYXN1YWxPU1ZlcnNpb24gPSBbb3MudmVyc2lvbigpXTsKCnJldHVybiB7c2lnbmF0dXJlOiBzaWduYXR1cmUsIGVnZ0RhdGE6IGVnZ307KADe34PFBaVWDGFiQm90VmVyc2lvbgF9uQInAN7fg8UFpVYPYWJCb3RNZW51QWN0aW9uAgQA3t+DxQW5/wFNQGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90KCk7CgovL3NldCB1cCB0aGUgcHVibGlzaCBtZW51CnRoaXNCb3Qub25TdG9yZU1lbnUoKTsnAN7fg8UFpVYOYWJCb3RNZW51TGFiZWwCBADe34PFBYeAAgVzaGFyZScA3t+DxQWlVg1hYkJvdE1lbnVJY29uAgQA3t+DxQWNgAIJaW9zX3NoYXJlJwDe34PFBaVWEmFiQm90TWVudVNvcnRPcmRlcgIEAN7fg8UFl4ACATMnAN7fg8UFpVYFbGVhcm4CBADe34PFBZmAAijwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwDe34PFBaVWDWFiUHVibGlzaFVVQUICBADe34PFBcCAAqcPQGNvbmZpZ0JvdC50YWdzLnV1YWJTY2FuID0gbnVsbDsKCmxldCB1dWFiQ29uZmlnID0gYXdhaXQgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBjb25maWdCb3QudGFncy51dWFiLCByZXR1cm5UeXBlOiAiZGF0YSJ9KTsKCmxldCBwaW4gPSBhd2FpdCBvcy5zaG93SW5wdXQobnVsbCx7CiAgICB0aXRsZTogImVudGVyIHBpbiIsCiAgICB0eXBlOiAic2VjcmV0Igp9KTsKCmlmIChwaW4pCnsKICAgIGxldCBwaCA9IGNyeXB0by5zaGEyNTYocGluKS5zdWJzdHJpbmcoMCw0KTsKCiAgICBpZiAocGggPT0gY29uZmlnQm90LnRhZ3MucGgpCiAgICB7CiAgICAgICAgbGV0IHJlY29yZEtleTsKICAgICAgICBsZXQgZWdnRGF0YUNoZWNrOwogICAgICAgIGxldCBlZ2dEYXRhOwoKICAgICAgICBmb3IgKHRhZyBpbiB1dWFiQ29uZmlnLnN0YXRlKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKHRhZykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmVjb3JkS2V5ID0gdXVhYkNvbmZpZy5zdGF0ZVt0YWddLnRhZ3MucmVjb3JkS2V5OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGhhdCkKICAgICAgICB7CiAgICAgICAgICAgIGVnZ0RhdGFDaGVjayA9IGF3YWl0IG9zLmdldERhdGEocmVjb3JkS2V5LCB0aGF0LnRhcmdldFJlY29yZCk7CgogICAgICAgICAgICBpZiAoZWdnRGF0YUNoZWNrLnN1Y2Nlc3MpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmIChlZ2dEYXRhQ2hlY2suZGF0YS5lZ2dzKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHRyeQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgZWdnRGF0YSA9IEpTT04ucGFyc2UoZWdnRGF0YUNoZWNrLmRhdGEuZWdncyk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWdnRGF0YS5sZW5ndGggPj0gMTIpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9zLnRvYXN0KCJwcmFjdGljZSBwZXJtaXQgZnVsbCIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3V0KCJhYlJlZnJlc2giKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2F0Y2gKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJlZ2cgZGF0YSBub3QgcmVhZGFibGUiKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGVnZ0RhdGEgPSBbXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYlJlY29yZEtleSA9IHJlY29yZEtleTsKCiAgICAgICAgY29uZmlnQm90LnRhZ3MubWFudWFsUHVibGlzaCA9IHRydWU7CgogICAgICAgIHRoaXNCb3QuYWJQdWJsaXNoQUIoe2FiOiBjb25maWdCb3QudGFncy5hYiwga2V5OiBjb25maWdCb3QudGFncy5rZXl9KTsKCiAgICAgICAgZWdnRGF0YS5wdXNoKGNvbmZpZ0JvdC50YWdzLmFiKTsKCiAgICAgICAgZWdnRGF0YVRvUHVibGlzaCA9IHtlZ2dzOiBKU09OLnN0cmluZ2lmeShlZ2dEYXRhKX07CgogICAgICAgIGF3YWl0IG9zLnJlY29yZERhdGEocmVjb3JkS2V5LCB0aGF0LnRhcmdldFJlY29yZCwgZWdnRGF0YVRvUHVibGlzaCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgYXdhaXQgb3MudG9hc3QoInBpbiBkb2VzIG5vdCBtYXRjaCIsIDIpOwoKICAgICAgICBzaG91dCgiYWJSZWZyZXNoIik7CiAgICB9Cn0KZWxzZQp7CiAgICBhd2FpdCBvcy50b2FzdCgibm8gcGluIGdpdmVuIiwgMik7CgogICAgc2hvdXQoImFiUmVmcmVzaCIpOwoKICAgIHJldHVybgp9JwDe34PFBaVWC2FiUVJQdWJsaXNoAgQA3t+DxQXojwLvBEBjb25maWdCb3QudGFncy5wdWJsaXNoU2NhbiA9IG51bGw7CgpsZXQgc2Nhbm5lZFVSTDsKCnRyeSAKewogICAgc2Nhbm5lZFVSTCA9IG5ldyBVUkwodGhhdCk7Cn0KY2F0Y2ggKGUpIHsKICAgIHNob3V0KCJhYlB1Ymxpc2hBQiIsIHthYjogdGhhdH0pOwoKICAgIHRoaXNCb3QuYWJQdWJsaXNoQUIoe2FiOiB0aGF0fSk7CgogICAgcmV0dXJuOwp9CgppZiAoc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJwaCIpKSAKewogICAgbGV0IHRhcmdldFJlY29yZCA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmdldCgiaW5zdCIpOwoKICAgIGNvbmZpZ0JvdC50YWdzLnV1YWIgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5nZXQoImFiIik7CiAgICBjb25maWdCb3QudGFncy5waCA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmdldCgicGgiKTsKICAgIGNvbmZpZ0JvdC50YWdzLmFiID0gdXVpZCgpOwogICAgY29uZmlnQm90LnRhZ3Mua2V5ID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJwaCIpOwoKICAgIHRoaXNCb3QuYWJQdWJsaXNoVVVBQih7dGFyZ2V0UmVjb3JkOiB0YXJnZXRSZWNvcmR9KTsKfQplbHNlIAp7CiAgICBvcy50b2FzdCgidW5zdXBwb3J0ZWQgdXJsIGZvcm1hdCIpOwp9JwDe34PFBaVWBnNlYXJjaAIEAN7fg8UF2JQCKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAN7fg8UFpVYHYWJTaGVsbAIEAN7fg8UF/5QCBHRydWUnAN7fg8UFpVYMc3R1ZGlvU2VsZWN0AgQA3t+DxQWElQLRC0AvL3Nob3V0KCJhYk1lbnVSZWZyZXNoIik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYlN0dWRpb01lbnUiOwoKbGlua3MubWVudS5tYXNrcy5vbkdyaWRDbGljayA9ICJAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOyI7Cgpjb25zdCBzdHVkaW9zID0gdGhhdC5zdHVkaW9zOwpjb25zdCB0YXJnZXRTdHVkaW8gPSBjb25maWdCb3QudGFncy5zZWxlY3RlZF9zdHVkaW9JRCA/IGNvbmZpZ0JvdC50YWdzLnNlbGVjdGVkX3N0dWRpb0lEIDogY29uZmlnQm90LnRhZ3Muc3R1ZGlvID8gY29uZmlnQm90LnRhZ3Muc3R1ZGlvIDogYXV0aEJvdC5pZDsKY29uc3QgbWVudUJ1dHRvbiA9IHt9OwoKbWVudUJ1dHRvbi5hYlN0dWRpb01lbnUgPSB0cnVlOwptZW51QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IDA7Cm1lbnVCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbWVudUJ1dHRvbi5hYlN0dWRpb01lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwptZW51QnV0dG9uLmxhYmVsID0gInBsYXllciBzdHVkaW8iOwptZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gdGFyZ2V0U3R1ZGlvID09IGF1dGhCb3QuaWQgPyAicmFkaW9fYnV0dG9uX2NoZWNrZWQiIDogInJhZGlvX2J1dHRvbl91bmNoZWNrZWQiOwptZW51QnV0dG9uLmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKbWVudUJ1dHRvbi5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKbWVudUJ1dHRvbi5zdHVkaW9JRCA9IGF1dGhCb3QuaWQ7Cm1lbnVCdXR0b24ub25DbGljayA9IGBAIGNvbmZpZ0JvdC50YWdzLnNlbGVjdGVkX3N0dWRpb0lEID0gdGFncy5zdHVkaW9JRDsKCmxpbmtzLm1hbmFnZXIubGlua3Muc3R1ZGlvU2VsZWN0QnV0dG9uLnRhZ3MubGFiZWwgPSB0YWdzLmxhYmVsOwoKc2hvdXQoImFiU3R1ZGlvTWVudVJlZnJlc2giKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7YDsKCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwoKZm9yIChsZXQgaSA9IDA7IGkgPCBzdHVkaW9zLmxlbmd0aDsgaSsrKQp7CiAgICBsZXQgYWN0aXZlU3R1ZGlvID0gc3R1ZGlvc1tpXTsKICAgIGNvbnNvbGUubG9nKCJBQ1RJVkUiLCB0YXJnZXRTdHVkaW8gKyAiLCAiICsgYWN0aXZlU3R1ZGlvLnN0dWRpb0lkKQogICAgbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9IHRhcmdldFN0dWRpbyA9PSBhY3RpdmVTdHVkaW8uc3R1ZGlvSWQgPyAicmFkaW9fYnV0dG9uX2NoZWNrZWQiIDogInJhZGlvX2J1dHRvbl91bmNoZWNrZWQiOwogICAgbWVudUJ1dHRvbi5sYWJlbCA9IGFjdGl2ZVN0dWRpby5kaXNwbGF5TmFtZTsKICAgIG1lbnVCdXR0b24uc3R1ZGlvSUQgPSBhY3RpdmVTdHVkaW8uc3R1ZGlvSWQ7CgogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7Cn0nAN7fg8UFpVYOYWJQdWJsaXNoQXNrSUQCBADe34PFBdSgAvQEQGxldCBwcm9ncmVzc0J1dHRvbiA9IGF3YWl0IGxpbmtzLmlucHV0LmFiUHJvZ3Jlc3NCYXIoYHB1Ymxpc2hpbmcgJHt0aGF0LmFza0lEfWApOwoKYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsKCmNvbnN0IHBhdHRlcm5JRCA9IHRoYXQucGF0dGVybklEOwpjb25zdCBzdHVkaW9JRCA9IHRoYXQuc3R1ZGlvSUQgPyB0aGF0LnN0dWRpb0lEIDogY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQgPyBjb25maWdCb3QudGFncy5zZWxlY3RlZF9zdHVkaW9JRCA6IGF1dGhCb3QuaWQ7CmNvbnN0IGFza0lEID0gImFza18iICsgdGhhdC5hc2tJRC5yZXBsYWNlQWxsKCItIiwgIiIpOwpjb25zdCBlbmRwb2ludCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJFbmRwb2ludDsKY29uc3QgcHVibGlzaEFzayA9IGF3YWl0IG9zLnJlY29yZERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYlJlY29yZEtleSwgYXNrSUQsIHtwYXR0ZXJuSUQ6IHBhdHRlcm5JRCwgc3R1ZGlvSUQ6IHN0dWRpb0lEfSwge2VuZHBvaW50OiBlbmRwb2ludCwgdXBkYXRlUG9saWN5OiBbYXV0aEJvdC5pZF19KTsKCmlmIChwcm9ncmVzc0J1dHRvbikKewogICAgZGVzdHJveShwcm9ncmVzc0J1dHRvbik7Cn0KCnJldHVybiBwdWJsaXNoQXNrOycA3t+DxQWlVgVpbnB1dAIEAN7fg8UFyaUCKPCflJdmODYwMjg3OC1jMmVmLTQ4YmQtODVhMC04ZDYzNTFlYjQxMjAnAN7fg8UFpVYLYWJFbWJlZExpbmsCBADe34PFBfClAqQDQGNvbnN0IGFiID0gdGhhdCA/IHRydWUgOiBmYWxzZTsKY29uc3QgZW1iZWRMaW5rID0gYWIgPyAiYWI9IiArIHRoYXQgOiAiaW5zdD0iICsgY29uZmlnQm90LnRhZ3MuaW5zdDsKY29uc3Qgc2l0ZU9yaWdpbiA9IG5ldyBVUkwoY29uZmlnQm90LnRhZ3MudXJsKS5vcmlnaW47CmNvbnN0IGVtYmVkVGV4dCA9IGA8IURPQ1RZUEUgaHRtbD4KwqDCoMKgwqA8aHRtbD4KwqDCoMKgwqDCoMKgwqDCoDxoZWFkPjwvaGVhZD4KwqDCoMKgwqDCoMKgwqDCoDxib2R5PgrCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqA8aWZyYW1lIHNyYz0iJHtzaXRlT3JpZ2luICsgIi8/IiArIGVtYmVkTGlua30iIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjQwMCIgLz4KwqDCoMKgwqDCoMKgwqDCoDwvYm9keT4KwqDCoMKgwqA8L2h0bWw+YDsKCnJldHVybiBlbWJlZFRleHQ7JwDe34PFBaVWD2FiUGF0dGVyblVwZGF0ZQIEAN7fg8UF6agC7ARALy9zaG91dCgiYWJQYXR0ZXJuVXBkYXRlIiwge2FiSUQ6IGFiSUQsIHN0dWRpbzpzdHVkaW8/LCBib3RzOiBib3RzP30pOwphd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwoKaWYgKCFhdXRoQm90KQp7CiAgICByZXR1cm47Cn0KCmNvbnN0IGFiSUQgPSB0aGF0LmFiSUQ7CmNvbnN0IHN0dWRpbyA9IHRoYXQuc3R1ZGlvID8gdGhhdC5zdHVkaW8gOiBjb25maWdCb3QudGFncy5zdHVkaW8gPyBjb25maWdCb3QudGFncy5zdHVkaW8gOiBhdXRoQm90LmlkOwpjb25zdCBhYk1hbmlmZXN0ID0gZ2V0Qm90KGJ5TW9kKHthYkFydGlmYWN0OiB0cnVlLCBvcmlnaW5fYWI6IGFiSUR9KSk7CgppZiAoIWFiTWFuaWZlc3QpCnsKICAgIHNob3V0KCJvbkxvb2t1cEFCRWdncyIsIHthYklEOiBhYklELCByZWNvcmRLZXk6IHN0dWRpbywgYXV0b0hhdGNoOiB0cnVlfSk7CgogICAgcmV0dXJuOwp9Cgpjb25maWdCb3QudGFncy5zZWxlY3RlZF9zdHVkaW9JRCA9IHN0dWRpbzsKCmNvbnN0IGFiQm90cyA9IHRoYXQuYm90cyA/PyBnZXRCb3RzKCJhYklET3JpZ2luIiwgYWJJRCk7Cgphd2FpdCB0aGlzQm90LmFiUHVibGlzaEFCKHthYjogYWJJRCwgdGFyZ2V0OiBhYkJvdHMsIHB1YmxpY0ZhY2luZzogdHJ1ZX0pOycBBGJvdHMkZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1AScA3t+DxQXWrQIGc3lzdGVtAgQA3t+DxQXXrQIPYWIuc2hlbGwuc2VhcmNoJwDe34PFBdatAgRmb3JtAgQA3t+DxQXnrQIHbm90aGluZycA3t+DxQXWrQIOYWJSZXRyaWV2ZUZpbGUCBADe34PFBe+tAoIBQC8vcHVsbCBkb3duIGZpbGUgZGF0YQppZiAoIXRoYXQudXJsKQp7CiAgICByZXR1cm4gIm5vIGZpbGUgdXJsIHN1cHBsaWVkIjsKfQoKbGV0IGRhdGEgPSBhd2FpdCBvcy5nZXRGaWxlKHRoYXQudXJsKTsKCnJldHVybiBkYXRhOycA3t+DxQXWrQIQYWJSZXRyaWV2ZVJlY29yZAIEAN7fg8UF8q4C7ARALy9yZXRyaWV2ZSBzcGVjaWZpZWQgcmVjb3JkCmxldCByZWNvcmROYW1lID0gdGhhdC5yZWNvcmROYW1lOwoKbGV0IHJlY29yZEtleSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSZWNvcmRLZXk7CgppZiAodGhhdC5yZWNvcmRLZXkpCnsKICAgIHJlY29yZEtleSA9IHRoYXQucmVjb3JkS2V5Owp9CmVsc2UgaWYgKGF1dGhCb3QpCnsKICAgIGlmIChhdXRoQm90LmlkID09IGNvbmZpZ0JvdC50YWdzLnN0dWRpbykKICAgIHsKICAgICAgICByZWNvcmRLZXkgPSBhdXRoQm90LmlkOwoKICAgICAgICBhd2FpdCBvcy5ncmFudEluc3RBZG1pblBlcm1pc3Npb24ocmVjb3JkS2V5KTsKICAgIH0KfQoKbGV0IHJlY29yZEVuZHBvaW50ID0gdGhhdC5yZWNvcmRFbmRwb2ludCA/IHRoYXQucmVjb3JkRW5kcG9pbnQgOiBsaW5rcy5yZW1lbWJlci50YWdzLmFiRW5kcG9pbnQ7CgppZiAoIXJlY29yZE5hbWUpCnsKICAgIHJldHVybiAibm8gcmVjb3JkIG5hbWUgc3VwcGxpZWQiOwp9CgpsZXQgZ2V0UmVjb3JkID0gYXdhaXQgb3MuZ2V0RGF0YShyZWNvcmRLZXksIHJlY29yZE5hbWUsIHJlY29yZEVuZHBvaW50KTsKCi8vQUREIGFkZGl0aW9uYWwgZXJyb3IgaGFuZGxpbmc/CgpyZXR1cm4gZ2V0UmVjb3JkOycA3t+DxQXWrQIIcmVtZW1iZXICBADe34PFBd+zAijwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwDe34PFBdatAg1tYW5pZmVzdGF0aW9uAgQA3t+DxQWGtAIo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcA3t+DxQXWrQIOb25Mb29rdXBBQkVnZ3MCBADe34PFBa20ApIiQC8vc2hvdXQoIm9uTG9va3VwQUJFZ2dzIiwge2FiSUQ6IGFiSUQsIGtleToga2V5LCBhdXRvSGF0Y2g6IGJvb2xlYW4sIHJldHVyblR5cGU6IGRhdGEvbnVsbH0pOwphYi5sb2coYWJSZW1lbWJlci50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogbG9hZGluZyAiICsgdGhhdC5hYklEKTsKCi8vY2xlYXIgYWItMQppZiAobGlua3MubWFuaWZlc3RhdGlvbikKewogICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7Cn0KCmxldCBwcm9ncmVzc0J1dHRvbiA9IGF3YWl0IGxpbmtzLmlucHV0LmFiUHJvZ3Jlc3NCYXIoYGxvYWRpbmcgJHt0aGF0LmFiSUR9YCk7CgovL2NvbnN0YW50cyBpbiByZWdhcmRzIHRvIHRoZSBhYiB0byBiZSBsb29rZWQgdXAKY29uc3QgYWJJRCA9IHRoYXQuYWJJRDsKY29uc3QgaW5pdGlhbEJvb3QgPSB0aGF0LmluaXRpYWxCb290Owpjb25zdCBhdXRvSGF0Y2ggPSB0aGF0LmF1dG9IYXRjaDsKCi8vcmVjb3JkS2V5IGlzIHZhcmlhYmxlIGRlcGVuZGluZyBvbiBpZiBwdWJsaWMKbGV0IHJlY29yZEtleSA9IHRoYXQucmVjb3JkS2V5ID8/IGNvbmZpZ0JvdC50YWdzLnN0dWRpbzsKbGV0IHBvc3NpYmxlQXV0aCA9IGF1dGhCb3QgPyBhdXRoQm90IDogdHJ1ZTsKbGV0IGdldFJlY29yZCA9IGF3YWl0IG9zLmdldERhdGEocmVjb3JkS2V5LCBhYklEKTsKCi8vdmFyaWFibGVzIGZvciBlZ2cvYWIgaGF0Y2hpbmcKbGV0IHJldHVyblR5cGUgPSB0aGF0LnJldHVyblR5cGU7CmxldCBrZXkgPSB0aGF0LmtleTsKbGV0IG5ld0VnZzsKCi8vdGhpcyBsb2dpYyBoYW5kbGVzIHRoZSByZXRyaWV2ZWQgZGF0YSwgc2VhcmNoZXMgYWdhaW4gaWYgbm9uZSBjYW1lIHRocm91Z2gKaWYgKCFnZXRSZWNvcmQuc3VjY2VzcyAmJiBwb3NzaWJsZUF1dGguaWQgPT0gcmVjb3JkS2V5ICYmIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSZWNvcmRLZXkgJiYgZ2V0UmVjb3JkLmVycm9yQ29kZSAhPSAibm90X2F1dGhvcml6ZWQiKQp7CiAgICBnZXRSZWNvcmQgPSBhd2FpdCBvcy5nZXREYXRhKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSZWNvcmRLZXksIGFiSUQpOwp9CmVsc2UgaWYgKCFnZXRSZWNvcmQuc3VjY2VzcykKewogICAgaWYgKCFyZWNvcmRLZXkpCiAgICB7CiAgICAgICAgYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsKCiAgICAgICAgcmVjb3JkS2V5ID0gYXV0aEJvdC5pZDsKICAgIH0KCiAgICBhd2FpdCBvcy5ncmFudEluc3RBZG1pblBlcm1pc3Npb24ocmVjb3JkS2V5KTsKCiAgICBnZXRSZWNvcmQgPSBhd2FpdCBvcy5nZXREYXRhKHJlY29yZEtleSwgYWJJRCk7Cn0KCmlmICghZ2V0UmVjb3JkLnN1Y2Nlc3MpCnsKICAgIG9zLnRvYXN0KGBubyBkYXRhIGZvdW5kIGluICR7YWJJRH1gKTsKCiAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKICAgIGlmIChwcm9ncmVzc0J1dHRvbikKICAgIHsKICAgICAgICBkZXN0cm95KHByb2dyZXNzQnV0dG9uKTsKICAgIH0KCiAgICByZXR1cm4ge3N1Y2Nlc3M6IGZhbHNlfTsKfQplbHNlCnsKICAgIC8vcGFja2FnZSB0aGUgcmVjb3JkIGRhdGEKICAgIG5ld0VnZyA9IGdldFJlY29yZC5kYXRhOwp9CgphYi5sb2coYWJSZW1lbWJlci50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogIiArIHRoYXQuYWJJRCArICIgbG9hZGVkLCB2ZXJzaW9uICIgKyBnZXRSZWNvcmQuZGF0YS50YXJnZXRWZXJzaW9uICsgIiBvZiAiICsgZ2V0UmVjb3JkLmRhdGEubWF4VmVyc2lvbik7CgovL3RoaXMgbG9naWMgcGFyc2VzIHRoZSBkYXRhIGRlcGVuZGFudCBvbiBob3cgaXQgd2FzIGFjY2Vzc2VkL2dhaW5lZAppZiAocmV0dXJuVHlwZSA9PSAiZGF0YSIgJiYgZ2V0UmVjb3JkLnN1Y2Nlc3MpCnsKICAgIGxldCB2ZXJzaW9uID0gZ2V0UmVjb3JkLmRhdGEudGFyZ2V0VmVyc2lvbiAtIDE7CgogICAgaWYgKHRoYXQuYWJWZXJzaW9uKQogICAgewogICAgICAgIGlmICghaXNOYU4odGhhdC5hYlZlcnNpb24pKQogICAgICAgIHsKICAgICAgICAgICAgdmVyc2lvbiA9IHRoYXQuYWJWZXJzaW9uIC0gMTsKICAgICAgICB9CiAgICB9CgogICAgbGV0IGVnZ0RhdGFVUkwgPSBnZXRSZWNvcmQuZGF0YS5lZ2dWZXJzaW9uSGlzdG9yeVt2ZXJzaW9uXTsKICAgIGxldCByZXR1cm5EYXRhID0gYXdhaXQgb3MuZ2V0RmlsZShlZ2dEYXRhVVJMKTsKCiAgICBpZiAocHJvZ3Jlc3NCdXR0b24pCiAgICB7CiAgICAgICAgZGVzdHJveShwcm9ncmVzc0J1dHRvbik7CiAgICB9CgogICAgcmV0dXJuIHJldHVybkRhdGE7Cn0KZWxzZSBpZiAocmV0dXJuVHlwZSA9PSAiZGF0YSIpCnsKICAgIGxldCB2ZXJzaW9uQXJyYXkgPSBKU09OLnBhcnNlKG5ld0VnZy5lZ2dWZXJzaW9uSGlzdG9yeSk7CiAgICBsZXQgZmlsZVVVSUQgPSB2ZXJzaW9uQXJyYXlbbmV3RWdnLm1heFZlcnNpb24gLSAxXTsKICAgIGxldCBmaWxlbmFtZWhhc2hMVE0gPSBjcnlwdG8uc2hhMjU2KGZpbGVVVUlEKTsKICAgIGxldCBmaWxldXJsaGFzaExUTSA9ICJhdXhfIiArIGZpbGVuYW1laGFzaExUTSArICcuYXV4JzsKICAgIGxldCB0YXJnZXRMVE1VUkwgPSAiaHR0cHM6Ly9idWlsZGVyLWx0bS1maWxlcy5zMy5hbWF6b25hd3MuY29tLyIgKyBmaWxldXJsaGFzaExUTTsKICAgIGxldCBvID0ge307CiAgICBvLm1ldGhvZCA9ICJHRVQiOwogICAgby51cmwgPSB0YXJnZXRMVE1VUkw7CgogICAgZmlsZUdldCA9IGF3YWl0IHdlYmhvb2sobyk7CgogICAgaWYgKHByb2dyZXNzQnV0dG9uKQogICAgewogICAgICAgIGRlc3Ryb3kocHJvZ3Jlc3NCdXR0b24pOwogICAgfQoKICAgIGlmIChmaWxlR2V0LnN0YXR1cyAhPSAyMDApCiAgICB7CiAgICAgICAgb3MudG9hc3QoIm5vIGZpbGUgZm91bmQiKTsKCiAgICAgICAgc2hvdXQoImFiUmVmcmVzaCIpOwoKICAgICAgICByZXR1cm4ge3N1Y2Nlc3M6IGZhbHNlfTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBmaWxlR2V0ID0gZmlsZUdldC5kYXRhOwogICAgfQoKICAgIHJldHVybiBmaWxlR2V0Owp9CgovL2FiIHNwZWNpZmljIHZhcmlhYmxlcyBmb3IgdW5kZXJzdGFuZGluZyBpZiBhIHBvc2l0aW9uIGlzIHNwZWNpZmllZApsZXQgY3VycmVudERpbTsKbGV0IHNwYWNlTW9kOwpsZXQgZGltZW5zaW9uWDsKbGV0IGRpbWVuc2lvblk7CmxldCBkaW1Nb2Q7CgovL2hhbmRsZSBkaW1lbnNpb24gaWRlbnRpZmljYXRpb24KaWYgKGxpbmtzLm1hbmlmZXN0YXRpb24pCnsKICAgIGlmIChsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KQogICAgewogICAgICAgIGNvbnN0IGFiQm90ID0gbGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdDsKCiAgICAgICAgY3VycmVudERpbSA9IGFiQm90LnRhZ3MuZGltZW5zaW9uOwogICAgfQp9CmVsc2UKewogICAgY3VycmVudERpbSA9IG9zLmdldEN1cnJlbnREaW1lbnNpb24oKTsKfQoKLy9jaGVja3MgZm9yIGdyaWQgZm9jdXMKaWYgKCFsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzKSAKewogICAgZGltZW5zaW9uWCA9IG51bGw7CiAgICBkaW1lbnNpb25ZID0gbnVsbDsKfQplbHNlCnsKICAgIGxldCBoYXRjaFBvaW50ID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsKCiAgICBjdXJyZW50RGltID0gaGF0Y2hQb2ludC5kaW1lbnNpb247CiAgICBkaW1lbnNpb25YID0gaGF0Y2hQb2ludC5wb3NpdGlvbi54OwogICAgZGltZW5zaW9uWSA9IGhhdGNoUG9pbnQucG9zaXRpb24ueTsKICAgIHNwYWNlTW9kID0ge3NwYWNlOiAic2hhcmVkIn07Cn0KCi8vdGhpcyBsb2dpYyBoYW5kbGVzIGxvZ2ljIGFyb3VuZCBhdXRvSGF0Y2ggdnMgbWFudWFsIGhhdGNoaW5nCmlmICghYXV0b0hhdGNoICYmIGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4gPT0gbnVsbCkKewogICAgZGltTW9kID0ge1tjdXJyZW50RGltXTogdHJ1ZSwgW2N1cnJlbnREaW0rIlgiXTogZGltZW5zaW9uWCwgW2N1cnJlbnREaW0rIlkiXTogZGltZW5zaW9uWSwgZGltZW5zaW9uOiBjdXJyZW50RGltfTsKfQplbHNlCnsKICAgIGlmIChjb25maWdCb3QudGFncy5rZXkgJiYgIXRoYXQua2V5KQogICAgewogICAgICAgIGtleSA9IGNvbmZpZ0JvdC50YWdzLmtleQogICAgfQoKICAgIGRpbU1vZCA9IHthdXRvSGF0Y2g6IHRydWUsIGtleToga2V5fTsKfQoKLy9jYWxsIGZvciBvdm8gd2l0aCBpbmZvcm1hdGlvbiBwcm92aWRlZAp0aGlzQm90Lm1hbmlmZXN0T3ZvKHthYklEOiBhYklELCBzdHVkaW86IHJlY29yZEtleSwgZGltTW9kOiBkaW1Nb2QsIHNwYWNlTW9kOiBzcGFjZU1vZCwgZWdnRGF0YTogbmV3RWdnLCBpbml0aWFsQm9vdDogaW5pdGlhbEJvb3QsIGVnZ1BhcmFtZXRlcnM6IHRoYXQuZWdnUGFyYW1ldGVyc30pOwoKaWYgKHByb2dyZXNzQnV0dG9uKQp7CiAgICBkZXN0cm95KHByb2dyZXNzQnV0dG9uKTsKfQoKcmV0dXJuIHtzdWNjZXNzOiB0cnVlfTsnAN7fg8UF1q0CC21hbmlmZXN0T3ZvAgQA3t+DxQXA1gKFDEAvL2VnZyB2aXN1YWxpemF0aW9uCnNob3V0KCJhYk1lbnVSZXNldCIpOwoKaWYgKGxpbmtzLm1hbmlmZXN0YXRpb24pCnsKICAgIGlmIChsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KQogICAgewogICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICB9Cn0KCmlmIChsaW5rcy5vdm9Cb3QpCnsKICAgIGRlc3Ryb3kobGlua3Mub3ZvQm90KTsKfQoKbGV0IHNwYWNlTW9kID0gdGhhdC5zcGFjZU1vZDsKbGV0IGRpbU1vZCA9IHRoYXQuZGltTW9kOwpsZXQgZWdnRGF0YSA9IHRoYXQuZWdnRGF0YTsKbGV0IGVnZ1BhcmFtZXRlcnMgPSB0aGF0LmVnZ1BhcmFtZXRlcnM7CmxldCBlZ2dNb2QgPSB7fTsKCmVnZ01vZC5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwplZ2dNb2QuaW5pdGlhbFRpbWVyID0gdHJ1ZTsKZWdnTW9kLmFiSUQgPSB0aGF0LmFiSUQ7CmVnZ01vZC5zdHVkaW8gPSB0aGF0LnN0dWRpbzsKZWdnTW9kLmluaXRpYWxCb290ID0gdGhhdC5pbml0aWFsQm9vdDsKZWdnTW9kLmVnZ1BhcmFtZXRlcnMgPSBlZ2dQYXJhbWV0ZXJzOwplZ2dNb2QubWFuYWdlciA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7CmVnZ01vZC5vbkNsaWNrID0gYEAgbGlua3MubWFuYWdlci5pbnRlcmFjdE92bygpO2A7CmVnZ01vZC5vbkNyZWF0ZSA9IGBAIGlmICh0YWdzLmF1dG9IYXRjaCkKewogICAgbGlua3MubWFuYWdlci5oYXRjaE92byh0aGlzQm90KTsKfQplbHNlCnsKICAgIHRhZ3MucHJvZ3Jlc3NCYXIgPSAwOyAKICAgIAogICAgY29uZmlnQm90LnRhZ3MudmVyc2lvbiA9IHRhZ3MubWF4VmVyc2lvbjsKCiAgICBzZXRUaW1lb3V0KCgpID0+IHt3aGlzcGVyKHRoaXNCb3QsICJlZ2dUaW1lciIpO30sIDc1KTsKfWA7CmVnZ01vZC5mb3JtID0gImVnZyI7CmVnZ01vZC5wcm9ncmVzc0JhckNvbG9yID0gIiNCRjVFNjYiOwplZ2dNb2QucHJvZ3Jlc3NCYXJCYWNrZ3JvdW5kQ29sb3IgPSAiIzU5Mjk4OSI7CmVnZ01vZC5sYWJlbFNpemUgPSAwLjU7CmVnZ01vZC5sYWJlbENvbG9yID0gIiM0MDQwNDAiOwplZ2dNb2Qub25Qb2ludGVyRW50ZXIgPSAiQCBvcy50b2FzdCh0YWdzLmFiSUQgKyAnIHYnK3RhZ3MudGFyZ2V0VmVyc2lvbik7IjsKZWdnTW9kLmxhYmVsUG9zaXRpb24gPSAiZnJvbnQiOwplZ2dNb2Qub3JpZW50YXRpb25Nb2RlID0gImJpbGxib2FyZEZyb250IjsKZWdnTW9kLm9uRGVzdHJveSA9IGBAIGxpbmtzLm1hbmFnZXIubWFza3Mub3ZvQm90ID0gbnVsbDtgOwplZ2dNb2QuZWdnVGltZXIgPSBgQCBpZiAodGFncy5wcm9ncmVzc0JhciA8IDEpIAp7CiAgICB0YWdzLnByb2dyZXNzQmFyICs9IDAuMTsKCiAgICBzZXRUaW1lb3V0KCgpID0+IHt3aGlzcGVyKHRoaXNCb3QsICJlZ2dUaW1lciIpO30sIDc1KTsKfQplbHNlCnsKICAgIHRoaXNCb3Qub25DbGljaygpOwogICAgCiAgICB0YWdzLnByb2dyZXNzQmFyID0gbnVsbDsKfWA7CgpsZXQgb3ZvID0gY3JlYXRlKGVnZ0RhdGEsIGVnZ01vZCwgZGltTW9kLCBzcGFjZU1vZCk7CgptYXNrcy5vdm9Cb3QgPSAi8J+UlyIgKyBvdm8uaWQ7JwDe34PFBdatAglvbktleURvd24CBADe34PFBcLiAtoFQC8vaGlkZGVuIHZlcnNpb24gYnV0dG9uIGZvciBoYXRjaCBtZW51CmlmICghbGlua3Mub3ZvQm90IHx8IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgIT0gIm92byIpCnsKICAgIHJldHVybjsKfQoKaWYgKHRoYXQua2V5cyA9PSAiU2hpZnQiKQp7CiAgICBsZXQgdmVyc2lvbkJ1dHRvbiA9IHt9OwoKICAgIHZlcnNpb25CdXR0b24ub3ZvID0gdHJ1ZTsKICAgIHZlcnNpb25CdXR0b24ub3ZvU29ydE9yZGVyID0gLTE7CiAgICB2ZXJzaW9uQnV0dG9uLm1heFZlcnNpb24gPSBsaW5rcy5vdm9Cb3QudGFncy5tYXhWZXJzaW9uOwogICAgdmVyc2lvbkJ1dHRvbi5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKICAgIHZlcnNpb25CdXR0b24ubGFiZWwgPSAiY2hhbmdlIGVnZyB2ZXJzaW9uIjsKICAgIHZlcnNpb25CdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAiY2VudGVyIjsKICAgIHZlcnNpb25CdXR0b24ub3ZvTWVudVJlc2V0ID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwogICAgdmVyc2lvbkJ1dHRvbi5jb2xvciA9ICIjRkZGRkZGIjsKICAgIHZlcnNpb25CdXR0b24ub25LZXlVcCA9ICJAIGlmKHRoYXQua2V5cyA9PSAnU2hpZnQnKXtkZXN0cm95KHRoaXNCb3QpfTsiOwogICAgdmVyc2lvbkJ1dHRvbi5vbkNsaWNrID0gIkAgbGlua3MubWFuYWdlci5jaGFuZ2VPdm9WZXJzaW9uKCk7IjsKCiAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbih2ZXJzaW9uQnV0dG9uKTsKfScA3t+DxQXWrQIIaGF0Y2hPdm8CBADe34PFBZvoAv4TQC8vbG9naWMgZm9yIGhhdGNoaW5nIG9mIGFuIGFiCnNob3V0KCdvdm9NZW51UmVzZXQnKTsKCi8vZGF0YSBpbiByZWdhcmRzIHRvIHdoYXQgYWIgaXMgZ29pbmcgdG8gYmUgaGF0Y2hlZApjb25zdCBvdm8gPSB0aGF0OwoKLy9oYXRjaCBzcGVjaWZpYyB2YXJpYWJsZXMKbGV0IGluaXRpYWxCb290ID0gb3ZvLnRhZ3MuaW5pdGlhbEJvb3Q7CmxldCB0YXJnZXRWZXJzaW9uID0gb3ZvLnRhZ3Muc3RhYmxlVmVyc2lvbiA/PyBvdm8udGFncy50YXJnZXRWZXJzaW9uOwoKaWYgKChjb25maWdCb3QudGFncy5hYlZlcnNpb24gfHwgY29uZmlnQm90LnRhZ3MucGF0dGVyblZlcnNpb24pICYmIChvdm8udGFncy5hYklEID09IGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4gfHwgb3ZvLnRhZ3MuYWJJRCA9PSBjb25maWdCb3QudGFncy5hYikpCnsKICAgIHRhcmdldFZlcnNpb24gPSBjb25maWdCb3QudGFncy5hYlZlcnNpb24gPz8gY29uZmlnQm90LnRhZ3MucGF0dGVyblZlcnNpb247Cn0KCi8vdGFyZ2V0ZWQgdmVyc2lvbnMKaWYgKGNvbmZpZ0JvdC50YWdzLnZlcnNpb24gJiYgKG92by50YWdzLmFiSUQgPT0gY29uZmlnQm90LnRhZ3MucGF0dGVybiB8fCBvdm8udGFncy5hYklEID09IGNvbmZpZ0JvdC50YWdzLmFiIHx8ICFpc05hTihjb25maWdCb3QudGFncy52ZXJzaW9uKSkpCnsKICAgIGlmIChjb25maWdCb3QudGFncy52ZXJzaW9uID09ICJmZWVkYmFjayIpCiAgICB7CiAgICAgICAgdGFyZ2V0VmVyc2lvbiA9IG92by50YWdzLmZlZWRiYWNrVmVyc2lvbjsKICAgIH0KICAgIGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnZlcnNpb24gPT0gImN1cnJlbnQiKQogICAgewogICAgICAgIHRhcmdldFZlcnNpb24gPSBvdm8udGFncy5lZ2dWZXJzaW9uSGlzdG9yeS5sZW5ndGg7CiAgICB9CiAgICBlbHNlIGlmICghaXNOYU4oY29uZmlnQm90LnRhZ3MudmVyc2lvbikpCiAgICB7CiAgICAgICAgdGFyZ2V0VmVyc2lvbiA9IGNvbmZpZ0JvdC50YWdzLnZlcnNpb24KICAgIH0KCiAgICBjb25maWdCb3QudGFncy52ZXJzaW9uID0gbnVsbDsKfQoKaWYgKGlzTmFOKHRhcmdldFZlcnNpb24pKQp7CiAgICB0YXJnZXRWZXJzaW9uID0gb3ZvLnRhZ3MuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RoOwp9CgpsZXQgdmVyc2lvbkFycmF5ID0gb3ZvLnRhZ3MuZWdnVmVyc2lvbkhpc3Rvcnk7CmxldCBmaWxlVVJMID0gdmVyc2lvbkFycmF5W3RhcmdldFZlcnNpb24gLSAxXTsKbGV0IGtleSA9IG92by50YWdzLmtleSA/IG92by50YWdzLmtleSA6IGNvbmZpZ0JvdC50YWdzLmtleTsKbGV0IGZpbGVHZXQ7CgovL2FjdHVhbCBmaWxlIHJldHJpZXZhbAp0cnkKewogICAgZmlsZUdldCA9IGF3YWl0IG9zLmdldEZpbGUoZmlsZVVSTCk7Cn0KY2F0Y2ggKGVycm9yKQp7CiAgICBjb25zb2xlLmxvZyhlcnJvcik7CgogICAgb3MudG9hc3QoIm5vIGZpbGUgZm91bmQiKTsKCiAgICByZXR1cm47Cn0KCi8vaGFuZGxpbmcgZm9yIGVuY3J5cHRlZCBhYiBmaWxlCmlmIChjcnlwdG8uaXNFbmNyeXB0ZWQoZmlsZUdldCkpCnsKICAgIGlmICgha2V5KQogICAgewogICAgICAgIGtleSA9IGF3YWl0IG9zLnNob3dJbnB1dCgnJywgewogICAgICAgICAgICB0eXBlOiAnc2VjcmV0JywKICAgICAgICAgICAgdGl0bGU6ICdFbnRlciBrZXknCiAgICAgICAgfSk7CiAgICB9CgogICAgdHJ5CiAgICB7CiAgICAgICAgZmlsZUdldCA9IGNyeXB0by5kZWNyeXB0KGtleSwgZmlsZUdldCk7CiAgICB9CiAgICBjYXRjaCAoZXJyb3IpCiAgICB7CiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpCgogICAgICAgIG9zLnRvYXN0KCJrZXkgZG9lcyBub3QgbWF0Y2ggZmlsZSIpOwoKICAgICAgICByZXR1cm47CiAgICB9CiAgIAogICAgZmlsZUdldCA9IEpTT04ucGFyc2UoZmlsZUdldCk7CgogICAgZmlsZUdldCA9IGZpbGVHZXQuc3RhdGU7Cn0KZWxzZQp7CiAgICBmaWxlR2V0ID0gZmlsZUdldC5zdGF0ZTsKfQoKLy9jbGVhbiB1cApkZXN0cm95KG92byk7CgovL3RvYXN0IGlmIG5vdCBvbiBzdGFibGUKaWYob3ZvLnRhZ3Muc3RhYmxlVmVyc2lvbiAhPSB0YXJnZXRWZXJzaW9uKQp7CiAgICBpZiAob3ZvLnRhZ3MuZmVlZGJhY2tWZXJzaW9uID09IHRhcmdldFZlcnNpb24pCiAgICB7CiAgICAgICAgb3MudG9hc3QoImxvYWRpbmcgZmVlZGJhY2sgdmVyc2lvbiBvZiAiICsgb3ZvLnRhZ3MuYWJJRCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgb3MudG9hc3QoImxvYWRpbmcgdmVyc2lvbiAiICsgdGFyZ2V0VmVyc2lvbiArICIgb2YgIiArIG92by50YWdzLmVnZ1ZlcnNpb25IaXN0b3J5Lmxlbmd0aCArICIgb2YgIiArIG92by50YWdzLmFiSUQpOwogICAgfQp9CgovL2dlbmVyYXRlIGJvdHMgYmFzZWQgb24gdGhlIGZpbGUgcmV0cmlldmVkICpIRVJFKgpsaW5rcy5jcmVhdGUuYWJDcmVhdGVCb3RzKHtib3RzOiBmaWxlR2V0LCBvcmlnaW46IG92by50YWdzLmFiSUQsIHN0dWRpbzogb3ZvLnRhZ3Muc3R1ZGlvLCB2ZXJzaW9uOiB0YXJnZXRWZXJzaW9uLCBpbml0aWFsQm9vdDogaW5pdGlhbEJvb3QsIGVnZ1BhcmFtZXRlcnM6IG92by50YWdzLmVnZ1BhcmFtZXRlcnN9KTsnAN7fg8UF1q0CC2ludGVyYWN0T3ZvAgQA3t+DxQWa/AKOB0AvL21hbnVhbCBoYXRjaCBtZW51CmNvbnN0IG92b0JvdCA9IHRoYXQgPyB0aGF0IDogbGlua3Mub3ZvQm90OwoKaWYgKCFvdm9Cb3QpCnsKICAgIHJldHVybjsKfQoKc2hvdXQoIm92b01lbnVSZXNldCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAib3ZvIjsKCm1hc2tzLm9uR3JpZENsaWNrID0gYEAgc2hvdXQoIm92b01lbnVSZXNldCIpO2A7Cm1hc2tzLm92b01lbnVSZXNldCA9IGBAIG1hc2tzLm9uR3JpZENsaWNrID0gbnVsbDsKbWFza3Mub3ZvTWVudVJlc2V0ID0gbnVsbDsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsKYDsKCmxldCBlZ2dNZW51QnV0dG9uID0ge307Cgpvcy50d2VlblRvKG92b0JvdCwgMTUsNDUsNDUsIDUpOwoKZWdnTWVudUJ1dHRvbi5vdm8gPSB0cnVlOwplZ2dNZW51QnV0dG9uLm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwplZ2dNZW51QnV0dG9uLm92b0JvdCA9ICLwn5SXIiArIG92b0JvdC5pZDsKZWdnTWVudUJ1dHRvbi50YXJnZXRWZXJzaW9uID0gb3ZvQm90LnRhZ3MudGFyZ2V0VmVyc2lvbjsKZWdnTWVudUJ1dHRvbi5sYWJlbCA9ICJoYXRjaCAiICsgb3ZvQm90LnRhZ3MuYWJJRCArICIgdiIgKyBvdm9Cb3QudGFncy50YXJnZXRWZXJzaW9uICsgIiBvZiAiICsgb3ZvQm90LnRhZ3MubWF4VmVyc2lvbjsKZWdnTWVudUJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJjZW50ZXIiOwplZ2dNZW51QnV0dG9uLm92b01lbnVSZXNldCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKZWdnTWVudUJ1dHRvbi5jb2xvciA9ICIjRkZGRkZGIjsKZWdnTWVudUJ1dHRvbi5vbkNsaWNrID0gIkAgbGlua3MubWFuYWdlci5oYXRjaE92byhsaW5rcy5vdm9Cb3QpOyI7CgpsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihlZ2dNZW51QnV0dG9uKTsnAN7fg8UF1q0CBmNyZWF0ZQIEAN7fg8UFpYMDKPCflJczNGMzYzIxMC01YmYxLTQ5Y2YtYjE1MS1lZTJkMDdmMGU2NzMnAN7fg8UF1q0CEGNoYW5nZU92b1ZlcnNpb24CBADe34PFBcyDA/ACQC8vbG9naWMgZm9yIHZlcnNpb24gY2hhbmdpbmcgd2hlbiBtYW51YWxseSBoYXRjaGluZyBhbiBhYgpjb25zdCBvdm9Cb3QgPSBsaW5rcy5vdm9Cb3Q7CgpsZXQgbmV3VmVyc2lvbiA9IGF3YWl0IG9zLnNob3dJbnB1dChvdm9Cb3QudGFncy50YXJnZXRWZXJzaW9uLCB7CiAgICBwbGFjZWhvbGRlcjogImVudGVyIGEgdmVyc2lvbiBmcm9tIDEgdG8gIiArIG92b0JvdC50YWdzLm1heFZlcnNpb24KfSk7Cgpvdm9Cb3QudGFncy50YXJnZXRWZXJzaW9uID0gbmV3VmVyc2lvbjsKb3ZvQm90LnRhZ3MubGFiZWwgPSAndicrIG5ld1ZlcnNpb247Cgpjb25maWdCb3QudGFncy52ZXJzaW9uID0gbmV3VmVyc2lvbjsKCnNob3V0KCJvdm9NZW51UmVzZXQiKTsnAN7fg8UF1q0CBG1lbnUCBADe34PFBb2GAyjwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwDe34PFBdatAghhYklnbm9yZQIEAN7fg8UF5IYDBHRydWUoAN7fg8UF1q0CDGFiQm90VmVyc2lvbgF9uQInAN7fg8UF1q0CB2FiU2hlbGwCBADe34PFBeqGAwR0cnVlJwDe34PFBdatAgxhYjFMVE1TZWFyY2gCBADe34PFBe+GAzNALy9zdXBwb3J0IG9sZCBzeW50YXgKdGhpc0JvdC5vbkxvb2t1cEFCRWdncyh0aGF0KTsnAN7fg8UF1q0CDW9uTG9va3VwQXNrSUQCBADe34PFBaOHA9AFQGxldCBwcm9ncmVzc0J1dHRvbiA9IGF3YWl0IGxpbmtzLmlucHV0LmFiUHJvZ3Jlc3NCYXIoYGxvb2tpbmcgdXAgJHt0aGF0LmFza0lEfWApOwoKY29uc3QgYXNrSUQgPSAiYXNrXyIgKyB0aGF0LmFza0lEOwpjb25zdCBlbmRwb2ludCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJFbmRwb2ludDsKbGV0IGxvb2t1cEFzazsgCgp0cnkKewogICAgbG9va3VwQXNrID0gYXdhaXQgb3MuZ2V0RGF0YShsaW5rcy5yZW1lbWJlci50YWdzLmFiUmVjb3JkS2V5LCBhc2tJRCwgZW5kcG9pbnQpOwp9CmNhdGNoCnsKICAgIGxvb2t1cEFzayA9IGF3YWl0IG9zLmdldERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYlJlY29yZEtleSwgdGhhdC5hc2tJRCwgZW5kcG9pbnQpOwp9CgppZiAobG9va3VwQXNrLnN1Y2Nlc3MgJiYgbG9va3VwQXNrLmRhdGEucGF0dGVybklEKQp7CiAgICB0aGlzQm90Lm9uTG9va3VwQUJFZ2dzKHthYklEOiBsb29rdXBBc2suZGF0YS5wYXR0ZXJuSUQsIHJlY29yZEtleTogbG9va3VwQXNrLmRhdGEuc3R1ZGlvSUQsIGF1dG9IYXRjaDogdHJ1ZX0pOyAgCn0KZWxzZSBpZiAobG9va3VwQXNrLnN1Y2Nlc3MgJiYgIWxvb2t1cEFzay5kYXRhLnVybCkKewogICAgbG9va3VwQXNrLnN1Y2Nlc3MgPSAhbG9va3VwQXNrLnN1Y2Nlc3M7Cn0KCmlmIChwcm9ncmVzc0J1dHRvbikKewogICAgZGVzdHJveShwcm9ncmVzc0J1dHRvbik7Cn0KCnJldHVybiBsb29rdXBBc2s7JwDe34PFBdatAgVpbnB1dAIEAN7fg8UF9IwDKPCflJdmODYwMjg3OC1jMmVmLTQ4YmQtODVhMC04ZDYzNTFlYjQxMjAnAN7fg8UF1q0CBWhhdGNoAgQA3t+DxQWbjQPAAUAvL3Nob3V0KCJoYXRjaCIsIHthYklEOiBhYklELCByZWNvcmRLZXk6IHN0dWRpbywga2V5OiBrZXksIGF1dG9IYXRjaDogYm9vbGVhbiwgcmV0dXJuVHlwZTogZGF0YS9udWxsLCBlZ2dQYXJhbWV0ZXJzOiBhcmd9KTsKCmNvbnN0IGxvb2tVcCA9IGF3YWl0IHRoaXNCb3Qub25Mb29rdXBBQkVnZ3ModGhhdCk7CgpyZXR1cm4gbG9va1VwOycBBGJvdHMkZjg2MDI4NzgtYzJlZi00OGJkLTg1YTAtOGQ2MzUxZWI0MTIwAScA3t+DxQXcjgMGc3lzdGVtAgQA3t+DxQXdjgMOYWIuc2hlbGwuaW5wdXQnAN7fg8UF3I4DBGZvcm0CBADe34PFBeyOAwdub3RoaW5nJwDe34PFBdyOAwlvbktleURvd24CBADe34PFBfSOA21ALy9hbGxvdyBwdWxsaW5nIHVwIGNoYXQgaW4gYnVpbGRlciB2ZXJzaW9uCmlmICh0aGF0LmtleXMgPT0gImAiICYmIGJ1aWxkZXJWZXJzaW9uKQp7CiAgICBvcy5zaG93Q2hhdCgiPiIpOwp9JwDe34PFBdyOAwZvbkNoYXQCBADe34PFBeKPA4YZQC8vbm90IHN1cHBvcnRlZCBvdXRzaWRlIG9mIGJ1aWxkZXIgdmVyc2lvbgppZiAoIWJ1aWxkZXJWZXJzaW9uKQp7CiAgICByZXR1cm47Cn0KCi8vdGhpcyBsb29wIGlkZW50aWZpZXMgcG9zc2libGUgYWIgc3BlY2lmaWMgbWVzc2FnZXMsIGFuZCBjYWxscyBhIHNldCBsaXN0IG9mIGNvbW1hbmRzCmlmICh0aGF0Lm1lc3NhZ2VbMF0gPT0gIi4iKSAKewogICAgb3MuaGlkZUNoYXQoKTsKCiAgICBzd2l0Y2ggKHRoYXQubWVzc2FnZSkKICAgIHsKICAgICAgICBjYXNlICcuZG93bmxvYWRBQic6CiAgICAgICAgICAgIGNoYW5nZVN0YXRlKGxpbmtzLm1hbmlmZXN0YXRpb24sICJBc2xlZXAiLCAiYWJNYW5pZmVzdFN0YXRlIik7CgogICAgICAgICAgICBjb25zdCBncm91cCA9IGF3YWl0IG9zLnNob3dJbnB1dCgiZ3JvdXAiKTsKCiAgICAgICAgICAgIGlmIChncm91cCA9PSAiYWJDb25maWciKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmFiQ29yZUl0ZXJhdGlvbisrOwogICAgICAgICAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5pbml0aWFsQm9vdCA9IHRydWU7CiAgICAgICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmNvcmVBQiA9IG51bGw7CiAgICAgICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRCA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoZ3JvdXAgPT0gImFiQ29yZSIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxpbmtzLmxlYXJuLnRhZ3MuYWJJbnN0ID0gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgYWJHcm91cCA9IGdldEJvdHMoZ3JvdXApOwoKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhYkdyb3VwLmxlbmd0aDsgaSsrKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBhYkdyb3VwW2ldLnRhZ3MuYWJCb3RWZXJzaW9uKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIG9zLmRvd25sb2FkQm90c0FzSW5pdGlhbHphdGlvblVwZGF0ZShhYkdyb3VwLCBncm91cCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC5sb2FkU2tpbGxgOgogICAgICAgICAgICBsZXQgc2tpbGwgPSBhd2FpdCBvcy5zaG93SW5wdXQoInNraWxsIik7CgogICAgICAgICAgICBsaW5rcy5sZWFybi5hYkFkYXB0KHNraWxsKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLnN5c3RlbWA6CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnN5c3RlbVBvcnRhbCA9IHRydWU7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAuc2hlZXRgOgogICAgICAgICAgICBjb25maWdCb3QudGFncy5zaGVldFBvcnRhbCA9ICFjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPyBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsIDogY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLm1lbnVTaGVldGA6CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsID0gY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbDsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC5kb3dubG9hZGA6CiAgICAgICAgICAgIG9zLmRvd25sb2FkQm90cyhnZXRCb3RzKGJ5TW9kKHtzcGFjZTogInNoYXJlZCIsIGFiSWdub3JlOiBudWxsfSkpLCBvcy5nZXRDdXJyZW50SW5zdCgpKTsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC51cGxvYWRgOgogICAgICAgICAgICBvcy5zaG93VXBsb2FkQXV4RmlsZSgpOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLnNsZWVwYDoKICAgICAgICAgICAgY2hhbmdlU3RhdGUobGlua3MubWFuaWZlc3RhdGlvbiwgIkFzbGVlcCIsICJhYk1hbmlmZXN0U3RhdGUiKTsKCiAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsKICAgICAgICAgICAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbCA9IG51bGw7CiAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWxTcGFjZSA9IG51bGw7CgogICAgICAgICAgICB0YWdQb3J0YWxCb3QubWFza3MudGFnUG9ydGFsQW5jaG9yUG9pbnQgPSBudWxsOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAuLmA6CiAgICAgICAgY2FzZSBgLndha2VgOgoKICAgICAgICAgICAgbGV0IHNraWxsQXJyYXkgPSBbImFiSW50ZXJmYWNlIiwgImFiQWN0aW9uIiwgImFiVGVzdHMiXTsKCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2tpbGxBcnJheS5sZW5ndGg7IGkrKykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgYXdhaXQgbGlua3MubGVhcm4uYWJBZGFwdChza2lsbEFycmF5W2ldKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYXdhaXQgb3Muc2xlZXAoMzAwKTsKCiAgICAgICAgICAgIC8va2VlcCBhYiBhd2FrZQogICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmFiQXdha2VTdGF0ZSA9IHRydWU7CgogICAgICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MucGF0dGVybikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIgPSBjb25maWdCb3QudGFncy5wYXR0ZXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIgPSB1dWlkKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNoYW5nZVN0YXRlKGxpbmtzLm1hbmlmZXN0YXRpb24sICJBd2FrZSIsICJhYk1hbmlmZXN0U3RhdGUiKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJy5sb2cnOgogICAgICAgICAgICBzaG91dCgidG9nZ2xlQ29uc29sZSIpCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGxldCBtZXNzYWdlID0gdGhhdC5tZXNzYWdlOwogICAgICAgICAgICBsZXQgZXhlY3V0YWJsZSA9IG1lc3NhZ2Uuc2xpY2UoMSk7CgogICAgICAgICAgICB0cnkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgb3MucnVuKGV4ZWN1dGFibGUpOyAgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggKGUpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgICB9CiAgICB9Cn0nAN7fg8UF3I4DC2Rlc2NyaXB0aW9uAgQA3t+DxQXpqANCVGhpcyBpcyBtZWFudCB0byBoYW5kbGUgYW55IG5vbmUgbWVudSByZWxhdGVkIGlucHV0cy9pbnRlcmFjdGlvbnMuJwDe34PFBdyOAwxvbkZpbGVVcGxvYWQCBADe34PFBaypA9cYQC8vZmlsdGVyIG91dCB0aW1lcyB3aGVuIGZpbGUgbG9hZGluZyBpcyBub3QgYWxsb3dlZAppZiAoIWJ1aWxkZXJWZXJzaW9uIHx8IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJMaXN0ZW5pbmdGb3JGaWxlVXBsb2FkcyAhPT0gdHJ1ZSkKewogICAgcmV0dXJuOwp9CgovL3ZhcmlvdXMgZmlsZSBzcGVjaWZpYyB2YXJpYWJsZXMKbGV0IGZpbGVFeHRlbnNpb24gPSB0aGF0LmZpbGUubmFtZS5zcGxpdCgnLicpLnBvcCgpLnRvTG93ZXJDYXNlKCk7CmxldCBmaWxlTmFtZSA9IHRoYXQuZmlsZS5uYW1lLnNwbGl0KCcuJykuc2hpZnQoKTsKbGV0IHNpemUgPSB0aGF0LmZpbGUuc2l6ZTsKbGV0IG1pbWVUeXBlOwpsZXQgYm90SW5mbyA9IHt9OwoKLy9oYXJkIGxpbWl0IGJhc2VkIG9uIGZpbGUgc2l6ZQppZiAoc2l6ZSA+IDIwMDAwMDAwMCkKewogIG9zLnRvYXN0KCJtYXhpbXVtIGZpbGUgc2l6ZSBleGNlZWRlZCAoMjAwIG1iKSIpOwoKICByZXR1cm47Cn0KCi8vdGhpcyBzd2l0Y2ggaGFuZGxlcyBwb3NzaWJsZSBmaWxlcyBleHRlbnNpb25zLCB3aGlsZSByZWplY3RpbmcgYW55IGl0IGRvZXMgbm90IHJlY29nbml6ZQpzd2l0Y2goZmlsZUV4dGVuc2lvbikKewogIGNhc2UgJ2pwZyc6CiAgY2FzZSAnanBlZyc6CiAgY2FzZSAnd2VicCc6CiAgY2FzZSAnZ2lmJzoKICBjYXNlICdwbmcnOgogICAgbWltZVR5cGUgPSAiaW1hZ2UvIiArIGZpbGVFeHRlbnNpb247CiAgICBib3RJbmZvLmZvcm0gPSAic3ByaXRlIjsKICAgIGJyZWFrOwogIGNhc2UgJ3N2Zyc6CiAgICBtaW1lVHlwZSA9ICJpbWFnZS9zdmcreG1sIjsKICAgIGJvdEluZm8uZm9ybSA9ICJzcHJpdGUiOwogICAgYnJlYWs7CiAgY2FzZSAnZ2xiJzoKICBjYXNlICdleHInOgogIGNhc2UgJ2dsdGYnOgogICAgbWltZVR5cGUgPSAidGV4dC94bWwiOwogICAgYm90SW5mby5mb3JtID0gIm1lc2giOwogICAgYm90SW5mby5mb3JtU3VidHlwZSA9ICJnbHRmIjsKICAgIGJyZWFrOwogIGNhc2UgJ2F1eCc6CiAgY2FzZSAncGRmJzoKICAgIGxldCBib3REYXRhID0gZmlsZUV4dGVuc2lvbiA9PSAiLmF1eCIgPyBKU09OLnBhcnNlKHRoYXQuZmlsZS5kYXRhKS5zdGF0ZSA6IG9zLnBhcnNlQm90c0Zyb21EYXRhKHRoYXQuZmlsZS5kYXRhKTsKCiAgICBsaW5rcy5jcmVhdGUuYWJDcmVhdGVCb3RzKHtib3RzOiBib3REYXRhLCBvcmlnaW46IGZpbGVOYW1lfSk7CgogICAgcmV0dXJuOwovLyAgIGNhc2UgJ3BkZic6Ci8vICAgICBicmVhazsKICBjYXNlICdtcDMnOgogICAgbWltZVR5cGUgPSAnYXVkaW8vbXBlZyc7CiAgICBib3RJbmZvLm9uQ2xpY2sgPSAiQCBvcy5wbGF5U291bmQodGFncy5mb3JtQWRkcmVzcyk7IjsKICAgIGJvdEluZm8ubGFiZWwgPSAiQ2xpY2sgdG8gUGxheSI7CiAgICBicmVhazsKICBjYXNlICdtcDQnOgogICAgbWltZVR5cGUgPSAndmlkZW8vbXA0JzsKICAgIGJvdEluZm8uZm9ybSA9ICJpZnJhbWUiOwogICAgYm90SW5mby5mb3JtU3VidHlwZSA9ICJzcmMiOwogICAgYnJlYWs7CiAgY2FzZSAnb3RmJzoKICAgIG1pbWVUeXBlID0gJ2ZvbnQvb3RmJzsKICAgIGJvdEluZm8ubGFiZWwgPSAiZXhhbXBsZSI7CiAgICBicmVhazsKICBjYXNlICd3b2ZmJzoKICAgIG1pbWVUeXBlID0gJ2ZvbnQvd29mZic7CiAgICBib3RJbmZvLmxhYmVsID0gImV4YW1wbGUiOwogICAgYnJlYWs7CiAgZGVmYXVsdDoKICAgIGxldCByZXN1bHQgPSBuZXcgRXJyb3IoInVuaGFuZGxlZCBmaWxlIHR5cGU6ICIgKyBmaWxlRXh0ZW5zaW9uKTsKICAgIG9zLnRvYXN0KCJmaWxlIHR5cGUgbm90IHN1cHBvcnRlZCIpOwogICAgY29uc29sZS53YXJuKHJlc3VsdCkKICAgIHJldHVybiByZXN1bHQ7Cn0KCi8vdGhlIGZvbGxvd2luZyB2YXJpYWJsZXMgYW5kIG9iamVjdHMgc2V0IHVwIGEgbG9hZGluZyBiYXIgYnV0dG9uCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgpsZXQgdXBsb2FkUmVzdWx0OwpsZXQgcHJvZ3Jlc3NCdXR0b24gPSBhd2FpdCB0aGlzQm90LmFiUHJvZ3Jlc3NCYXIoYHVwbG9hZGluZ2ApOwoKY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQgPSBjb25maWdCb3QudGFncy5zdHVkaW9JRCA/PyBjb25maWdCb3QudGFncy5zdHVkaW87CgppZiAoIWNvbmZpZ0JvdC50YWdzLnNlbGVjdGVkX3N0dWRpb0lEKQp7CiAgYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsKCiAgY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQgPSBhdXRoQm90LmlkOwp9CgovL3RoaXMgaXMgdGhlIGFjdHVhbCB1cGxvYWQgZnVuY3Rpb25hbGl0eQp1cGxvYWRSZXN1bHQgPSBhd2FpdCBsaW5rcy5zdG9yZS5hYlB1Ymxpc2hGaWxlKHtmaWxlOiB0aGF0LmZpbGUuZGF0YSwgZmlsZU5hbWU6IGZpbGVOYW1lLCBtaW1lVHlwZTogbWltZVR5cGV9KTsKCi8vaWYgdGhlIGZpbGUgc2hvdWxkIGJlIGluY2x1ZGVkIGFzIGEgYm90IHdpdGggYSBsaW5rLCB0aGlzIGxvZ2ljIGhhbmRsZXMgdGhhdAoKaWYgKG1pbWVUeXBlLmluY2x1ZGVzKCJmb250IikpCnsKICAgIGJvdEluZm9bY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbF0gPSB0cnVlOwogICAgYm90SW5mby5sYWJlbEZvbnRBZGRyZXNzID0gdXBsb2FkUmVzdWx0LnVybCA/IHVwbG9hZFJlc3VsdC51cmwgOiB1cGxvYWRSZXN1bHQuZXhpc3RpbmdGaWxlVXJsOwoKICAgIGNyZWF0ZShib3RJbmZvKTsKfQplbHNlIGlmIChPYmplY3Qua2V5cyhib3RJbmZvKS5sZW5ndGggPiAwKQp7CiAgICBib3RJbmZvW2NvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWxdID0gdHJ1ZTsKICAgIGJvdEluZm8uZm9ybUFkZHJlc3MgPSB1cGxvYWRSZXN1bHQudXJsID8gdXBsb2FkUmVzdWx0LnVybCA6IHVwbG9hZFJlc3VsdC5leGlzdGluZ0ZpbGVVcmw7CgogICAgY3JlYXRlKGJvdEluZm8pOwp9Cgpjb25zdCBjbGlwVVJMID0gdXBsb2FkUmVzdWx0LnVybCA/PyB1cGxvYWRSZXN1bHQuZXhpc3RpbmdGaWxlVXJsOwoKb3Muc2V0Q2xpcGJvYXJkKGNsaXBVUkwpOwoKb3MudG9hc3QoImZpbGUgdXJsIGFkZGVkIHNldCB0byBjbGlwYm9hcmQiKTsKCi8vY2xlYXIgdGhlIHByb2dyZXNzIGJhciBidXR0b24KY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOwoKaWYgKHByb2dyZXNzQnV0dG9uKQp7CiAgZGVzdHJveShwcm9ncmVzc0J1dHRvbik7Cn0KCnJldHVybiB1cGxvYWRSZXN1bHQ7JwDe34PFBdyOAwVsZWFybgIEAN7fg8UFhMIDKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAN7fg8UF3I4DCHJlbWVtYmVyAgQA3t+DxQWrwgMo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycA3t+DxQXcjgMNbWFuaWZlc3RhdGlvbgIEAN7fg8UF0sIDKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAN7fg8UF3I4DCGFiSWdub3JlAgQA3t+DxQX5wgMEdHJ1ZSgA3t+DxQXcjgMMYWJCb3RWZXJzaW9uAX25AicA3t+DxQXcjgMGY3JlYXRlAgQA3t+DxQX/wgMo8J+UlzM0YzNjMjEwLTViZjEtNDljZi1iMTUxLWVlMmQwN2YwZTY3MycA3t+DxQXcjgMFc3RvcmUCBADe34PFBabDAyjwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwDe34PFBdyOAwRtZW51AgQA3t+DxQXNwwMo8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicA3t+DxQXcjgMHYWJTaGVsbAIEAN7fg8UF9MMDBHRydWUnAN7fg8UF3I4DDWFiUHJvZ3Jlc3NCYXICBADe34PFBfnDA98IQGlmICghY29uZmlnQm90LnRhZ3MuYWJTaWxlbnRNb2RlKQp7CiAgICBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwp9CgpsZXQgbG9hZExhYmVsID0gdGhhdCA/PyAidXBkYXRpbmciOwpsZXQgbWVudUJ1dHRvbiA9IHt9OwoKbWVudUJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwptZW51QnV0dG9uLmFiTWVudSA9IHRydWU7Cm1lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IHsgImJvcmRlci1yYWRpdXMiOiI4cHgiLCAibWFyZ2luLXRvcCI6IjNweCJ9OwptZW51QnV0dG9uLnRyYWNrTnVtID0gLTE7Cm1lbnVCdXR0b24ub25DcmVhdGUgPSBgQAogICAgaWYgKHRhZ3MudHJhY2tOdW0gPT0gMikKICAgIHsKICAgICAgICB0YWdzLnRyYWNrTnVtID0gMDsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICB0YWdzLnRyYWNrTnVtKys7CiAgICB9CgogICAgdGFncy5sYWJlbCA9IHRhZ3NbImxhYmVsIit0YWdzLnRyYWNrTnVtXTsKICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSB0YWdzWyJmb3JtIit0YWdzLnRyYWNrTnVtXTsKCiAgICBzZXRUaW1lb3V0KCgpID0+IHdoaXNwZXIodGhpc0JvdCwgIm9uQ3JlYXRlIiksIDUwMCk7YDsKbWVudUJ1dHRvbi5sYWJlbDAgPSBsb2FkTGFiZWwgKyAiLiI7Cm1lbnVCdXR0b24ubGFiZWwxID0gbG9hZExhYmVsICsgIi4uIjsKbWVudUJ1dHRvbi5sYWJlbDIgPSBsb2FkTGFiZWwgKyAiLi4uIjsKbWVudUJ1dHRvbi5mb3JtMCA9ICJob3VyZ2xhc3NfYm90dG9tIjsKbWVudUJ1dHRvbi5mb3JtMSA9ICJob3VyZ2xhc3NfdG9wIjsKbWVudUJ1dHRvbi5mb3JtMiA9ICJob3VyZ2xhc3NfYm90dG9tIjsKbWVudUJ1dHRvbi5jb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7Cm1lbnVCdXR0b24ubGFiZWxDb2xvciA9ICJibGFjayI7Cm1lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAiY2VudGVyIjsKbWVudUJ1dHRvbi5hYlByb2dyZXNzUmVzZXQgPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7Cm1lbnVCdXR0b24ub25EZXN0cm95ID0gIkAgY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOyI7CgptZW51QnV0dG9uID0gY3JlYXRlKG1lbnVCdXR0b24pOwoKcmV0dXJuIG1lbnVCdXR0b247JwDe34PFBdyOAwlvblRhcENvZGUCBADe34PFBdnMA6ICQGNvbnN0IHRhcENvZGUgPSB0aGF0OwoKc3dpdGNoICh0YXBDb2RlKQp7CiAgICBjYXNlICIzMzQyIjoKICAgICAgICBvcy50b2FzdCgid2FraW5nICIgKyBsaW5rcy5yZW1lbWJlci50YWdzLmFiQnVpbGRlcklkZW50aXR5KTsKCiAgICAgICAgdGhpc0JvdC5vbkNoYXQoe21lc3NhZ2U6ICIuLiJ9KTsKICAgICAgICBicmVhazsKICAgIGNhc2UgIjQyNDIiOgogICAgICAgIG9zLnNob3dDaGF0KCI+Iik7CiAgICAgICAgYnJlYWs7CiAgICBkZWZhdWx0OgogICAgICAgIC8vY29uc29sZS5sb2codGFwQ29kZSk7Cn0A',
    'Aa0Btp6erQoAJwEEYm90cyQxNzQxMGQ4My03ZWVlLTRhMWUtYjYzOC02NTQ2Mzc0ZDE3YzMBJwC2np6tCgAGc3lzdGVtAgQAtp6erQoBEWFiLmludGVyZmFjZS5zY2FuJwC2np6tCgAEZm9ybQIEALaenq0KEwdub3RoaW5nJwC2np6tCgALYWJJbnRlcmZhY2UCBAC2np6tChsEdHJ1ZScAtp6erQoACGFiSWdub3JlAgQAtp6erQogBHRydWUoALaenq0KAAxhYkJvdFZlcnNpb24BfYQBJwC2np6tCgAPb25RUkNvZGVTY2FubmVkAgQAtp6erQomrw1AaWYgKCFidWlsZGVyVmVyc2lvbikKewogICAgcmV0dXJuOwp9CgphYi5sb2coYWJSZW1lbWJlci50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogc2Nhbm5lZCAiICsgdGhhdCk7CgppZiAoY29uZmlnQm90LnRhZ3MudXVhYlNjYW4pCnsKICAgIG9zLmNsb3NlUVJDb2RlU2Nhbm5lcigpOwoKICAgIGxpbmtzLnN0b3JlLmFiUHVibGlzaFVVQUIodGhhdCk7Cn0KZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MucHVibGlzaFNjYW4pCnsKICAgIG9zLmNsb3NlUVJDb2RlU2Nhbm5lcigpOwoKICAgIGxpbmtzLnN0b3JlLmFiUVJQdWJsaXNoKHRoYXQpOwp9CmVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnByYWN0aWNlUGVybWl0U2NhbikKewogICAgbGV0IHNjYW5uZWRVUkw7CgogICAgY29uZmlnQm90LnRhZ3MucHJhY3RpY2VQZXJtaXRTY2FuID0gbnVsbDsKCiAgICBvcy5jbG9zZVFSQ29kZVNjYW5uZXIoKTsKCiAgICB0cnkKICAgIHsKICAgICAgICBzY2FubmVkVVJMID0gbmV3IFVSTCh0aGF0KTsKICAgIH0KICAgIGNhdGNoIChlKQogICAgewogICAgICAgIG9zLnRvYXN0KCJub3QgYSByZWNvZ25pemVkIHByYWN0aWNlIHBlcm1pdCIpOwoKICAgICAgICBjb25zb2xlLmxvZyhlKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGxldCBwaENoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJwaCIpOwogICAgbGV0IGluc3RDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiaW5zdCIpOwogICAgbGV0IGFiQ2hlY2sgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5oYXMoImFiIik7CiAgICBsZXQgY3dDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygiY3ciKTsKCiAgICBpZiAocGhDaGVjayAmJiBpbnN0Q2hlY2sgJiYgYWJDaGVjayAmJiBjd0NoZWNrKQogICAgewogICAgICAgIG9zLmdvVG9VUkwodGhhdCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgb3MudG9hc3QoIm5vdCBhIHJlY29nbml6ZWQgcHJhY3RpY2UgcGVybWl0Iik7CiAgICB9CgogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKfQplbHNlIGlmIChjb25maWdCb3QudGFncy5hYlNjYW4pCnsKICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgogICAgY29uZmlnQm90LnRhZ3MuYWJTY2FuID0gbnVsbDsKICAgIAogICAgb3MuY2xvc2VRUkNvZGVTY2FubmVyKCk7CgogICAgbGV0IHNjYW5uZWRVUkw7CgogICAgdHJ5IAogICAgewogICAgICAgIHNjYW5uZWRVUkwgPSBuZXcgVVJMKHRoYXQpOwogICAgfQogICAgY2F0Y2ggKGUpIAogICAgewogICAgICAgIGxpbmtzLnNlYXJjaC5hYkxUTVNlYXJjaCh7YWJJRDogdGhhdH0pOwoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgaWYoc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJhYiIpID09ICJlZ2dDYXJ0b24iKQogICAgewogICAgICAgIG9zLmdvVG9VUkwodGhhdCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZm9yRWFjaCgodmFsdWUsIGtleSkgPT4gewogICAgICAgICAgICBsZXQgbmV3VGFnID0ga2V5OwogICAgICAgICAgICBsZXQgbmV3VmFsdWUgPSB2YWx1ZTsKCiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzW25ld1RhZ10gPSBuZXdWYWx1ZTsKICAgICAgICB9KTsKCiAgICAgICAgbGlua3Muc2VhcmNoLmFiTFRNU2VhcmNoKHthYklEOiBjb25maWdCb3QudGFncy5hYn0pOwogICAgfQp9JwC2np6tCgAFc3RvcmUCBAC2np6tCtYNKPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnALaenq0KAAZzZWFyY2gCBAC2np6tCv0NKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnALaenq0KABBhYkNvcmVNZW51QWN0aW9uAgQAtp6erQqkDjdAb3Mub3BlblFSQ29kZVNjYW5uZXIoKTsKCmNvbmZpZ0JvdC50YWdzLmFiU2NhbiA9IHRydWU7JwC2np6tCgAPYWJDb3JlTWVudUxhYmVsAgQAtp6erQrcDgRzY2FuJwC2np6tCgAOYWJDb3JlTWVudUljb24CBAC2np6tCuEOD3FyX2NvZGVfc2Nhbm5lcicAtp6erQoAE2FiQ29yZU1lbnVTb3J0T3JkZXICBAC2np6tCvEOATMnAQRib3RzJDQwMmNjYjE2LWQ0MDItNDQwNC1iMWFkLTdhZDczY2MyOTc3MgEnALaenq0K8w4HQXBwLmNzcwIEALaenq0K9A6dEDpyb290IHsKICAtLWJhY2tncm91bmQ6ICNmOGY5ZmE7CiAgLS1vbi1iYWNrZ3JvdW5kOiAjMjEyNTI5Owp9Ci8qIERhcmsgbW9kZSBzdXBwb3J0ICovCkBtZWRpYSAocHJlZmVycy1jb2xvci1zY2hlbWU6IGRhcmspIHsKICA6cm9vdCB7CiAgICAtLWJhY2tncm91bmQ6ICMyMTI1Mjk7CiAgICAtLW9uLWJhY2tncm91bmQ6ICNmOGY5ZmE7CiAgfQp9CgouYWItY29uc29sZSB7CiAgd2lkdGg6IDEwMCU7CiAgaGVpZ2h0OiB2YXIoLS1hcHAtaGVpZ2h0KTsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgcGFkZGluZzogMCAxcmVtOwogIGNvbG9yOiB2YXIoLS1vbi1iYWNrZ3JvdW5kKTsKICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsKICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoMTBweCkgYnJpZ2h0bmVzcygyMDAlKTsKICBhbmltYXRpb24tbmFtZTogc2xpZGUtYXBwLWluOwogIGFuaW1hdGlvbi1kdXJhdGlvbjogMC41czsKICBvdmVyZmxvdy15OiBoaWRkZW47CiAgei1pbmRleDogMTsKfQoKLmFiLWNvbnNvbGU6OmFmdGVyIHsKICBjb250ZW50OiAiIjsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1iYWNrZ3JvdW5kKTsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgdG9wOiAwOwogIGxlZnQ6IDA7CiAgcmlnaHQ6IDA7CiAgYm90dG9tOiAwOwogIG9wYWNpdHk6IDAuOTsKICB6LWluZGV4OiAwOwp9CgpAa2V5ZnJhbWVzIHNsaWRlLWFwcC1pbiB7CiAgZnJvbSB7CiAgICBhbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBjdWJpYy1iZXppZXIoLjYsMCwuNzksMS4wMyk7CiAgICAvKiB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMTEwJSk7ICovCiAgICBoZWlnaHQ6IDBweDsKICAgIG1pbi1oZWlnaHQ6IDBweDsKICB9CgogIHRvIHsKICAgIGhlaWdodDogdmFyKC0tYXBwLWhlaWdodCk7CiAgICBtaW4taGVpZ2h0OiB2YXIoLS1hcHAtaGVpZ2h0KTsKICB9Cn0KCi5hYi1jb25zb2xlID4gZGl2IHsKICB6LWluZGV4OiAxOwogIHBvc2l0aW9uOiByZWxhdGl2ZQp9CgouYWItY29uc29sZS1sb2cgewogIG92ZXJmbG93LXk6IGF1dG87CiAgZmxleC1ncm93OiAxOwogIGRpc3BsYXk6IGZsZXg7CiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbi1yZXZlcnNlOwp9CgouYWItY29uc29sZS1tZXNzYWdlIHsKICBtYXJnaW4tYm90dG9tOiAxcmVtOwogIGJvcmRlci1yYWRpdXM6IDAuMjVyZW07CiAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYmFja2dyb3VuZCk7CiAgY29sb3I6IHZhcigtLW9uLWJhY2tncm91bmQpOwogIHBhZGRpbmc6IDAuNXJlbSAxcmVtOwp9CgouYWItY29uc29sZS10aW1lc3RhbXAgewogIG9wYWNpdHk6IDAuNjsKfQoKLmFiLWNvbnNvbGUtaW5wdXQgewogIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWJhY2tncm91bmQpOwogIGNvbG9yOiB2YXIoLS1vbi1iYWNrZ3JvdW5kKTsKICB3aWR0aDogMTAwJTsKICByZXNpemU6IHZlcnRpY2FsOwogIGJvcmRlci1yYWRpdXM6IDJweDsKICBwYWRkaW5nOiAwIDAuNXJlbTsKICBsaW5lLWhlaWdodDogMS44cmVtOwoKICAvKiBSZXNldCB0ZXh0YXJlYSBzdHlsZXMgKi8KICBib3JkZXI6IG5vbmU7CiAgb3V0bGluZTogbm9uZTsKICAtd2Via2l0LWFwcGVhcmFuY2U6IG5vbmU7CiAgLXdlYmtpdC1ib3gtc2hhZG93OiBub25lOwogIC1tb3otYm94LXNoYWRvdzogbm9uZTsKICBib3gtc2hhZG93OiBub25lOwp9CgouYWItY29uc29sZS1pbnB1dDpmb2N1cyB7CiAgYm9yZGVyLWJvdHRvbS13aWR0aDogMnB4ICFpbXBvcnRhbnQ7CiAgYm9yZGVyLWJvdHRvbS1jb2xvcjogIzNlODJmOCAhaW1wb3J0YW50OwogIGJvcmRlci1ib3R0b20tc3R5bGU6IHNvbGlkOwp9CgouY29uc29sZS1zZW5kLWJ0biB7CiAgY29sb3I6IHZhcigtLW9uLWJhY2tncm91bmQpOwogIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWJhY2tncm91bmQpOwoJYm9yZGVyOiBub25lOwoJZm9udDogaW5oZXJpdDsKCWN1cnNvcjogcG9pbnRlcjsKCW91dGxpbmU6IGluaGVyaXQ7CiAgcGFkZGluZzogMCAxcmVtOwp9CgouY29uc29sZS1zZW5kLWJ0biA+IHNwYW4gewogIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgzcHgpCn0nALaenq0K8w4MUmVzaXplSGFuZGxlAgQAtp6erQqSH4sLQGNvbnN0IHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSwgdXNlUmVmIH0gPSBvcy5hcHBIb29rcwpjb25zdCBvZmZzZXQgPSA4CmNvbnN0IGluaXRpYWxIZWlnaHQgPSAyNTYKY29uc3QgZHJhZ0ludGVydmFsID0gMjUKCmNvbnN0IFJlc2l6ZUhhbmRsZSA9ICgpID0+IHsKICAgIGNvbnN0IFtoZWlnaHQsIHNldEhlaWdodF0gPSB1c2VTdGF0ZShpbml0aWFsSGVpZ2h0ICsgb2Zmc2V0KQogICAgY29uc3QgW2xpc3RlbmluZywgc2V0TGlzdGVuaW5nXSA9IHVzZVN0YXRlKGZhbHNlKQoKICAgIGNvbnN0IHVwZGF0ZUhlaWdodCA9ICgpID0+IHsKICAgICAgICBpZiAobGlzdGVuaW5nKSB7CiAgICAgICAgICAgIHNldEhlaWdodChncmlkUG9ydGFsQm90LnRhZ3MucG9pbnRlclBpeGVsWSArIDYgKyBNYXRoLnJhbmRvbSgpLzEwMDApCiAgICAgICAgfQogICAgfQoKICAgIHVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgaWYgKGxpc3RlbmluZykgewogICAgICAgICAgICB1cGRhdGVIZWlnaHQoKQogICAgICAgIH0KICAgIH0sIFtsaXN0ZW5pbmddKQoKICAgIHVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgaWYgKCFsaXN0ZW5pbmcpIHJldHVybjsKCiAgICAgICAgaWYgKGhlaWdodCA8IDgwKSB7CiAgICAgICAgICAgIHNldExpc3RlbmluZyhmYWxzZSk7CiAgICAgICAgICAgIGdyaWRQb3J0YWxCb3QudGFncy5wb3J0YWxab29tYWJsZSA9IHRydWU7CiAgICAgICAgICAgIHNob3V0KCdoaWRlQ29uc29sZScpOwogICAgICAgICAgICBtYXNrcy5vcGVuID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIG9zLnNsZWVwKGRyYWdJbnRlcnZhbCkudGhlbigoKSA9PiB7CiAgICAgICAgICAgIHVwZGF0ZUhlaWdodCgpOwogICAgICAgIH0pCiAgICB9LCBbaGVpZ2h0XSkKCgogICAgcmV0dXJuICg8PgogICAgICAgIDxzdHlsZT57YDpyb290IHstLWFwcC1oZWlnaHQ6ICR7aGVpZ2h0fXB4fWB9PC9zdHlsZT4KICAgICAgICA8ZGl2CiAgICAgICAgICAgIG9uUG9pbnRlckRvd249eygpID0+IHNldExpc3RlbmluZyh0cnVlKX0KICAgICAgICAgICAgb25Qb2ludGVyVXA9eygpID0+IHNldExpc3RlbmluZyhmYWxzZSl9CiAgICAgICAgICAgIHN0eWxlPXt7CiAgICAgICAgICAgICAgICB3aWR0aDogJzEwMCUnLAogICAgICAgICAgICAgICAgaGVpZ2h0OiAnMjRweCcsCiAgICAgICAgICAgICAgICBmb250U2l6ZTogJzI0cHgnLAogICAgICAgICAgICAgICAgbGluZUhlaWdodDogJzIycHgnLAogICAgICAgICAgICAgICAgdGV4dEFsaWduOiAnY2VudGVyJywKICAgICAgICAgICAgICAgIGN1cnNvcjogJ2dyYWInLAogICAgICAgICAgICAgICAgdXNlclNlbGVjdDogJ25vbmUnLAogICAgICAgICAgICB9fQogICAgICAgID4KICAgICAgICAgICAg4oCUCiAgICAgICAgPC9kaXY+CiAgICA8Lz4pCn0KCnJldHVybiBSZXNpemVIYW5kbGUKJwC2np6tCvMOCmFiSURPcmlnaW4CBAC2np6tCpwqB2FiTG9nVjInALaenq0K8w4GZ2V0QXBwAgQAtp6erQqkKukLQGNvbnN0IHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSB9ID0gb3MuYXBwSG9va3MKY29uc3QgUmVzaXplSGFuZGxlID0gdGhpc0JvdC5SZXNpemVIYW5kbGUoKQoKY29uc3QgTWVzc2FnZSA9ICh7dGltZXN0YW1wLCBtZXNzYWdlfSkgPT4gewogICAgcmV0dXJuICgKICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYWItY29uc29sZS1tZXNzYWdlIj4KICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImFiLWNvbnNvbGUtdGltZXN0YW1wIj4KICAgICAgICAgICAgICAgIHt0aW1lc3RhbXAudG9Mb2NhbGVTdHJpbmcoJ2VuLVVTJywgeyB0aW1lU3R5bGU6ICdtZWRpdW0nIH0pfQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImFiLWNvbnNvbGUtY29udGVudCI+e21lc3NhZ2V9PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICApCn0KCmNvbnN0IEFwcCA9ICh7ICB9KSA9PiB7CiAgICBjb25zdCBbY29uc29sZUxvZywgc2V0Q29uc29sZUxvZ10gPSB1c2VTdGF0ZSh0aGlzQm90Lm1hc2tzLmhpc3RvcnkpCgogICAgY29uc3QgdXBkYXRlTG9nID0gKCkgPT4gewogICAgICAgIHNldENvbnNvbGVMb2coWyAuLi50aGlzQm90Lm1hc2tzLmhpc3RvcnkgXSkKICAgIH0KCiAgICB1c2VFZmZlY3QoKCkgPT4gewogICAgICAgIHRoaXNCb3QudmFycy51cGRhdGVMb2cgPSB1cGRhdGVMb2cKICAgICAgICByZXR1cm4gKCgpID0+IHsKICAgICAgICAgICAgdGhpc0JvdC52YXJzLnVwZGF0ZUxvZyA9IG51bGwKICAgICAgICB9KQogICAgfSwgW10pCgogICAgcmV0dXJuICg8PgogICAgICAgIDxzdHlsZT57dGFnc1snQXBwLmNzcyddfTwvc3R5bGU+CgogICAgICAgIDxkaXYKICAgICAgICAgICAgaWQ9ImFiLWNvbnNvbGUiCiAgICAgICAgICAgIGNsYXNzTmFtZT0iYWItY29uc29sZSIKICAgICAgICAgICAgb25Qb2ludGVyRW50ZXI9eygpID0+IGdyaWRQb3J0YWxCb3QudGFncy5wb3J0YWxab29tYWJsZSA9IGZhbHNlfQogICAgICAgICAgICBvblBvaW50ZXJMZWF2ZT17KGUpID0+IHsKICAgICAgICAgICAgICAgIGlmIChlLmN1cnJlbnRUYXJnZXQuaWQgPT0gImFiLWNvbnNvbGUiKXsKICAgICAgICAgICAgICAgICAgICBncmlkUG9ydGFsQm90LnRhZ3MucG9ydGFsWm9vbWFibGUgPSB0cnVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH19CiAgICAgICAgPgoKICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImFiLWNvbnNvbGUtbG9nIj4KICAgICAgICAgICAgICAgIHsvKiBNZXNzYWdlIGhpc3RvcnkgKi8gQXJyYXkuaXNBcnJheShjb25zb2xlTG9nKQogICAgICAgICAgICAgICAgPyBjb25zb2xlTG9nLm1hcChtID0+CiAgICAgICAgICAgICAgICAgICAgPE1lc3NhZ2UgdGltZXN0YW1wPXttLnRpbWVzdGFtcH0gbWVzc2FnZT17bS5tZXNzYWdlfSAvPikKICAgICAgICAgICAgICAgIDogPD48Lz59CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPFJlc2l6ZUhhbmRsZSAvPgogICAgICAgIDwvZGl2PgogICAgPC8+KQp9CgpyZXR1cm4gQXBwCicAtp6erQrzDgtoaWRlQ29uc29sZQIEALaenq0KjjZeQHZhciBjdXJyZW50VmVyID0gbWFza3MuY29uc29sZVZlcnNpb24gPz8gMAphd2FpdCBvcy51bnJlZ2lzdGVyQXBwKGBhYi1jb25zb2xlLSR7Y3VycmVudFZlcn1gKScAtp6erQrzDgNsb2cCBAC2np6tCu02ygNAY29uc3QgbWVzc2FnZSA9IHRoYXQKCi8vIENyZWF0ZSBsb2NhbCBjb3B5IG9mIGhpc3RvcnkgbWFzawp2YXIgX2hpc3RvcnkgPSB0aGlzQm90Lm1hc2tzLmhpc3RvcnkKCi8vIFB1c2ggbWVzc2FnZSBpZiB0aGUgbWFzayBleGlzdGVkCmlmICggQXJyYXkuaXNBcnJheShfaGlzdG9yeSkgKSB7CiAgICBfaGlzdG9yeS51bnNoaWZ0KHsKICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksCiAgICAgICAgbWVzc2FnZQogICAgfSkKCi8vIEluaXRpYWxpemUgdGhlIGFycmF5IGlmIGl0IGRpZG4ndAp9IGVsc2UgewogICAgX2hpc3RvcnkgPSBbewogICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSwKICAgICAgICBtZXNzYWdlCiAgICB9XQp9Cgp0aGlzQm90Lm1hc2tzLmhpc3RvcnkgPSBbIC4uLl9oaXN0b3J5IF0KaWYgKHRoaXNCb3QudmFycy51cGRhdGVMb2cpIHRoaXNCb3QudmFycy51cGRhdGVMb2coKScAtp6erQrzDgtzaG93Q29uc29sZQIEALaenq0KuDq0A0Bjb25maWdCb3QubWFza3MudGFnUG9ydGFsID0gbnVsbApjb25maWdCb3QubWFza3MudGFnUG9ydGFsU3BhY2UgPSBudWxsCgovLyBVbnJlZ2lzdGVyIGluIGNhc2UgaXQgd2FzIGFscmVhZHkgb3Blbgp2YXIgY3VycmVudFZlciA9IG1hc2tzLmNvbnNvbGVWZXJzaW9uID8/IDAKYXdhaXQgb3MudW5yZWdpc3RlckFwcChgYWItY29uc29sZS0ke2N1cnJlbnRWZXJ9YCkKCmN1cnJlbnRWZXIgKz0gMQptYXNrcy5jb25zb2xlVmVyc2lvbiA9IGN1cnJlbnRWZXIKLy8gR2V0LCByZWdpc3RlciwgYW5kIGNvbXBpbGUgdGhlIGFwcApjb25zdCBBcHAgPSB0aGlzQm90LmdldEFwcCgpCmF3YWl0IG9zLnJlZ2lzdGVyQXBwKGBhYi1jb25zb2xlLSR7Y3VycmVudFZlcn1gLCB0aGlzQm90KQpvcy5jb21waWxlQXBwKGBhYi1jb25zb2xlLSR7Y3VycmVudFZlcn1gLCA8QXBwIC8+KQonALaenq0K8w4Gc3lzdGVtAgQAtp6erQrtPRRhYi5pbnRlcmZhY2UuY29uc29sZSgAtp6erQrzDghhYklnbm9yZQF4JwC2np6tCvMODXRvZ2dsZUNvbnNvbGUCBAC2np6tCoM+lgFAaWYgKG1hc2tzLm9wZW4pIHsKICAgIHdoaXNwZXIodGhpc0JvdCwgImhpZGVDb25zb2xlIik7CiAgICBtYXNrcy5vcGVuID0gZmFsc2U7Cn0gZWxzZSB7CiAgICB3aGlzcGVyKHRoaXNCb3QsICJzaG93Q29uc29sZSIpOwogICAgbWFza3Mub3BlbiA9IHRydWU7Cn0nALaenq0K8w4LYWJJbnRlcmZhY2UCBAC2np6tCpo/BHRydWUoALaenq0K8w4MYWJCb3RWZXJzaW9uAX0DJwC2np6tCvMOBGZvcm0CBAC2np6tCqA/B25vdGhpbmcnAQRib3RzJDRhYWY2OTllLWFiYmYtNDRhOC04NWUxLTY4Y2JiNWRmMGUxZgEnALaenq0KqD8Gc3lzdGVtAgQAtp6erQqpPxNhYi5pbnRlcmZhY2UubnVnZ2V0JwC2np6tCqg/BGZvcm0CBAC2np6tCr0/B25vdGhpbmcnALaenq0KqD8LYWJJbnRlcmZhY2UCBAC2np6tCsU/BHRydWUnALaenq0KqD8IYWJJZ25vcmUCBAC2np6tCso/BHRydWUoALaenq0KqD8MYWJCb3RWZXJzaW9uAX2FAScAtp6erQqoPwxhYkxvYWROdWdnZXQCBAC2np6tCtA/mAJAbGV0IG51Z2dldE5hbWUgPSB0aGF0Lm51Z2dldE5hbWU7CmxldCBmb3JtYXR0ZWROdWdnZXRBQiA9ICJudWdfIitudWdnZXROYW1lOwpsZXQgbG9hZGVkTnVnZ2V0ID0gYXdhaXQgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBmb3JtYXR0ZWROdWdnZXRBQiwgYWJWZXJzaW9uOiB0aGF0LnZlcnNpb24sIHJldHVyblR5cGU6ICJkYXRhIn0pOwoKbG9hZGVkTnVnZ2V0ID0gbG9hZGVkTnVnZ2V0LnN0YXRlW251Z2dldE5hbWVdLm51Z2dldDsKCnJldHVybiBsb2FkZWROdWdnZXQ7JwC2np6tCqg/D2FiUHVibGlzaE51Z2dldAIEALaenq0K6UHtAkAvL3Nob3V0KCJhYlB1Ymxpc2hOdWdnZXQiLCB7bnVnOiAibnVnTmFtZSIsIGRhdGE6IGRhdGF9KTsgIEFERCBFR0cgSUQgRVZFTlRVQUxMWQpsZXQgdGVzdE51Z2dldCA9IHRoYXQuZGF0YTsKbGV0IGZvcm1hdHRlZE51Z2dldCA9IHtpZDogdGhhdC5udWcsIG51Z2dldDogdGVzdE51Z2dldH07CmxldCB0ZXN0TnVnZ2V0TmFtZSA9IHRoYXQubnVnOwpsZXQgZm9ybWF0dGVkTnVnZ2V0QUIgPSAibnVnXyIrdGVzdE51Z2dldE5hbWU7CgptYXNrcy5udWdnZXRUb1B1Ymxpc2ggPSBmb3JtYXR0ZWROdWdnZXRBQjsKCmxpbmtzLnN0b3JlLmFiUHVibGlzaEFCKHthYjogZm9ybWF0dGVkTnVnZ2V0QUIsIHRhcmdldDogZm9ybWF0dGVkTnVnZ2V0fSk7JwC2np6tCqg/D2ltcGxlbWVudE51Z2dldAIEALaenq0K10SxB0BsZXQgbnVnZ2V0TmFtZSA9IHRoYXQubnVnZ2V0OwpsZXQgbnVnZ2V0VmVyc2lvbkNoZWNrID0gbnVnZ2V0TmFtZS5pbmRleE9mKCIudiIpOwpsZXQgdmVyc2lvbjsKCmlmIChudWdnZXRWZXJzaW9uQ2hlY2sgIT0gLTEpCnsKICAgIG51Z2dldE5hbWUgPSBudWdnZXROYW1lLnN1YnN0cmluZygwLCBudWdnZXRWZXJzaW9uQ2hlY2spOwoKICAgIGxldCB2ZXJzaW9uQ2hlY2sgPSB0aGF0Lm51Z2dldC5zdWJzdHJpbmcobnVnZ2V0VmVyc2lvbkNoZWNrICsgMik7CgogICAgaWYgKGlzTmFOKHZlcnNpb25DaGVjaykpCiAgICB7CiAgICAgICAgY29uc29sZS5sb2codmVyc2lvbkNoZWNrLCAidmVyc2lvbiBpcyBub3QgYSBudW1iZXIiKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICB2ZXJzaW9uID0gTnVtYmVyKHZlcnNpb25DaGVjayk7CiAgICB9Cn0KY29uc29sZS5sb2cobnVnZ2V0TmFtZSwgdmVyc2lvbik7CmxldCBudWdEYXRhID0gYXdhaXQgdGhpc0JvdC5hYkxvYWROdWdnZXQoe251Z2dldE5hbWU6IG51Z2dldE5hbWUsIHZlcnNpb246IHZlcnNpb259KTsKCmlmIChudWdEYXRhID09ICJhYklEIG5vdCBmb3VuZCIpCnsKICAgIG9zLnRvYXN0KCJudWdnZXQgbm90IGZvdW5kIik7Cn0KZWxzZQp7CiAgICBsZXQgdGFyZ2V0Qm90ID0gZ2V0Qm90KCJpZCIsIHRoYXQuYm90KTsKICAgIGxldCB0YXJnZXRUYWcgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXS50b1N0cmluZygpOwogICAgbGV0IHRhcmdldE51ZyA9ICJ7IiArIHRoYXQubnVnZ2V0ICsgIn0iOyAKICAgIGxldCBudWdQb3MgPSB0YXJnZXRUYWcuaW5kZXhPZih0YXJnZXROdWcpOwoKICAgIGRlbGV0ZVRhZ1RleHQodGFyZ2V0Qm90LCB0aGF0LnRhZywgbnVnUG9zLCB0YXJnZXROdWcubGVuZ3RoKTsKICAgIGluc2VydFRhZ1RleHQodGFyZ2V0Qm90LCB0aGF0LnRhZywgbnVnUG9zLCBudWdEYXRhKTsKfScAtp6erQqoPwxudWdnZXRCdXR0b24CBAC2np6tColM9QxAbGV0IHRhZ1ZhbHVlID0gdGhhdC50YWdWYWx1ZTsKbGV0IHJlZ2V4ID0gL1xuL2dpOwpsZXQgYnJlYWtDaGVjazsKbGV0IGJyZWFrQXJyYXkgPSBbMF07Ci8vbGV0IGNyZWF0ZWRCdXR0b25zID0gW107Cgp3aGlsZSAoYnJlYWtDaGVjayA9IHJlZ2V4LmV4ZWModGFnVmFsdWUpKQp7CiAgICBicmVha0FycmF5LnB1c2goYnJlYWtDaGVjay5pbmRleCk7Cn0KCmxldCBuZXdOdWdnZXRCdXR0b24gPSB7fTsKCm5ld051Z2dldEJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpuZXdOdWdnZXRCdXR0b24uZm9ybSA9ICJjb2RlQnV0dG9uIjsKbmV3TnVnZ2V0QnV0dG9uLnRhcmdldEJvdCA9IHRoYXQuYm90LmlkOwpuZXdOdWdnZXRCdXR0b24udGFyZ2V0VGFnID0gdGhhdC50YWc7Cm5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJsb2FkIG51Z2dldCI7Cm5ld051Z2dldEJ1dHRvbi5udWdnZXRSZXNldCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbmV3TnVnZ2V0QnV0dG9uW3RoYXQuYm90LmlkICsgIi4iICsgdGhhdC50YWddID0gdHJ1ZTsKbmV3TnVnZ2V0QnV0dG9uLm51Z2dldE1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwpuZXdOdWdnZXRCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm51Z2dldE1hbmFnZXIuaW1wbGVtZW50TnVnZ2V0KHtib3Q6IHRhZ3MudGFyZ2V0Qm90LCBudWdnZXQ6IHRhZ3MudGFyZ2V0TnVnZ2V0LCB0YWc6IHRhZ3MudGFyZ2V0VGFnfSk7CgpkZXN0cm95KHRoaXNCb3QpO2A7Cgpmb3IgKGxldCBudWdzID0gMDsgbnVncyA8IHRoYXQubnVnZ2V0Lmxlbmd0aDsgbnVncysrKQp7CiAgICBsZXQgY3VycmVudE51Z2dldCA9IHRoYXQubnVnZ2V0W251Z3NdOwogICAgLy9sZXQgYnV0dG9uQ2hlY2sgPSBjcmVhdGVkQnV0dG9ucy5pbmRleE9mKGN1cnJlbnROdWdnZXQubnVnTmFtZSk7CgogICAgaWYgKCFjdXJyZW50TnVnZ2V0IHx8IGN1cnJlbnROdWdnZXQgPT0gdW5kZWZpbmVkKSAvL3x8IGJ1dHRvbkNoZWNrICE9IC0xCiAgICB7CiAgICAgICAgY29udGludWU7CiAgICB9CgogICAgaWYgKGN1cnJlbnROdWdnZXQubnVnUHVibGlzaCkKICAgIHsKICAgICAgICBuZXdOdWdnZXRCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm51Z2dldE1hbmFnZXIucGFja2FnZU51Z2dldCh7Ym90OiB0YWdzLnRhcmdldEJvdCwgbnVnZ2V0OiB0YWdzLnRhcmdldE51Z2dldCwgdGFnOiB0YWdzLnRhcmdldFRhZ30pOwoKICAgICAgICBkZXN0cm95KHRoaXNCb3QpO2A7CgogICAgICAgIG5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJwdWJsaXNoICIgKyBjdXJyZW50TnVnZ2V0Lm51Z05hbWUgKyAiIG51Z2dldCI7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbmV3TnVnZ2V0QnV0dG9uLmxhYmVsID0gImxvYWQgIiArIGN1cnJlbnROdWdnZXQubnVnTmFtZSArICIgbnVnZ2V0IjsKICAgIH0KCiAgICBuZXdOdWdnZXRCdXR0b24udGFyZ2V0TnVnZ2V0ID0gY3VycmVudE51Z2dldC5udWdOYW1lOwogICAgbmV3TnVnZ2V0QnV0dG9uW3RoYXQuYm90LmlkICsgIi4iICsgdGhhdC50YWcgKyAiU3RhcnQiXSA9IGN1cnJlbnROdWdnZXQubnVnU3RhcnQ7CgogICAgY3JlYXRlKG5ld051Z2dldEJ1dHRvbik7CgogICAgLy9jcmVhdGVkQnV0dG9ucy5wdXNoKGN1cnJlbnROdWdnZXQubnVnTmFtZSk7Cn0KCnJldHVybjsnALaenq0KqD8LbnVnZ2V0UGFyc2UCBAC2np6tCv1Ypw9AY29uc3Qgb3JpZ2luYWxUYWdWYWx1ZSA9IHRoYXQuZWRpdGVkQm90LnJhd1t0aGF0LmVkaXRlZFRhZ107CmxldCB0YWdWYWx1ZSA9IG9yaWdpbmFsVGFnVmFsdWU7CgppZiAoIXRhZ1ZhbHVlKSAKewogICAgcmV0dXJuOwp9CmVsc2UgaWYgKHR5cGVvZiB0YWdWYWx1ZSAhPT0gInN0cmluZyIpIAp7CiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnRvU3RyaW5nKCk7Cn0KCmxldCBpbml0aWFsUG9zc2libGVOdWdQb3MgPSAwOwoKaWYgKGluaXRpYWxQb3NzaWJsZU51Z1BvcyA9PSAtMSkgCnsKICAgIHJldHVybjsKfQplbHNlCnsKICAgIHRhZ1ZhbHVlID0gdGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxQb3NzaWJsZU51Z1Bvcyk7Cn0KCmxldCBwb3NzaWJsZU51Z3MgPSBvcmlnaW5hbFRhZ1ZhbHVlLnJlcGxhY2UoL1tee10vZywgIiIpLmxlbmd0aDsKbGV0IHRvdGFsTnVnQnJlYWtzID0gb3JpZ2luYWxUYWdWYWx1ZS5yZXBsYWNlKC9bXlxuXS9nLCAiIikubGVuZ3RoOwpsZXQgYnJlYWtMZXZlbCA9IDA7CmxldCBudWdzVG9DaGVjayA9IFtdOwoKZm9yIChsZXQgaSA9IDA7IGkgPCBwb3NzaWJsZU51Z3M7IGkrKykKewogICAgbGV0IGluaXRpYWxOdWdQb3MgPSB0YWdWYWx1ZS5pbmRleE9mKCJ7IikgKyAxOwogICAgbGV0IHBvc3NpYmxlTnVnRW5kID0gdGFnVmFsdWUuaW5kZXhPZigifSIpOwogICAgbGV0IHBvc3NpYmxlTnVnID0gdGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MsIHBvc3NpYmxlTnVnRW5kKTsKCiAgICBpZiAocG9zc2libGVOdWcuaW5kZXhPZigiICIpID09IC0xICYmIC9cbi9nLnRlc3QocG9zc2libGVOdWcpICE9IHRydWUgJiYgcG9zc2libGVOdWcubGVuZ3RoID4gMCAmJiBwb3NzaWJsZU51Zy5pbmRleE9mKCI6IikgPT0gLTEpCiAgICB7CiAgICAgICAgbGV0IG51Z0JyZWFrcyA9IHRhZ1ZhbHVlLnN1YnN0cmluZygwLCB0YWdWYWx1ZS5pbmRleE9mKCJ7Iitwb3NzaWJsZU51ZysifSIpKS5yZXBsYWNlKC9bXlxuXS9nLCAiIikubGVuZ3RoOwogICAgICAgIGxldCBwdWJsaXNoQ2hlY2sgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoaW5pdGlhbE51Z1BvcyAtIDYsIGluaXRpYWxOdWdQb3MgLSAyKTsKICAgICAgICBsZXQgbnVnUHVibGlzaCA9IG51bGw7CgogICAgICAgIGlmIChwdWJsaXNoQ2hlY2sgPT0gIi5udWciKQogICAgICAgIHsKICAgICAgICAgICAgbnVnUHVibGlzaCA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBicmVha0xldmVsICs9IG51Z0JyZWFrczsKCiAgICAgICAgbnVnQnJlYWtzID0gdG90YWxOdWdCcmVha3MgLSAodG90YWxOdWdCcmVha3MgLSBicmVha0xldmVsKTsKICAgICAgICAKICAgICAgICAvL0NIRUNLIElGICQgYmVmb3JlIG51Z2dldAogICAgICAgIGlmICh0YWdWYWx1ZS5zdWJzdHJpbmcoaW5pdGlhbE51Z1BvcyAtIDIsIGluaXRpYWxOdWdQb3MgLSAxKSAhPSAiJCIpCiAgICAgICAgewogICAgICAgICAgICBudWdzVG9DaGVjay5wdXNoKHtudWdOYW1lOiBwb3NzaWJsZU51ZywgbnVnU3RhcnQ6IG51Z0JyZWFrcyArIDEsIG51Z1B1Ymxpc2g6IG51Z1B1Ymxpc2h9KTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbGV0IG51Z0JyZWFrcyA9IHRhZ1ZhbHVlLnN1YnN0cmluZygwLCB0YWdWYWx1ZS5pbmRleE9mKCJ9IikpLnJlcGxhY2UoL1teXG5dL2csICIiKS5sZW5ndGg7CgogICAgICAgIGJyZWFrTGV2ZWwgKz0gbnVnQnJlYWtzOwoKICAgICAgICBudWdCcmVha3MgPSB0b3RhbE51Z0JyZWFrcyAtICh0b3RhbE51Z0JyZWFrcyAtIGJyZWFrTGV2ZWwpOwogICAgfQoKICAgIHRhZ1ZhbHVlID0gdGFnVmFsdWUuc3Vic3RyaW5nKHBvc3NpYmxlTnVnRW5kICsgMSk7Cn0KCnRoaXNCb3QubnVnZ2V0QnV0dG9uKHsgbnVnZ2V0OiBudWdzVG9DaGVjaywgYm90OiB0aGF0LmVkaXRlZEJvdCwgdGFnOiB0aGF0LmVkaXRlZFRhZywgdGFnVmFsdWU6IG9yaWdpbmFsVGFnVmFsdWV9KTsnALaenq0KqD8Nb25BQlB1Ymxpc2hlZAIEALaenq0KpWjBAUBjb25zb2xlLmxvZyh0aGF0LmFiLCB0YWdzLm51Z2dldFRvUHVibGlzaCkKCmlmICh0aGF0LmFiID09IHRhZ3MubnVnZ2V0VG9QdWJsaXNoKQp7CiAgICBvcy50b2FzdCgibnVnZ2V0IHB1Ymxpc2hlZCIpOwoKICAgIG1hc2tzLm51Z2dldFRvUHVibGlzaCA9IG51bGw7CgogICAgY29uZmlnQm90Lm1hc2tzLmFiVmVyc2lvbiA9IG51bGw7Cn0nALaenq0KqD8Qb25BbnlCb3RzQ2hhbmdlZAIEALaenq0K52m3BEBpZiAoY29uZmlnQm90ICYmIHRoYXRbMF0uYm90LmlkICE9IHRoaXNCb3QuaWQpIAp7CiAgICBpZiAoIWNvbmZpZ0JvdC50YWdzLmVkaXRpbmdCb3QpIHJldHVybjsgLy8gSWdub3JlIGlmIHRoZSBjb25maWdCb3QgaXNuJ3QgcmVhZHkgeWV0LgoKICAgIGNvbnN0IGVkaXRlZEJvdElEID0gY29uZmlnQm90LnRhZ3MuZWRpdGluZ0JvdC5yZXBsYWNlKCLwn5SXIiwgIiIpOwoKICAgIGlmICghdGhhdC5maW5kKHggPT4geC5ib3QuaWQgPT0gZWRpdGVkQm90SUQpKSByZXR1cm47IC8vIElmIHRoZSBib3QgY2hhbmdlZCB3YXNuJ3QgYmVpbmcgZWRpdGVkIGJ5IHRoZSB1c2VyIGlnbm9yZSBpdC4KCiAgICBjb25zdCBlZGl0ZWRUYWcgPSBjb25maWdCb3QudGFncy5lZGl0aW5nVGFnOwogICAgY29uc3QgZWRpdGVkQm90ID0gZ2V0Qm90KCJpZCIsIGVkaXRlZEJvdElEKTsKCiAgICBpZiAoZWRpdGVkQm90ICYmIGVkaXRlZFRhZykgCiAgICB7CiAgICAgICAgc2hvdXQoIm51Z2dldFJlc2V0Iik7CgogICAgICAgIHRoaXNCb3QubnVnZ2V0UGFyc2UoeyBlZGl0ZWRCb3QsIGVkaXRlZFRhZyB9KTsKICAgIH0KfScAtp6erQqoPwhvbkNyZWF0ZQIEALaenq0KnW5MQHRhZ3MubGlzdGVuaW5nID0gZmFsc2U7CgovL3NldFRhZ01hc2sodGhpc0JvdCwgImxpc3RlbmluZyIsIHRydWUsICJsb2NhbCIpOycAtp6erQqoPw1wYWNrYWdlTnVnZ2V0AgQAtp6erQrqbvgGQGNvbnN0IHRhcmdldEJvdCA9IGdldEJvdCgiaWQiLCB0aGF0LmJvdCk7CmNvbnN0IHRhZ1RleHQgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXTsKCmlmIChjb25maWdCb3QudGFncy5jdXJzb3JTdGFydEluZGV4IHx8IGNvbmZpZ0JvdC50YWdzLmN1cnNvckVuZEluZGV4KQp7CiAgICBsZXQgc3RhcnRQb3MgPSBjb25maWdCb3QudGFncy5jdXJzb3JTdGFydEluZGV4OwogICAgbGV0IGVuZFBvcyA9IGNvbmZpZ0JvdC50YWdzLmN1cnNvckVuZEluZGV4OwoKICAgIGlmIChzdGFydFBvcyA9PSBlbmRQb3MpCiAgICB7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgZWxzZSBpZiAoc3RhcnRQb3MgPiBlbmRQb3MpCiAgICB7CiAgICAgICAgbGV0IG5ld1N0YXJ0UG9zID0gZW5kUG9zOwogICAgICAgIGxldCBuZXdFbmRQb3MgPSBzdGFydFBvczsKCiAgICAgICAgc3RhcnRQb3MgPSBuZXdTdGFydFBvczsKICAgICAgICBlbmRQb3MgPSBuZXdFbmRQb3M7CiAgICB9CgogICAgbGV0IGRhdGEgPSB0YWdUZXh0LnN1YnN0cmluZyhzdGFydFBvcywgZW5kUG9zICsgMSk7CgogICAgc2hvdXQoImFiUHVibGlzaE51Z2dldCIsIHtudWc6IHRoYXQubnVnZ2V0LCBkYXRhOiBkYXRhfSk7CgogICAgb3MudG9hc3QoIm51ZyBpcyBwdWJsaXNoaW5nIiwgMTApOwoKICAgIGxldCB0YXJnZXROdWcgPSAiLm51ZyB7IiArIHRoYXQubnVnZ2V0ICsgIn0iOyAKICAgIGxldCBudWdQb3MgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXS5pbmRleE9mKHRhcmdldE51Zyk7CgogICAgZGVsZXRlVGFnVGV4dCh0YXJnZXRCb3QsIHRoYXQudGFnLCBudWdQb3MsIHRhcmdldE51Zy5sZW5ndGgpOwp9CmVsc2UKewogICAgb3MudG9hc3QoImNhbm5vdCByZWFkIG51Z2dldCB0byBiZSBwdWJsaXNoZWQiKQp9JwC2np6tCqg/CHJlbWVtYmVyAgQAtp6erQrjdSjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwC2np6tCqg/BnNlYXJjaAIEALaenq0KinYo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScAtp6erQqoPwVzdG9yZQIEALaenq0KsXYo8J+Ulzc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZicAtp6erQqoPwlsaXN0ZW5pbmcCBAC2np6tCth2BWZhbHNlJwEEYm90cyRiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2IBJwC2np6tCt52BnN5c3RlbQIEALaenq0K33YRYWIuaW50ZXJmYWNlLm1lbnUnALaenq0K3nYEZm9ybQIEALaenq0K8XYHbm90aGluZycAtp6erQredgtkZXNjcmlwdGlvbgIEALaenq0K+XYmVGhpcyBza2lsbCBpcyBkZXNpZ25lZCBmb3IgbWVudSBzdHVmZi4oALaenq0K3nYLYWJJbnRlcmZhY2UBeCcAtp6erQredgphYk9wZW5NZW51AgQAtp6erQqhd9sKQGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGV0IG1lbnVUeXBlID0gdGhhdCA/ICJhYiIgKyB0aGF0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdGhhdC5zbGljZSgxKSArICJNZW51IjogImFiQ29yZU1lbnUiOyAvL3NldCB1cCBhIGNoZWNrIHRvIHNlZSB3aGF0IHR5cGUgb2YgbWVudSBzaG91bGQgYmUgb2NjdXJpbmcgW2NvcmUsIGJvdCwgZ3JpZCwgaW5zdF0KbGV0IG1lbnVTa2lsbHMgPSBnZXRCb3RzKG1lbnVUeXBlICsgIkFjdGlvbiIpOwpsZXQgbWF4T3B0aW9ucyA9IG1lbnVUeXBlID09ICJpbnN0IiA/IDcgOiA1OwpsZXQgYWJNZW51QnV0dG9uID0ge307CgphYk1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKYWJNZW51QnV0dG9uLnJlbWVtYmVyID0gdGFncy5yZW1lbWJlcjsKYWJNZW51QnV0dG9uLm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247CmFiTWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwphYk1lbnVCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLmJhc2VTa2lsbC4ke21lbnVUeXBlICsgIkFjdGlvbiJ9KCk7YDsKCmZvciAobGV0IGkgPSAwOyBpIDwgbWVudVNraWxscy5sZW5ndGg7IGkrKykvL0FERCBMT0dJQyBGT1IgTU9SRSBPUFRJT05TIFRIQU4gNSA6IG1heE9wdGlvbnMKewogICAgbGV0IGN1cnJlbnRTa2lsbCA9IG1lbnVTa2lsbHNbaV07CgogICAgYWJNZW51QnV0dG9uLmJhc2VTa2lsbCA9ICLwn5SXIiArIGN1cnJlbnRTa2lsbC5pZDsKICAgIGFiTWVudUJ1dHRvbi5sYWJlbCA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkxhYmVsIl07CiAgICBhYk1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJY29uIl07CiAgICBhYk1lbnVCdXR0b24ub25DcmVhdGUgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJPbkdlbmVyYXRlIl07CiAgICBhYk1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiU29ydE9yZGVyIl07CiAgICBhYk1lbnVCdXR0b24uY29sb3IgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJDb2xvciJdID8gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiQ29sb3IiXSA6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CgogICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24oYWJNZW51QnV0dG9uKTsKfQoKdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9ICJAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOyI7JwC2np6tCt52EmFiQ3JlYXRlTWVudUJ1dHRvbgIEALaenq0K+4EBvwNAbGV0IGFkZGl0aW9uYWxUYWdzID0gdGhhdDsKbGV0IG5ld01lbnVCdXR0b24gPSB7fTsKCm5ld01lbnVCdXR0b24uc3BhY2UgPSAidGVtcExvY2FsIjsKbmV3TWVudUJ1dHRvbi5jb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7Cm5ld01lbnVCdXR0b24ubGFiZWxDb2xvciA9ICJibGFjayI7Cm5ld01lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAibGVmdCI7Cm5ld01lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IHsgImJvcmRlci1yYWRpdXMiOiI4cHgiLCAibWFyZ2luLXRvcCI6IjNweCJ9OwoKZm9yIChjb25zdCB0YWcgaW4gYWRkaXRpb25hbFRhZ3MpCnsKICAgIG5ld01lbnVCdXR0b25bdGFnXSA9IGFkZGl0aW9uYWxUYWdzW3RhZ107Cn0KCm5ld01lbnVCdXR0b24gPSBjcmVhdGUobmV3TWVudUJ1dHRvbik7CgpyZXR1cm4gbmV3TWVudUJ1dHRvbjsnALaenq0K3nYNYWJNZW51UmVmcmVzaAIEALaenq0Ku4UBPkBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7CgptYXNrcy5vbkdyaWRDbGljayA9IG51bGw7JwC2np6tCt52CHJlbWVtYmVyAgQAtp6erQr6hQEo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAtp6erQredg1tYW5pZmVzdGF0aW9uAgQAtp6erQqhhgEo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAtp6erQredhFhYkVudmlyb25tZW50TWVudQIEALaenq0KyIYB0AZAc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgpsZXQgYWJNZW51QnV0dG9uID0ge307CgphYk1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKYWJNZW51QnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CmFiTWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwphYk1lbnVCdXR0b24ucmVtZW1iZXIgPSB0YWdzLnJlbWVtYmVyOwphYk1lbnVCdXR0b24ubGVhcm4gPSB0YWdzLmxlYXJuOwoKYnV0dG9uTG9vcDoKZm9yIChsZXQgaSA9IDA7IGkgPCB0YWdzLmFiRW52aXJvbm1lbnRBcnJheS5sZW5ndGg7IGkrKykKewogICAgbGV0IGFjdGl2ZUJ1dHRvbiA9IHRhZ3MuYWJFbnZpcm9ubWVudEFycmF5W2ldOwoKICAgIGFiTWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSBhY3RpdmVCdXR0b24uYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXI7CgogICAgaWYgKGFjdGl2ZUJ1dHRvbi5hYkVudmlyb25tZW50R2F0ZSkKICAgIHsKICAgICAgICBpZiAoIWxpbmtzW2FjdGl2ZUJ1dHRvbi5hYkVudmlyb25tZW50R2F0ZV0pCiAgICAgICAgewogICAgICAgICAgICBjb250aW51ZSBidXR0b25Mb29wOwogICAgICAgIH0KICAgIH0KCiAgICBsZXQgbmV3QnV0dG9uRGF0YSA9IHsuLi5hYk1lbnVCdXR0b24sIC4uLmFjdGl2ZUJ1dHRvbn07CgogICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obmV3QnV0dG9uRGF0YSk7Cn0KCnRoaXNCb3QubWFza3Mub25HcmlkQ2xpY2sgPSAiQCBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsiOycAtp6erQredgVsZWFybgIEALaenq0KmY0BKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnALaenq0K3nYDZ3B0AgQAtp6erQrAjQEo8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycAtp6erQredghhYklnbm9yZQIEALaenq0K540BBHRydWUoALaenq0K3nYMYWJCb3RWZXJzaW9uAX2JAScAtp6erQredhFhYkluaXRpYWxCb290TWVudQIEALaenq0K7Y0BvwpAY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJJbml0aWFsTWVudSI7CgptYXNrcy5lID0gIkAgbWFza3Mub25HcmlkQ2xpY2sgPSBudWxsOyI7Cm1hc2tzLm9uR3JpZENsaWNrID0gIkAgbWFza3Mub25HcmlkQ2xpY2sgPSBudWxsOyBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7IjsKCmxldCBtZW51QnV0dG9uID0ge307CgptZW51QnV0dG9uLmFiSW5pdGlhbE1lbnUgPSB0cnVlOwptZW51QnV0dG9uLmdyaWRDbGljayA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwptZW51QnV0dG9uLmxlYXJuID0gdGFncy5sZWFybjsKbWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwptZW51QnV0dG9uLnNlYXJjaCA9IHRhZ3Muc2VhcmNoOwptZW51QnV0dG9uLmFzayA9IHRhZ3MuYXNrOwptZW51QnV0dG9uLmxhYmVsID0gImJ1aWxkIjsKbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjdWJlIjsKbWVudUJ1dHRvbi5jb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7Cm1lbnVCdXR0b24ub25DbGljayA9IGBAIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgpsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTtgOwoKLy90aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKCm1lbnVCdXR0b24ubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5yZW1lbWJlci50YWdzLmFiQnVpbGRlcklkZW50aXR5OwptZW51QnV0dG9uLmZvcm0gPSAiaW5wdXQiOwptZW51QnV0dG9uLmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjdWJlIjsKbWVudUJ1dHRvbi5vblN1Ym1pdCA9IGBAIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgogICAgbGlua3MuYXNrLmFiQ29yZU1lbnVBY3Rpb24odGhhdC50ZXh0KTtgOwoKdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7CgptZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gInFyX2NvZGVfc2Nhbm5lciI7Cm1lbnVCdXR0b24uZm9ybSA9IG51bGw7Cm1lbnVCdXR0b24ubGFiZWwgPSAic2NhbiI7Cm1lbnVCdXR0b24uY29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwptZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKY29uZmlnQm90LnRhZ3MucHJhY3RpY2VQZXJtaXRTY2FuID0gdHJ1ZTsKCm9zLm9wZW5RUkNvZGVTY2FubmVyKCk7YDsKCnRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOycAtp6erQredgZzZWFyY2gCBAC2np6tCq2YASjwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwC2np6tCt52Bm51Z2dldAIEALaenq0K1JgBKPCflJc0YWFmNjk5ZS1hYmJmLTQ0YTgtODVlMS02OGNiYjVkZjBlMWYnALaenq0K3nYFdGVzdHMCBAC2np6tCvuYASjwn5SXYjgzZDk3MmItMDUzNS00MDUxLWI1ODktNDFjZWRhODUzNWYxJwC2np6tCt52D29uUG9ydGFsQ2hhbmdlZAIEALaenq0KopkBbkBpZiAodGhhdC5wb3J0YWwgPT0gInN5c3RlbVBvcnRhbCIgJiYgIXRoYXQuZGltZW5zaW9uICYmICFsaW5rcy50ZXN0cykKewogICAgbGlua3MubGVhcm4uYWJBZGFwdCgiYWJUZXN0cyIpOwp9JwC2np6tCt52A2FzawIEALaenq0KkZoBKPCflJdlYzg1YzFkNi05ZjFhLTQwZDQtODJlMS01YmQ2ODAzNDljMjcnALaenq0K3nYSYWJFbnZpcm9ubWVudEFycmF5AgQAtp6erQq4mgHDIfCfp6xbeyJsYWJlbCI6ICJoaWRlIiwgImZvcm1BZGRyZXNzIjogInZpc2liaWxpdHlfb2ZmIiwgIm9uQ2xpY2siOiAiQCBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOyBsaW5rcy5tYW5pZmVzdGF0aW9uLm1hc2tzLmFiQm90ID0gbnVsbDsiLCAiYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXIiOiAwfSwKeyJsYWJlbCI6ICJvcHRpbWl6ZSBtb2RlIiwgIm9uQ3JlYXRlIjogIkAgY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPyB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveCcgOiB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsiLCAib25DbGljayI6ICJAIGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID8gY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQgPSBmYWxzZSA6IGNvbmZpZ0JvdC50YWdzLmFiT3B0aW1pemVkID0gdHJ1ZTsgdGhpc0JvdC5vbkNyZWF0ZSgpOyIsICJhYkVudmlyb25tZW50TWVudVNvcnRPcmRlciI6IDF9LAp7ImxhYmVsIjogImNvbG9yIiwgImZvcm1BZGRyZXNzIjogInBhbGV0dGUiLCAib25DbGljayI6ICJAIG9zLnNob3dJbnB1dEZvclRhZyhsaW5rcy5yZW1lbWJlciwnYWJCYXNlQ29sb3InLCB7dHlwZTogJ2NvbG9yJyx0aXRsZTogJ3BpY2sgYSBjb2xvcid9KTsgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTtsaW5rcy5tYW5pZmVzdGF0aW9uLm1hc2tzLmFiQm90ID0gbnVsbDsiLCAiYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXIiOiAyfSwKeyJsYWJlbCI6ICJzbGVlcCIsICJmb3JtQWRkcmVzcyI6ICJuaWdodHNfc3RheSIsICJvbkNsaWNrIjogIkBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOyBsaW5rcy5tYW5pZmVzdGF0aW9uLm1hc2tzLmFiQm90ID0gbnVsbDsgbGlua3MucmVtZW1iZXIudGFncy5hYkF3YWtlU3RhdGUgPSBmYWxzZTsiLCAiYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXIiOiAzfSwKeyJsYWJlbCI6ICJjaGF0IiwgImZvcm1BZGRyZXNzIjogImNoYXQiLCAib25DbGljayI6ICJAIG9zLnNob3dDaGF0KCk7IiwgImFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyIjogNH0sCnsibGFiZWwiOiAibnVnZ2V0cyIsICJvbkNyZWF0ZSI6ICJAIHRhZ3MubnVnTWFuYWdlciA9IGdldExpbmsoZ2V0Qm90KCdzeXN0ZW0nLCAnYWIuaW50ZXJmYWNlLm51Z2dldCcpKTsgaWYgKGxpbmtzLm51Z01hbmFnZXIudGFncy5saXN0ZW5pbmcpe3RhZ3Mub25DbGljayA9IGBAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOyBzZXRUYWdNYXNrKGxpbmtzLm51Z01hbmFnZXIsICdsaXN0ZW5pbmcnLCBudWxsKTtgO3RhZ3MuZm9ybUFkZHJlc3MgPSBgY2hlY2tfYm94YDt9ZWxzZXsgICAgdGFncy5vbkNsaWNrID0gYEAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7IHNldFRhZ01hc2sobGlua3MubnVnTWFuYWdlciwgJ2xpc3RlbmluZycsIHRydWUsICdsb2NhbCcpO2A7ICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSBgY2hlY2tfYm94X291dGxpbmVfYmxhbmtgO30iLCAiYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXIiOiA1fSwKeyJsYWJlbCI6ICJzeXN0ZW1Qb3J0YWw9dHJ1ZSIsICJmb3JtQWRkcmVzcyI6ICJzZXR0aW5nc19hcHBsaWNhdGlvbnMiLCAib25LZXlEb3duIjogIkAgbWFza3MubGFiZWwgPSAnc3lzdGVtUG9ydGFsPXRydWUgaW4gbmV3IHRhYic7IiwgIm9uS2V5VXAiOiAiQCBtYXNrcy5sYWJlbCA9IG51bGw7IiwgIm9uQ2xpY2siOiAiQCBjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoJ2tleWJvYXJkJywgJ1NoaWZ0Jyk7IGlmIChzdGF0ZSl7b3Mub3BlblVSTChjb25maWdCb3QudGFncy5wZXJtYWxpbmsgKyBgJnN5c3RlbVBvcnRhbD10cnVlYCk7fWVsc2V7Y29uZmlnQm90LnRhZ3Muc3lzdGVtUG9ydGFsID0gdHJ1ZTt9IiwgImFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyIjogNn0sCnsiYWJFbnZpcm9ubWVudEdhdGUiOiAiZ3B0IiwgIm9uQ3JlYXRlIjogIkAgIGlmICghYXV0aEJvdCl7ZGVzdHJveSh0aGlzQm90KTt9ZWxzZSBpZiAoYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gJ0ZyZWVQbGF5JyB8fCBhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSB1bmRlZmluZWQpe2Rlc3Ryb3kodGhpc0JvdCk7fTsgdGFncy5sYWJlbCA9ICdlZGl0ICcgKyBsaW5rcy5yZW1lbWJlci50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgJyBwcm9tcHQnOyB0YWdzLmdwdEJvdCA9IGdldExpbmsoZ2V0Qm90KCdzeXN0ZW0nLCAnYWIuYWN0aW9uLmFzaycpKTsiLCAiZm9ybUFkZHJlc3MiOiAiZWRpdF9ub3RlIiwgIm9uQ2xpY2siOiAiQCBsaW5rcy5ncHRCb3QuZWRpdFByb21wdCgpOyIsICJhYkVudmlyb25tZW50TWVudVNvcnRPcmRlciI6IDd9LAp7ImxhYmVsIjogImdyaWQgc25hcCIsICJvbkNyZWF0ZSI6ICJAIHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJyIsICJvbkNsaWNrIjogIkAgbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGUgPSAhbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGU7dGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOyIsICJhYkVudmlyb25tZW50TWVudVNvcnRPcmRlciI6IDh9LAp7ImxhYmVsIjogImJvdCBzbmFwIiwgIm9uQ3JlYXRlIjogIkAgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7IiwgIm9uQ2xpY2siOiAiQCBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlID0gIWxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGU7IHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOyIsICJhYkVudmlyb25tZW50TWVudVNvcnRPcmRlciI6IDl9LAp7ImFiRW52aXJvbm1lbnRHYXRlIjogInRlc3RzIiwgImxhYmVsIjogInJlY29yZCB0ZXN0IiwgImZvcm1BZGRyZXNzIjogInNjaWVuY2UiLCAib25LZXlEb3duIjogIkAgIiwgIm9uS2V5VXAiOiAiQCAiLCAib25DbGljayI6ICJAIGxldCBzaGlmdENoZWNrID0gb3MuZ2V0SW5wdXRTdGF0ZSgna2V5Ym9hcmQnLCAnU2hpZnQnKTtsZXQgY3VycmVudEluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpO3Nob3V0KCdhYlJlY29yZFRlc3QnKTtzaG91dCgnYWJNZW51UmVmcmVzaCcpOyIsICJhYkVudmlyb25tZW50TWVudVNvcnRPcmRlciI6IDEwfSwKeyJhYkVudmlyb25tZW50R2F0ZSI6ICJ0ZXN0cyIsICJsYWJlbCI6ICJyZWNvcmQgdHJhY2UiLCAiZm9ybUFkZHJlc3MiOiAidGltZWxpbmUiLCAib25LZXlEb3duIjogIkAgIiwgIm9uS2V5VXAiOiAiQCAiLCAib25DbGljayI6ICJAIGxldCBzaGlmdENoZWNrID0gb3MuZ2V0SW5wdXRTdGF0ZSgna2V5Ym9hcmQnLCAnU2hpZnQnKTtsZXQgY3VycmVudEluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpO3Nob3V0KCdhYlJlY29yZFRyYWNlJyk7c2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsiLCAiYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXIiOiAxMX0sCnsib25DcmVhdGUiOiAiQCB0YWdzLmxhYmVsID0gJ3Blcm1hbmVudGx5IGRlbGV0ZSAnICsgbGlua3MucmVtZW1iZXIudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICcgdicgKyBsaW5rcy5yZW1lbWJlci50YWdzLmFiQ29yZVZlcnNpb24gKyAnLicgKyBsaW5rcy5yZW1lbWJlci50YWdzLmFiQ29yZUl0ZXJhdGlvbjsiLCAiZm9ybUFkZHJlc3MiOiAiZGVsZXRlX2ZvcmV2ZXIiLCAiY29sb3IiOiAiI0Q5MzAzMCIsICJvbkNsaWNrIjogIkAgbGV0IGFsbEJvdHMgPSBnZXRCb3RzKCdzcGFjZScsICdzaGFyZWQnKTtkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpO2ZvciAobGV0IGkgPSAwOyBpIDwgYWxsQm90cy5sZW5ndGg7IGkrKyl7aWYgKGFsbEJvdHNbaV0udGFncy5zeXN0ZW0pIHtpZiAoYWxsQm90c1tpXS50YWdzLnN5c3RlbS5pbmNsdWRlcygnYWInKSl7ZGVzdHJveShhbGxCb3RzW2ldKTt9fX0iLCAiYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXIiOiAxMDB9Cl0nAQRib3RzJGRjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZAEnALaenq0K+rsBBnN5c3RlbQIEALaenq0K+7sBGmFiLmludGVyZmFjZS5tYW5pZmVzdGF0aW9uJwC2np6tCvq7AQRmb3JtAgQAtp6erQqWvAEHbm90aGluZygAtp6erQr6uwELYWJJbnRlcmZhY2UBeCcAtp6erQr6uwELZGVzY3JpcHRpb24CBAC2np6tCp+8AThUaGlzIHNraWxsIGNvbnRyb2xzIHRoZSBhY3R1YWwgYm90IGZvciB0aGUgYWIgaW50ZXJmYWNlLicAtp6erQr6uwEFbGVhcm4CBAC2np6tCti8ASjwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwC2np6tCvq7AQ9vblBvcnRhbENoYW5nZWQCBAC2np6tCv+8AcIFQGlmICghbGlua3MucmVtZW1iZXIudGFncy5hYkF3YWtlU3RhdGUgfHwgdGhhdC5wb3J0YWwgPT0gInRhZ1BvcnRhbCIpCnsKICAgIHJldHVybjsKfQoKbGV0IHBvcnRhbEFycmF5ID0gWyJtaW5pR3JpZFBvcnRhbCIsICJncmlkUG9ydGFsIiwgIm1hcFBvcnRhbCIsICJtaW5pTWFwUG9ydGFsIiwgImxlZnRXcmlzdFBvcnRhbCIsICJyaWdodFdyaXN0UG9ydGFsIl07CgppZiAocG9ydGFsQXJyYXkuaW5kZXhPZih0aGF0LnBvcnRhbCkgIT0gLTEgJiYgdGhhdC5kaW1lbnNpb24pCnsKICAgIHRoaXNCb3QuYWJNYW5pZmVzdEJvdCh7ZGltZW5zaW9uOiB0aGF0LmRpbWVuc2lvbiwgcG9zaXRpb246e3g6MCx5OjB9fSk7Cn0KZWxzZSBpZiAocG9ydGFsQXJyYXkuaW5kZXhPZih0aGF0LnBvcnRhbCkgPT0gLTEgJiYgIXRoYXQuZGltZW5zaW9uICYmIHRoYXQucG9ydGFsICE9ICJtZW51UG9ydGFsIikKewogICAgbGV0IHN1bW1vbkRpbWVuc2lvbiA9IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA/IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA6IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWw7CgogICAgdGhpc0JvdC5hYk1hbmlmZXN0Qm90KHtkaW1lbnNpb246IHN1bW1vbkRpbWVuc2lvbiwgcG9zaXRpb246e3g6MCx5OjB9fSk7Cn0KZWxzZSBpZiAodGhhdC5wb3J0YWwgIT0gIm1lbnVQb3J0YWwiKQp7CiAgICBkZXN0cm95KGxpbmtzLmFiQm90KTsKfScAtp6erQr6uwEIcmVtZW1iZXICBAC2np6tCsLCASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwC2np6tCvq7AQ1hYk1hbmlmZXN0Qm90AgQAtp6erQrpwgHkD0BpZiAodGFncy5hYkJvdCkKewogICAgZGVzdHJveShsaW5rcy5hYkJvdCk7Cn0KCmxldCBhYiA9IHt9OwoKYWIuc3BhY2UgPSAidGVtcExvY2FsIjsKYWIuY29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yOwphYi5mb3JtT3BhY2l0eSA9ICIwLjMzIjsKYWIubGFiZWwgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUxhYmVsOwphYi5sYWJlbFBvc2l0aW9uID0gImZyb250IjsKYWIubGFiZWxDb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CmFiLmxhYmVsU2l6ZSA9IDAuNjE7CmFiLm9uQ2xpY2sgPSAiQCBsaW5rcy5tYW5hZ2VyLmFiQ2xpY2soKTsiOwphYi5kaW1lbnNpb24gPSB0aGF0LmRpbWVuc2lvbjsKYWJbdGhhdC5kaW1lbnNpb25dID0gdHJ1ZTsKYWJbdGhhdC5kaW1lbnNpb24gKyAiWCJdID0gdGhhdC5wb3NpdGlvbi54OwphYlt0aGF0LmRpbWVuc2lvbiArICJZIl0gPSB0aGF0LnBvc2l0aW9uLnk7CmFiLnN0cm9rZUNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKYWIubGluZUNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKYWIubWFuYWdlciA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7CmFiLmFuaW1hdGVCb3QgPSBgQCBpZiAoY29uZmlnQm90LnRhZ3MuYWJPcHRpbWl6ZWQpCnsKICAgIHJldHVybjsKfQoKY29uc3Qgcm90WiA9IHRhZ3MuZGltZW5zaW9uICsgIlJvdGF0aW9uWiI7CmxldCB0YXJnZXRTY2FsZSA9IDAuNjU7CgppZiAodGFncy5zY2FsZSA8PSAwLjY1MSkKewogICAgdGFyZ2V0U2NhbGUgPSAwLjk1Owp9Cgphd2FpdCBhbmltYXRlVGFnKHRoaXNCb3QsCnsKICAgIGZyb21WYWx1ZTogewogICAgICAgIFtyb3RaXTogMCwKICAgICAgICBzY2FsZTogdGFncy5zY2FsZQogICAgfSwKICAgIHRvVmFsdWU6IHsKICAgICAgICBbcm90Wl06IDYuMywKICAgICAgICBzY2FsZTogdGFyZ2V0U2NhbGUKICAgIH0sCiAgICBlYXNpbmc6IHsKICAgICAgICB0eXBlOiAic2ludXNvaWRhbCIsCiAgICAgICAgbW9kZTogImlub3V0IgogICAgfSwKICAgIGR1cmF0aW9uOiAyCn0pLmNhdGNoKGUgPT4ge30pOwpgOwphYi5vbkNyZWF0ZSA9IGBACgp0aGlzQm90LmFuaW1hdGVCb3QoKTsKCm1hc2tzLmludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4gdGhpc0JvdC5hbmltYXRlQm90KCksIDIwMDApOwpgOwphYi5vbkRlc3Ryb3kgPSBgQApjbGVhckludGVydmFsKHRhZ3MuaW50ZXJ2YWwpOwoKc2hvdXQoImFiTWVudVJlZnJlc2giKTsKYDsKYWIuZHJhZ2dhYmxlID0gZmFsc2U7CmFiLnNjYWxlID0gMC45OwoKbGV0IGFiTWFuaWZlc3RlZCA9IGF3YWl0IGNyZWF0ZShhYik7CgppZiAobGlua3MucmVtZW1iZXIudGFncy5hYlNlY29uZGFyeUxhYmVsKQp7CiAgICBsZXQgYWJMYWJlbEJvdCA9IHt9OwoKICAgIGFiTGFiZWxCb3Quc3BhY2UgPSAidGVtcExvY2FsIjsKICAgIGFiTGFiZWxCb3RbdGhhdC5kaW1lbnNpb25dID0gdHJ1ZTsKICAgIGFiTGFiZWxCb3RbdGhhdC5kaW1lbnNpb24gKyAiWiJdID0gLTE7CiAgICBhYkxhYmVsQm90LmNyZWF0b3IgPSBhYk1hbmlmZXN0ZWQuaWQ7CiAgICBhYkxhYmVsQm90LnRyYW5zZm9ybWVyID0gYWJNYW5pZmVzdGVkLmlkOwogICAgYWJMYWJlbEJvdC5wb2ludGFibGUgPSBmYWxzZTsKICAgIGFiTGFiZWxCb3QuY29sb3IgPSAiY2xlYXIiOwogICAgYWJMYWJlbEJvdC5sYWJlbCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJTZWNvbmRhcnlMYWJlbDsKICAgIGFiTGFiZWxCb3QubGFiZWxQb3NpdGlvbiA9ICJsZWZ0IjsKICAgIGFiTGFiZWxCb3QubGFiZWxTaXplID0gMC43OwogICAgYWJMYWJlbEJvdC5sYWJlbENvbG9yID0gYWJNYW5pZmVzdGVkLnRhZ3MubGFiZWxDb2xvcjsKCiAgICBjcmVhdGUoYWJMYWJlbEJvdCk7Cn0KCm1hc2tzLmFiQm90ID0gIvCflJciICsgYWJNYW5pZmVzdGVkLmlkOwoKbGlua3MucmVtZW1iZXIubWFza3MuYWJBY3RpdmVEaW1lbnNpb24gPSB0aGF0LmRpbWVuc2lvbjsnALaenq0K+rsBD2FiTWFuaWZlc3RTdGF0ZQIEALaenq0KytIBBkFzbGVlcCcAtp6erQr6uwEcYWJNYW5pZmVzdFN0YXRlQXNsZWVwT25FbnRlcgIEALaenq0K0dIBb0BkZXN0cm95KGxpbmtzLmFiQm90KTsKCm1hc2tzLmFiQm90ID0gbnVsbDsKCnNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgpsaW5rcy5yZW1lbWJlci50YWdzLmFiQXdha2VTdGF0ZSA9IGZhbHNlOycAtp6erQr6uwELb25HcmlkQ2xpY2sCBAC2np6tCsHTAfYQQGlmICghbGlua3MucmVtZW1iZXIudGFncy5hYkF3YWtlU3RhdGUpCnsKICAgIHJldHVybjsKfQoKc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmNvbnN0IHNoaWZ0Q2hlY2sgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOwoKaWYgKHNoaWZ0Q2hlY2sgJiYgdGFncy5hYkJvdCkKewogICAgaWYgKGxpbmtzLmFiQm90LnRhZ3MuYXJtKQogICAgewogICAgICAgIGRlc3Ryb3kobGlua3MuYWJCb3QubGlua3MuYXJtKTsKCiAgICAgICAgbGlua3MuYWJCb3QubWFza3MubGluZVRvID0gbnVsbDsKICAgIH0KICAgIAogICAgbGV0IGFybSA9IHt9OwoKICAgIGFybS5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwogICAgYXJtW3RoYXQuZGltZW5zaW9uXSA9IHRydWU7CiAgICBhcm1bdGhhdC5kaW1lbnNpb24gKyAiWCJdID0gdGhhdC5wb3NpdGlvbi54OwogICAgYXJtW3RoYXQuZGltZW5zaW9uICsgIlkiXSA9IHRoYXQucG9zaXRpb24ueTsKICAgIGFybS5kaW1lbnNpb24gPSB0aGF0LmRpbWVuc2lvbjsKICAgIGFybS5zY2FsZSA9IDAuOTsKICAgIGFybS5zY2FsZVogPSAwLjAxOwogICAgYXJtLmNvbG9yID0gImNsZWFyIjsKICAgIGFybS5zdHJva2VDb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CiAgICBhcm0ubGluZUNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKICAgIGFybS5saW5lVG8gPSBsaW5rcy5hYkJvdC5pZDsKICAgIGFybS5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKICAgIGFybS5vbkNsaWNrID0gYEAgZGVzdHJveSh0aGlzQm90KTsKCiAgICBsaW5rcy5tYW5hZ2VyLmFiTWFuaWZlc3RCb3Qoe2RpbWVuc2lvbjogdGFncy5kaW1lbnNpb24sIHBvc2l0aW9uOnt4OnRhZ3NbdGFncy5kaW1lbnNpb24gKyAiWCJdLHk6dGFnc1t0YWdzLmRpbWVuc2lvbiArICJZIl19fSk7YDsKCiAgICBsZXQgbmV3QXJtID0gYXdhaXQgY3JlYXRlKGFybSk7CgogICAgbGlua3MuYWJCb3QubWFza3MuYXJtID0gIvCflJciICsgbmV3QXJtLmlkOwoKICAgIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiR3JpZEZvY3VzID0ge2RpbWVuc2lvbjogdGhhdC5kaW1lbnNpb24sIHBvc2l0aW9uOiB7eDogdGhhdC5wb3NpdGlvbi54LCB5OiB0aGF0LnBvc2l0aW9uLnl9fTsKCiAgICB0aGlzQm90LmFiQ2xpY2soe21lbnU6ICJncmlkIn0pOwoKICAgIHJldHVybjsKfQoKbGV0IGZvb3RwcmludCA9IHt9OwoKZm9vdHByaW50LnNwYWNlID0gInRlbXBMb2NhbCI7CmZvb3RwcmludFt0aGF0LmRpbWVuc2lvbl0gPSB0cnVlOwpmb290cHJpbnQuZGltZW5zaW9uID0gdGhhdC5kaW1lbnNpb247CmZvb3RwcmludFt0aGF0LmRpbWVuc2lvbiArICJYIl0gPSB0aGF0LnBvc2l0aW9uLng7CmZvb3RwcmludFt0aGF0LmRpbWVuc2lvbiArICJZIl0gPSB0aGF0LnBvc2l0aW9uLnk7CmZvb3RwcmludC5zY2FsZVogPSAwLjAxOwpmb290cHJpbnQub25DbGljayA9IGBAIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gZmFsc2U7CgpsaW5rcy5tYW5hZ2VyLmFiTWFuaWZlc3RCb3QodGFncy5wb3NpdGlvbkluZm8pOwpgOwpmb290cHJpbnQucG9zaXRpb25JbmZvID0gdGhhdDsKZm9vdHByaW50LmNvbG9yID0gImNsZWFyIjsKZm9vdHByaW50LnN0cm9rZUNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKZm9vdHByaW50LmRyYWdnYWJsZSA9IGZhbHNlOwpmb290cHJpbnQubWFuYWdlciA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7CmZvb3RwcmludC5vbkNyZWF0ZSA9IGBAIHNldFRpbWVvdXQoKCkgPT4gZGVzdHJveSh0aGlzQm90KSwgODAwKTsKCiAgICBhd2FpdCBhbmltYXRlVGFnKHRoaXNCb3QsIHsKICAgICAgICBmcm9tVmFsdWU6IHsKICAgICAgICAgICAgc2NhbGVYOiAwLjEsCiAgICAgICAgICAgIHNjYWxlWTogMC4xCiAgICAgICAgfSwKICAgICAgICB0b1ZhbHVlOiB7CiAgICAgICAgICAgIHNjYWxlWDogMS4xLAogICAgICAgICAgICBzY2FsZVk6IDEuMQogICAgICAgIH0sCiAgICAgICAgZHVyYXRpb246IDAuNSwKICAgICAgICBlYXNpbmc6IHsKICAgICAgICAgICAgdHlwZTogImVsYXN0aWMiLAogICAgICAgICAgICBtb2RlOiAib3V0IgogICAgICAgIH0KICAgIH0pLmNhdGNoKGUgPT4ge30pOwpgOwoKY3JlYXRlKGZvb3RwcmludCk7JwC2np6tCvq7AQRtZW51AgQAtp6erQqy5AEo8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicAtp6erQr6uwEHYWJDbGljawIEALaenq0K2eQB3wlAaWYgKCFsaW5rcy5hYkJvdCkKewogICAgcmV0dXJuOwp9Cgpjb25zdCBtZW51VHlwZSA9IHRoYXQgPyB0aGF0Lm1lbnUgOiAiY29yZSI7CmNvbnN0IHN0YXRlID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiU2hpZnQiKTsKCmlmIChsaW5rcy5hYkJvdC50YWdzLmludGVydmFsIHx8IHN0YXRlKQp7CiAgICBjb25zdCBhYk1lbnVCb3RzID0gZ2V0Qm90cygiYWJNZW51IiwgdHJ1ZSk7CgogICAgd2hpc3BlcihhYk1lbnVCb3RzLCAiYWJNZW51UmVmcmVzaCIpOwogICAgCiAgICBjbGVhckludGVydmFsKGxpbmtzLmFiQm90LnRhZ3MuaW50ZXJ2YWwpOwoKICAgIGxpbmtzLmFiQm90Lm1hc2tzLmludGVydmFsID0gbnVsbDsKCiAgICBjbGVhckFuaW1hdGlvbnMobGlua3MuYWJCb3QpOwoKICAgIGNvbnN0IHJvdFogPSBsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbiArICJSb3RhdGlvbloiOwoKICAgIGlmIChzdGF0ZSAmJiBtZW51VHlwZSA9PSAiY29yZSIpCiAgICB7CiAgICAgICAgbGlua3MubWVudS5hYkVudmlyb25tZW50TWVudSgpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGxpbmtzLm1lbnUuYWJPcGVuTWVudShtZW51VHlwZSk7CiAgICB9CgogICAgYXdhaXQgYW5pbWF0ZVRhZyhsaW5rcy5hYkJvdCwKICAgIHsKICAgICAgICBmcm9tVmFsdWU6IHsKICAgICAgICAgICAgW3JvdFpdOiBsaW5rcy5hYkJvdC50YWdzW3JvdFpdLAogICAgICAgICAgICBzY2FsZTogbGlua3MuYWJCb3QudGFncy5zY2FsZQogICAgICAgIH0sCiAgICAgICAgdG9WYWx1ZTogewogICAgICAgICAgICBbcm90Wl06IDAsCiAgICAgICAgICAgIHNjYWxlOiAwLjkKICAgICAgICB9LAogICAgICAgIGVhc2luZzogewogICAgICAgICAgICB0eXBlOiAic2ludXNvaWRhbCIsCiAgICAgICAgICAgIG1vZGU6ICJpbm91dCIKICAgICAgICB9LAogICAgICAgIGR1cmF0aW9uOiAwLjUKICAgIH0pLmNhdGNoKGUgPT4ge30pOwp9CmVsc2UKewogICAgbGlua3MuYWJCb3QuYW5pbWF0ZUJvdCgpOwoKICAgIGxpbmtzLmFiQm90Lm1hc2tzLmxpbmVUbyA9IG51bGw7CgogICAgaWYgKGxpbmtzLmFiQm90LnRhZ3MuYXJtKQogICAgewogICAgICAgIGRlc3Ryb3kobGlua3MuYWJCb3QubGlua3MuYXJtKTsKICAgIH0KCiAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKICAgIGxpbmtzLmFiQm90Lm1hc2tzLmludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4gbGlua3MuYWJCb3QuYW5pbWF0ZUJvdCgpLCAyMDAwKTsKfScAtp6erQr6uwEbYWJNYW5pZmVzdFN0YXRlQXdha2VPbkVudGVyAgQAtp6erQq57gH0AUBsaW5rcy5yZW1lbWJlci50YWdzLmFiQXdha2VTdGF0ZSA9IHRydWU7CgpsZXQgZGltZW5zaW9uID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsIDogY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbDsKCmlmICghZGltZW5zaW9uKQp7CiAgICByZXR1cm47Cn0KCnRoaXNCb3QuYWJNYW5pZmVzdEJvdCh7ZGltZW5zaW9uOiBkaW1lbnNpb24sIHBvc2l0aW9uOiB7eDogMCwgeTogMH19KTsnALaenq0K+rsBDG9uQW55Qm90RHJhZwIEALaenq0KrvAB+whAaWYgKHRoYXQuYm90ICE9IGxpbmtzLmFiQm90KSByZXR1cm47CgppZiAobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzICYmIHRoYXQuYm90LmlkID09IGxpbmtzLmFiQm90LmlkKQp7CiAgICBvcy5lbmFibGVDdXN0b21EcmFnZ2luZygpOwoKICAgIHJldHVybjsKfQoKaWYgKGxpbmtzLmFiQm90LnRhZ3MuYXJtKQp7CiAgICBkZXN0cm95KGxpbmtzLmFiQm90LmxpbmtzLmFybSk7Cn0KCmlmICghdGhhdC5ib3QudGFncy5pbnRlcnZhbCkKewogICAgdGhpc0JvdC5hYkNsaWNrKCk7Cn0KCmxldCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIlNoaWZ0Iik7CmxldCBhcm0gPSB7fTsKCmFybS5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwphcm1bdGhhdC5mcm9tLmRpbWVuc2lvbl0gPSB0cnVlOwphcm0uY3JlYXRvciA9IGxpbmtzLmFiQm90LmlkOwphcm0uZGltZW5zaW9uID0gdGhhdC5mcm9tLmRpbWVuc2lvbjsKYXJtLnNjYWxlID0gMC45Owphcm0uc2NhbGVaID0gMC4wMTsKYXJtLmNvbG9yID0gImNsZWFyIjsKYXJtLnN0cm9rZUNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKYXJtLmxpbmVDb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CmFybS5saW5lVG8gPSB0aGF0LmJvdC5pZDsKYXJtLm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwphcm0ub25DbGljayA9IGBAIGRlc3Ryb3kodGhpc0JvdCk7CgpsaW5rcy5tYW5hZ2VyLmFiTWFuaWZlc3RCb3Qoe2RpbWVuc2lvbjogdGFncy5kaW1lbnNpb24sIHBvc2l0aW9uOnt4OnRhZ3NbdGFncy5kaW1lbnNpb24gKyAiWCJdLHk6dGFnc1t0YWdzLmRpbWVuc2lvbiArICJZIl19fSk7YDsKCmlmIChzdGF0ZSkKewogICAgYXJtLm11bHRpU2VsZWN0ID0gdHJ1ZTsKICAgIGFybS5mb3JtID0gInNwaGVyZSI7CiAgICBhcm0uY29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwoKICAgIGxpbmtzLmFiQm90Lm1hc2tzLmRyYWdnYWJsZSA9IHRydWU7Cn0KCmxldCBuZXdBcm0gPSBhd2FpdCBjcmVhdGUoYXJtKTsKCmxpbmtzLmFiQm90Lm1hc2tzLmFybSA9ICLwn5SXIiArIG5ld0FybS5pZDsKCm9zLnJlcGxhY2VEcmFnQm90KG5ld0FybSk7JwC2np6tCvq7ARFvbkFueUJvdERyb3BFbnRlcgIEALaenq0KpvkBuQdAaWYgKCF0YWdzLmFiQm90KSByZXR1cm47CmlmIChsaW5rcy5hYkJvdC5saW5rcy5hcm0gIT0gdGhhdC5kcmFnQm90KSByZXR1cm47CgppZiAobGlua3MuYWJCb3QubGlua3MuYXJtLnRhZ3MubXVsdGlTZWxlY3QpCnsKICAgIGlmIChBcnJheS5pc0FycmF5KGxpbmtzLmFiQm90LnRhZ3MubGluZVRvKSkKICAgIHsKICAgICAgICBsaW5rcy5hYkJvdC5tYXNrcy5saW5lVG8ucHVzaCh0aGF0LnRvLmJvdC5pZCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbGlua3MuYWJCb3QubWFza3MubGluZVRvID0gW3RoYXQudG8uYm90LmlkXTsKICAgIH0KCiAgICBsZXQgbmV3TGluazsKCiAgICBpZiAoIWxpbmtzLmFiQm90LmxpbmtzLmFybS50YWdzLnNlbGVjdGVkQm90cykKICAgIHsKICAgICAgICBuZXdMaW5rID0gZ2V0TGluayh0aGF0LnRvLmJvdCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbGV0IHByZXZpb3VzTGlua0JvdHMgPSBsaW5rcy5hYkJvdC5saW5rcy5hcm0ubGlua3Muc2VsZWN0ZWRCb3RzOwoKICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocHJldmlvdXNMaW5rQm90cykpCiAgICAgICAgewogICAgICAgICAgICBwcmV2aW91c0xpbmtCb3RzID0gW3ByZXZpb3VzTGlua0JvdHNdCiAgICAgICAgfQoKICAgICAgICBwcmV2aW91c0xpbmtCb3RzLnB1c2godGhhdC50by5ib3QpOwoKICAgICAgICBuZXdMaW5rID0gZ2V0TGluayhwcmV2aW91c0xpbmtCb3RzKTsKICAgIH0KCiAgICBsaW5rcy5hYkJvdC5saW5rcy5hcm0udGFncy5zZWxlY3RlZEJvdHMgPSBuZXdMaW5rOwp9CmVsc2UKewogICAgbGlua3MuYWJCb3QubGlua3MuYXJtLm1hc2tzLnN0cm9rZUNvbG9yID0gImNsZWFyIjsKICAgIGxpbmtzLmFiQm90LmxpbmtzLmFybS5tYXNrcy5saW5lVG8gPSBmYWxzZTsKCiAgICBsaW5rcy5hYkJvdC5tYXNrcy5saW5lVG8gPSB0aGF0LnRvLmJvdC5pZDsKfScAtp6erQr6uwEQb25BbnlCb3REcm9wRXhpdAIEALaenq0K4IACnAJAaWYgKCFsaW5rcy5hYkJvdCkgcmV0dXJuOwppZiAobGlua3MuYWJCb3QubGlua3MuYXJtICE9IHRoYXQuZHJhZ0JvdCkgcmV0dXJuOwoKaWYgKCFsaW5rcy5hYkJvdC5saW5rcy5hcm0udGFncy5tdWx0aVNlbGVjdCkKewogICAgbGlua3MuYWJCb3QubGlua3MuYXJtLm1hc2tzLnN0cm9rZUNvbG9yID0gbnVsbDsKICAgIGxpbmtzLmFiQm90LmxpbmtzLmFybS5tYXNrcy5saW5lVG8gPSBudWxsOwoKICAgIGxpbmtzLmFiQm90Lm1hc2tzLmxpbmVUbyA9IGxpbmtzLmFiQm90LmxpbmtzLmFybS5pZDsKfScAtp6erQr6uwEMb25BbnlCb3REcm9wAgQAtp6erQr9ggKyBkBtYXNrcy5tdWx0aURyYWcgPSBudWxsOwoKaWYgKCF0YWdzLmFiQm90KSByZXR1cm47CmlmICghbGlua3MuYWJCb3QpIHJldHVybjsKaWYgKCFsaW5rcy5hYkJvdC50YWdzLmFybSkgcmV0dXJuOwppZiAobGlua3MuYWJCb3QubGlua3MuYXJtICE9IHRoYXQuZHJhZ0JvdCkgcmV0dXJuOwoKaWYgKGxpbmtzLmFiQm90LmxpbmtzLmFybS50YWdzLm11bHRpU2VsZWN0KQp7CiAgICBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYk11bHRpcGxlQm90Rm9jdXMgPSBsaW5rcy5hYkJvdC5saW5rcy5hcm0udGFncy5zZWxlY3RlZEJvdHM7CgogICAgdGhpc0JvdC5hYkNsaWNrKHttZW51OiAibXVsdGlwbGVCb3QifSk7CgogICAgZGVzdHJveShsaW5rcy5hYkJvdC5saW5rcy5hcm0pOwp9CmVsc2UgaWYgKHRoYXQudG8uYm90KQp7CiAgICBpZiAodGhhdC50by5ib3QgPT0gbGlua3MuYWJCb3QpCiAgICB7CiAgICAgICAgbGlua3MubWVudS5hYkVudmlyb25tZW50TWVudSgpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiQm90Rm9jdXMgPSAi8J+UlyIgKyB0aGF0LnRvLmJvdC5pZDsKCiAgICAgICAgdGhpc0JvdC5hYkNsaWNrKHttZW51OiAiYm90In0pOwogICAgfQoKICAgIGRlc3Ryb3kobGlua3MuYWJCb3QubGlua3MuYXJtKTsKfQplbHNlCnsKICAgIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiR3JpZEZvY3VzID0ge2RpbWVuc2lvbjogdGhhdC50by5kaW1lbnNpb24sIHBvc2l0aW9uOiB7eDogdGhhdC50by54LCB5OiB0aGF0LnRvLnl9fTsKCiAgICB0aGlzQm90LmFiQ2xpY2soe21lbnU6ICJncmlkIn0pOwp9JwC2np6tCvq7AQhhYklnbm9yZQIEALaenq0KrokCBHRydWUoALaenq0K+rsBDGFiQm90VmVyc2lvbgF9iQEnALaenq0K+rsBA2FzawIEALaenq0KtIkCKPCflJdlYzg1YzFkNi05ZjFhLTQwZDQtODJlMS01YmQ2ODAzNDljMjcnALaenq0K+rsBCWFza0J1dHRvbgIEALaenq0K24kC2QVAaWYgKCFsaW5rcy5yZW1lbWJlci50YWdzLmFiQXdha2VTdGF0ZSkKewogICAgcmV0dXJuOwp9CgpsZXQgYWJNZW51QnV0dG9uID0ge307CgphYk1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKYWJNZW51QnV0dG9uLnJlbWVtYmVyID0gbGlua3MubWVudS50YWdzLnJlbWVtYmVyOwphYk1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IGxpbmtzLm1lbnUudGFncy5tYW5pZmVzdGF0aW9uOwphYk1lbnVCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKYWJNZW51QnV0dG9uLmJhc2VTa2lsbCA9ICLwn5SXIiArIGxpbmtzLmFzay5pZDsKYWJNZW51QnV0dG9uLmxhYmVsID0gbGlua3MuYXNrLnRhZ3MuYWJDb3JlTWVudUxhYmVsOwphYk1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSBsaW5rcy5hc2sudGFncy5hYkNvcmVNZW51SWNvbjsKYWJNZW51QnV0dG9uLm9uQ3JlYXRlID0gbGlua3MuYXNrLnRhZ3MuYWJDb3JlTWVudU9uR2VuZXJhdGU7CmFiTWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSBsaW5rcy5hc2sudGFncy5hYkNvcmVNZW51U29ydE9yZGVyOwphYk1lbnVCdXR0b24uY29sb3IgPSBsaW5rcy5hc2sudGFncy5hYkNvcmVNZW51Q29sb3IgPyBsaW5rcy5hc2sudGFncy5hYkNvcmVNZW51Q29sb3IgOiBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwoKbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oYWJNZW51QnV0dG9uKTsnALaenq0K+rsBCWFiQm90Q2hhdAIEALaenq0Ks48C1QtAaWYgKCFsaW5rcy5hYkJvdCAmJiAhdGhhdC5ib3QpCnsKICAgIHJldHVybjsKfQoKY29uc3QgYm90QmFzZSA9IHRoYXQuYm90ID8gdGhhdC5ib3Q6IGxpbmtzLmFiQm90Owpjb25zdCBkaW1lbnNpb24gPSAhdGhhdC5ib3QgPyBib3RCYXNlLnRhZ3MuZGltZW5zaW9uIDogdGhhdC5kaW1lbnNpb24gPyB0aGF0LmRpbWVuc2lvbiA6IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWw7CmNvbnN0IG1lc3NhZ2UgPSB0aGF0Lm1lc3NhZ2U7CmNvbnN0IG1lc3NhZ2VUaW1lID0gdGhhdC50aW1lID8gdGhhdC50aW1lICogMTAwMCA6IDE2MDA7IApjb25zdCBtZXNzYWdlQm90ID0ge307CgptZXNzYWdlQm90LnNwYWNlID0gInRlbXBMb2NhbCI7Cm1lc3NhZ2VCb3QudHJhbnNmb3JtZXIgPSBib3RCYXNlLmlkOwptZXNzYWdlQm90LmZvcm0gPSAic3ByaXRlIjsKbWVzc2FnZUJvdC5jb2xvciA9ICIjMDAwMDAwIjsKbWVzc2FnZUJvdC5sYWJlbCA9IG1lc3NhZ2U7Cm1lc3NhZ2VCb3QubGFiZWxDb2xvciA9ICIjZmZmZmZmIjsKbWVzc2FnZUJvdC5sYWJlbFNpemUgPSAxOwptZXNzYWdlQm90LnNjYWxlWCA9IG1lc3NhZ2UubGVuZ3RoIC8gNSA+IDEwID8gMTAgOiBtZXNzYWdlLmxlbmd0aCA8IDEwID8gMiA6IG1lc3NhZ2UubGVuZ3RoIC8gNTsKbWVzc2FnZUJvdC5zY2FsZVkgPSAobWVzc2FnZS5sZW5ndGggLyA1MCkgPiAxID8gTWF0aC5yb3VuZChtZXNzYWdlLmxlbmd0aCAvIDUwKSA6IDEuMzM7Cm1lc3NhZ2VCb3Quc2NhbGVaID0gMC4xOwptZXNzYWdlQm90Lm9yaWVudGF0aW9uTW9kZSA9ICJiaWxsYm9hcmQiOwptZXNzYWdlQm90W2RpbWVuc2lvbl0gPSB0cnVlOwptZXNzYWdlQm90LmRpbWVuc2lvbiA9IGRpbWVuc2lvbjsKbWVzc2FnZUJvdFtkaW1lbnNpb24gKyAiWCJdID0gMDsKbWVzc2FnZUJvdFtkaW1lbnNpb24gKyAiWSJdID0gMDsKbWVzc2FnZUJvdFtkaW1lbnNpb24gKyAiWiJdID0gYm90QmFzZS50YWdzLnNjYWxlID8gYm90QmFzZS50YWdzLnNjYWxlIC8gMiArIDIgOiAyOwptZXNzYWdlQm90Lm9uRmFkZSA9IGBAIGF3YWl0IGFuaW1hdGVUYWcodGhpc0JvdCwgewogICAgZnJvbVZhbHVlOiB7CiAgICAgICAgZm9ybU9wYWNpdHk6IDEsCiAgICAgICAgbGFiZWxPcGFjaXR5OiAxLAogICAgICAgIFt0YWdzLmRpbWVuc2lvbiArICJaIl06IHRhZ3NbdGFncy5kaW1lbnNpb24gKyAiWiJdCiAgICB9LAogICAgdG9WYWx1ZTogewogICAgICAgIGZvcm1PcGFjaXR5OiAwLAogICAgICAgIGxhYmVsT3BhY2l0eTogMCwKICAgICAgICBbdGFncy5kaW1lbnNpb24gKyAiWiJdOiB0YWdzW3RhZ3MuZGltZW5zaW9uICsgIloiXSArIDUKICAgIH0sCiAgICBkdXJhdGlvbjogJHt0aGF0LmR1cmF0aW9uID8/IDN9Cn0pLmNhdGNoKHt9KTsKCmRlc3Ryb3kodGhpc0JvdCk7YDsKCmNvbnN0IGFjdGl2ZU1lc3NhZ2UgPSBjcmVhdGUobWVzc2FnZUJvdCk7CgpzZXRUaW1lb3V0KCgpPT4gYWN0aXZlTWVzc2FnZS5vbkZhZGUoKSwgbWVzc2FnZVRpbWUpOycAtp6erQr6uwEQb25BbnlCb3REcmFnZ2luZwIEALaenq0KiZsChRBAaWYgKGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1cyAmJiB0aGF0LmJvdC5pZCA9PSBsaW5rcy5hYkJvdC5pZCkKewogICAgY29uc3QgYWN0aXZlRGltZW5zaW9uID0gbGlua3MucmVtZW1iZXIubWFza3MuYWJBY3RpdmVEaW1lbnNpb24gPz8gY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbDsKICAgIGxldCBkcmFnQ29vcmRpbmF0b3JCb3QgPSBsaW5rcy5kcmFnQ29vcmQ7CgogICAgaWYgKCFkcmFnQ29vcmRpbmF0b3JCb3QpCiAgICB7CiAgICAgICAgY29uc3QgZHJhZ0Nvb3JkaW5hdG9yQm90TW9kID0ge307CgogICAgICAgIGRyYWdDb29yZGluYXRvckJvdE1vZC5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwogICAgICAgIGRyYWdDb29yZGluYXRvckJvdE1vZC5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsKICAgICAgICBkcmFnQ29vcmRpbmF0b3JCb3RNb2QuZGltZW5zaW9uID0gYWN0aXZlRGltZW5zaW9uOwogICAgICAgIGRyYWdDb29yZGluYXRvckJvdE1vZFthY3RpdmVEaW1lbnNpb25dID0gdHJ1ZTsKICAgICAgICBkcmFnQ29vcmRpbmF0b3JCb3RNb2RbYWN0aXZlRGltZW5zaW9uICsgIlgiXSA9IDA7CiAgICAgICAgZHJhZ0Nvb3JkaW5hdG9yQm90TW9kW2FjdGl2ZURpbWVuc2lvbiArICJZIl0gPSAwOwogICAgICAgIGRyYWdDb29yZGluYXRvckJvdE1vZFthY3RpdmVEaW1lbnNpb24gKyAiWiJdID0gLTE7CiAgICAgICAgZHJhZ0Nvb3JkaW5hdG9yQm90TW9kLnBvaW50YWJsZSA9IGZhbHNlOwogICAgICAgIGRyYWdDb29yZGluYXRvckJvdE1vZC5jb2xvciA9ICJjbGVhciI7CiAgICAgICAgZHJhZ0Nvb3JkaW5hdG9yQm90TW9kLm9uQW55Qm90UG9pbnRlclVwID0gYEAgbGlua3MubWFuYWdlci5tYXNrcy5kcmFnQ29vcmQgPSBudWxsOyBzaG91dCgnYWJTdG9wRHJhZycsIHt4OiB0YWdzLiR7YWN0aXZlRGltZW5zaW9ufVgsIHk6IHRhZ3MuJHthY3RpdmVEaW1lbnNpb259WX0pOyBkZXN0cm95KHRoaXNCb3QpO2A7CgogICAgICAgIGRyYWdDb29yZGluYXRvckJvdCA9IGNyZWF0ZShkcmFnQ29vcmRpbmF0b3JCb3RNb2QpOwoKICAgICAgICBtYXNrcy5kcmFnQ29vcmQgPSBnZXRMaW5rKGRyYWdDb29yZGluYXRvckJvdCk7CgogICAgICAgIGNvbnN0IGRyYWdCb3RzID0gbGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzOwoKICAgICAgICBsaW5rcy5hYkJvdC5tYXNrcy50cmFuc2Zvcm1lciA9IGRyYWdDb29yZGluYXRvckJvdC5pZDsKICAgICAgICBsaW5rcy5hYkJvdC5tYXNrcy5hYlN0b3BEcmFnID0gYEAgbWFza3MudHJhbnNmb3JtZXIgPSBudWxsOyBtYXNrcy5hYlN0b3BEcmFnID0gbnVsbDsgdGFncy4ke2FjdGl2ZURpbWVuc2lvbn1YID0gdGFncy4ke2FjdGl2ZURpbWVuc2lvbn1YICsgdGhhdC54OyB0YWdzLiR7YWN0aXZlRGltZW5zaW9ufVkgPSB0YWdzLiR7YWN0aXZlRGltZW5zaW9ufVkgKyB0aGF0LnlgOwoKICAgICAgICBzZXRUYWdNYXNrKGRyYWdCb3RzLCAidHJhbnNmb3JtZXIiLCBkcmFnQ29vcmRpbmF0b3JCb3QuaWQsICJ0ZW1wTG9jYWwiKTsKICAgICAgICBzZXRUYWdNYXNrKGRyYWdCb3RzLCAiYWJTdG9wRHJhZyIsIGBAIG1hc2tzLnRyYW5zZm9ybWVyID0gbnVsbDsgbWFza3MuYWJTdG9wRHJhZyA9IG51bGw7IHRhZ3MuJHthY3RpdmVEaW1lbnNpb259WCA9IHRhZ3MuJHthY3RpdmVEaW1lbnNpb259WCArIHRoYXQueDsgdGFncy4ke2FjdGl2ZURpbWVuc2lvbn1ZID0gdGFncy4ke2FjdGl2ZURpbWVuc2lvbn1ZICsgdGhhdC55YCwgInRlbXBMb2NhbCIpOwogICAgfQoKICAgIGNvbnN0IHhDaGFuZ2UgPSB0aGF0LnRvLnggLSB0aGF0LmZyb20ueDsKICAgIGNvbnN0IHlDaGFuZ2UgPSB0aGF0LnRvLnkgLSB0aGF0LmZyb20ueTsKCiAgICBkcmFnQ29vcmRpbmF0b3JCb3QudGFnc1thY3RpdmVEaW1lbnNpb24gKyAiWCJdID0geENoYW5nZTsKICAgIGRyYWdDb29yZGluYXRvckJvdC50YWdzW2FjdGl2ZURpbWVuc2lvbiArICJZIl0gPSB5Q2hhbmdlOwogICAgZHJhZ0Nvb3JkaW5hdG9yQm90LnRhZ3NbYWN0aXZlRGltZW5zaW9uICsgIloiXSA9IC0xOwp9Ad7fg8UFAcwj2TI=',
    'AaACirL7tQEAJwEEYm90cyQzOTg4MDFmZS00YjM1LTRjZTQtODI2Zi0yMzgzNWMxYjlhYzUBJwCKsvu1AQAGc3lzdGVtAgQAirL7tQEBFGFiLmFjdGlvbi5jcmVhdGVfYm90JwCKsvu1AQAIYWJBY3Rpb24CBACKsvu1ARYEdHJ1ZScAirL7tQEABGZvcm0CBACKsvu1ARsHbm90aGluZycAirL7tQEAC2Rlc2NyaXB0aW9uAgQAirL7tQEjDUNyZWF0ZXMgYm90cy4nAIqy+7UBABBhYkdyaWRNZW51QWN0aW9uAgQAirL7tQEx0gRAY29uc3QgZ3JpZEluZm9ybWF0aW9uID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsKY29uc3QgbmV3Qm90ID0ge307CgpuZXdCb3QuY3JlYXRvciA9IG51bGw7Cm5ld0JvdFtncmlkSW5mb3JtYXRpb24uZGltZW5zaW9uXSA9IHRydWU7Cm5ld0JvdFtncmlkSW5mb3JtYXRpb24uZGltZW5zaW9uICsgIlgiXSA9IGdyaWRJbmZvcm1hdGlvbi5wb3NpdGlvbi54OwpuZXdCb3RbZ3JpZEluZm9ybWF0aW9uLmRpbWVuc2lvbiArICJZIl0gPSBncmlkSW5mb3JtYXRpb24ucG9zaXRpb24ueTsKbmV3Qm90LmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKCmxldCBjcmVhdGVkQm90ID0gY3JlYXRlKG5ld0JvdCk7CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CgpsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90Lm1hc2tzLmxpbmVUbyA9IGNyZWF0ZWRCb3QuaWQ7CgpsaW5rcy5yZW1lbWJlci5tYXNrcy5hYkJvdEZvY3VzID0gIvCflJciICsgY3JlYXRlZEJvdC5pZDsKCmxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljayh7bWVudTogImJvdCJ9KTsnAIqy+7UBAA9hYkdyaWRNZW51TGFiZWwCBACKsvu1AYIFA2JvdCcAirL7tQEADmFiR3JpZE1lbnVJY29uAgQAirL7tQGGBQdhZGRfYm94JwCKsvu1AQAIcmVtZW1iZXICBACKsvu1AY4FKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAIqy+7UBAA1tYW5pZmVzdGF0aW9uAgQAirL7tQG1BSjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCKsvu1AQAIYWJJZ25vcmUCBACKsvu1AdwFBHRydWUoAIqy+7UBAAxhYkJvdFZlcnNpb24BfZ8BJwCKsvu1AQATYWJHcmlkTWVudVNvcnRPcmRlcgIEAIqy+7UB4gUBMScBBGJvdHMkNTg0OWFmNTUtNWU4YS00OGQ2LTkxMDYtMTk5NDk4ZTllYzA4AScAirL7tQHkBQZzeXN0ZW0CBACKsvu1AeUFEWFiLmFjdGlvbi5kZXN0cm95JwCKsvu1AeQFCGFiQWN0aW9uAgQAirL7tQH3BQR0cnVlJwCKsvu1AeQFBGZvcm0CBACKsvu1AfwFB25vdGhpbmcnAIqy+7UB5AUPYWJCb3RNZW51QWN0aW9uAgQAirL7tQGEBoEBQGNvbnN0IHRhcmdldEJvdCA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXM7CgpkZXN0cm95KHRhcmdldEJvdCk7CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7JwCKsvu1AeQFDmFiQm90TWVudUxhYmVsAgQAirL7tQGGBwdkZXN0cm95JwCKsvu1AeQFDWFiQm90TWVudUljb24CBACKsvu1AY4HDmRlbGV0ZV9mb3JldmVyJwCKsvu1AeQFEmFiQm90TWVudVNvcnRPcmRlcgIEAIqy+7UBnQcDMTAwJwCKsvu1AeQFCHJlbWVtYmVyAgQAirL7tQGhByjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCKsvu1AeQFDW1hbmlmZXN0YXRpb24CBACKsvu1AcgHKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAIqy+7UB5AUIYWJJZ25vcmUCBACKsvu1Ae8HBHRydWUoAIqy+7UB5AUMYWJCb3RWZXJzaW9uAX2fAScAirL7tQHkBQ5hYkJvdE1lbnVDb2xvcgIEAIqy+7UB9QcHI0Q5MzAzMCcBBGJvdHMkNzE3NTY0NWMtNGI1My00NDU0LTg3MTYtZmMwZTY4ZGIyNjY1AScAirL7tQH9BwZzeXN0ZW0CBACKsvu1Af4HD2FiLmFjdGlvbi5sb2dpbicAirL7tQH9BwhhYkFjdGlvbgIEAIqy+7UBjggEdHJ1ZSgAirL7tQH9BwxhYkJvdFZlcnNpb24BfQknAIqy+7UB/QcIYWJJZ25vcmUCBACKsvu1AZQIBHRydWUnAIqy+7UB/QcEZm9ybQIEAIqy+7UBmQgHbm90aGluZycAirL7tQH9Bw9hYkNvcmVNZW51Q29sb3ICBACKsvu1AaEIByNGMkI3MDUnAIqy+7UB/QcTYWJDb3JlTWVudVNvcnRPcmRlcgIEAIqy+7UBqQgCLTUnAIqy+7UB/QcQYWJDb3JlTWVudUFjdGlvbgIEAIqy+7UBrAgsQG9zLmdvVG9VUkwobGlua3MucmVtZW1iZXIudGFncy5hYkF1dGhTaXRlKTsnAIqy+7UB/QcUYWJDb3JlTWVudU9uR2VuZXJhdGUCBACKsvu1AdkInQJAYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsKCmlmICghbGlua3MucmVtZW1iZXIudGFncy5hYkF1dGhTaXRlKQp7CiAgICBkZXN0cm95KHRoaXNCb3QpOwp9Cgp0YWdzLmxhYmVsID0gImJ1eSAiICsgbGlua3MucmVtZW1iZXIudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsKCmlmICghYXV0aEJvdCkKewogICAgcmV0dXJuOwp9CmVsc2UgaWYgKGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09ICJGcmVlUGxheSIpCnsKICAgIHJldHVybjsKfQoKZGVzdHJveSh0aGlzQm90KTsnAIqy+7UB/QcOYWJDb3JlTWVudUljb24CBACKsvu1AfcKDmFjY291bnRfY2lyY2xlJwCKsvu1Af0HCHJlbWVtYmVyAgQAirL7tQGGCyjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwEEYm90cyRiMWU3MTU2NC04ZDM5LTRmZTItYjkxYi0wZjEwNWJlYzRmYjIBJwCKsvu1Aa0LBnN5c3RlbQIEAIqy+7UBrgsOYWIuYWN0aW9uLm5vdGUnAIqy+7UBrQsIYWJBY3Rpb24CBACKsvu1Ab0LBHRydWUoAIqy+7UBrQsMYWJCb3RWZXJzaW9uAX2QAScAirL7tQGtCw5hYkdyaWRNZW51SWNvbgIEAIqy+7UBwwsNc3RpY2t5X25vdGVfMicAirL7tQGtCwRmb3JtAgQAirL7tQHRCwdub3RoaW5nJwCKsvu1Aa0LD2FiR3JpZE1lbnVMYWJlbAIEAIqy+7UB2QsEbm90ZScAirL7tQGtCwhhYklnbm9yZQIEAIqy+7UB3gsEdHJ1ZScAirL7tQGtCw1tYW5pZmVzdGF0aW9uAgQAirL7tQHjCyjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCKsvu1Aa0LCHJlbWVtYmVyAgQAirL7tQGKDCjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCKsvu1Aa0LEGFiR3JpZE1lbnVBY3Rpb24CBACKsvu1AbEMqgRAY29uc3QgZ3JpZEluZm9ybWF0aW9uID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsKY29uc3QgbmV3Qm90ID0ge307CgpuZXdCb3QuY3JlYXRvciA9IG51bGw7Cm5ld0JvdFtncmlkSW5mb3JtYXRpb24uZGltZW5zaW9uXSA9IHRydWU7Cm5ld0JvdFtncmlkSW5mb3JtYXRpb24uZGltZW5zaW9uICsgIlgiXSA9IGdyaWRJbmZvcm1hdGlvbi5wb3NpdGlvbi54OwpuZXdCb3RbZ3JpZEluZm9ybWF0aW9uLmRpbWVuc2lvbiArICJZIl0gPSBncmlkSW5mb3JtYXRpb24ucG9zaXRpb24ueTsKCmxldCBjcmVhdGVkQm90ID0gY3JlYXRlKHRhZ3Mubm90ZU1vZCwgbmV3Qm90KTsKCnNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgpsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsKCmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QubWFza3MubGluZVRvID0gY3JlYXRlZEJvdC5pZDsKCmxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiQm90Rm9jdXMgPSAi8J+UlyIgKyBjcmVhdGVkQm90LmlkOwoKbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKHttZW51OiAiYm90In0pOycAirL7tQGtCxNhYkdyaWRNZW51U29ydE9yZGVyAgQAirL7tQHaEAEyJwCKsvu1Aa0LB25vdGVNb2QCBACKsvu1AdwQkBfwn6esewogICAgImFiTm90ZSI6IHRydWUsCiAgICAic2NhbGVYIjogMSwKICAgICJzY2FsZVkiOiAxLAogICAgInNjYWxlIjogMSwKICAgICJvcmllbnRhdGlvbk1vZGUiOiAiYmlsbGJvYXJkIiwKICAgICJjb2xvciI6ICIjRkNDNDAwIiwKICAgICJtYXhMT0RUaHJlc2hvbGQiOiAwLjEsCiAgICAib25DcmVhdGUiOiAiQCBzZXRUaW1lb3V0KCgpID0+IHdoaXNwZXIodGhpc0JvdCwgJ2FiTm90ZVJlZnJlc2gnKSwgMjUpOyIsCiAgICAib25NYXhMT0RFbnRlciI6ICJAc2V0VGFnTWFzayh0aGlzQm90LCBcIkxPRFN0YXRlXCIsIFwiRGV0YWlsc1wiLCBcInRlbXBMb2NhbFwiKTtcbndoaXNwZXIodGhpc0JvdCwgXCJhYk5vdGVSZWZyZXNoXCIpOyIsCiAgICAib25NYXhMT0RFeGl0IjogIkBcbnNldFRhZ01hc2sodGhpc0JvdCwgXCJMT0RTdGF0ZVwiLCBcIk5vdGVcIiwgXCJ0ZW1wTG9jYWxcIik7XG53aGlzcGVyKHRoaXNCb3QsIFwiYWJOb3RlUmVmcmVzaFwiKTtcbiIsCiAgICAib25Cb3RDaGFuZ2VkIjogIkBcbmxldCBjaGFuZ2UgPSB0aGF0LnRhZ3NbMF07XG5cbmlmIChjaGFuZ2UgPT0gXCJOb3RlXCIgfHwgY2hhbmdlID09IFwiRGV0YWlsc1wiKSBcbntcbiAgICB3aGlzcGVyKHRoaXNCb3QsIFwiYWJOb3RlUmVmcmVzaFwiKTtcbn0iLAogICAgImxhYmVsV29yZFdyYXBNb2RlIjogImJyZWFrV29yZHMiLAogICAgIm9uQ2xpY2siOiAiQGNvbnN0IHN0YXRlID0gb3MuZ2V0SW5wdXRTdGF0ZShcImtleWJvYXJkXCIsIFwiU2hpZnRcIik7XG5cbmlmIChzdGF0ZSlcbntcbiAgICByZXR1cm47XG59XG5lbHNlXG57XG4gICAgaWYgKHRhZ3MuTE9EU3RhdGUgPT0gbnVsbCB8fCB0YWdzLkxPRFN0YXRlID09IFwiTm90ZVwiKSBcbiAgICB7XG4gICAgICAgIHZhciBjdXJyZW50TE9EID0gXCJOb3RlXCI7XG4gICAgICAgIHZhciB0ZXh0TE9EID0gXCJub3RlXCI7XG4gICAgfVxuICAgIGVsc2UgXG4gICAge1xuICAgICAgICB2YXIgY3VycmVudExPRCA9IFwiRGV0YWlsc1wiO1xuICAgICAgICB2YXIgdGV4dExPRCA9IFwiZGV0YWlsc1wiO1xuICAgIH1cblxuICAgIGNvbnN0IG5ld0xhYmVsID0gYXdhaXQgb3Muc2hvd0lucHV0KHRhZ3NbY3VycmVudExPRF0sIFxuICAgIHtcbiAgICAgICAgdGl0bGU6IGBlZGl0ICR7dGV4dExPRH0gdGV4dGBcbiAgICB9KTtcblxuICAgIGlmIChjdXJyZW50TE9EID09IFwiTm90ZVwiICYmIHRhZ3MuRGV0YWlscylcbiAgICB7XG4gICAgICAgIHNldFRhZ01hc2sodGhpc0JvdCwgXCJsYWJlbFwiLCBcIitcIiArIG5ld0xhYmVsLCBcInRlbXBMb2NhbFwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY3VycmVudExPRCA9PSBcIk5vdGVcIilcbiAgICB7XG4gICAgICAgIHNldFRhZ01hc2sodGhpc0JvdCwgXCJsYWJlbFwiLCBuZXdMYWJlbCwgXCJ0ZW1wTG9jYWxcIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGN1cnJlbnRMT0QgPT0gXCJEZXRhaWxzXCIpXG4gICAge1xuICAgICAgICBzZXRUYWdNYXNrKHRoaXNCb3QsIFwibGFiZWxcIiwgXCIqXCIgKyBuZXdMYWJlbCwgXCJ0ZW1wTG9jYWxcIik7XG4gICAgfVxuICAgIGVsc2VcbiAgICB7XG4gICAgICAgIHNldFRhZ01hc2sodGhpc0JvdCwgXCJsYWJlbFwiLCBuZXdMYWJlbCwgXCJ0ZW1wTG9jYWxcIik7XG4gICAgfVxuXG4gICAgdGFnc1tjdXJyZW50TE9EXSA9IG5ld0xhYmVsO1xufSIsCiAgICAiYWJOb3RlUmVmcmVzaCI6ICJAZnVuY3Rpb24gbWFwKGlucHV0LCBtaW4xLCBtYXgxLCBtaW4yLCBtYXgyKSB7XG4gICAgcmV0dXJuIChpbnB1dCAtIG1pbjEpICogKG1heDIgLSBtaW4yKSAvIChtYXgxIC0gbWluMSkgKyBtaW4yO1xufVxuXG5pZiAodGFncy5MT0RTdGF0ZSA9PSBcIk5vdGVcIiB8fCB0YWdzLkxPRFN0YXRlID09IG51bGwpIFxue1xuICAgIGlmICh0YWdzLkRldGFpbHMgJiYgdGFncy5Ob3RlKSBcbiAgICB7XG4gICAgICAgIHZhciBuZXdMYWJlbCA9IFwiK1wiICsgdGFncy5Ob3RlO1xuICAgIH1cbiAgICBlbHNlIGlmICh0YWdzLk5vdGUpIFxuICAgIHtcbiAgICAgICAgdmFyIG5ld0xhYmVsID0gdGFncy5Ob3RlO1xuICAgIH1cbiAgICBlbHNlIGlmICh0YWdzLkRldGFpbHMpIFxuICAgIHtcbiAgICAgICAgdmFyIG5ld0xhYmVsID0gXCIrXCI7XG4gICAgfVxuICAgIGVsc2UgXG4gICAge1xuICAgICAgICB2YXIgbmV3TGFiZWwgPSBcIiBcIjtcbiAgICB9XG59XG5lbHNlIGlmICh0YWdzLkxPRFN0YXRlID09IFwiRGV0YWlsc1wiKSBcbntcbiAgICBpZiAodGFncy5EZXRhaWxzKSBcbiAgICB7XG4gICAgICAgIHZhciBuZXdMYWJlbCA9IFwiKlwiICsgdGFncy5EZXRhaWxzO1xuICAgIH1cbiAgICBlbHNlIGlmICh0YWdzLk5vdGUpXG4gICAge1xuICAgICAgICB2YXIgbmV3TGFiZWwgPSBcIipcIiArIHRhZ3MuTm90ZTtcbiAgICB9XG4gICAgZWxzZVxuICAgIHtcbiAgICAgICAgdmFyIG5ld0xhYmVsID0gXCIqXCI7XG4gICAgfVxufVxuXG5pZiAobmV3TGFiZWwpXG57XG4gICAgc2V0VGFnTWFzayh0aGlzQm90LCBcImxhYmVsXCIsIG5ld0xhYmVsKTtcblxuICAgIGxldCBsZW5ndGhUZXN0ID0gbmV3TGFiZWwubGVuZ3RoO1xuXG4gICAgaWYoIW5ld0xhYmVsLmluY2x1ZGVzKFwiIFwiKSkgdGFncy5sYWJlbEZvbnRTaXplID0gbWFwKGxlbmd0aFRlc3QsIDEsIDI1LCAuNywgLjIpICogdGFncy5zY2FsZTtcbiAgICBlbHNlIGlmKGxlbmd0aFRlc3QgPCA0MCkgdGFncy5sYWJlbEZvbnRTaXplID0gbWFwKGxlbmd0aFRlc3QsIDEsIDMwLCAuOCwgLjMpICogdGFncy5zY2FsZTtcbiAgICBlbHNlIHRhZ3MubGFiZWxGb250U2l6ZSA9IG51bGw7XG4gICAgaWYodGFncy5sYWJlbEZvbnRTaXplIDw9IDApIHRhZ3MubGFiZWxGb250U2l6ZSA9IC4xO1xuICAgIFxufSIsCiAgICAib25EZXN0cm95IjogIkAgZGVzdHJveShnZXRCb3RzKCd0cmFuc2Zvcm1lcicsIHRoaXNCb3QuaWQpKTsiLAogICAgImxhYmVsRm9udFNpemUiOiAwLjgKfScBBGJvdHMkYjMzOWMxMTgtNDg5YS00NjZiLWJhOWYtYjA3YTVmOWI2NjRmAScAirL7tQHrJwZzeXN0ZW0CBACKsvu1AewnD2FiLmFjdGlvbi5wYXN0ZSgAirL7tQHrJwhhYkFjdGlvbgF4JwCKsvu1AesnBGZvcm0CBACKsvu1Af0nB25vdGhpbmcnAIqy+7UB6ycLZGVzY3JpcHRpb24CBACKsvu1AYUoK2FiIHNraWxsIHVzZWQgZm9yIGNvcHlpbmcgYW5kIHBhc3RpbmcgYm90cy4nAIqy+7UB6ycHb25QYXN0ZQIEAIqy+7UBsSjiB0BpZiAoIWJ1aWxkZXJWZXJzaW9uKQp7CiAgICByZXR1cm47Cn0KCmNvbnN0IE1BQ1JPUyA9IFsKICAgIHsKICAgICAgICB0ZXN0OiAvKD86W+KAnOKAnV0pL2csCiAgICAgICAgcmVwbGFjZW1lbnQ6ICh2YWwpID0+ICciJywKICAgIH0sCiAgICB7CiAgICAgICAgdGVzdDogLyg/OlvigJjigJldKS9nLAogICAgICAgIHJlcGxhY2VtZW50OiAodmFsKSA9PiAiJyIsCiAgICB9LApdOwoKbGV0IGZvcm1hdHRlZENvcHkgPSByZXBsYWNlTWFjcm9zKHRoYXQudGV4dCk7CmxldCBjb3B5Qm90ID0gSlNPTi5wYXJzZShmb3JtYXR0ZWRDb3B5KTsKbGV0IHBhc3RlZERhdGEgPSAhY29weUJvdC5zdGF0ZSA/IHtbY29weUJvdC5pZF06IGNvcHlCb3R9IDogY29weUJvdC5zdGF0ZTsKbGV0IGRpbU1vZCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJGb2N1c0RhdGE7CgppZiAoT2JqZWN0LmtleXMocGFzdGVkRGF0YSkubGVuZ3RoID09IDEgJiYgZGltTW9kKQp7CiAgICBwYXN0ZWREYXRhW2RpbU1vZC5kaW1lbnNpb25dID0gdHJ1ZTsKICAgIHBhc3RlZERhdGFbZGltTW9kLmRpbWVuc2lvbisiWCJdID0gZGltTW9kLng7CiAgICBwYXN0ZWREYXRhW2RpbU1vZC5kaW1lbnNpb24rIlkiXSA9IGRpbU1vZC55OwoKICAgIG9zLnRvYXN0KCJib3QgYWRkZWQgdG8gaW5zdCIpOwp9CmVsc2UKewogICAgb3MudG9hc3QoImJvdHMgYWRkZWQgdG8gaW5zdCIpOwp9CgphYi5sb2coYWJSZW1lbWJlci50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogcGFzdGVkIGRhdGEiKTsKCmxpbmtzLmNyZWF0ZS5hYkNyZWF0ZUJvdHMoe2JvdHM6IHBhc3RlZERhdGF9KTsKCmZ1bmN0aW9uIHJlcGxhY2VNYWNyb3ModGV4dCkgewogICAgaWYgKCF0ZXh0KSB7CiAgICAgICAgcmV0dXJuIHRleHQ7CiAgICB9CgogICAgZm9yIChsZXQgbSBvZiBNQUNST1MpIHsKICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKG0udGVzdCwgbS5yZXBsYWNlbWVudCk7CiAgICB9CgogICAgcmV0dXJuIHRleHQ7Cn0nAIqy+7UB6ycIcmVtZW1iZXICBACKsvu1AYwwKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAIqy+7UB6ycGY3JlYXRlAgQAirL7tQGzMCjwn5SXMzRjM2MyMTAtNWJmMS00OWNmLWIxNTEtZWUyZDA3ZjBlNjczJwCKsvu1AesnCGFiSWdub3JlAgQAirL7tQHaMAR0cnVlKACKsvu1AesnDGFiQm90VmVyc2lvbgF9nwEnAIqy+7UB6ycJb25LZXlEb3duAgQAirL7tQHgMKwJQGlmICghYnVpbGRlclZlcnNpb24gfHwgKCFsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzICYmICFsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXMpKQp7CiAgICByZXR1cm47Cn0KCmlmICh0aGF0LmtleXMgPT0gImMiKQp7CiAgICBsZXQgbWV0YUlucHV0ID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiTWV0YSIpOwoKICAgIGlmICghbWV0YUlucHV0KQogICAgewogICAgICAgIG1ldGFJbnB1dCA9IG9zLmdldElucHV0U3RhdGUoImtleWJvYXJkIiwgIkNvbnRyb2wiKTsKICAgIH0KICAgIAogICAgaWYgKCFtZXRhSW5wdXQpCiAgICB7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGxldCBmb3JtYXR0ZWRGaWxlOwogICAgbGV0IHN0YXRlID0ge307CgogICAgaWYgKGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXMpCiAgICB7CiAgICAgICAgbGV0IHNlbGVjdGVkQm90ID0gbGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1czsKCiAgICAgICAgc3RhdGVbc2VsZWN0ZWRCb3QuaWRdID0gc2VsZWN0ZWRCb3Q7CgogICAgICAgIGFiLmxvZyhhYlJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBjb3BpZWQgYSBib3QgdG8gY2xpcGJvYXJkIik7CiAgICB9CiAgICBlbHNlIGlmIChsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXMpCiAgICB7CiAgICAgICAgbGV0IHNlbGVjdGVkQm90cyA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1czsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZWxlY3RlZEJvdHMubGVuZ3RoOyBpKyspCiAgICAgICAgewogICAgICAgICAgICBzdGF0ZVtzZWxlY3RlZEJvdHNbaV0uaWRdID0gc2VsZWN0ZWRCb3RzW2ldOwogICAgICAgIH0KCiAgICAgICAgYWIubG9nKGFiUmVtZW1iZXIudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IGNvcGllZCBtdWx0aXBsZSBib3RzIHRvIGNsaXBib2FyZCIpOwogICAgfQoKICAgIGxldCBuZXdGaWxlID0ge307CiAgICBuZXdGaWxlLnZlcnNpb24gPSAxOwogICAgbmV3RmlsZS5zdGF0ZSA9IHN0YXRlOwoKICAgIGZvcm1hdHRlZEZpbGUgPSBKU09OLnN0cmluZ2lmeShuZXdGaWxlKTsKCiAgICBvcy5zZXRDbGlwYm9hcmQoZm9ybWF0dGVkRmlsZSk7CgogICAgb3MudG9hc3QoImJvdCBjb3BpZWQgdG8gY2xpcGJvYXJkIik7Cn0nAQRib3RzJGJkYWJkNmMwLTg5ZjktNGY3NS1iMzVjLTI2ZjRlYzUyMDdkNgEnAIqy+7UBjToGc3lzdGVtAgQAirL7tQGOOhBhYi5hY3Rpb24ucmVwb3J0JwCKsvu1AY06BGZvcm0CBACKsvu1AZ86B25vdGhpbmcnAIqy+7UBjToQYWJDb3JlTWVudUFjdGlvbgIEAIqy+7UBpzoRQG9zLnJlcG9ydEluc3QoKTsnAIqy+7UBjToTYWJDb3JlTWVudVNvcnRPcmRlcgIEAIqy+7UBuToDMTAxJwCKsvu1AY06D2FiQ29yZU1lbnVDb2xvcgIEAIqy+7UBvToHI0YyQjcwNScAirL7tQGNOg5hYkNvcmVNZW51SWNvbgIEAIqy+7UBxToEZmxhZycAirL7tQGNOg9hYkNvcmVNZW51TGFiZWwCBACKsvu1Aco6BnJlcG9ydCcAirL7tQGNOghhYkFjdGlvbgIEAIqy+7UB0ToEdHJ1ZScAirL7tQGNOghhYklnbm9yZQIEAIqy+7UB1joEdHJ1ZSgAirL7tQGNOgxhYkJvdFZlcnNpb24BfRAnAQRib3RzJGM2OGM1YjgyLWMwYTctNGE1YS05MTA0LTVkZDhlMzJhZTRlMgEnAIqy+7UB3DoGc3lzdGVtAgQAirL7tQHdOhRhYi5hY3Rpb24ub3Blbl9zaGVldCcAirL7tQHcOgtkZXNjcmlwdGlvbgIEAIqy+7UB8joUU2tpbGwgdG8gb3BlbiBzaGVldC4nAIqy+7UB3DoIYWJBY3Rpb24CBACKsvu1AYc7BHRydWUnAIqy+7UB3DoEZm9ybQIEAIqy+7UBjDsHbm90aGluZycAirL7tQHcOhBhYkNvcmVNZW51QWN0aW9uAgQAirL7tQGUO/UCQGNvbnN0IGN1cnJlbnRJbnN0ID0gb3MuZ2V0Q3VycmVudEluc3QoKTsKY29uc3QgY3VycmVudERpbSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb247CmNvbnN0IHN0YXRlID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiU2hpZnQiKTsKCmlmIChzdGF0ZSkgCnsKICAgIG9zLm9wZW5VUkwoY29uZmlnQm90LnRhZ3MucGVybWFsaW5rICsgYCZzaGVldFBvcnRhbD0ke2N1cnJlbnREaW19YCk7Cn0KZWxzZQp7CiAgICBjb25maWdCb3QudGFncy5zaGVldFBvcnRhbCA9IGN1cnJlbnREaW07Cn0KCmFiLmxvZyhhYlJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyBgOiBvcGVuZWQgJHtjdXJyZW50RGltfSBzaGVldGApOycAirL7tQHcOghyZW1lbWJlcgIEAIqy+7UBij4o8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAirL7tQHcOg9hYkNvcmVNZW51TGFiZWwCBACKsvu1AbE+Cm9wZW4gc2hlZXQnAIqy+7UB3DoPYWJCb3RNZW51QWN0aW9uAgQAirL7tQG8PvECQGNvbnN0IGN1cnJlbnRJbnN0ID0gb3MuZ2V0Q3VycmVudEluc3QoKTsKY29uc3QgY3VycmVudERpbSA9IGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QudGFncy5saW5lVG87CmNvbnN0IHN0YXRlID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiU2hpZnQiKTsKCmlmIChzdGF0ZSkgCnsKICAgIG9zLm9wZW5VUkwoY29uZmlnQm90LnRhZ3MucGVybWFsaW5rICsgYCZzaGVldFBvcnRhbD0ke2N1cnJlbnREaW19YCk7Cn0KZWxzZQp7CiAgICBjb25maWdCb3QudGFncy5zaGVldFBvcnRhbCA9IGN1cnJlbnREaW07Cn0KCmFiLmxvZyhhYlJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBvcGVuZWQgYm90IHNoZWV0Iik7JwCKsvu1Adw6DmFiQm90TWVudUxhYmVsAgQAirL7tQGuQQ5vcGVuIGJvdCBzaGVldCcAirL7tQHcOg1tYW5pZmVzdGF0aW9uAgQAirL7tQG9QSjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCKsvu1Adw6DWFiQm90TWVudUljb24CBACKsvu1AeRBCnRhYmxlX3ZpZXcnAIqy+7UB3DoOYWJDb3JlTWVudUljb24CBACKsvu1Ae9BCnRhYmxlX3ZpZXcnAIqy+7UB3DoSYWJCb3RNZW51U29ydE9yZGVyAgQAirL7tQH6QQExJwCKsvu1Adw6CGFiSWdub3JlAgQAirL7tQH8QQR0cnVlKACKsvu1Adw6DGFiQm90VmVyc2lvbgF9nwEnAIqy+7UB3DoXYWJNdWx0aXBsZUJvdE1lbnVBY3Rpb24CBACKsvu1AYJClARAY29uc3QgY3VycmVudEluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpOwpjb25zdCBjdXJyZW50RGltID0gImFiTXVsdGlwbGVTZWxlY3QiOwoKY29uZmlnQm90LnRhZ3Muc2hlZXRQb3J0YWwgPSBjdXJyZW50RGltOwoKc2V0VGFnTWFzayhsaW5rcy5yZW1lbWJlci5saW5rcy5hYk11bHRpcGxlQm90Rm9jdXMsIGN1cnJlbnREaW0sIHRydWUsICJ0ZW1wTG9jYWwiKTsKCm1hc2tzLmN1cnJlbnRTaGVldEJvdHMgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiTXVsdGlwbGVCb3RGb2N1czsKbWFza3Mub25Qb3J0YWxDaGFuZ2VkID0gYEAgaWYgKHRoYXQuZGltZW5zaW9uICE9ICJhYk11bHRpcGxlU2VsZWN0IiAmJiB0aGF0LnBvcnRhbCA9PSAic2hlZXRQb3J0YWwiKQp7CiAgICBjbGVhclRhZ01hc2tzKGxpbmtzLmN1cnJlbnRTaGVldEJvdHMpOwoKICAgIGNsZWFyVGFnTWFza3ModGhpc0JvdCk7Cn0gYDsKCmFiLmxvZyhhYlJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBvcGVuZWQgbXVsdGlwbGUgc2VsZWN0IHNoZWV0Iik7JwCKsvu1Adw6FmFiTXVsdGlwbGVCb3RNZW51TGFiZWwCBACKsvu1AZdGGm9wZW4gbXVsdGlwbGUgc2VsZWN0IHNoZWV0JwCKsvu1Adw6FWFiTXVsdGlwbGVCb3RNZW51SWNvbgIEAIqy+7UBskYKdGFibGVfdmlldycAirL7tQHcOhRhYkNvcmVNZW51T25HZW5lcmF0ZQIEAIqy+7UBvUaAAkBsZXQgY3VycmVudERpbSA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBY3RpdmVEaW1lbnNpb247Cgp0YWdzLmxhYmVsID0gInNoZWV0UG9ydGFsPSIgKyBjdXJyZW50RGltOwoKdGFncy5vbktleURvd24gPSBgQCBpZih0aGF0LmtleXMgPT0gIlNoaWZ0Iil7bWFza3MubGFiZWwgPSB0YWdzLmxhYmVsICsgIiBpbiBuZXcgdGFiIjt9YDsKdGFncy5vbktleVVwID0gYEAgaWYodGhhdC5rZXlzID09ICJTaGlmdCIpe21hc2tzLmxhYmVsID0gbnVsbDt9YDsnAIqy+7UB3DoTYWJCb3RNZW51T25HZW5lcmF0ZQIEAIqy+7UBvkiYAkBsZXQgc2VsZWN0ZWRCb3QgPSBsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90LnRhZ3MubGluZVRvOwoKdGFncy5sYWJlbCA9ICJzaGVldFBvcnRhbD0iICsgc2VsZWN0ZWRCb3Quc3Vic3RyaW5nKDAsIDQpOwoKdGFncy5vbktleURvd24gPSBgQCBpZih0aGF0LmtleXMgPT0gIlNoaWZ0Iil7bWFza3MubGFiZWwgPSB0YWdzLmxhYmVsICsgIiBpbiBuZXcgdGFiIjt9YDsKdGFncy5vbktleVVwID0gYEAgaWYodGhhdC5rZXlzID09ICJTaGlmdCIpe21hc2tzLmxhYmVsID0gbnVsbDt9YDsnAQRib3RzJGVjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNwEnAIqy+7UB10oGc3lzdGVtAgQAirL7tQHYSg1hYi5hY3Rpb24uYXNrJwCKsvu1AddKBGZvcm0CBACKsvu1AeZKB25vdGhpbmcnAIqy+7UB10oGYXNrR1BUAgQAirL7tQHuSuQRQGlmICghdGFncy5ncHRBY3RpdmUgfHwgYXV0aEJvdC50YWdzLnByaXZhY3lGZWF0dXJlcy5hbGxvd0FJID09IGZhbHNlKQp7CiAgICBvcy50b2FzdCgiQUkgbm90IGF1dGhvcml6ZWQgZm9yIHRoaXMgYWNjb3VudCIpOwogICAgCiAgICByZXR1cm47Cn0gCgpjb25zb2xlLmxvZygiQVNLIiwgdGhhdCk7CgpsZXQgaW5xdWlyeSA9IHRoYXQuaW5xdWlyeSA/PyB0aGF0OwoKY29uc3QgcHJvbXB0ID0gIXRoYXQucHJvbXB0ID8gdGFncy5wcm9tcHRfY29yZSA6IHRhZ3NbInByb21wdF8iICsgdGhhdC5wcm9tcHRdOwoKYWIubG9nKGFiUmVtZW1iZXIudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IHRoaW5raW5nIGFib3V0ICIgKyBpbnF1aXJ5KTsKCmxpbmtzLm1hbmlmZXN0YXRpb24uYWJCb3RDaGF0KHttZXNzYWdlOiAidGhpbmtpbmcgYWJvdXQgIiArIGlucXVpcnl9KTsKCmlmICh0aGF0LnByb21wdCA9PSAiZ3JpZCIpCnsKICAgIGlucXVpcnkgPSBpbnF1aXJ5ICsgYC4gQm90IG11c3QgaW5jbHVkZSB7JHt0aGF0LmRhdGEuZGltZW5zaW9ufTogdHJ1ZSwgJHt0aGF0LmRhdGEuZGltZW5zaW9ufVg6ICR7dGhhdC5kYXRhLmRpbWVuc2lvblh9LCAke3RoYXQuZGF0YS5kaW1lbnNpb259WToke3RoYXQuZGF0YS5kaW1lbnNpb25ZfX0uYAp9CmVsc2UgaWYgKHRoYXQucHJvbXB0ID09ICJib3QiKQp7CiAgICBpbnF1aXJ5ID0gaW5xdWlyeSArIGAuIEJvdCB0byBiZSBtb2RpZmllZCBoYXMgdGhlIGlkIG9mOiBgICsgdGhhdC5kYXRhLmJvdC5pZDsKfQplbHNlIGlmICh0aGF0LnByb21wdCA9PSAiY29yZSIpCnsKICAgIC8vQ0hFQ0sgSUYgSVQgSVMgQ09OVkVSU0FUSU9OQUwsIGFuZCBpZiBpdCBpcyBjaGFuZ2UgUHJvbXB0CiAgICBjb25zdCBjb252ZXJzYXRpb25Qcm9tcHQgPSB0YWdzLmNvbnZlcnNhdGlvblByb21wdCArIGlucXVpcnk7CiAgICBjb25zdCBidWlsZENoZWNrID0gYXdhaXQgYWkuY2hhdChjb252ZXJzYXRpb25Qcm9tcHQpOwoKICAgIGlmIChidWlsZENoZWNrICE9ICJ0cnVlIikKICAgIHsKICAgICAgICBjb25zdCBjaGF0dGluZ1Byb21wdCA9IGBZb3UgYXJlIGFuIEFJIGJ1aWxkZXIgYWdlbnQgY2FsbGVkICR7YWJSZW1lbWJlci50YWdzLmFiQnVpbGRlcklkZW50aXR5fSBtZWFudCB0byBoZWxwIHBlb3BsZSBidWlsZCBhbmQgbGVhcm4gaW5zaWRlIG9mIGNhc3VhbE9TIChhIHdlYiBiYXNlZCBqYXZhc2NyaXB0IGFuZCB0eXBlc2NyaXB0IGVudmlyb25tZW50KS4KICAgICAgICAKICAgICAgICBQbGVhc2UgYmUga2luZCBjb3VydGVvdXMgYW5kIGZyaWVuZGx5IHdoaWxlIHlvdSBhbnN3ZXIgdGhlIGZvbGxvd2luZyBpbnF1aXJ5IHRvIHRoZSBiZXN0IG9mIHlvdXIgYWJpbGl0eS4KICAgICAgICAKICAgICAgICBSVUxFUzoKICAgICAgICAxLiBBbHdheXMgYmUgd2FybSBhbmQgZnJpZW5kbHkuCiAgICAgICAgMi4gQmUgYXMgaGVscGZ1bCBhcyB5b3UgY2FuIHdpdGhvdXQgaW52ZW50aW5nIGlkZWFzLgogICAgICAgIDMuIEJlIGVuY291cmFnaW5nLgogICAgICAgIAogICAgICAgIElOUVVJUlk6IGAgKyBpbnF1aXJ5OwogICAgICAgIGNvbnN0IGNoYXR0aW5nID0gYXdhaXQgYWkuY2hhdChjaGF0dGluZ1Byb21wdCk7CgogICAgICAgIGFiLmxvZyhhYlJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiAiICsgY2hhdHRpbmcpOwoKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQm90Q2hhdCh7bWVzc2FnZTogY2hhdHRpbmcsIGR1cmF0aW9uOiA3fSk7CgogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwoKICAgICAgICByZXR1cm47CiAgICB9Cn0KCmNvbnN0IGFuc3dlciA9IGF3YWl0IHRoaXNCb3Quc3VibWl0UmVxdWVzdEdQVCh7aW5xdWlyeTogaW5xdWlyeSwgcHJvbXB0OiBwcm9tcHR9KTsKCmxldCBuZXdBbnN3ZXIgPSBhbnN3ZXI7CgppZiAoYW5zd2VyLmluZGV4T2YoImBgYCIpICE9IC0xKQp7CiAgICBuZXdBbnN3ZXIgPSBhbnN3ZXIuc3Vic3RyaW5nKGFuc3dlci5pbmRleE9mKCJgYGAiKSwgYW5zd2VyLmxhc3RJbmRleE9mKCJgYGAiKSk7CgogICAgbmV3QW5zd2VyID0gbmV3QW5zd2VyLnJlcGxhY2VBbGwoJ2phdmFzY3JpcHQnLCAiIik7CgogICAgbmV3QW5zd2VyID0gbmV3QW5zd2VyLnJlcGxhY2VBbGwoImBgYCIsICIiKTsKfQoKYWIubG9nKGFiUmVtZW1iZXIudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6ICIgKyBuZXdBbnN3ZXIpOwoKb3MucnVuKG5ld0Fuc3dlcik7CgpsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsKCnJldHVybjsoAIqy+7UB10oJZ3B0QWN0aXZlAXgnAIqy+7UB10oQc3VibWl0UmVxdWVzdEdQVAIEAIqy+7UB1FyTBkBsZXQgc3lzdGVtUHJvbXB0ID0gdGhhdC5wcm9tcHQgPyB0aGF0LnByb21wdCA6IHRhZ3MucHJvbXB0X2NvcmU7CgpzeXN0ZW1Qcm9tcHQgPSBzeXN0ZW1Qcm9tcHQgKyB0aGF0LmlucXVpcnk7CgppZiAoYXV0aEJvdC50YWdzLnByaXZhY3lGZWF0dXJlcy5hbGxvd0FJID09IGZhbHNlKQp7CiAgICBvcy50b2FzdCgiQUkgbm90IGF1dGhvcml6ZWQgb24gdGhpcyBhY2NvdW50Iik7CgogICAgcmV0dXJuOwp9CgpsZXQgY3VycmVudEV4cGVyaWVuY2VCb3RzID0gZ2V0Qm90cyhieU1vZCh7c3BhY2U6ICJzaGFyZWQiLCBhYklnbm9yZTogbnVsbH0pKTsKCmlmIChjdXJyZW50RXhwZXJpZW5jZUJvdHMubGVuZ3RoID4gMCkKewogICAgc3lzdGVtUHJvbXB0ID0gc3lzdGVtUHJvbXB0ICsgIiBUaGVzZSBhcmUgdGhlIGJvdHMgdGhhdCBjdXJyZW50bHkgZXhpc3QgaW4gdGhlIGV4cGVyaWVuY2U6ICIgKyBjdXJyZW50RXhwZXJpZW5jZUJvdHM7Cn0KCmxldCBuZXdTdGF0dXNCYXIgPSBhd2FpdCBsaW5rcy5pbnB1dC5hYlByb2dyZXNzQmFyKGBhc2tpbmcgJHtsaW5rcy5yZW1lbWJlci50YWdzLmFiQnVpbGRlcklkZW50aXR5fWApOwoKY29uc3QgYWlSZXNwID0gYXdhaXQgYWkuY2hhdChzeXN0ZW1Qcm9tcHQsIHsKICAgIG1vZGVsOiB0aGF0Lm1vZGVsID8/ICJncHQtNG8iLAogICAgdGVtcGVyYXR1cmU6IDAsCiAgICB0b3BQOiAxLAogICAgcHJlc2VuY2VQZW5hbHR5OiAwLjYsCiAgICBmcmVxdWVuY3lQZW5hbHR5OiAwCn0pOwoKZGVzdHJveShuZXdTdGF0dXNCYXIpOwoKcmV0dXJuIGFpUmVzcDsnAIqy+7UB10oGcHJvbXB0AgQAirL7tQHoYqAiVGhlIGZvbGxvd2luZyBpcyBhIGNvbnZlcnNhdGlvbiB3aXRoIGFiLiBhYiBpcyBhIGhlbHBmdWwsIGNsZXZlciwgYW5kIGNhcGFibGUgQUkuIGFiIHdpbGwgcmVzcG9uZCB3aXRoIHRoZSBjb3JyZWN0IGphdmFzY3JpcHQgaW1wbGVtZW50YXRpb24gKGNvZGUpIG9mIHRoZSByZXF1ZXN0ZWQgYWN0aW9uLgoKSGVyZSBpcyBhIGJyaWVmIGxpc3Qgb2YgdGhpbmdzIGFiIGNhbiBkbzoKLSBDcmVhdGUgYm90cwoKQm90cyBhcmUgYSBjb2xsZWN0aW9uIG9mIHRhZ3MsIGFuZCB0aGV5IGNhbiBiZSBjcmVhdGVkIHVzaW5nIHRoZSBjcmVhdGUoKSBmdW5jdGlvbi4KVGhlIGNyZWF0ZSgpIGZ1bmN0aW9uIGlzIHVzZWQgdG8gY3JlYXRlIG9uZSBvciBtdWx0aXBsZSBib3RzIG9iamVjdHMuCmNyZWF0ZSgpIHJldHVybnMgYSBib3Qgb2JqZWN0OyBpdCBkb2VzIG5vdCBuZWVkIHRvIGJlIHN0b3JlZCBpbiBhIHZhcmlhYmxlIG9yIGNvbnN0LiAKCkhlcmUgaXMgYW4gZXhhbXBsZSBvZiB1c2luZyB0aGUgY3JlYXRlKCkgZnVuY3Rpb24gdG8gbWFrZSBhIHJlZCBib3QgaW4gdGhlIGhvbWUgZGltZW5zaW9uOgpgYGAKY3JlYXRlKHsKICAgIGhvbWU6IHRydWUsCiAgICBjb2xvcjogInJlZCIsCiAgICBmb3JtOiAiY3ViZSIKfSk7CmBgYAoKQXMgeW91IGNhbiBzZWUsIHRoZSBleGFtcGxlIGFib3ZlIGNyZWF0ZXMgYSBib3Qgd2l0aCB0aGUgYGhvbWVgIHRhZyBzZXQgdG8gYHRydWVgIGFuZCB0aGUgYGNvbG9yYCB0YWcgc2V0IHRvIGByZWRgLgpVbmxlc3Mgc3BlY2lmaWVkIG90aGVyd2lzZSwgYWIgc2hvdWxkIGNyZWF0ZSBib3RzIHdpdGggdGhlIGBob21lYCB0YWcgc2V0IHRvIGB0cnVlYC4KCkRpbWVuc2lvbnMgYXJlIHRhZ3Mgd2hpY2ggZW5kIHVwIGJlaW5nIHZpc3VhbGl6ZWQgaW4gM0Qgc3BhY2UuIEluIGFkZGl0aW9uIHRvIGJlaW5nIGEgdGFnLCBgaG9tZWAgaXMgYWxzbyBhIGRpbWVuc2lvbi4KWW91IGNhbiBjb250cm9sIHRoZSBwb3NpdGlvbiB0aGF0IGEgYm90IGlzIHJlbmRlcmVkIGF0IGJ5IHVzaW5nIHRoZSBge2RpbWVuc2lvbn1Qb3NpdGlvbmAgdGFnLCB3aGVyZSBge2RpbWVuc2lvbn1gIGlzIHJlcGxhY2VkIHdpdGggdGhlIG5hbWUgb2YgdGhlIGRpbWVuc2lvbi4KSGVyZSBpcyBhbiBleGFtcGxlIG9mIHVzaW5nIHRoZSBjcmVhdGUoKSBmdW5jdGlvbiB0byBtYWtlIGEgYm90IGF0IHBvc2l0aW9uICgzLCAyKSBpbiB0aGUgaG9tZSBkaW1lbnNpb246CmBgYApjcmVhdGUoewogICAgaG9tZTogdHJ1ZSwKICAgIGhvbWVQb3NpdGlvbjogJ+Keoe+4jzMsMScKfSk7CmBgYAoKTGlzdGVuZXJzIGFyZSB0YWdzIHdoaWNoIGNvbnRhaW4gSmF2YVNjcmlwdCBhbmQgcmVzcG9uZCB0byBjZXJ0YWluIGV2ZW50cy4gVGhleSB3b3JrIGxpa2Ugbm9ybWFsIHRhZ3MsIGV4Y2VwdCB0aGV5IG5lZWQgdG8gaGF2ZSBhIGBAYCBzeW1ib2wgYXQgdGhlIHN0YXJ0IG9mIHRoZSB0YWcgdmFsdWUuCkhlcmUgaXMgYW4gZXhhbXBsZSBvZiB1c2luZyB0aGUgY3JlYXRlKCkgZnVuY3Rpb24gdG8gbWFrZSBhIGJvdCB3aXRoIGEgYG9uQ2xpY2tgIGxpc3RlbmVyOgpgYGAKY3JlYXRlKHsKICAgIGhvbWU6IHRydWUsCiAgICBvbkNsaWNrOiBgQG9zLnRvYXN0KCJIZWxsbywgd29ybGQhIik7YAp9KTsKYGBgCgpGb3IgZXhhbXBsZSBpZiBhc2tlZCBmb3IgYSBwcm9jZWR1cmFsIGZvcmVzdCB0aGUgY29kZSByZXR1cm5lZCB3b3VsZCBiZSBzb21ldGhpbmcgbGlrZSB0aGlzOgoKYGBgCmNyZWF0ZSh7CiAgICBob21lOiB0cnVlLAogICAgb25DbGljazogYEB7CiAgICAgICAgY29uc3QgZWxlbWVudHMgPSBbJ3RyZWUnLCAnYnVzaCcsICdmbG93ZXInLCAncm9jaycsICdyYWJiaXQnLCAnZm94JywgJ3dhdGVyJ107CiAgICAgICAgY29uc3QgY29sb3JzID0gWydncmVlbicsICdkYXJrZ3JlZW4nLCAnZ29sZCcsICdncmF5JywgJ2Jyb3duJywgJ29yYW5nZScsICdibHVlJ107CiAgICAgICAgY29uc3QgaW50ZXJhY3Rpb25Tb3VuZHMgPSBbJ3dpbmQgaW4gdGhlIGJyYW5jaGVzJywgJ3J1c3RsaW5nIGxlYXZlcycsICdjcmlja2V0IGNoaXJwaW5nJywgJ3JhaW4gcGF0dGVyaW5nJywgJ3RodW1waW5nJywgJ3lpcHBpbmcnLCAnc3BsYXNoaW5nJ107CiAgICAgICAgY29uc3Qgc2NhbGVzWCA9IFswLjksIDEuMiwgMC4xLCAxLCAwLjI1LCAwLjMsIDFdOwogICAgICAgIGNvbnN0IHNjYWxlc1kgPSBbMC45LCAxLjIsIDAuMSwgMSwgMC40LCAwLjcsIDFdOwogICAgICAgIGNvbnN0IHNjYWxlc1ogPSBbMywgMC43NSwgMC4yLCAwLjUsIDAuNSwgMC42LCAwLjAxXTsKICAgICAgICAKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDsgaSsrKSAKICAgICAgICB7CiAgICAgICAgICAgIGxldCByYW5kb21JbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGVsZW1lbnRzLmxlbmd0aCk7CiAgICAgICAgICAgIGxldCBwb3NpdGlvblg7CiAgICAgICAgICAgIGxldCBwb3NpdGlvblk7CiAgICAgICAgCiAgICAgICAgICAgaWYgKGVsZW1lbnRzW3JhbmRvbUluZGV4XSA9PSAnd2F0ZXInKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoZ2V0Qm90KCdsYWJlbCcsICd3YXRlcicpKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGxldCBwb3NzaWJsZVdhdGVyQ29ubmVjdGlvbnMgPSBnZXRCb3RzKCdsYWJlbCcsICd3YXRlcicpOwogICAgICAgICAgICAgICAgICAgIGxldCBhY3RpdmVXYXRlckJvdCA9IHBvc3NpYmxlV2F0ZXJDb25uZWN0aW9uc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBwb3NzaWJsZVdhdGVyQ29ubmVjdGlvbnMubGVuZ3RoKV07CiAgICAgICAgICAgICAgICAgICAgbGV0IGNvaW5GbGlwID0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgwLDEpKTsKICAgICAgICAgICAgICAgICAgICBsZXQgcmFuZG9tRGlyZWN0aW9uID0gTWF0aC5yYW5kb20oKSA8IDAuNSA/IC0xIDogMTsKICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAoY29pbkZsaXApCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblggPSBhY3RpdmVXYXRlckJvdC50YWdzLmhvbWVYOwogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblkgPSBhY3RpdmVXYXRlckJvdC50YWdzLmhvbWVZICsgcmFuZG9tRGlyZWN0aW9uOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblggPSBhY3RpdmVXYXRlckJvdC50YWdzLmhvbWVYICsgcmFuZG9tRGlyZWN0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblkgPSBhY3RpdmVXYXRlckJvdC50YWdzLmhvbWVZOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDApOwogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uWSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBwb3NpdGlvblggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDApOwogICAgICAgICAgICAgICAgcG9zaXRpb25ZID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwKTsKICAgICAgICAgICAgfQogICAgICAgIAogICAgICAgICAgICBjcmVhdGUoewogICAgICAgICAgICAgICAgaG9tZTogdHJ1ZSwKICAgICAgICAgICAgICAgIGhvbWVQb3NpdGlvbjogJ+Keoe+4jycgKyBwb3NpdGlvblggKyAnLCcgKyBwb3NpdGlvblksCiAgICAgICAgICAgICAgICB0aXBMYWJlbDogZWxlbWVudHNbcmFuZG9tSW5kZXhdLAogICAgICAgICAgICAgICAgb25Qb2ludGVyRW50ZXI6ICJAIG9zLnRpcCh0YWdzLnRpcExhYmVsKSI7CiAgICAgICAgICAgICAgICBjb2xvcjogY29sb3JzW3JhbmRvbUluZGV4XSwKICAgICAgICAgICAgICAgIHNjYWxlWDogc2NhbGVzWFtyYW5kb21JbmRleF0sCiAgICAgICAgICAgICAgICBzY2FsZVk6IHNjYWxlc1lbcmFuZG9tSW5kZXhdLAogICAgICAgICAgICAgICAgc2NhbGVaOiBzY2FsZXNaW3JhbmRvbUluZGV4XSwKICAgICAgICAgICAgICAgIG9uQ2xpY2s6ICJAIG9zLnRpcCgnWW91IGhlYXIgIiArIGludGVyYWN0aW9uU291bmRzW3JhbmRvbUluZGV4XSArICInKTsiCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH1gCn0pOwpgYGAKClBsZWFzZSByZXR1cm4gb25seSB0aGUgZnVuY3Rpb24gd2l0aCB0aGUgY29kZSBhcyBhIHJlc3BvbnNlLicAirL7tQHXSghyZW1lbWJlcgIEAIqy+7UBgYUBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAIqy+7UB10oQYWJDb3JlTWVudUFjdGlvbgIEAIqy+7UBqIUB/QpAY29uc3QgaW5xdWlyeSA9IHRoYXQubWVzc2FnZSA/PyB0aGF0Owpjb25zdCBiYXNlSW5xdWlyeSA9IGlucXVpcnk7CmNvbnN0IG1lbnUgPSB0aGF0Lm1lbnUgPz8gImNvcmUiOwpjb25zdCBzcGFjZUNoZWNrID0gaW5xdWlyeS5pbmRleE9mKCIgIik7CmNvbnN0IG1lbnVCb3RzID0gZ2V0Qm90cyhjb25maWdCb3QudGFncy5tZW51UG9ydGFsLCB0cnVlKTsKCndoaXNwZXIobWVudUJvdHMsICJhYk1lbnVSZWZyZXNoIik7CgphYi5sb2coInVzZXI6ICIgKyBpbnF1aXJ5KTsKCmlmICghY29uZmlnQm90LnRhZ3MudGFnUG9ydGFsICYmIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBd2FrZVN0YXRlICYmIHRoYXQubWVzc2FnZSAhPSAiLmxvZyIpCnsKICAgIGxpbmtzLmlucHV0Lm9uQ2hhdCh7bWVzc2FnZTogIi5sb2cifSk7Cn0KCmlmIChpbnF1aXJ5WzBdID09ICIuIikKewogICAgbGlua3MuaW5wdXQub25DaGF0KHttZXNzYWdlOiBpbnF1aXJ5fSk7Cn0KZWxzZSBpZiAoc3BhY2VDaGVjayA9PSAtMSkKewogICAgbGV0IGFza0pvaW5JRCA9IGlucXVpcnkucmVwbGFjZUFsbCgiLSIsICIiKTsKICAgIGxldCBhc2sgPSBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBc2tJRCh7YXNrSUQ6IGFza0pvaW5JRH0pOwoKICAgIGlmIChhc2suc3VjY2VzcyAmJiBhc2suZGF0YS51cmwpCiAgICB7CiAgICAgICAgbGlua3MubGVhcm4uYWJKb2luSG9zdCh7ZGF0YTogYXNrLmRhdGF9KTsKICAgIH0KICAgIGVsc2UgaWYgKCFhc2suc3VjY2VzcykKICAgIHsKICAgICAgICBhc2sgPSBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3Moe2FiSUQ6IGJhc2VJbnF1aXJ5LCBpbml0aWFsQm9vdDogdGhhdC5pbml0aWFsQm9vdCwgYXV0b0hhdGNoOiB0aGF0LmF1dG9IYXRjaH0pOwogICAgfQp9CmVsc2UKewogICAgYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsKCiAgICBpZiAoIWF1dGhCb3QpCiAgICB7CiAgICAgICAgb3MudG9hc3QoInBsZWFzZSBzaWduIGluIHRvIGFjY2VzcyBhZHZhbmNlZCBBSSBmZWF0dXJlcyIpOwoKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsKICAgIH0KICAgIGVsc2UgaWYgKGF1dGhCb3QudGFncy5zdWJzY3JpcHRpb25UaWVyID09ICJGcmVlUGxheSIpCiAgICB7CiAgICAgICAgb3MudG9hc3QoInBsZWFzZSBjaGVjayB5b3VyIHN1YnNjcmlwdGlvbiBpbiBvcmRlciB0byBhY2Nlc3MgYWR2YW5jZWQgQUkgZmVhdHVyZXMiKTsKCiAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbWFza3MuZ3B0QWN0aXZlID0gdHJ1ZTsKCiAgICAgICAgYXdhaXQgdGhpc0JvdC5hc2tHUFQoe2lucXVpcnk6IGlucXVpcnksIHByb21wdDogbWVudSwgZGF0YTogdGhhdH0pOwogICAgfQp9JwCKsvu1AddKFGFiQ29yZU1lbnVPbkdlbmVyYXRlAgQAirL7tQGmkAGoA0B0YWdzLm9uU3VibWl0ID0gYEAgbGlua3MuYmFzZVNraWxsLmFiQ29yZU1lbnVBY3Rpb24oe21lc3NhZ2U6IHRoYXQudGV4dCwgbWVudTogImNvcmUifSk7YDsKdGFncy5mb3JtID0gImlucHV0IjsKCmlmICghYXV0aEJvdCkKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIChsaW1pdGVkKSI7Cn0KZWxzZSBpZiAoYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gIkZyZWVQbGF5IikKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIChsaW1pdGVkKSI7Cn0KZWxzZQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucmVtZW1iZXIudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsKfQonAIqy+7UB10oTYWJDb3JlTWVudVNvcnRPcmRlcgIEAIqy+7UBz5MBAzEwMicAirL7tQHXShBhYkdyaWRNZW51QWN0aW9uAgQAirL7tQHTkwEOQC8vcGxhY2Vob2xkZXInAIqy+7UB10oUYWJHcmlkTWVudU9uR2VuZXJhdGUCBACKsvu1AeKTAbMFQHRhZ3MuZGltZW5zaW9uID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1cy5kaW1lbnNpb247CnRhZ3MuZGltZW5zaW9uWCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXMucG9zaXRpb24ueDsKdGFncy5kaW1lbnNpb25ZID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1cy5wb3NpdGlvbi55Owp0YWdzLm9uU3VibWl0ID0gYEBsaW5rcy5iYXNlU2tpbGwuYWJDb3JlTWVudUFjdGlvbih7bWVzc2FnZTogdGhhdC50ZXh0LCBtZW51OiAiZ3JpZCIsIGRpbWVuc2lvbjogdGFncy5kaW1lbnNpb24sIGRpbWVuc2lvblg6IHRhZ3MuZGltZW5zaW9uWCwgZGltZW5zaW9uWTogdGFncy5kaW1lbnNpb25ZfSk7YDsKdGFncy5mb3JtID0gImlucHV0IjsKCmlmICghYXV0aEJvdCkKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIChsaW1pdGVkKSI7Cn0KZWxzZSBpZiAoYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gIkZyZWVQbGF5IikKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIChsaW1pdGVkKSI7Cn0KZWxzZQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucmVtZW1iZXIudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsKfScAirL7tQHXSg1tYW5pZmVzdGF0aW9uAgQAirL7tQGWmQEo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcAirL7tQHXShNhYkdyaWRNZW51U29ydE9yZGVyAgQAirL7tQG9mQEDMTAyJwCKsvu1AddKD2FiR3JpZE1lbnVMYWJlbAIEAIqy+7UBwZkBBmFzayBhYicAirL7tQHXSg9hYkNvcmVNZW51TGFiZWwCBACKsvu1AciZAQZhc2sgYWInAIqy+7UB10oOYWJDb3JlTWVudUljb24CBACKsvu1Ac+ZAQRjdWJlJwCKsvu1AddKDmFiR3JpZE1lbnVJY29uAgQAirL7tQHUmQEEY3ViZScAirL7tQHXSgplZGl0UHJvbXB0AgQAirL7tQHZmQGHCEBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmxldCBwcm9tcHRNZW51QnV0dG9uID0ge307Cgpwcm9tcHRNZW51QnV0dG9uLmFiTWVudSA9IHRydWU7CnByb21wdE1lbnVCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKcHJvbXB0TWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwpwcm9tcHRNZW51QnV0dG9uLnJlbWVtYmVyID0gdGFncy5yZW1lbWJlcjsKcHJvbXB0TWVudUJ1dHRvbi5ncHRCb3QgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwpwcm9tcHRNZW51QnV0dG9uLmxhYmVsID0gImxvYWQgcHJvbXB0IjsKcHJvbXB0TWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjbG91ZF9kb3dubG9hZCI7CnByb21wdE1lbnVCdXR0b24ub25DbGljayA9ICJAIGxpbmtzLmdwdEJvdC51cGRhdGVQcm9tcHQoJ2xvYWQnKTsiOwoKbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24ocHJvbXB0TWVudUJ1dHRvbik7Cgpwcm9tcHRNZW51QnV0dG9uLmxhYmVsID0gInNhdmUgcHJvbXB0IjsKcHJvbXB0TWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJiYWNrdXAiOwpwcm9tcHRNZW51QnV0dG9uLm9uQ2xpY2sgPSAiQCBsaW5rcy5ncHRCb3QudXBkYXRlUHJvbXB0KCdzYXZlJyk7IjsKCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHByb21wdE1lbnVCdXR0b24pOwoKbWFza3Mub25HcmlkQ2xpY2sgPSBgQCBjb25maWdCb3QubWFza3MudGFnUG9ydGFsID0gbnVsbDsKCnRhZ1BvcnRhbEJvdC5tYXNrcy50YWdQb3J0YWxBbmNob3JQb2ludCA9IG51bGw7CmA7Cgp0YWdQb3J0YWxCb3QubWFza3MudGFnUG9ydGFsQW5jaG9yUG9pbnQgPSAidG9wIjsKCmNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWwgPSB0aGlzQm90LmlkICsgIi5wcm9tcHRfY29yZSI7CgppZiAoY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbFNwYWNlKQp7CiAgICBjb25maWdCb3QubWFza3MudGFnUG9ydGFsU3BhY2UgPSBudWxsOwp9JwCKsvu1AddKBG1lbnUCBACKsvu1Ad+hASjwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwCKsvu1AddKDHVwZGF0ZVByb21wdAIEAIqy+7UBhqIBywhAc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgpsZXQgcHJvbXB0TWVudUJ1dHRvbiA9IHt9OwoKcHJvbXB0TWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwpwcm9tcHRNZW51QnV0dG9uLmZvcm0gPSAiaW5wdXQiOwpwcm9tcHRNZW51QnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CnByb21wdE1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKcHJvbXB0TWVudUJ1dHRvbi5yZW1lbWJlciA9IHRhZ3MucmVtZW1iZXI7CnByb21wdE1lbnVCdXR0b24uZ3B0Qm90ID0gIvCflJciICsgdGhpc0JvdC5pZDsKCmlmICh0aGF0ID09ICJsb2FkIikKewogICAgcHJvbXB0TWVudUJ1dHRvbi5sYWJlbCA9ICJsb2FkIHByb21wdCI7CiAgICBwcm9tcHRNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImNsb3VkX2Rvd25sb2FkIjsKICAgIHByb21wdE1lbnVCdXR0b24ub25TdWJtaXQgPSAiQCBsaW5rcy5ncHRCb3QubG9hZFByb21wdCh0aGF0LnRleHQpOyI7Cn0KZWxzZQp7CiAgICBwcm9tcHRNZW51QnV0dG9uLmxhYmVsID0gInNhdmUgcHJvbXB0IjsKICAgIHByb21wdE1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiYmFja3VwIjsKICAgIHByb21wdE1lbnVCdXR0b24ub25TdWJtaXQgPSAiQCBsaW5rcy5ncHRCb3Quc2F2ZVByb21wdCh0aGF0LnRleHQpOyI7Cn0KCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHByb21wdE1lbnVCdXR0b24pOwoKcHJvbXB0TWVudUJ1dHRvbi5mb3JtID0gbnVsbDsKcHJvbXB0TWVudUJ1dHRvbi5sYWJlbCA9ICIgICI7CnByb21wdE1lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAiY2VudGVyIjsKcHJvbXB0TWVudUJ1dHRvbi5jb2xvciA9ICIjZjI0NzI3IjsKcHJvbXB0TWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjYW5jZWwiOwpwcm9tcHRNZW51QnV0dG9uLm9uU3VibWl0ID0gbnVsbDsKcHJvbXB0TWVudUJ1dHRvbi5vbkNsaWNrID0gIkAgbGlua3MuZ3B0Qm90LmVkaXRQcm9tcHQoKTsiOwoKbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24ocHJvbXB0TWVudUJ1dHRvbik7JwCKsvu1AddKCmxvYWRQcm9tcHQCBACKsvu1AdCqAdoDQGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7CgppZiAoYXV0aEJvdC50YWdzLnByaXZhY3lGZWF0dXJlcy5hbGxvd1B1YmxpY0RhdGEgPT0gZmFsc2UpCnsKICAgIG9zLnRvYXN0KCJub3QgYXV0aG9yaXplZCIpOwoKICAgIHJldHVybjsKfQoKY29uc3QgcHJvbXB0TmFtZSA9ICJncHRfcHJvbXB0XyIgKyB0aGF0Owpjb25zdCBuZXdQcm9tcHQgPSBhd2FpdCBvcy5nZXREYXRhKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSZWNvcmRLZXksIHByb21wdE5hbWUpOwoKaWYgKCFuZXdQcm9tcHQuc3VjY2VzcykKewogICAgb3MudG9hc3QoIm5vIHByb21wdCBmb3VuZCBieSB0aGF0IG5hbWUiKTsKfQplbHNlCnsKICAgIHRhZ3MucHJvbXB0X2NvcmUgPSBuZXdQcm9tcHQuZGF0YTsKfQoKaWYgKGNvbmZpZ0JvdC50YWdzLnByb21wdF9iYXNlID09IHRoYXQpCnsKICAgIHJldHVybjsKfQoKdGhpc0JvdC5lZGl0UHJvbXB0KCk7JwCKsvu1AddKCnNhdmVQcm9tcHQCBACKsvu1AauuAb4EQGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7CgppZiAoYXV0aEJvdC50YWdzLnByaXZhY3lGZWF0dXJlcy5hbGxvd1B1YmxpY0RhdGEgPT0gZmFsc2UgfHwgYXV0aEJvdC50YWdzLnByaXZhY3lGZWF0dXJlcy5wdWJsaXNoRGF0YSA9PSBmYWxzZSkKewogICAgb3MudG9hc3QoIm5vdCBhdXRob3JpemVkIik7CgogICAgcmV0dXJuOwp9Cgpjb25zdCBhdXRob3IgPSBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwpjb25zdCBwcm9tcHROYW1lID0gImdwdF9wcm9tcHRfIiArIHRoYXQ7CmNvbnN0IG5ld1Byb21wdCA9IGF3YWl0IG9zLnJlY29yZERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYlJlY29yZEtleSwgcHJvbXB0TmFtZSwgdGFncy5wcm9tcHRfY29yZSwge3VwZGF0ZVBvbGljeTogW2F1dGhvci5pZF19KTsKCmlmICghbmV3UHJvbXB0LnN1Y2Nlc3MpCnsKICAgIG9zLnRvYXN0KCJzb21ldGhpbmcgd2VudCB3cm9uZywgcGxlYXNlIHRyeSBhZ2FpbiIpOwp9CmVsc2UKewogICAgb3MudG9hc3QoInByb21wdCBzYXZlZCBhcyAiICsgdGhhdCk7Cn0KCnRoaXNCb3QuZWRpdFByb21wdCgpOycAirL7tQHXSghhYklnbm9yZQIEAIqy+7UB6rIBBHRydWUoAIqy+7UB10oMYWJCb3RWZXJzaW9uAX2cAScAirL7tQHXSghhYkFjdGlvbgIEAIqy+7UB8LIBBHRydWUnAIqy+7UB10oGc2VhcmNoAgQAirL7tQH1sgEo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScAirL7tQHXSgVsZWFybgIEAIqy+7UBnLMBKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAIqy+7UB10oKbWF4X3Rva2VucwIEAIqy+7UBw7MBBDUwMDAnAIqy+7UB10oPb25BQkluaXRpYWxpemVkAgQAirL7tQHIswFYQGlmIChjb25maWdCb3QudGFncy5wcm9tcHRfYmFzZSkKewogICAgdGhpc0JvdC5sb2FkUHJvbXB0KGNvbmZpZ0JvdC50YWdzLnByb21wdF9iYXNlKTsKfScAirL7tQHXSgVhc2tBQgIEAIqy+7UBobQBzQNALy9zaG91dCgiYXNrQUIiLCB7cHJvbXB0OiBwcm9tcHQsIHNob3V0OiBzaG91dCwgY29udGV4dDogY29udGV4dH0pOwoKaWYgKCF0YWdzLmdwdEFjdGl2ZSkgcmV0dXJuOwoKbGV0IGlucXVpcnkgPSB0aGF0LnByb21wdDsKCi8vYWIubG9nKCJ1c2VyOiAiICsgaW5xdWlyeSk7IC8vbm90IG5lZWRlZAoKY29uc3QgYW5zd2VyID0gYXdhaXQgdGhpc0JvdC5zdWJtaXRSZXF1ZXN0R1BUKHtpbnF1aXJ5OiBpbnF1aXJ5LCBjb250ZXh0OiB0aGF0LmNvbnRleHQsIGRlZmluZWRQcm9tcHQ6IHRydWV9KTsKCmFiLmxvZyhhYlJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiAiICsgYW5zd2VyKTsKCmxpbmtzLm1hbmlmZXN0YXRpb24uYWJCb3RDaGF0KHttZXNzYWdlOiBhbnN3ZXJ9KTsKCmlmICh0aGF0LnNob3V0KQp7CiAgICBzaG91dCh0aGF0LnNob3V0LCBhbnN3ZXIpOwp9CgpyZXR1cm4gYW5zd2VyOycAirL7tQHXSgVpbnB1dAIEAIqy+7UB77cBKPCflJdmODYwMjg3OC1jMmVmLTQ4YmQtODVhMC04ZDYzNTFlYjQxMjAnAIqy+7UB10oLcHJvbXB0X2NvcmUCBACKsvu1AZa4AZsiVGhlIGZvbGxvd2luZyBpcyBhIGNvbnZlcnNhdGlvbiB3aXRoIGFiLiBhYiBpcyBoZWxwZnVsLCBjbGV2ZXIsIGFuZCBjYXBhYmxlLiBhYiB3aWxsIHJlc3BvbmQgd2l0aCB0aGUgY29ycmVjdCBqYXZhc2NyaXB0IGltcGxlbWVudGF0aW9uIChjb2RlKSBvZiB0aGUgcmVxdWVzdGVkIGFjdGlvbi4KCkhlcmUgaXMgYSBicmllZiBsaXN0IG9mIHRoaW5ncyBhYiBjYW4gZG86Ci0gQ3JlYXRlIGJvdHMKCkJvdHMgYXJlIGEgY29sbGVjdGlvbiBvZiB0YWdzLCBhbmQgdGhleSBjYW4gYmUgY3JlYXRlZCB1c2luZyB0aGUgY3JlYXRlKCkgZnVuY3Rpb24uClRoZSBjcmVhdGUoKSBmdW5jdGlvbiBpcyB1c2VkIHRvIGNyZWF0ZSBvbmUgb3IgbXVsdGlwbGUgYm90cyBvYmplY3RzLgpjcmVhdGUoKSByZXR1cm5zIGEgYm90IG9iamVjdDsgaXQgZG9lcyBub3QgbmVlZCB0byBiZSBzdG9yZWQgaW4gYSB2YXJpYWJsZSBvciBjb25zdC4gCgpIZXJlIGlzIGFuIGV4YW1wbGUgb2YgdXNpbmcgdGhlIGNyZWF0ZSgpIGZ1bmN0aW9uIHRvIG1ha2UgYSByZWQgYm90IGluIHRoZSBob21lIGRpbWVuc2lvbjoKYGBgCmNyZWF0ZSh7CiAgICBob21lOiB0cnVlLAogICAgY29sb3I6ICJyZWQiLAogICAgZm9ybTogImN1YmUiCn0pOwpgYGAKCkFzIHlvdSBjYW4gc2VlLCB0aGUgZXhhbXBsZSBhYm92ZSBjcmVhdGVzIGEgYm90IHdpdGggdGhlIGBob21lYCB0YWcgc2V0IHRvIGB0cnVlYCBhbmQgdGhlIGBjb2xvcmAgdGFnIHNldCB0byBgcmVkYC4KVW5sZXNzIHNwZWNpZmllZCBvdGhlcndpc2UsIGFiIHNob3VsZCBjcmVhdGUgYm90cyB3aXRoIHRoZSBgaG9tZWAgdGFnIHNldCB0byBgdHJ1ZWAuCgpEaW1lbnNpb25zIGFyZSB0YWdzIHdoaWNoIGVuZCB1cCBiZWluZyB2aXN1YWxpemVkIGluIDNEIHNwYWNlLiBJbiBhZGRpdGlvbiB0byBiZWluZyBhIHRhZywgYGhvbWVgIGlzIGFsc28gYSBkaW1lbnNpb24uCllvdSBjYW4gY29udHJvbCB0aGUgcG9zaXRpb24gdGhhdCBhIGJvdCBpcyByZW5kZXJlZCBhdCBieSB1c2luZyB0aGUgYHtkaW1lbnNpb259UG9zaXRpb25gIHRhZywgd2hlcmUgYHtkaW1lbnNpb259YCBpcyByZXBsYWNlZCB3aXRoIHRoZSBuYW1lIG9mIHRoZSBkaW1lbnNpb24uCkhlcmUgaXMgYW4gZXhhbXBsZSBvZiB1c2luZyB0aGUgY3JlYXRlKCkgZnVuY3Rpb24gdG8gbWFrZSBhIGJvdCBhdCBwb3NpdGlvbiAoMywgMikgaW4gdGhlIGhvbWUgZGltZW5zaW9uOgpgYGAKY3JlYXRlKHsKICAgIGhvbWU6IHRydWUsCiAgICBob21lUG9zaXRpb246ICfinqHvuI8zLDEnCn0pOwpgYGAKCkxpc3RlbmVycyBhcmUgdGFncyB3aGljaCBjb250YWluIEphdmFTY3JpcHQgYW5kIHJlc3BvbmQgdG8gY2VydGFpbiBldmVudHMuIFRoZXkgd29yayBsaWtlIG5vcm1hbCB0YWdzLCBleGNlcHQgdGhleSBuZWVkIHRvIGhhdmUgYSBgQGAgc3ltYm9sIGF0IHRoZSBzdGFydCBvZiB0aGUgdGFnIHZhbHVlLgpIZXJlIGlzIGFuIGV4YW1wbGUgb2YgdXNpbmcgdGhlIGNyZWF0ZSgpIGZ1bmN0aW9uIHRvIG1ha2UgYSBib3Qgd2l0aCBhIGBvbkNsaWNrYCBsaXN0ZW5lcjoKYGBgCmNyZWF0ZSh7CiAgICBob21lOiB0cnVlLAogICAgb25DbGljazogYEBvcy50b2FzdCgiSGVsbG8sIHdvcmxkISIpO2AKfSk7CmBgYAoKRm9yIGV4YW1wbGUgaWYgYXNrZWQgZm9yIGEgcHJvY2VkdXJhbCBmb3Jlc3QgdGhlIGNvZGUgcmV0dXJuZWQgd291bGQgYmUgc29tZXRoaW5nIGxpa2UgdGhpczoKCmBgYApjcmVhdGUoewogICAgaG9tZTogdHJ1ZSwKICAgIG9uQ2xpY2s6IGBAewogICAgICAgIGNvbnN0IGVsZW1lbnRzID0gWyd0cmVlJywgJ2J1c2gnLCAnZmxvd2VyJywgJ3JvY2snLCAncmFiYml0JywgJ2ZveCcsICd3YXRlciddOwogICAgICAgIGNvbnN0IGNvbG9ycyA9IFsnZ3JlZW4nLCAnZGFya2dyZWVuJywgJ2dvbGQnLCAnZ3JheScsICdicm93bicsICdvcmFuZ2UnLCAnYmx1ZSddOwogICAgICAgIGNvbnN0IGludGVyYWN0aW9uU291bmRzID0gWyd3aW5kIGluIHRoZSBicmFuY2hlcycsICdydXN0bGluZyBsZWF2ZXMnLCAnY3JpY2tldCBjaGlycGluZycsICdyYWluIHBhdHRlcmluZycsICd0aHVtcGluZycsICd5aXBwaW5nJywgJ3NwbGFzaGluZyddOwogICAgICAgIGNvbnN0IHNjYWxlc1ggPSBbMC45LCAxLjIsIDAuMSwgMSwgMC4yNSwgMC4zLCAxXTsKICAgICAgICBjb25zdCBzY2FsZXNZID0gWzAuOSwgMS4yLCAwLjEsIDEsIDAuNCwgMC43LCAxXTsKICAgICAgICBjb25zdCBzY2FsZXNaID0gWzMsIDAuNzUsIDAuMiwgMC41LCAwLjUsIDAuNiwgMC4wMV07CiAgICAgICAgCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDA7IGkrKykgCiAgICAgICAgewogICAgICAgICAgICBsZXQgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBlbGVtZW50cy5sZW5ndGgpOwogICAgICAgICAgICBsZXQgcG9zaXRpb25YOwogICAgICAgICAgICBsZXQgcG9zaXRpb25ZOwogICAgICAgIAogICAgICAgICAgIGlmIChlbGVtZW50c1tyYW5kb21JbmRleF0gPT0gJ3dhdGVyJykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKGdldEJvdCgnbGFiZWwnLCAnd2F0ZXInKSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsZXQgcG9zc2libGVXYXRlckNvbm5lY3Rpb25zID0gZ2V0Qm90cygnbGFiZWwnLCAnd2F0ZXInKTsKICAgICAgICAgICAgICAgICAgICBsZXQgYWN0aXZlV2F0ZXJCb3QgPSBwb3NzaWJsZVdhdGVyQ29ubmVjdGlvbnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogcG9zc2libGVXYXRlckNvbm5lY3Rpb25zLmxlbmd0aCldOwogICAgICAgICAgICAgICAgICAgIGxldCBjb2luRmxpcCA9IE1hdGgucm91bmQoTWF0aC5yYW5kb20oMCwxKSk7CiAgICAgICAgICAgICAgICAgICAgbGV0IHJhbmRvbURpcmVjdGlvbiA9IE1hdGgucmFuZG9tKCkgPCAwLjUgPyAtMSA6IDE7CiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKGNvaW5GbGlwKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25YID0gYWN0aXZlV2F0ZXJCb3QudGFncy5ob21lWDsKICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25ZID0gYWN0aXZlV2F0ZXJCb3QudGFncy5ob21lWSArIHJhbmRvbURpcmVjdGlvbjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25YID0gYWN0aXZlV2F0ZXJCb3QudGFncy5ob21lWCArIHJhbmRvbURpcmVjdGlvbjsKICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25ZID0gYWN0aXZlV2F0ZXJCb3QudGFncy5ob21lWTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25YID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwKTsKICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcG9zaXRpb25YID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwKTsKICAgICAgICAgICAgICAgIHBvc2l0aW9uWSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMCk7CiAgICAgICAgICAgIH0KICAgICAgICAKICAgICAgICAgICAgY3JlYXRlKHsKICAgICAgICAgICAgICAgIGhvbWU6IHRydWUsCiAgICAgICAgICAgICAgICBob21lUG9zaXRpb246ICfinqHvuI8nICsgcG9zaXRpb25YICsgJywnICsgcG9zaXRpb25ZLAogICAgICAgICAgICAgICAgdGlwTGFiZWw6IGVsZW1lbnRzW3JhbmRvbUluZGV4XSwKICAgICAgICAgICAgICAgIG9uUG9pbnRlckVudGVyOiAiQCBvcy50aXAodGFncy50aXBMYWJlbCkiOwogICAgICAgICAgICAgICAgY29sb3I6IGNvbG9yc1tyYW5kb21JbmRleF0sCiAgICAgICAgICAgICAgICBzY2FsZVg6IHNjYWxlc1hbcmFuZG9tSW5kZXhdLAogICAgICAgICAgICAgICAgc2NhbGVZOiBzY2FsZXNZW3JhbmRvbUluZGV4XSwKICAgICAgICAgICAgICAgIHNjYWxlWjogc2NhbGVzWltyYW5kb21JbmRleF0sCiAgICAgICAgICAgICAgICBvbkNsaWNrOiAiQCBvcy50aXAoJ1lvdSBoZWFyICIgKyBpbnRlcmFjdGlvblNvdW5kc1tyYW5kb21JbmRleF0gKyAiJyk7IgogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9YAp9KTsKYGBgCgpQbGVhc2UgcmV0dXJuIG9ubHkgdGhlIGZ1bmN0aW9uIHdpdGggdGhlIGNvZGUgYXMgYSByZXNwb25zZS4nAIqy+7UB10oLcHJvbXB0X2dyaWQCBACKsvu1AaraAZsiVGhlIGZvbGxvd2luZyBpcyBhIGNvbnZlcnNhdGlvbiB3aXRoIGFiLiBhYiBpcyBoZWxwZnVsLCBjbGV2ZXIsIGFuZCBjYXBhYmxlLiBhYiB3aWxsIHJlc3BvbmQgd2l0aCB0aGUgY29ycmVjdCBqYXZhc2NyaXB0IGltcGxlbWVudGF0aW9uIChjb2RlKSBvZiB0aGUgcmVxdWVzdGVkIGFjdGlvbi4KCkhlcmUgaXMgYSBicmllZiBsaXN0IG9mIHRoaW5ncyBhYiBjYW4gZG86Ci0gQ3JlYXRlIGJvdHMKCkJvdHMgYXJlIGEgY29sbGVjdGlvbiBvZiB0YWdzLCBhbmQgdGhleSBjYW4gYmUgY3JlYXRlZCB1c2luZyB0aGUgY3JlYXRlKCkgZnVuY3Rpb24uClRoZSBjcmVhdGUoKSBmdW5jdGlvbiBpcyB1c2VkIHRvIGNyZWF0ZSBvbmUgb3IgbXVsdGlwbGUgYm90cyBvYmplY3RzLgpjcmVhdGUoKSByZXR1cm5zIGEgYm90IG9iamVjdDsgaXQgZG9lcyBub3QgbmVlZCB0byBiZSBzdG9yZWQgaW4gYSB2YXJpYWJsZSBvciBjb25zdC4gCgpIZXJlIGlzIGFuIGV4YW1wbGUgb2YgdXNpbmcgdGhlIGNyZWF0ZSgpIGZ1bmN0aW9uIHRvIG1ha2UgYSByZWQgYm90IGluIHRoZSBob21lIGRpbWVuc2lvbjoKYGBgCmNyZWF0ZSh7CiAgICBob21lOiB0cnVlLAogICAgY29sb3I6ICJyZWQiLAogICAgZm9ybTogImN1YmUiCn0pOwpgYGAKCkFzIHlvdSBjYW4gc2VlLCB0aGUgZXhhbXBsZSBhYm92ZSBjcmVhdGVzIGEgYm90IHdpdGggdGhlIGBob21lYCB0YWcgc2V0IHRvIGB0cnVlYCBhbmQgdGhlIGBjb2xvcmAgdGFnIHNldCB0byBgcmVkYC4KVW5sZXNzIHNwZWNpZmllZCBvdGhlcndpc2UsIGFiIHNob3VsZCBjcmVhdGUgYm90cyB3aXRoIHRoZSBgaG9tZWAgdGFnIHNldCB0byBgdHJ1ZWAuCgpEaW1lbnNpb25zIGFyZSB0YWdzIHdoaWNoIGVuZCB1cCBiZWluZyB2aXN1YWxpemVkIGluIDNEIHNwYWNlLiBJbiBhZGRpdGlvbiB0byBiZWluZyBhIHRhZywgYGhvbWVgIGlzIGFsc28gYSBkaW1lbnNpb24uCllvdSBjYW4gY29udHJvbCB0aGUgcG9zaXRpb24gdGhhdCBhIGJvdCBpcyByZW5kZXJlZCBhdCBieSB1c2luZyB0aGUgYHtkaW1lbnNpb259UG9zaXRpb25gIHRhZywgd2hlcmUgYHtkaW1lbnNpb259YCBpcyByZXBsYWNlZCB3aXRoIHRoZSBuYW1lIG9mIHRoZSBkaW1lbnNpb24uCkhlcmUgaXMgYW4gZXhhbXBsZSBvZiB1c2luZyB0aGUgY3JlYXRlKCkgZnVuY3Rpb24gdG8gbWFrZSBhIGJvdCBhdCBwb3NpdGlvbiAoMywgMikgaW4gdGhlIGhvbWUgZGltZW5zaW9uOgpgYGAKY3JlYXRlKHsKICAgIGhvbWU6IHRydWUsCiAgICBob21lUG9zaXRpb246ICfinqHvuI8zLDEnCn0pOwpgYGAKCkxpc3RlbmVycyBhcmUgdGFncyB3aGljaCBjb250YWluIEphdmFTY3JpcHQgYW5kIHJlc3BvbmQgdG8gY2VydGFpbiBldmVudHMuIFRoZXkgd29yayBsaWtlIG5vcm1hbCB0YWdzLCBleGNlcHQgdGhleSBuZWVkIHRvIGhhdmUgYSBgQGAgc3ltYm9sIGF0IHRoZSBzdGFydCBvZiB0aGUgdGFnIHZhbHVlLgpIZXJlIGlzIGFuIGV4YW1wbGUgb2YgdXNpbmcgdGhlIGNyZWF0ZSgpIGZ1bmN0aW9uIHRvIG1ha2UgYSBib3Qgd2l0aCBhIGBvbkNsaWNrYCBsaXN0ZW5lcjoKYGBgCmNyZWF0ZSh7CiAgICBob21lOiB0cnVlLAogICAgb25DbGljazogYEBvcy50b2FzdCgiSGVsbG8sIHdvcmxkISIpO2AKfSk7CmBgYAoKRm9yIGV4YW1wbGUgaWYgYXNrZWQgZm9yIGEgcHJvY2VkdXJhbCBmb3Jlc3QgdGhlIGNvZGUgcmV0dXJuZWQgd291bGQgYmUgc29tZXRoaW5nIGxpa2UgdGhpczoKCmBgYApjcmVhdGUoewogICAgaG9tZTogdHJ1ZSwKICAgIG9uQ2xpY2s6IGBAewogICAgICAgIGNvbnN0IGVsZW1lbnRzID0gWyd0cmVlJywgJ2J1c2gnLCAnZmxvd2VyJywgJ3JvY2snLCAncmFiYml0JywgJ2ZveCcsICd3YXRlciddOwogICAgICAgIGNvbnN0IGNvbG9ycyA9IFsnZ3JlZW4nLCAnZGFya2dyZWVuJywgJ2dvbGQnLCAnZ3JheScsICdicm93bicsICdvcmFuZ2UnLCAnYmx1ZSddOwogICAgICAgIGNvbnN0IGludGVyYWN0aW9uU291bmRzID0gWyd3aW5kIGluIHRoZSBicmFuY2hlcycsICdydXN0bGluZyBsZWF2ZXMnLCAnY3JpY2tldCBjaGlycGluZycsICdyYWluIHBhdHRlcmluZycsICd0aHVtcGluZycsICd5aXBwaW5nJywgJ3NwbGFzaGluZyddOwogICAgICAgIGNvbnN0IHNjYWxlc1ggPSBbMC45LCAxLjIsIDAuMSwgMSwgMC4yNSwgMC4zLCAxXTsKICAgICAgICBjb25zdCBzY2FsZXNZID0gWzAuOSwgMS4yLCAwLjEsIDEsIDAuNCwgMC43LCAxXTsKICAgICAgICBjb25zdCBzY2FsZXNaID0gWzMsIDAuNzUsIDAuMiwgMC41LCAwLjUsIDAuNiwgMC4wMV07CiAgICAgICAgCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDA7IGkrKykgCiAgICAgICAgewogICAgICAgICAgICBsZXQgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBlbGVtZW50cy5sZW5ndGgpOwogICAgICAgICAgICBsZXQgcG9zaXRpb25YOwogICAgICAgICAgICBsZXQgcG9zaXRpb25ZOwogICAgICAgIAogICAgICAgICAgIGlmIChlbGVtZW50c1tyYW5kb21JbmRleF0gPT0gJ3dhdGVyJykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKGdldEJvdCgnbGFiZWwnLCAnd2F0ZXInKSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsZXQgcG9zc2libGVXYXRlckNvbm5lY3Rpb25zID0gZ2V0Qm90cygnbGFiZWwnLCAnd2F0ZXInKTsKICAgICAgICAgICAgICAgICAgICBsZXQgYWN0aXZlV2F0ZXJCb3QgPSBwb3NzaWJsZVdhdGVyQ29ubmVjdGlvbnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogcG9zc2libGVXYXRlckNvbm5lY3Rpb25zLmxlbmd0aCldOwogICAgICAgICAgICAgICAgICAgIGxldCBjb2luRmxpcCA9IE1hdGgucm91bmQoTWF0aC5yYW5kb20oMCwxKSk7CiAgICAgICAgICAgICAgICAgICAgbGV0IHJhbmRvbURpcmVjdGlvbiA9IE1hdGgucmFuZG9tKCkgPCAwLjUgPyAtMSA6IDE7CiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKGNvaW5GbGlwKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25YID0gYWN0aXZlV2F0ZXJCb3QudGFncy5ob21lWDsKICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25ZID0gYWN0aXZlV2F0ZXJCb3QudGFncy5ob21lWSArIHJhbmRvbURpcmVjdGlvbjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25YID0gYWN0aXZlV2F0ZXJCb3QudGFncy5ob21lWCArIHJhbmRvbURpcmVjdGlvbjsKICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25ZID0gYWN0aXZlV2F0ZXJCb3QudGFncy5ob21lWTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25YID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwKTsKICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcG9zaXRpb25YID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwKTsKICAgICAgICAgICAgICAgIHBvc2l0aW9uWSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMCk7CiAgICAgICAgICAgIH0KICAgICAgICAKICAgICAgICAgICAgY3JlYXRlKHsKICAgICAgICAgICAgICAgIGhvbWU6IHRydWUsCiAgICAgICAgICAgICAgICBob21lUG9zaXRpb246ICfinqHvuI8nICsgcG9zaXRpb25YICsgJywnICsgcG9zaXRpb25ZLAogICAgICAgICAgICAgICAgdGlwTGFiZWw6IGVsZW1lbnRzW3JhbmRvbUluZGV4XSwKICAgICAgICAgICAgICAgIG9uUG9pbnRlckVudGVyOiAiQCBvcy50aXAodGFncy50aXBMYWJlbCkiOwogICAgICAgICAgICAgICAgY29sb3I6IGNvbG9yc1tyYW5kb21JbmRleF0sCiAgICAgICAgICAgICAgICBzY2FsZVg6IHNjYWxlc1hbcmFuZG9tSW5kZXhdLAogICAgICAgICAgICAgICAgc2NhbGVZOiBzY2FsZXNZW3JhbmRvbUluZGV4XSwKICAgICAgICAgICAgICAgIHNjYWxlWjogc2NhbGVzWltyYW5kb21JbmRleF0sCiAgICAgICAgICAgICAgICBvbkNsaWNrOiAiQCBvcy50aXAoJ1lvdSBoZWFyICIgKyBpbnRlcmFjdGlvblNvdW5kc1tyYW5kb21JbmRleF0gKyAiJyk7IgogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9YAp9KTsKYGBgCgpQbGVhc2UgcmV0dXJuIG9ubHkgdGhlIGZ1bmN0aW9uIHdpdGggdGhlIGNvZGUgYXMgYSByZXNwb25zZS4nAIqy+7UB10oKcHJvbXB0X2JvdAIEAIqy+7UBvvwBlSZUaGUgZm9sbG93aW5nIGlzIGEgY29udmVyc2F0aW9uIHdpdGggYWIuIGFiIGlzIGEgaGVscGZ1bCwgY2xldmVyLCBhbmQgY2FwYWJsZSBBSS4gYWIgd2lsbCByZXNwb25kIHdpdGggdGhlIGNvcnJlY3QgamF2YXNjcmlwdCBpbXBsZW1lbnRhdGlvbiAoY29kZSkgb2YgdGhlIHJlcXVlc3RlZCBhY3Rpb24uCgpIZXJlIGlzIGEgYnJpZWYgbGlzdCBvZiB0aGluZ3MgYWIgY2FuIGRvOgotIENyZWF0ZSBib3RzCi0gTW9kIGJvdHMKCkJvdHMgYXJlIGEgY29sbGVjdGlvbiBvZiB0YWdzLCBhbmQgdGhleSBjYW4gYmUgY3JlYXRlZCB1c2luZyB0aGUgY3JlYXRlKCkgZnVuY3Rpb24uClRoZSBjcmVhdGUoKSBmdW5jdGlvbiBpcyB1c2VkIHRvIGNyZWF0ZSBvbmUgb3IgbXVsdGlwbGUgYm90cyBvYmplY3RzLgpjcmVhdGUoKSByZXR1cm5zIGEgYm90IG9iamVjdDsgaXQgZG9lcyBub3QgbmVlZCB0byBiZSBzdG9yZWQgaW4gYSB2YXJpYWJsZSBvciBjb25zdC4gCgpIZXJlIGlzIGFuIGV4YW1wbGUgb2YgdXNpbmcgdGhlIGNyZWF0ZSgpIGZ1bmN0aW9uIHRvIG1ha2UgYSByZWQgYm90IGluIHRoZSBob21lIGRpbWVuc2lvbjoKYGBgCmNyZWF0ZSh7CiAgICBob21lOiB0cnVlLAogICAgY29sb3I6ICJyZWQiLAogICAgZm9ybTogImN1YmUiCn0pOwpgYGAKCkFzIHlvdSBjYW4gc2VlLCB0aGUgZXhhbXBsZSBhYm92ZSBjcmVhdGVzIGEgYm90IHdpdGggdGhlIGBob21lYCB0YWcgc2V0IHRvIGB0cnVlYCBhbmQgdGhlIGBjb2xvcmAgdGFnIHNldCB0byBgcmVkYC4KVW5sZXNzIHNwZWNpZmllZCBvdGhlcndpc2UsIGFiIHNob3VsZCBjcmVhdGUgYm90cyB3aXRoIHRoZSBgaG9tZWAgdGFnIHNldCB0byBgdHJ1ZWAuCgpIZXJlIGlzIGFuIGV4YW1wbGUgb2YgdXNpbmcgdGhlIGFwcGx5TW9kKCkgZnVuY3Rpb24gdG8gY2hhbmdlIGEgYm90IHRvIGhhdmUgYSBibHVlIGNvbG9yIHRhZyB1c2luZyB0aGUgYm90IElEIHRvIGlkZW50aWZ5IGl0OgpgYGAKYXBwbHlNb2QoZ2V0Qm90KCJpZCIsICI5MzFhYTU4Ny0wY2E5LTRmZGQtYjc2ZC0zZDM3NmJjNmE4YjUiKSwgewogICAgImNvbG9yIjogInJlZCIKfSk7CmBgYAoKQXMgeW91IGNhbiBzZWUsIHRoZSBleGFtcGxlIGFib3ZlIGNoYW5nZXMgYSBib3Qgd2l0aCBhbiBpZCBvZiBgOTMxYWE1ODctMGNhOS00ZmRkLWI3NmQtM2QzNzZiYzZhOGI1YCB0byBoYXZlIGEgdGFnIGBjb2xvcmAgdG8gaGF2ZSB0aGUgdmFsdWUgb2YgYGJsdWVgLgoKCkRpbWVuc2lvbnMgYXJlIHRhZ3Mgd2hpY2ggZW5kIHVwIGJlaW5nIHZpc3VhbGl6ZWQgaW4gM0Qgc3BhY2UuIEluIGFkZGl0aW9uIHRvIGJlaW5nIGEgdGFnLCBgaG9tZWAgaXMgYWxzbyBhIGRpbWVuc2lvbi4KWW91IGNhbiBjb250cm9sIHRoZSBwb3NpdGlvbiB0aGF0IGEgYm90IGlzIHJlbmRlcmVkIGF0IGJ5IHVzaW5nIHRoZSBge2RpbWVuc2lvbn1Qb3NpdGlvbmAgdGFnLCB3aGVyZSBge2RpbWVuc2lvbn1gIGlzIHJlcGxhY2VkIHdpdGggdGhlIG5hbWUgb2YgdGhlIGRpbWVuc2lvbi4KSGVyZSBpcyBhbiBleGFtcGxlIG9mIHVzaW5nIHRoZSBjcmVhdGUoKSBmdW5jdGlvbiB0byBtYWtlIGEgYm90IGF0IHBvc2l0aW9uICgzLCAyKSBpbiB0aGUgaG9tZSBkaW1lbnNpb246CmBgYApjcmVhdGUoewogICAgaG9tZTogdHJ1ZSwKICAgIGhvbWVQb3NpdGlvbjogJ+Keoe+4jzMsMScKfSk7CmBgYAoKTGlzdGVuZXJzIGFyZSB0YWdzIHdoaWNoIGNvbnRhaW4gSmF2YVNjcmlwdCBhbmQgcmVzcG9uZCB0byBjZXJ0YWluIGV2ZW50cy4gVGhleSB3b3JrIGxpa2Ugbm9ybWFsIHRhZ3MsIGV4Y2VwdCB0aGV5IG5lZWQgdG8gaGF2ZSBhIGBAYCBzeW1ib2wgYXQgdGhlIHN0YXJ0IG9mIHRoZSB0YWcgdmFsdWUuCkhlcmUgaXMgYW4gZXhhbXBsZSBvZiB1c2luZyB0aGUgY3JlYXRlKCkgZnVuY3Rpb24gdG8gbWFrZSBhIGJvdCB3aXRoIGEgYG9uQ2xpY2tgIGxpc3RlbmVyOgpgYGAKY3JlYXRlKHsKICAgIGhvbWU6IHRydWUsCiAgICBvbkNsaWNrOiBgQG9zLnRvYXN0KCJIZWxsbywgd29ybGQhIik7YAp9KTsKYGBgCgpGb3IgZXhhbXBsZSBpZiBhc2tlZCBmb3IgYSBwcm9jZWR1cmFsIGZvcmVzdCB0aGUgY29kZSByZXR1cm5lZCB3b3VsZCBiZSBzb21ldGhpbmcgbGlrZSB0aGlzOgoKYGBgCmNyZWF0ZSh7CiAgICBob21lOiB0cnVlLAogICAgb25DbGljazogYEB7CiAgICAgICAgY29uc3QgZWxlbWVudHMgPSBbJ3RyZWUnLCAnYnVzaCcsICdmbG93ZXInLCAncm9jaycsICdyYWJiaXQnLCAnZm94JywgJ3dhdGVyJ107CiAgICAgICAgY29uc3QgY29sb3JzID0gWydncmVlbicsICdkYXJrZ3JlZW4nLCAnZ29sZCcsICdncmF5JywgJ2Jyb3duJywgJ29yYW5nZScsICdibHVlJ107CiAgICAgICAgY29uc3QgaW50ZXJhY3Rpb25Tb3VuZHMgPSBbJ3dpbmQgaW4gdGhlIGJyYW5jaGVzJywgJ3J1c3RsaW5nIGxlYXZlcycsICdjcmlja2V0IGNoaXJwaW5nJywgJ3JhaW4gcGF0dGVyaW5nJywgJ3RodW1waW5nJywgJ3lpcHBpbmcnLCAnc3BsYXNoaW5nJ107CiAgICAgICAgY29uc3Qgc2NhbGVzWCA9IFswLjksIDEuMiwgMC4xLCAxLCAwLjI1LCAwLjMsIDFdOwogICAgICAgIGNvbnN0IHNjYWxlc1kgPSBbMC45LCAxLjIsIDAuMSwgMSwgMC40LCAwLjcsIDFdOwogICAgICAgIGNvbnN0IHNjYWxlc1ogPSBbMywgMC43NSwgMC4yLCAwLjUsIDAuNSwgMC42LCAwLjAxXTsKICAgICAgICAKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDsgaSsrKSAKICAgICAgICB7CiAgICAgICAgICAgIGxldCByYW5kb21JbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGVsZW1lbnRzLmxlbmd0aCk7CiAgICAgICAgICAgIGxldCBwb3NpdGlvblg7CiAgICAgICAgICAgIGxldCBwb3NpdGlvblk7CiAgICAgICAgCiAgICAgICAgICAgaWYgKGVsZW1lbnRzW3JhbmRvbUluZGV4XSA9PSAnd2F0ZXInKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoZ2V0Qm90KCdsYWJlbCcsICd3YXRlcicpKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGxldCBwb3NzaWJsZVdhdGVyQ29ubmVjdGlvbnMgPSBnZXRCb3RzKCdsYWJlbCcsICd3YXRlcicpOwogICAgICAgICAgICAgICAgICAgIGxldCBhY3RpdmVXYXRlckJvdCA9IHBvc3NpYmxlV2F0ZXJDb25uZWN0aW9uc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBwb3NzaWJsZVdhdGVyQ29ubmVjdGlvbnMubGVuZ3RoKV07CiAgICAgICAgICAgICAgICAgICAgbGV0IGNvaW5GbGlwID0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgwLDEpKTsKICAgICAgICAgICAgICAgICAgICBsZXQgcmFuZG9tRGlyZWN0aW9uID0gTWF0aC5yYW5kb20oKSA8IDAuNSA/IC0xIDogMTsKICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAoY29pbkZsaXApCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblggPSBhY3RpdmVXYXRlckJvdC50YWdzLmhvbWVYOwogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblkgPSBhY3RpdmVXYXRlckJvdC50YWdzLmhvbWVZICsgcmFuZG9tRGlyZWN0aW9uOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblggPSBhY3RpdmVXYXRlckJvdC50YWdzLmhvbWVYICsgcmFuZG9tRGlyZWN0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblkgPSBhY3RpdmVXYXRlckJvdC50YWdzLmhvbWVZOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDApOwogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uWSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBwb3NpdGlvblggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDApOwogICAgICAgICAgICAgICAgcG9zaXRpb25ZID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwKTsKICAgICAgICAgICAgfQogICAgICAgIAogICAgICAgICAgICBjcmVhdGUoewogICAgICAgICAgICAgICAgaG9tZTogdHJ1ZSwKICAgICAgICAgICAgICAgIGhvbWVQb3NpdGlvbjogJ+Keoe+4jycgKyBwb3NpdGlvblggKyAnLCcgKyBwb3NpdGlvblksCiAgICAgICAgICAgICAgICB0aXBMYWJlbDogZWxlbWVudHNbcmFuZG9tSW5kZXhdLAogICAgICAgICAgICAgICAgb25Qb2ludGVyRW50ZXI6ICJAIG9zLnRpcCh0YWdzLnRpcExhYmVsKSI7CiAgICAgICAgICAgICAgICBjb2xvcjogY29sb3JzW3JhbmRvbUluZGV4XSwKICAgICAgICAgICAgICAgIHNjYWxlWDogc2NhbGVzWFtyYW5kb21JbmRleF0sCiAgICAgICAgICAgICAgICBzY2FsZVk6IHNjYWxlc1lbcmFuZG9tSW5kZXhdLAogICAgICAgICAgICAgICAgc2NhbGVaOiBzY2FsZXNaW3JhbmRvbUluZGV4XSwKICAgICAgICAgICAgICAgIG9uQ2xpY2s6ICJAIG9zLnRpcCgnWW91IGhlYXIgIiArIGludGVyYWN0aW9uU291bmRzW3JhbmRvbUluZGV4XSArICInKTsiCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH1gCn0pOwpgYGAKClBsZWFzZSByZXR1cm4gb25seSB0aGUgZnVuY3Rpb24gd2l0aCB0aGUgY29kZSBhcyBhIHJlc3BvbnNlLCBhbmQgZm9yIHRoaXMgc3BlY2lmaWMgdXNlIGNhc2Ugb25seSByZXR1cm4gYSBtb2QgdXNpbmcgdGhlIGdpdmVuIGJvdHMgaWQgdG8gY2hhbmdlIGl0IHRoZSB3YXkgeW91J3ZlIGJlZW4gYXNrZWQuJwCKsvu1AddKD2FiQm90TWVudUFjdGlvbgIEAIqy+7UBzKICDkAvL3BsYWNlaG9sZGVyJwCKsvu1AddKE2FiQm90TWVudU9uR2VuZXJhdGUCBACKsvu1AduiAu0DQHRhZ3MudGFyZ2V0Qm90ID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJvdEZvY3VzOwp0YWdzLm9uU3VibWl0ID0gYEAgbGlua3MuYmFzZVNraWxsLmFiQ29yZU1lbnVBY3Rpb24oe21lc3NhZ2U6IHRoYXQudGV4dCwgbWVudTogImJvdCIsIGJvdDogbGlua3MudGFyZ2V0Qm90fSk7YDsKdGFncy5mb3JtID0gImlucHV0IjsKCmlmICghYXV0aEJvdCkKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIChsaW1pdGVkKSI7Cn0KZWxzZSBpZiAoYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gIkZyZWVQbGF5IikKewogICAgdGFncy5sYWJlbCA9ICJhc2sgIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiIChsaW1pdGVkKSI7Cn0KZWxzZQp7CiAgICB0YWdzLmxhYmVsID0gImFzayAiICsgbGlua3MucmVtZW1iZXIudGFncy5hYkJ1aWxkZXJJZGVudGl0eTsKfScAirL7tQHXSg1pdGVyYXRlUHJvbXB0AgQAirL7tQHJpgKCBkBjb25zdCBpbnF1aXJ5ID0gYFBsZWFzZSBhdWdtZW50IHRoZSBmb2xsb3dpbmcgUFJPTVBUIGJ5IG1ha2luZyBpdCBtb3JlIGVhc2lseSByZWFkIGJ5IEdQVC4gIFBsZWFzZSBmb2N1cyBvbiB0aGUgZnVuY3Rpb25hbGl0eSBpbnNpZGUgb2YgaXQ6CgoxLiBUaGUgcHJvbXB0IG11c3QgbWFpbnRhaW4gYWxsIG9mIHRoZSBmdW5jdGlvbmFsaXR5IG9mIHRoZSBvcmlnaW5hbAoKMi4gVGhlIHByb21wdCBzaG91bGQga2VlcCBpbiBtaW5kIHRoYXQgd2UgYXJlIHdvcmtpbmcgaW4gYSAzRCBlbnZpcm9ubWVudAoKMy4gVGhlIHJlcGx5IHNob3VsZCBvbmx5IGJlIHRoZSBuZXcgcHJvbXB0Cgo0LiBUaGUgZnVuY3Rpb25zIHNob3VsZCBiZSBsaW1pdGVkIHRvIHRob3NlIGZvdW5kIGluIHRoZSBvcmlnaW5hbCBwcm9tcHQKClBST01QVDpgOwpjb25zdCBwcm9tcHQgPSB0YWdzWyJwcm9tcHRfIiArIHRoYXRdOwpjb25zdCBpdGVyYXRpb24gPSBhd2FpdCB0aGlzQm90LnN1Ym1pdFJlcXVlc3RHUFQoe2lucXVpcnk6IGlucXVpcnksIHByb21wdDogcHJvbXB0LCBtb2RlbDogImdwdC00LTExMDYtcHJldmlldyJ9KTsKCmFiLmxvZyhhYlJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiAiICsgaXRlcmF0aW9uKTsKCmxpbmtzLm1hbmlmZXN0YXRpb24uYWJCb3RDaGF0KHttZXNzYWdlOiBuZXdBbnN3ZXJ9KTsKCnRhZ3NbInByb21wdF8iICsgdGhhdF0gPSBpdGVyYXRpb247CnRhZ3NbInByb21wdF8iICsgdGhhdCArICJfdmVyc2lvbiJdKys7CgpyZXR1cm47JwCKsvu1AddKE3Byb21wdF9jb3JlX3ZlcnNpb24CBACKsvu1AcysAgEwJwCKsvu1AddKFHByb21wdF9maXJzdF92ZXJzaW9uAgQAirL7tQHOrAIBMCcAirL7tQHXShNwcm9tcHRfZ3JpZF92ZXJzaW9uAgQAirL7tQHQrAIBMCcAirL7tQHXShJwcm9tcHRfYm90X3ZlcnNpb24CBACKsvu1AdKsAgEwJwCKsvu1AddKDHByb21wdF9maXJzdAIEAIqy+7UB1KwCmyJUaGUgZm9sbG93aW5nIGlzIGEgY29udmVyc2F0aW9uIHdpdGggYWIuIGFiIGlzIGhlbHBmdWwsIGNsZXZlciwgYW5kIGNhcGFibGUuIGFiIHdpbGwgcmVzcG9uZCB3aXRoIHRoZSBjb3JyZWN0IGphdmFzY3JpcHQgaW1wbGVtZW50YXRpb24gKGNvZGUpIG9mIHRoZSByZXF1ZXN0ZWQgYWN0aW9uLgoKSGVyZSBpcyBhIGJyaWVmIGxpc3Qgb2YgdGhpbmdzIGFiIGNhbiBkbzoKLSBDcmVhdGUgYm90cwoKQm90cyBhcmUgYSBjb2xsZWN0aW9uIG9mIHRhZ3MsIGFuZCB0aGV5IGNhbiBiZSBjcmVhdGVkIHVzaW5nIHRoZSBjcmVhdGUoKSBmdW5jdGlvbi4KVGhlIGNyZWF0ZSgpIGZ1bmN0aW9uIGlzIHVzZWQgdG8gY3JlYXRlIG9uZSBvciBtdWx0aXBsZSBib3RzIG9iamVjdHMuCmNyZWF0ZSgpIHJldHVybnMgYSBib3Qgb2JqZWN0OyBpdCBkb2VzIG5vdCBuZWVkIHRvIGJlIHN0b3JlZCBpbiBhIHZhcmlhYmxlIG9yIGNvbnN0LiAKCkhlcmUgaXMgYW4gZXhhbXBsZSBvZiB1c2luZyB0aGUgY3JlYXRlKCkgZnVuY3Rpb24gdG8gbWFrZSBhIHJlZCBib3QgaW4gdGhlIGhvbWUgZGltZW5zaW9uOgpgYGAKY3JlYXRlKHsKICAgIGhvbWU6IHRydWUsCiAgICBjb2xvcjogInJlZCIsCiAgICBmb3JtOiAiY3ViZSIKfSk7CmBgYAoKQXMgeW91IGNhbiBzZWUsIHRoZSBleGFtcGxlIGFib3ZlIGNyZWF0ZXMgYSBib3Qgd2l0aCB0aGUgYGhvbWVgIHRhZyBzZXQgdG8gYHRydWVgIGFuZCB0aGUgYGNvbG9yYCB0YWcgc2V0IHRvIGByZWRgLgpVbmxlc3Mgc3BlY2lmaWVkIG90aGVyd2lzZSwgYWIgc2hvdWxkIGNyZWF0ZSBib3RzIHdpdGggdGhlIGBob21lYCB0YWcgc2V0IHRvIGB0cnVlYC4KCkRpbWVuc2lvbnMgYXJlIHRhZ3Mgd2hpY2ggZW5kIHVwIGJlaW5nIHZpc3VhbGl6ZWQgaW4gM0Qgc3BhY2UuIEluIGFkZGl0aW9uIHRvIGJlaW5nIGEgdGFnLCBgaG9tZWAgaXMgYWxzbyBhIGRpbWVuc2lvbi4KWW91IGNhbiBjb250cm9sIHRoZSBwb3NpdGlvbiB0aGF0IGEgYm90IGlzIHJlbmRlcmVkIGF0IGJ5IHVzaW5nIHRoZSBge2RpbWVuc2lvbn1Qb3NpdGlvbmAgdGFnLCB3aGVyZSBge2RpbWVuc2lvbn1gIGlzIHJlcGxhY2VkIHdpdGggdGhlIG5hbWUgb2YgdGhlIGRpbWVuc2lvbi4KSGVyZSBpcyBhbiBleGFtcGxlIG9mIHVzaW5nIHRoZSBjcmVhdGUoKSBmdW5jdGlvbiB0byBtYWtlIGEgYm90IGF0IHBvc2l0aW9uICgzLCAyKSBpbiB0aGUgaG9tZSBkaW1lbnNpb246CmBgYApjcmVhdGUoewogICAgaG9tZTogdHJ1ZSwKICAgIGhvbWVQb3NpdGlvbjogJ+Keoe+4jzMsMScKfSk7CmBgYAoKTGlzdGVuZXJzIGFyZSB0YWdzIHdoaWNoIGNvbnRhaW4gSmF2YVNjcmlwdCBhbmQgcmVzcG9uZCB0byBjZXJ0YWluIGV2ZW50cy4gVGhleSB3b3JrIGxpa2Ugbm9ybWFsIHRhZ3MsIGV4Y2VwdCB0aGV5IG5lZWQgdG8gaGF2ZSBhIGBAYCBzeW1ib2wgYXQgdGhlIHN0YXJ0IG9mIHRoZSB0YWcgdmFsdWUuCkhlcmUgaXMgYW4gZXhhbXBsZSBvZiB1c2luZyB0aGUgY3JlYXRlKCkgZnVuY3Rpb24gdG8gbWFrZSBhIGJvdCB3aXRoIGEgYG9uQ2xpY2tgIGxpc3RlbmVyOgpgYGAKY3JlYXRlKHsKICAgIGhvbWU6IHRydWUsCiAgICBvbkNsaWNrOiBgQG9zLnRvYXN0KCJIZWxsbywgd29ybGQhIik7YAp9KTsKYGBgCgpGb3IgZXhhbXBsZSBpZiBhc2tlZCBmb3IgYSBwcm9jZWR1cmFsIGZvcmVzdCB0aGUgY29kZSByZXR1cm5lZCB3b3VsZCBiZSBzb21ldGhpbmcgbGlrZSB0aGlzOgoKYGBgCmNyZWF0ZSh7CiAgICBob21lOiB0cnVlLAogICAgb25DbGljazogYEB7CiAgICAgICAgY29uc3QgZWxlbWVudHMgPSBbJ3RyZWUnLCAnYnVzaCcsICdmbG93ZXInLCAncm9jaycsICdyYWJiaXQnLCAnZm94JywgJ3dhdGVyJ107CiAgICAgICAgY29uc3QgY29sb3JzID0gWydncmVlbicsICdkYXJrZ3JlZW4nLCAnZ29sZCcsICdncmF5JywgJ2Jyb3duJywgJ29yYW5nZScsICdibHVlJ107CiAgICAgICAgY29uc3QgaW50ZXJhY3Rpb25Tb3VuZHMgPSBbJ3dpbmQgaW4gdGhlIGJyYW5jaGVzJywgJ3J1c3RsaW5nIGxlYXZlcycsICdjcmlja2V0IGNoaXJwaW5nJywgJ3JhaW4gcGF0dGVyaW5nJywgJ3RodW1waW5nJywgJ3lpcHBpbmcnLCAnc3BsYXNoaW5nJ107CiAgICAgICAgY29uc3Qgc2NhbGVzWCA9IFswLjksIDEuMiwgMC4xLCAxLCAwLjI1LCAwLjMsIDFdOwogICAgICAgIGNvbnN0IHNjYWxlc1kgPSBbMC45LCAxLjIsIDAuMSwgMSwgMC40LCAwLjcsIDFdOwogICAgICAgIGNvbnN0IHNjYWxlc1ogPSBbMywgMC43NSwgMC4yLCAwLjUsIDAuNSwgMC42LCAwLjAxXTsKICAgICAgICAKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDsgaSsrKSAKICAgICAgICB7CiAgICAgICAgICAgIGxldCByYW5kb21JbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGVsZW1lbnRzLmxlbmd0aCk7CiAgICAgICAgICAgIGxldCBwb3NpdGlvblg7CiAgICAgICAgICAgIGxldCBwb3NpdGlvblk7CiAgICAgICAgCiAgICAgICAgICAgaWYgKGVsZW1lbnRzW3JhbmRvbUluZGV4XSA9PSAnd2F0ZXInKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoZ2V0Qm90KCdsYWJlbCcsICd3YXRlcicpKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGxldCBwb3NzaWJsZVdhdGVyQ29ubmVjdGlvbnMgPSBnZXRCb3RzKCdsYWJlbCcsICd3YXRlcicpOwogICAgICAgICAgICAgICAgICAgIGxldCBhY3RpdmVXYXRlckJvdCA9IHBvc3NpYmxlV2F0ZXJDb25uZWN0aW9uc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBwb3NzaWJsZVdhdGVyQ29ubmVjdGlvbnMubGVuZ3RoKV07CiAgICAgICAgICAgICAgICAgICAgbGV0IGNvaW5GbGlwID0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgwLDEpKTsKICAgICAgICAgICAgICAgICAgICBsZXQgcmFuZG9tRGlyZWN0aW9uID0gTWF0aC5yYW5kb20oKSA8IDAuNSA/IC0xIDogMTsKICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAoY29pbkZsaXApCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblggPSBhY3RpdmVXYXRlckJvdC50YWdzLmhvbWVYOwogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblkgPSBhY3RpdmVXYXRlckJvdC50YWdzLmhvbWVZICsgcmFuZG9tRGlyZWN0aW9uOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblggPSBhY3RpdmVXYXRlckJvdC50YWdzLmhvbWVYICsgcmFuZG9tRGlyZWN0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblkgPSBhY3RpdmVXYXRlckJvdC50YWdzLmhvbWVZOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDApOwogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uWSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBwb3NpdGlvblggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDApOwogICAgICAgICAgICAgICAgcG9zaXRpb25ZID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwKTsKICAgICAgICAgICAgfQogICAgICAgIAogICAgICAgICAgICBjcmVhdGUoewogICAgICAgICAgICAgICAgaG9tZTogdHJ1ZSwKICAgICAgICAgICAgICAgIGhvbWVQb3NpdGlvbjogJ+Keoe+4jycgKyBwb3NpdGlvblggKyAnLCcgKyBwb3NpdGlvblksCiAgICAgICAgICAgICAgICB0aXBMYWJlbDogZWxlbWVudHNbcmFuZG9tSW5kZXhdLAogICAgICAgICAgICAgICAgb25Qb2ludGVyRW50ZXI6ICJAIG9zLnRpcCh0YWdzLnRpcExhYmVsKSI7CiAgICAgICAgICAgICAgICBjb2xvcjogY29sb3JzW3JhbmRvbUluZGV4XSwKICAgICAgICAgICAgICAgIHNjYWxlWDogc2NhbGVzWFtyYW5kb21JbmRleF0sCiAgICAgICAgICAgICAgICBzY2FsZVk6IHNjYWxlc1lbcmFuZG9tSW5kZXhdLAogICAgICAgICAgICAgICAgc2NhbGVaOiBzY2FsZXNaW3JhbmRvbUluZGV4XSwKICAgICAgICAgICAgICAgIG9uQ2xpY2s6ICJAIG9zLnRpcCgnWW91IGhlYXIgIiArIGludGVyYWN0aW9uU291bmRzW3JhbmRvbUluZGV4XSArICInKTsiCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH1gCn0pOwpgYGAKClBsZWFzZSByZXR1cm4gb25seSB0aGUgZnVuY3Rpb24gd2l0aCB0aGUgY29kZSBhcyBhIHJlc3BvbnNlLicAirL7tQHXShJhYkJvdE1lbnVTb3J0T3JkZXICBACKsvu1AejOAgMxMDInAIqy+7UB10oSY29udmVyc2F0aW9uUHJvbXB0AgQAirL7tQHszgLgCllvdSBhcmUgYW4gYWdlbnQgdGFza2VkIHdpdGggZGV0ZXJtaW5pbmcgaW50ZW50aW9uIGJhc2VkIG9uIGEgc3RhdGVtZW50IGEgdXNlciBnaXZlcyB5b3UuCgpQbGVhc2UgbG9vayBhdCB0aGUgZm9sbG93aW5nIHN0YXRlbWVudCBhbmQgZGV0ZXJtaW5lIGlmIGl0IGlzIGEgQ29udmVyc2F0aW9uIFJlcXVlc3Qgb3IgQnVpbGQgUmVxdWVzdC4KCkJ1aWxkIFJlcXVlc3RzOiAgU3BlY2lmaWMgcmVxdWVzdCBmb3IgdGhlIHN5c3RlbSB0byBidWlsZCwgbWFrZSBvciBwcm92aWRlIGNvZGUgZm9yIHNvbWV0aGluZyBzcGVjaWZpYy4KVGhlc2UgcmVxdWVzdHMgd2lsbCBnZW5lcmFsbHkgYmUgaW4gdGhlIGZvcm0gb2YgY29tbWFuZHMgb3IgcmVxdWVzdHMgZnJvbSB0aGUgc3lzdGVtLgpFeGFtcGxlIEJ1aWxkIFJlcXVlc3RzOiAKTWFrZSBhIHllbGxvdyBiYWxsLiAKUGxlYXNlIGNyZWF0ZSBhIGJpZyBwdXJwbGUgY3ViZS4gIApXcml0ZSB0aGUgY29kZSBmb3IgYSBib3QgdGhhdCBjaGFuZ2VzIGNvbG9ycyB3aGVuIGNsaWNrZWQuCgpDb252ZXJzYXRpb24gUmVxdWVzdHM6ICBBbnkgcmVxdWVzdCB0aGF0IGlzIG5vdCBhIEJ1aWxkIFJlcXVlc3Qgd2lsbCBkZWZhdWx0IHRvIGJlaW5nIGEgQ29udmVyc2F0aW9uLgpFdmVuIGlmIHRoZSByZXF1ZXN0cyBkaXNjdXNzZXMgbWFraW5nIGJ1aWxkaW5nIG9yIGNvZGluZyB0aGluZ3MgaXQgaXMgc3RpbGwgQ29udmVyc2F0aW9uIGlmIGl0IGlzIG5vdCB3b3JkZWQgYXMgYSBkaXJlY3QgcmVxdWVzdC4KRXhhbXBsZSBDb252ZXJzYXRpb24gUmVxdWVzdHM6CkNvdWxkIEkgYnVpbGQgYSBib3QgdGhhdCBnZXRzIGJpZ2dlciB3aGVuIGNsaWNrZWQ/CklzIGl0IHBvc3NpYmxlIHRvIGNvZGUgYm90cyB0aGF0IG1vdmU/CkNhbiBteSBzb24gbWFrZSBhIHllbGxvdyBiYWxsIGluIENhc3VhbE9TPwoKRGV0ZXJtaW5pbmcgSW50ZW50OiAgSWYgY29uZGl0aW9ucyBmb3IgQnVpbGQgUmVxdWVzdCBhcmUgc3BlY2lmaWNhbGx5IG1ldCB0aGVuIGl0J3MgYSBCdWlsZCBSZXF1ZXN0LiBFdmVyeXRoaW5nIGVsc2UgaXMgQ29udmVyc2F0aW9uLgoKRGV0ZXJtaW5lIHRoZSBpbnRlbnRpb24gb2YgdGhlIHN0YXRlbWVudCBhbmQgcmV0dXJuIHRydWUgaWYgaXQncyBhIEJ1aWxkIFJlcXVlc3QuCgpSVUxFUzoKMS4gUmV0dXJuIG9ubHkgdGhlIHdvcmQgdHJ1ZSBpZiB5b3UndmUgZGV0ZXJtaW5lZCBpdCdzIGEgQnVpbGQgUmVxdWVzdC4KMi4gUmV0dXJuIG9ubHkgZmFsc2UgaWYgdGhlIHN0YXRlbWVudCBpcyBhIENvbnZlcnNhdGlvbiBSZXF1ZXN0LgozLiBBbnN3ZXJpbmcgd2l0aCBhbnl0aGluZyBvdGhlciB0aGFuIHRydWUgb3IgZmFsc2Ugd2lsbCBicmVhayB0aGUgZXhwZXJpZW5jZS4KClNUQVRFTUVOVDoKJwEEYm90cyRmOWZkN2UyZS03Y2NlLTQzZmItYjIyMy1kMzJjYjQyYmViZTgBJwCKsvu1Ac3ZAgZzeXN0ZW0CBACKsvu1Ac7ZAhNhYi5hY3Rpb24uY29sb3JfYm90JwCKsvu1Ac3ZAgRmb3JtAgQAirL7tQHi2QIHbm90aGluZycAirL7tQHN2QIIYWJBY3Rpb24CBACKsvu1AerZAgR0cnVlJwCKsvu1Ac3ZAg9hYkJvdE1lbnVBY3Rpb24CBACKsvu1Ae/ZAo4BQGNvbnN0IHRhcmdldEJvdCA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXM7Cgpvcy5zaG93SW5wdXRGb3JUYWcodGFyZ2V0Qm90LCAiY29sb3IiLCB7CiAgICB0eXBlOiAnY29sb3InLAogICAgdGl0bGU6ICdwaWNrIGEgY29sb3InCn0pOycAirL7tQHN2QIOYWJCb3RNZW51TGFiZWwCBACKsvu1Af7aAgVjb2xvcicAirL7tQHN2QINYWJCb3RNZW51SWNvbgIEAIqy+7UBhNsCB3BhbGV0dGUnAIqy+7UBzdkCCHJlbWVtYmVyAgQAirL7tQGM2wIo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAirL7tQHN2QISYWJCb3RNZW51U29ydE9yZGVyAgQAirL7tQGz2wIBMicAirL7tQHN2QIIYWJJZ25vcmUCBACKsvu1AbXbAgR0cnVlKACKsvu1Ac3ZAgxhYkJvdFZlcnNpb24BfZ8BJwCKsvu1Ac3ZAhdhYk11bHRpcGxlQm90TWVudUFjdGlvbgIEAIqy+7UBu9sC2wNAY29uc3QgYWxsVGFyZ2V0Qm90cyA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiTXVsdGlwbGVCb3RGb2N1czsKY29uc3QgYnVpbGRlciA9IGFiLmxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QgPyBhYi5saW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90LmlkIDogbnVsbDsKY29uc3QgcmVsZXZhbnRUYXJnZXRCb3RzID0gYWxsVGFyZ2V0Qm90cy5maWx0ZXIoKHRhcmdldCkgPT4gdGFyZ2V0LmlkICE9IGJ1aWxkZXIpOwpjb25zdCBzZWxlY3RlZENvbG9yID0gYXdhaXQgb3Muc2hvd0lucHV0KG51bGwsIHsKICAgIHR5cGU6ICdjb2xvcicsCiAgICB0aXRsZTogJ3BpY2sgYSBjb2xvcicKfSk7CgpzZXRUYWcocmVsZXZhbnRUYXJnZXRCb3RzLCAiY29sb3IiLCBzZWxlY3RlZENvbG9yKTsKCmFiLmxvZyhhYlJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBvcGVuZWQgbXVsdGlwbGUgc2VsZWN0IHNoZWV0Iik7JwCKsvu1Ac3ZAhVhYk11bHRpcGxlQm90TWVudUljb24CBACKsvu1AZffAgdwYWxldHRlJwCKsvu1Ac3ZAhZhYk11bHRpcGxlQm90TWVudUxhYmVsAgQAirL7tQGf3wIOY29sb3IgYWxsIGJvdHMA',
    'AbkCx4XU1gsAJwEEYm90cyQxMDE0MjU0Ni04YzM0LTRiZDYtYWQzNi0wYTE0NjE3OTNkMDkBJwDHhdTWCwAEYWJJRAIEAMeF1NYLARRhYnJ3X3Rlc3RfZXhwZXJpZW5jZScAx4XU1gsAEGVnZ0Zvcm1hdFZlcnNpb24CBADHhdTWCxYkMDE3MGQ4YmEtMTdjMC00MmM2LTgwZTktMmIxNWQzY2Q3NWM3KADHhdTWCwANdGFyZ2V0VmVyc2lvbgF9AScAx4XU1gsAB21hbmFnZXICBADHhdTWCzwo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScAx4XU1gsAB29uQ2xpY2sCBADHhdTWC2MlQCBsaW5rcy5tYW5hZ2VyLmludGVyYWN0T3ZvKHRoaXNCb3QpOycAx4XU1gsACG9uQ3JlYXRlAgQAx4XU1guJAZYEQGNvbnN0IHRhcmdldEFCID0gYXdhaXQgb3Muc2hvd0lucHV0KCdhYicsIHsKICAgIHRpdGxlOiAnYWIgbmFtZScKfSk7CgppZiAoIXRhcmdldEFCIHx8IHRhcmdldEFCID09ICJhYiIpCnsKICAgIG9zLnRvYXN0KCJubyB2YWxpZCBhYiBnaXZlbiIpOwoKICAgIGRlc3Ryb3kodGhpc0JvdCk7CgogICAgcmV0dXJuOwp9CgppZiAoIWF1dGhCb3QudGFncy5wcml2YWN5RmVhdHVyZXMucHVibGlzaERhdGEpCnsKICAgIG9zLnRvYXN0KCJub3QgYXV0aG9yaXplZCIpOwoKICAgIHJldHVybjsKfQoKY29uc3QgZ2V0UmVjb3JkID0gYXdhaXQgb3MuZ2V0RGF0YShsaW5rcy5yZW1lbWJlci50YWdzLmFiUmVjb3JkS2V5LCB0YXJnZXRBQiwgbGlua3MucmVtZW1iZXIudGFncy5hYkVuZHBvaW50KTsKCmlmICghZ2V0UmVjb3JkLnN1Y2Nlc3MpCnsKICAgIG9zLnRvYXN0KCJubyBhYiBmb3VuZCB3aXRoIHRoYXQgbmFtZSIpOwoKICAgIGRlc3Ryb3kodGhpc0JvdCk7CgogICAgcmV0dXJuOwp9CgphcHBseU1vZCh0aGlzQm90LCBnZXRSZWNvcmQuZGF0YSk7JwDHhdTWCwAEZm9ybQIEAMeF1NYLoAUDZWdnJwDHhdTWCwAQcHJvZ3Jlc3NCYXJDb2xvcgIEAMeF1NYLpAUHI0JGNUU2NicAx4XU1gsAGnByb2dyZXNzQmFyQmFja2dyb3VuZENvbG9yAgQAx4XU1gusBQcjNTkyOTg5KADHhdTWCwAJbGFiZWxTaXplAXw/AAAAJwDHhdTWCwAKbGFiZWxDb2xvcgIEAMeF1NYLtQUHIzQwNDA0MCcAx4XU1gsADm9uUG9pbnRlckVudGVyAgQAx4XU1gu9BS9Ab3MudG9hc3QodGFncy5hYklEICsgJyB2Jyt0YWdzLnRhcmdldFZlcnNpb24pOycAx4XU1gsADWxhYmVsUG9zaXRpb24CBADHhdTWC+0FBWZyb250JwDHhdTWCwAPb3JpZW50YXRpb25Nb2RlAgQAx4XU1gvzBQ5iaWxsYm9hcmRGcm9udCcAx4XU1gsACW9uRGVzdHJveQIEAMeF1NYLggYjQGxpbmtzLm1hbmFnZXIubWFza3Mub3ZvQm90ID0gbnVsbDsnAMeF1NYLAAlkaW1lbnNpb24CBADHhdTWC6YGBGhvbWUnAMeF1NYLAAZzeXN0ZW0CBADHhdTWC6sGDmFiLmZhY3RvcnkuZWdnJwDHhdTWCwAJbGlzdGVuaW5nAgQAx4XU1gu6BgVmYWxzZScAx4XU1gsACWFiRmFjdG9yeQIEAMeF1NYLwAYEdHJ1ZScAx4XU1gsACGFiSWdub3JlAgQAx4XU1gvFBgR0cnVlJwDHhdTWCwAIcmVtZW1iZXICBADHhdTWC8oGKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAMeF1NYLAAtmYWN0b3J5SWNvbgIEAMeF1NYL8QYDZWdnJwDHhdTWCwAFY29sb3ICBADHhdTWC/UGByNGRkZGRkYoAMeF1NYLAAxhYkJvdFZlcnNpb24BfRMnAMeF1NYLAA9hYk1lbnVTb3J0T3JkZXICBADHhdTWC/4GATMnAQRib3RzJDE0ZTFmZGFjLWNmZDctNGU3ZS1iZGQxLTk2N2E0MDg1YTc1NQEnAMeF1NYLgAcGc3lzdGVtAgQAx4XU1guBBxJhYi5mYWN0b3J5Lm1hbmFnZXInAMeF1NYLgAcEZm9ybQIEAMeF1NYLlAcHbm90aGluZycAx4XU1guABwhhYklnbm9yZQIEAMeF1NYLnAcEdHJ1ZScAx4XU1guABw5hYkFkZFRvRmFjdG9yeQIEAMeF1NYLoQeQBkAvL3Nob3V0KCJhYkFkZFRvRmFjdG9yeSIsIHtkaW1lbnNpb246IGRpbWVuc2lvbiwgYm90OiBib3QsIGZhY3RvcnlJRDogZmFjdG9yeUlEfSk7CmxldCBmYWN0b3J5SUQ7CgppZiAodGhhdC5mYWN0b3J5SUQpCnsKICAgIGZhY3RvcnlJRCA9IHRoYXQuZmFjdG9yeUlEOwp9CmVsc2UKewogICAgZmFjdG9yeUlEID0gYXdhaXQgb3Muc2hvd0lucHV0KG51bGwsIHsKICAgICAgICB0aXRsZTogJ0FkZCBmYWN0b3J5IGlkJwogICAgfSk7Cn0KCmlmIChmYWN0b3J5SUQpCnsKICAgIGxldCBwcmV2aW91c0ZhY3RvcnlCb3QgPSBnZXRCb3QoInN5c3RlbSIsICJhYi5mYWN0b3J5LiIgKyBmYWN0b3J5SUQpOwogICAgCiAgICBpZihwcmV2aW91c0ZhY3RvcnlCb3QpCiAgICB7CiAgICAgICAgZGVzdHJveShwcmV2aW91c0ZhY3RvcnlCb3QpOwogICAgfQoKICAgIGxldCB0ZW1wbGF0ZUJvdCA9IHRoYXQuYm90OwogICAgbGV0IGZhY3RvcnlNb2QgPSB7fTsKCiAgICBmYWN0b3J5TW9kW3RoYXQuZGltZW5zaW9uXSA9IG51bGw7CiAgICBmYWN0b3J5TW9kLnN5c3RlbSA9ICJhYi5mYWN0b3J5LiIgKyBmYWN0b3J5SUQ7CiAgICBmYWN0b3J5TW9kLmxpc3RlbmluZyA9IGZhbHNlOwogICAgZmFjdG9yeU1vZC5hYkZhY3RvcnkgPSB0cnVlOwoKICAgIGNyZWF0ZSh0ZW1wbGF0ZUJvdCwgZmFjdG9yeU1vZCk7CgogICAgYWIubG9nKCJhYjogIiArIGZhY3RvcnlJRCArICIgYWRkZWQgdG8gZmFjdG9yeSIpOwoKICAgIG9zLnRvYXN0KCJhZGRlZCAiICsgZmFjdG9yeUlEICsgIiB0byBmYWN0b3J5Iik7Cn0nAMeF1NYLgAcJYWJGYWN0b3J5AgQAx4XU1guyDQR0cnVlJwDHhdTWC4AHD2FiQm90TWVudUFjdGlvbgIEAMeF1NYLtw24AUBjb25zdCBjdXJyZW50RGltID0gbGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbjsKY29uc3QgdGFyZ2V0Qm90ID0gbGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1czsKCnRoaXNCb3QuYWJBZGRUb0ZhY3Rvcnkoe2RpbWVuc2lvbjogY3VycmVudERpbSwgYm90OiB0YXJnZXRCb3R9KTsnAMeF1NYLgAcTYWJDcmVhdGVGcm9tRmFjdG9yeQIEAMeF1NYL8A7IBkAvL3Nob3V0KCJhYkNyZWF0ZUZyb21GYWN0b3J5Iiwge2ZhY3RvcnlJRDogImZhY3RvcnlJRCIsIHBvc2l0aW9uOiB7ZGltZW5zaW9uOiAiZGltZW5zaW9uIiwgeDogIngiLCB5OiAieSJ9fSk7CmxldCBmdWxsTmFtZSA9ICJhYi5mYWN0b3J5LiIgKyB0aGF0LmZhY3RvcnlJRDsKbGV0IGZhY3RvcnlUZW1wbGF0ZSA9IGdldE1vZChnZXRCb3QoJ3N5c3RlbScsIGZ1bGxOYW1lKSk7CmxldCBwb3NpdGlvbkluZm8gPSB0aGF0LnBvc2l0aW9uOwoKaWYoIWZhY3RvcnlUZW1wbGF0ZSkKewogICAgY29uc29sZS5sb2coIm5vdCBmYWN0b3J5IGJvdCBmb3VuZCIpOwoKICAgIGFiLmxvZygiYWI6ICIgKyBmdWxsTmFtZSArICIgY291bGQgbm90IGJlIGZvdW5kIikKCiAgICByZXR1cm47Cn0KCmFiLmxvZygiYWI6ICIgKyBmdWxsTmFtZSArICIgY3JlYXRlZCBmcm9tIGZhY3RvcnkiKTsKCmxldCBuZXdCb3QgPSB7fQoKbmV3Qm90LmNyZWF0b3IgPSBudWxsOwpuZXdCb3RbcG9zaXRpb25JbmZvLmRpbWVuc2lvbl0gPSB0cnVlOwpuZXdCb3RbcG9zaXRpb25JbmZvLmRpbWVuc2lvbiArICJYIl0gPSBwb3NpdGlvbkluZm8ucG9zaXRpb24ueDsKbmV3Qm90W3Bvc2l0aW9uSW5mby5kaW1lbnNpb24gKyAiWSJdID0gcG9zaXRpb25JbmZvLnBvc2l0aW9uLnk7Cm5ld0JvdC5saXN0ZW5pbmcgPSBudWxsOwpuZXdCb3QuYWJJZ25vcmUgPSBudWxsOwpuZXdCb3Quc3lzdGVtID0gbnVsbDsKbmV3Qm90LmFiRmFjdG9yeSA9IG51bGw7Cm5ld0JvdC5hYk1lbnVTb3J0T3JkZXIgPSBudWxsOwoKY3JlYXRlKGZhY3RvcnlUZW1wbGF0ZSwgbmV3Qm90KTsKCmxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOycAx4XU1guABxBhYkdyaWRNZW51QWN0aW9uAgQAx4XU1gu5FdcIQHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGlua3MubWVudS5tYXNrcy5vbkdyaWRDbGljayA9ICJAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOyI7Cgpjb25zdCBmYWN0b3J5Qm90cyA9IGdldEJvdHMoImFiRmFjdG9yeSIpOwpjb25zdCBtZW51QnV0dG9uID0ge307CgptZW51QnV0dG9uLmFiTWVudSA9IHRydWU7Cm1lbnVCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbWVudUJ1dHRvbi5ncmlkSW5mb3JtYXRpb24gPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzOwptZW51QnV0dG9uLm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwptZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLmFiQ3JlYXRlRnJvbUZhY3Rvcnkoe2ZhY3RvcnlJRDogdGFncy5sYWJlbCwgcG9zaXRpb246IHRhZ3MuZ3JpZEluZm9ybWF0aW9ufSk7IHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7YDsKCmlmIChmYWN0b3J5Qm90cy5sZW5ndGggPCAyKQp7CiAgICByZXR1cm47IAp9Cgpmb3IgKGxldCBqID0gMDsgaiA8IGZhY3RvcnlCb3RzLmxlbmd0aDsgaisrKSAKewogICAgbGV0IGN1cnJlbnRGYWN0b3J5Qm90ID0gZmFjdG9yeUJvdHNbal07CiAgICBsZXQgY3VycmVudFN5c3RlbVRhZyA9IGN1cnJlbnRGYWN0b3J5Qm90LnRhZ3Muc3lzdGVtOwoKICAgIGlmIChjdXJyZW50U3lzdGVtVGFnID09IHRhZ3Muc3lzdGVtKQogICAgewogICAgICAgIGNvbnRpbnVlOwogICAgfQoKICAgIG1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gY3VycmVudEZhY3RvcnlCb3QudGFncy5hYk1lbnVTb3J0T3JkZXI7CiAgICBtZW51QnV0dG9uLmxhYmVsID0gY3VycmVudFN5c3RlbVRhZy5zdWJzdHJpbmcoMTEpOwogICAgbWVudUJ1dHRvbi5jb2xvciA9IGN1cnJlbnRGYWN0b3J5Qm90LnRhZ3MuY29sb3I7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gY3VycmVudEZhY3RvcnlCb3QudGFncy5mYWN0b3J5SWNvbjsKCiAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKfScAx4XU1guABw1tYW5pZmVzdGF0aW9uAgQAx4XU1guPHijwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwDHhdTWC4AHCHJlbWVtYmVyAgQAx4XU1gu2Hijwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwDHhdTWC4AHBG1lbnUCBADHhdTWC90eKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAMeF1NYLgAcPYWJHcmlkTWVudUxhYmVsAgQAx4XU1guEHwd0b29sYm94JwDHhdTWC4AHDmFiR3JpZE1lbnVJY29uAgQAx4XU1guMHwxjb25zdHJ1Y3Rpb24nAMeF1NYLgAcTYWJHcmlkTWVudVNvcnRPcmRlcgIEAMeF1NYLmR8BMycAx4XU1guABw1hYkJvdE1lbnVJY29uAgQAx4XU1gubHwxjb25zdHJ1Y3Rpb24nAMeF1NYLgAcOYWJCb3RNZW51TGFiZWwCBADHhdTWC6gfDmFkZCB0byB0b29sYm94JwDHhdTWC4AHEmFiQm90TWVudVNvcnRPcmRlcgIEAMeF1NYLtx8BMycAx4XU1guABw5hYkJvdE1lbnVDb2xvcgIEAMeF1NYLuR8HIzU1RTY3OScAx4XU1guABw9hYkdyaWRNZW51Q29sb3ICBADHhdTWC8EfByM1NUU2NzkoAMeF1NYLgAcMYWJCb3RWZXJzaW9uAX0ZJwEEYm90cyQxZGQ1OTZlMS04ODI2LTQyNTctYjVkNi1kYzJhOWE1NzFkZjUBJwDHhdTWC8ofBWNvbG9yAgQAx4XU1gvLHwcjN0I2NEZGJwDHhdTWC8ofBGZvcm0CBADHhdTWC9MfA2hleCgAx4XU1gvKHwVzY2FsZQF8P8AAACgAx4XU1gvKHwZzY2FsZVoBez+EeuFHrhR7JwDHhdTWC8ofB29uQ2xpY2sCBADHhdTWC9kfiQlAc2hvdXQoInBhZE1lbnVSZXNldCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAicGFkTWVudSI7CgptYXNrcy5vbkdyaWRDbGljayA9IGBAIHNob3V0KCJwYWRNZW51UmVzZXQiKTtgOwptYXNrcy5wYWRNZW51UmVzZXQgPSBgQCBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7CgpjbGVhclRhZ01hc2tzKHRoaXNCb3QpO2A7Cgpjb25zdCBwYWRMb2NhdGlvbnMgPSB0YWdzLnBhZExvY2F0aW9uczsKY29uc3QgbWVudUJ1dHRvbiA9IHt9OwoKbWVudUJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwptZW51QnV0dG9uLnBhZE1lbnUgPSB0cnVlOwptZW51QnV0dG9uLnBhZE1lbnVSZXNldCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0geyJib3JkZXItcmFkaXVzIjoiOHB4IiwgIm1hcmdpbi10b3AiOiIzcHgifTsKbWVudUJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJsZWZ0IjsKbWVudUJ1dHRvbi5jb2xvciA9IHRhZ3MuY29sb3I7Cm1lbnVCdXR0b24ubWFuYWdlciA9IGdldExpbmsodGhpc0JvdCk7CgppZiAocGFkTG9jYXRpb25zLmxlbmd0aCA+IDApCnsKICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAibWVldGluZ19yb29tIjsKICAgIG1lbnVCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm1hbmFnZXIucGFkR29Ub0xvY2F0aW9uKHRhZ3MubGFiZWwpO2A7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYWRMb2NhdGlvbnMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgICAgbWVudUJ1dHRvbi5sYWJlbCA9IHBhZExvY2F0aW9uc1tpXTsKCiAgICAgICAgY3JlYXRlKG1lbnVCdXR0b24pOwogICAgfQp9CgptZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImNlbnRlciI7Cm1lbnVCdXR0b24ubGFiZWwgPSAiICAgICI7Cm1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiaW9zX3NoYXJlIjsKbWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MubWFuYWdlci5wYWRTaGFyZSgpO2A7CgpjcmVhdGUobWVudUJ1dHRvbik7CgppZiAoYnVpbGRlclZlcnNpb24pCnsKICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiZWRpdCI7CiAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLnBhZEVkaXRNZW51KCk7YDsKCiAgICBjcmVhdGUobWVudUJ1dHRvbik7Cn0nAMeF1NYLyh8Ob25Qb2ludGVyRW50ZXICBADHhdTWC+MoIUAgbWFza3Muc2NhbGUgPSB0YWdzLnNjYWxlICsgMC4xOycAx4XU1gvKHw1vblBvaW50ZXJFeGl0AgQAx4XU1guFKRlAIGNsZWFyVGFnTWFza3ModGhpc0JvdCk7JwDHhdTWC8ofBnN5c3RlbQIEAMeF1NYLnykOYWIuZmFjdG9yeS5wYWQnAMeF1NYLyh8PcGFkR29Ub0xvY2F0aW9uAgQAx4XU1guuKaIFQGxldCB0YXJnZXRMb2NhdGlvbiA9IHRoYXQ7CmxldCB1cmxDaGVjayA9IGZhbHNlOwoKdHJ5IAp7CiAgICB0YXJnZXRMb2NhdGlvbiA9IG5ldyBVUkwodGhhdCk7CgogICAgdXJsQ2hlY2sgPSAhdXJsQ2hlY2s7Cn0KY2F0Y2ggKGUpIAp7CgogICAgb3MudG9hc3QoInRyYXZlbGxpbmcgbm93Iik7CgogICAgb3MuZ29Ub1VSTCgiLz9hYj0iICsgdGFyZ2V0TG9jYXRpb24pOwp9CgpsZXQgaW5zdENoZWNrID0gdGFyZ2V0TG9jYXRpb24uc2VhcmNoUGFyYW1zLmhhcygiaW5zdCIpOwpsZXQgYWJDaGVjayA9IHRhcmdldExvY2F0aW9uLnNlYXJjaFBhcmFtcy5oYXMoImFiIik7CgppZiAoaW5zdENoZWNrKQp7CiAgICBpZiAoYWJDaGVjaykKICAgIHsKICAgICAgICBvcy5nb1RvVVJMKCIvP2dyaWRQb3J0YWw9aG9tZSZpbnN0PSIgKyB0YXJnZXRMb2NhdGlvbi5zZWFyY2hQYXJhbXMuZ2V0KCJpbnN0IikgKyAiJmFiPSIgKyB0YXJnZXRMb2NhdGlvbi5zZWFyY2hQYXJhbXMuZ2V0KCJhYiIpKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBvcy5nb1RvVVJMKCIvP2dyaWRQb3J0YWw9aG9tZSZpbnN0PSIgKyB0YXJnZXRMb2NhdGlvbi5zZWFyY2hQYXJhbXMuZ2V0KCJpbnN0IikpOwogICAgfQogICAgCn0KZWxzZSAKewogICAgb3MudG9hc3QoIm5vdCBhIHJlY29nbml6ZWQgdXJsIik7Cn0nAMeF1NYLyh8LcGFkRWRpdE1lbnUCBADHhdTWC9EugQ9Ac2hvdXQoInBhZE1lbnVSZXNldCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAicGFkTWVudSI7CgptYXNrcy5vbkdyaWRDbGljayA9IGBAIHNob3V0KCJwYWRNZW51UmVzZXQiKTtgOwptYXNrcy5wYWRNZW51UmVzZXQgPSBgQCBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7CgpjbGVhclRhZ01hc2tzKHRoaXNCb3QpO2A7Cgpjb25zdCBwYWRMb2NhdGlvbnMgPSB0YWdzLnBhZExvY2F0aW9uczsKY29uc3QgbWVudUJ1dHRvbiA9IHt9OwoKbWVudUJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwptZW51QnV0dG9uLnBhZE1lbnVTb3J0T3JkZXIgPSAxMDA7Cm1lbnVCdXR0b24ucGFkTWVudVJlc2V0ID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwptZW51QnV0dG9uLm1lbnVJdGVtU3R5bGUgPSB7ICJib3JkZXItcmFkaXVzIjogIjhweCIsICJtYXJnaW4tdG9wIjogIjNweCIgfTsKbWVudUJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJjZW50ZXIiOwptZW51QnV0dG9uLmNvbG9yID0gIiNENjZENUUiOwptZW51QnV0dG9uLm1hbmFnZXIgPSBnZXRMaW5rKHRoaXNCb3QpOwptZW51QnV0dG9uLmxhYmVsID0gIiAgICAiOwptZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImRlbGV0ZV9mb3JldmVyIjsKbWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MubWFuYWdlci5wYWRSZW1vdmVMb2NhdGlvbnMoKTtgOwptZW51QnV0dG9uLm9wdGlvbkNsaWNrID0gYEAgaWYgKGdldEJvdChieU1vZCh7cGFkTG9jYXRpb25PcHRpb246IHRydWUsIGZvcm1BZGRyZXNzOiAiY2hlY2tfYm94In0pKSkKewogICAgdGFncy5wYWRNZW51ID0gdHJ1ZTsKfQplbHNlCnsKICAgIHRhZ3MucGFkTWVudSA9IGZhbHNlOwp9YDsKCmxldCBkZWxldGVCdXR0b24gPSBjcmVhdGUobWVudUJ1dHRvbik7CgptZW51QnV0dG9uLnBhZE1lbnUgPSB0cnVlOwptZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImxlZnQiOwptZW51QnV0dG9uLmNvbG9yID0gdGFncy5jb2xvcjsKbWVudUJ1dHRvbi5kZWxldGVCdXR0b24gPSBnZXRMaW5rKGRlbGV0ZUJ1dHRvbik7CgppZiAocGFkTG9jYXRpb25zLmxlbmd0aCA+IDApIAp7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImNoZWNrX2JveF9vdXRsaW5lX2JsYW5rIjsKICAgIG1lbnVCdXR0b24ucGFkTG9jYXRpb25PcHRpb24gPSB0cnVlOwogICAgbWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgaWYgKHRhZ3MuZm9ybUFkZHJlc3MgPT0gImNoZWNrX2JveF9vdXRsaW5lX2JsYW5rIikKICAgIHsKICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gImNoZWNrX2JveCI7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9ICJjaGVja19ib3hfb3V0bGluZV9ibGFuayI7CiAgICB9CiAgICAKICAgIGxpbmtzLmRlbGV0ZUJ1dHRvbi5vcHRpb25DbGljayh0aGlzQm90KTtgOwoKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFkTG9jYXRpb25zLmxlbmd0aDsgaSsrKSAKICAgIHsKICAgICAgICBtZW51QnV0dG9uLnBhZE1lbnVTb3J0T3JkZXIgPSBpOwogICAgICAgIG1lbnVCdXR0b24ubGFiZWwgPSBwYWRMb2NhdGlvbnNbaV07CgogICAgICAgIGNyZWF0ZShtZW51QnV0dG9uKTsKICAgIH0KfQoKbWVudUJ1dHRvbi5vbkNsaWNrID0gbnVsbDsKbWVudUJ1dHRvbi5wYWRMb2NhdGlvbk9wdGlvbiA9IG51bGw7Cm1lbnVCdXR0b24ucGFkTWVudVNvcnRPcmRlciA9IC0xOwptZW51QnV0dG9uLmxhYmVsID0gIisiOwptZW51QnV0dG9uLmZvcm0gPSAiaW5wdXQiOwptZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gIm1lZXRpbmdfcm9vbSI7Cm1lbnVCdXR0b24ub25TdWJtaXQgPSBgQCBpZiAoIXRoYXQpCnsKICAgIHJldHVybjsKfQoKbGlua3MubWFuYWdlci5wYWRBZGRMb2NhdGlvbih0aGF0LnRleHQpO2A7CgpjcmVhdGUobWVudUJ1dHRvbik7JwDHhdTWC8ofCHBhZFNoYXJlAgQAx4XU1gvTPWNAc2hvdXQoInBhZE1lbnVSZXNldCIpOwoKb3Muc2V0Q2xpcGJvYXJkKGNvbmZpZ0JvdC50YWdzLnVybCk7Cgpvcy50b2FzdCgidXJsIGNvcGllZCB0byBjbGlwYm9hcmQiKTsnAMeF1NYLyh8OcGFkQWRkTG9jYXRpb24CBADHhdTWC7c+hwFAc2hvdXQoInBhZE1lbnVSZXNldCIpOwoKbGV0IG5ld0FycmF5ID0gdGFncy5wYWRMb2NhdGlvbnM7CgpuZXdBcnJheS5wdXNoKHRoYXQpOwoKdGFncy5wYWRMb2NhdGlvbnMgPSBuZXdBcnJheTsKCnRoaXNCb3QucGFkRWRpdE1lbnUoKTsnAMeF1NYLyh8ScGFkUmVtb3ZlTG9jYXRpb25zAgQAx4XU1gu/P+UDQGNvbnN0IHBhZE1lbnVPcHRpb25zID0gZ2V0Qm90cyhieU1vZCh7cGFkTG9jYXRpb25PcHRpb246IHRydWUsIGZvcm1BZGRyZXNzOiAiY2hlY2tfYm94IiwgcGFkTWVudTogdHJ1ZX0pKTsKY29uc3QgcmVtb3ZlVGFyZ2V0cyA9IFtdOwoKZm9yIChsZXQgaSA9IDA7IGkgPCBwYWRNZW51T3B0aW9ucy5sZW5ndGg7IGkrKykKewogICAgcmVtb3ZlVGFyZ2V0cy5wdXNoKHBhZE1lbnVPcHRpb25zW2ldLnRhZ3MubGFiZWwpOwp9CgpzaG91dCgicGFkTWVudVJlc2V0Iik7Cgpjb25zdCBwYWRMb2NhdGlvbnMgPSB0YWdzLnBhZExvY2F0aW9uczsKCmZvciAobGV0IGogPSAwOyBqIDwgcmVtb3ZlVGFyZ2V0cy5sZW5ndGg7IGorKykKewogICAgbGV0IHRhcmdldEluZGV4ID0gcGFkTG9jYXRpb25zLmluZGV4T2YocmVtb3ZlVGFyZ2V0c1tqXSk7CgogICAgcGFkTG9jYXRpb25zLnNwbGljZSh0YXJnZXRJbmRleCwgMSk7Cn0KCnRoaXNCb3QucGFkRWRpdE1lbnUoKTsoAMeF1NYLyh8MYWJCb3RWZXJzaW9uAX0JJwDHhdTWC8ofCWFiRmFjdG9yeQIEAMeF1NYLpkMEdHJ1ZScAx4XU1gvKHwhhYklnbm9yZQIEAMeF1NYLq0MEdHJ1ZScAx4XU1gvKHwtmYWN0b3J5SWNvbgIEAMeF1NYLsEMMbWVldGluZ19yb29tJwDHhdTWC8ofCWxpc3RlbmluZwIEAMeF1NYLvUMFZmFsc2UnAMeF1NYLyh8LdG9vbE1hbmFnZXICBADHhdTWC8NDKPCflJcxNGUxZmRhYy1jZmQ3LTRlN2UtYmRkMS05NjdhNDA4NWE3NTUnAMeF1NYLyh8Ib25DcmVhdGUCBADHhdTWC+pDUkBpZiAoIXRhZ3Muc3lzdGVtKQp7CiAgICBsZXQgYmFzZUFycmF5ID0gW107CgogICAgdGFncy5wYWRMb2NhdGlvbnMgPSBiYXNlQXJyYXk7Cn0nAMeF1NYLyh8PYWJNZW51U29ydE9yZGVyAgQAx4XU1gu9RAExJwEEYm90cyRhNWUyZWVkZi1jZDE3LTRiZjgtYTk4Ni1kZDgyYWExZmQ4NTgBJwDHhdTWC79EBWNvbG9yAgQAx4XU1gvARAcjNjIyNzczJwDHhdTWC79EBGZvcm0CBADHhdTWC8hEBWhlbGl4JwDHhdTWC79EBG1vZHMCBADHhdTWC85EGPCfp6x7ImNvbG9yIjogIiM2MjI3NzMifScAx4XU1gu/RAZzeXN0ZW0CBADHhdTWC+VEDmFiLmZhY3RvcnkubW9kJwDHhdTWC79ECWFiRmFjdG9yeQIEAMeF1NYL9EQEdHJ1ZScAx4XU1gu/RAhhYklnbm9yZQIEAMeF1NYL+UQEdHJ1ZScAx4XU1gu/RAlsaXN0ZW5pbmcCBADHhdTWC/5EBWZhbHNlJwDHhdTWC79EC2ZhY3RvcnlJY29uAgQAx4XU1guERQVoZWxpeCcAx4XU1gu/RAt0b29sTWFuYWdlcgIEAMeF1NYLikUo8J+UlzE0ZTFmZGFjLWNmZDctNGU3ZS1iZGQxLTk2N2E0MDg1YTc1NScAx4XU1gu/RAdvbkNsaWNrAgQAx4XU1guxRZMGQHNob3V0KCJtb2RNZW51UmVzZXQiKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gIm1vZE1lbnUiOwoKbWFza3Mub25HcmlkQ2xpY2sgPSBgQCBzaG91dCgibW9kTWVudVJlc2V0Iik7YDsKbWFza3MubW9kTWVudVJlc2V0ID0gYEAgY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOwpjb25maWdCb3QubWFza3MudGFnUG9ydGFsID0gbnVsbDsKCnRhZ1BvcnRhbEJvdC5tYXNrcy50YWdQb3J0YWxBbmNob3IgPSBudWxsOwoKY2xlYXJUYWdNYXNrcyh0aGlzQm90KTtgOwoKbGV0IG1vZE1lbnVCb3QgPSB7fTsKCm1vZE1lbnVCb3Quc3BhY2UgPSAidGVtcExvY2FsIjsKbW9kTWVudUJvdC5tb2RNZW51ID0gdHJ1ZTsKbW9kTWVudUJvdC5sYWJlbCA9ICJlZGl0IG1vZCI7Cm1vZE1lbnVCb3QuZm9ybUFkZHJlc3MgPSAiZWRpdCI7Cm1vZE1lbnVCb3QuY29sb3IgPSB0YWdzLmNvbG9yOwptb2RNZW51Qm90Lm1vZERpbWVuc2lvbiA9IHRoaXNCb3QuaWQgKyAiLm1vZHMiOwptb2RNZW51Qm90Lm1vZE1lbnVSZXNldCA9IGBAIGRlc3Ryb3kodGhpc0JvdCk7YDsKbW9kTWVudUJvdC5tZW51SXRlbVN0eWxlID0geyJib3JkZXItcmFkaXVzIjoiOHB4IiwgIm1hcmdpbi10b3AiOiIzcHgifTsKbW9kTWVudUJvdC5vbkNsaWNrID0gYEAgZGVzdHJveSh0aGlzQm90KTsKCmNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWwgPSB0YWdzLm1vZERpbWVuc2lvbjsKCnRhZ1BvcnRhbEJvdC5tYXNrcy50YWdQb3J0YWxBbmNob3JQb2ludCA9ICJ0b3AiOwpgOwoKY3JlYXRlKG1vZE1lbnVCb3QpOycAx4XU1gu/RAZvbkRyb3ACBADHhdTWC8VL6QJAaWYgKHRoYXQuZHJhZ0JvdCAhPSB0aGlzQm90IHx8IHRoYXQudG8uYm90LnRhZ3MuYWJGYWN0b3J5KQp7CiAgICByZXR1cm47Cn0KCmFwcGx5TW9kKHRoYXQudG8uYm90LCB0YWdzLm1vZHMpOwoKbGV0IHByZXZpb2l1c0RpbWVuc2lvbiA9IHRoYXQuZnJvbS5kaW1lbnNpb247Cgp0YWdzW3RoYXQudG8uZGltZW5zaW9uXSA9IG51bGw7CnRhZ3NbcHJldmlvaXVzRGltZW5zaW9uXSA9IHRydWU7CnRhZ3NbcHJldmlvaXVzRGltZW5zaW9uICsgIlgiXSA9IHRoYXQuZnJvbS54Owp0YWdzW3ByZXZpb2l1c0RpbWVuc2lvbiArICJZIl0gPSB0aGF0LmZyb20ueTsKdGFnc1twcmV2aW9pdXNEaW1lbnNpb24gKyAiWiJdID0gdGhhdC5mcm9tLno7KADHhdTWC79EDGFiQm90VmVyc2lvbgF9EycAx4XU1gu/RA9hYk1lbnVTb3J0T3JkZXICBADHhdTWC7BOATQnAQRib3RzJGM0NGViYzdmLTNkZjctNGU4ZS05NzgxLTE0ZTJjZThlMzRjOAEnAMeF1NYLsk4LZmFjdG9yeUljb24CBADHhdTWC7NOC2ludmVudG9yeV8yJwDHhdTWC7JOBWNvbG9yAgQAx4XU1gu/TgcjOTA4QkZDKADHhdTWC7JODGFiQm90VmVyc2lvbgF9GCcAx4XU1guyTgRmb3JtAgQAx4XU1gvITgZjaXJjbGUoAMeF1NYLsk4Fc2NhbGUBfQInAMeF1NYLsk4LdG9vbE1hbmFnZXICBADHhdTWC9BOKPCflJcxNGUxZmRhYy1jZmQ3LTRlN2UtYmRkMS05NjdhNDA4NWE3NTUnAMeF1NYLsk4Gc2NhbGVaAgQAx4XU1gv3TgMwLjEnAMeF1NYLsk4Gc3lzdGVtAgQAx4XU1gv7ThNhYi5mYWN0b3J5LmJvdFN0b3JlJwDHhdTWC7JOBm9uRHJvcAIEAMeF1NYLj09/QGlmICh0aGF0LmRyYWdCb3QgPT0gdGhpc0JvdCB8fCB0aGF0LmRyYWdCb3QudGFncy5zcGFjZSAhPSAic2hhcmVkIikKewogICAgcmV0dXJuOwp9Cgp0aGlzQm90W3RhZ3Muc3RvcmVNb2RlICsgIk9uRHJvcCJdKHRoYXQpOycAx4XU1guyThFib3RTdG9yZVJlamVjdEJvdAIEAMeF1NYLj1CKAkB0aGF0LmRyYWdCb3QudGFnc1t0aGF0LnRvLmRpbWVuc2lvbl0gPSBudWxsOwp0aGF0LmRyYWdCb3QudGFnc1t0aGF0LmZyb20uZGltZW5zaW9uXSA9IHRydWU7CnRoYXQuZHJhZ0JvdC50YWdzW3RoYXQuZnJvbS5kaW1lbnNpb24rIlgiXSA9IHRoYXQuZnJvbS54Owp0aGF0LmRyYWdCb3QudGFnc1t0aGF0LmZyb20uZGltZW5zaW9uKyJZIl0gPSB0aGF0LmZyb20ueTsKdGhhdC5kcmFnQm90LnRhZ3NbdGhhdC5mcm9tLmRpbWVuc2lvbisiWiJdID0gdGhhdC5mcm9tLno7JwDHhdTWC7JOCXN0b3JlTW9kZQIEAMeF1NYLmlIJdW5saW1pdGVkJwDHhdTWC7JOD3VubGltaXRlZE9uRHJvcAIEAMeF1NYLpFJlQGlmICh0YWdzLnRlbXBsYXRlKQp7CiAgICB0aGlzQm90LmJvdFN0b3JlUmVqZWN0Qm90KHRoYXQpOwoKICAgIHJldHVybjsKfQoKdGhpc0JvdC5hZGRUZW1wbGF0ZSh0aGF0KTsnAMeF1NYLsk4NbGltaXRlZE9uRHJvcAIEAMeF1NYLilOJAkBpZiAoKHRhZ3MuYm90U3RvcmVJRCAmJiB0aGF0LmRyYWdCb3QudGFncy5ib3RTdG9yZUlEICE9IHRhZ3MuYm90U3RvcmVJRCkgfHwgdGFncy5tYXhDb3VudCA9PSB0YWdzLmxhYmVsKQp7CiAgICB0aGlzQm90LmJvdFN0b3JlUmVqZWN0Qm90KHRoYXQpOwoKICAgIHJldHVybjsKfQoKdGFncy5sYWJlbCsrOwoKaWYgKHRhZ3MudGVtcGxhdGUpCnsKICAgIGRlc3Ryb3kodGhhdC5kcmFnQm90KTsKfQplbHNlCnsKICAgIHRoaXNCb3QuYWRkVGVtcGxhdGUodGhhdCk7Cn0nAMeF1NYLsk4LYWRkVGVtcGxhdGUCBADHhdTWC5RV4wtAdGFncy50ZW1wbGF0ZSA9IGdldExpbmsodGhhdC5kcmFnQm90KTsKCnRoYXQuZHJhZ0JvdC50YWdzLmxpc3RlbmluZyA9IGZhbHNlOwp0aGF0LmRyYWdCb3QudGFncy5wb2ludGFibGUgPSBmYWxzZTsKdGhhdC5kcmFnQm90LnRhZ3MudHJhbnNmb3JtZXIgPSB0aGlzQm90LmlkOwp0aGF0LmRyYWdCb3QudGFncy5jcmVhdG9yID0gdGhpc0JvdC5pZDsKdGhhdC5kcmFnQm90LnRhZ3MudHJhbnNmb3JtZXIgPSB0aGlzQm90LmlkOwp0aGF0LmRyYWdCb3QudGFnc1t0aGF0LnRvLmRpbWVuc2lvbiArICJYIl0gPSAwOwp0aGF0LmRyYWdCb3QudGFnc1t0aGF0LnRvLmRpbWVuc2lvbiArICJZIl0gPSAwOwp0aGF0LmRyYWdCb3QudGFnc1t0aGF0LnRvLmRpbWVuc2lvbiArICJaIl0gPSA1Owp0aGF0LmRyYWdCb3QudGFncy5zY2FsZSA9IHRoYXQuZHJhZ0JvdC50YWdzLnNjYWxlID8gdGhhdC5kcmFnQm90LnRhZ3Muc2NhbGUgLyAyIDogMC41Owp0aGF0LmRyYWdCb3QudGFncy5zY2FsZVggPSB0aGF0LmRyYWdCb3QudGFncy5zY2FsZVggPyB0aGF0LmRyYWdCb3QudGFncy5zY2FsZVggLyAyIDogMTsKdGhhdC5kcmFnQm90LnRhZ3Muc2NhbGVZID0gdGhhdC5kcmFnQm90LnRhZ3Muc2NhbGVZID8gdGhhdC5kcmFnQm90LnRhZ3Muc2NhbGVZIC8gMiA6IDE7CnRoYXQuZHJhZ0JvdC50YWdzLnNjYWxlWiA9IHRoYXQuZHJhZ0JvdC50YWdzLnNjYWxlWiA/IHRoYXQuZHJhZ0JvdC50YWdzLnNjYWxlWiAqIDEwIDogMTA7CgppZiAodGFncy5zdG9yZU1vZGUgPT0gImxpbWl0ZWQiKQp7CiAgICBsZXQgbmV3U3RvcmVJRCA9IHV1aWQoKTsKCiAgICB0YWdzLmJvdFN0b3JlSUQgPSBuZXdTdG9yZUlEOwoKICAgIHRoYXQuZHJhZ0JvdC50YWdzLmJvdFN0b3JlSUQgPSBuZXdTdG9yZUlEOwp9CgpsZXQgaGl0Qm94ID0ge307CgpoaXRCb3gudHJhbnNmb3JtZXIgPSB0aGlzQm90LmlkOwpoaXRCb3guY29sb3IgPSAiY2xlYXIiOwpoaXRCb3guZHJhZ2dhYmxlID0gZmFsc2U7CmhpdEJveC5tYW5hZ2VyID0gZ2V0TGluayh0aGlzQm90KTsKaGl0Qm94Lm9uRHJhZyA9IGBAIGxpbmtzLm1hbmFnZXIudGVtcGxhdGVEcmFnKHRoYXQpO2A7CmhpdEJveC5zY2FsZSA9IGxpbmtzLnRlbXBsYXRlLnRhZ3Muc2NhbGU7CmhpdEJveC5zY2FsZVggPSBsaW5rcy50ZW1wbGF0ZS50YWdzLnNjYWxlWDsKaGl0Qm94LnNjYWxlWSA9IGxpbmtzLnRlbXBsYXRlLnRhZ3Muc2NhbGVZOwpoaXRCb3guc2NhbGVaID0gbGlua3MudGVtcGxhdGUudGFncy5zY2FsZVo7CmhpdEJveFt0aGF0LnRvLmRpbWVuc2lvbl0gPSB0cnVlOwpoaXRCb3hbdGhhdC50by5kaW1lbnNpb24gKyAiWCJdID0gMDsKaGl0Qm94W3RoYXQudG8uZGltZW5zaW9uICsgIlkiXSA9IDA7CmhpdEJveFt0aGF0LnRvLmRpbWVuc2lvbiArICJaIl0gPSA1OwoKbGV0IG5ld0hpdGJveCA9IGNyZWF0ZShoaXRCb3gpOwoKbGlua3MuaGl0Qm94ID0gZ2V0TGluayhuZXdIaXRib3gpOwoKdGhpc0JvdC5pbml0aWF0ZUJvdFN0b3JlQW5pbWF0aW9uKCk7JwDHhdTWC7JOB29uQ2xpY2sCBADHhdTWC/hg/ApAc2hvdXQoImJvdFN0b3JlTWVudVJlc2V0Iik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJib3RTdG9yZU1lbnUiOwoKbWFza3Mub25HcmlkQ2xpY2sgPSBgQCBzaG91dCgiYm90U3RvcmVNZW51UmVzZXQiKTtgOwptYXNrcy5ib3RTdG9yZU1lbnVSZXNldCA9IGBAIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsKCmNsZWFyVGFnTWFza3ModGhpc0JvdCk7YDsKCmxldCBtZW51QnV0dG9uID0ge307CgptZW51QnV0dG9uLnNwYWNlID0gInRlbXBMb2NhbCI7Cm1lbnVCdXR0b24uYm90U3RvcmVNZW51ID0gdHJ1ZTsKbWVudUJ1dHRvbi5ib3RTdG9yZU1lbnVSZXNldCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0geyJib3JkZXItcmFkaXVzIjoiOHB4IiwgIm1hcmdpbi10b3AiOiIzcHgifTsKbWVudUJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJsZWZ0IjsKbWVudUJ1dHRvbi5jb2xvciA9IHRhZ3MuY29sb3I7Cm1lbnVCdXR0b24ubWFuYWdlciA9IGdldExpbmsodGhpc0JvdCk7Cm1lbnVCdXR0b24ub25DbGljayA9IGBAIHNob3V0KCJib3RTdG9yZU1lbnVSZXNldCIpOwogICAgCmxpbmtzLm1hbmFnZXIuY2hhbmdlU3RvcmVTdGF0ZSgpO2A7CgppZiAodGFncy5zdG9yZU1vZGUgPT0gInVubGltaXRlZCIpCnsKICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiaW52ZW50b3J5IjsKICAgIG1lbnVCdXR0b24ubGFiZWwgPSAiY2hhbmdlIHRvIGxpbWl0ZWQiOwoKICAgIGNyZWF0ZShtZW51QnV0dG9uKTsKfQplbHNlCnsKICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiZmlsZV9jb3B5IjsKICAgIG1lbnVCdXR0b24ubGFiZWwgPSAiY2hhbmdlIHRvIHVubGltaXRlZCI7CgogICAgY3JlYXRlKG1lbnVCdXR0b24pOwoKICAgIG1lbnVCdXR0b24ubGFiZWwgPSAiICAgICI7CiAgICBtZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImNlbnRlciI7CiAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLnRhZ3MudGVtcGxhdGVMb2NrID0gIWxpbmtzLm1hbmFnZXIudGFncy50ZW1wbGF0ZUxvY2sKICAgIAogICAgaWYgKGxpbmtzLm1hbmFnZXIudGFncy50ZW1wbGF0ZUxvY2spCiAgICB7CiAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9ICJsb2NrIjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gImxvY2tfb3BlbiI7CiAgICB9YDsKCiAgICBpZiAodGFncy50ZW1wbGF0ZUxvY2spCiAgICB7CiAgICAgICAgbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJsb2NrIjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImxvY2tfb3BlbiI7CiAgICB9CgogICAgY3JlYXRlKG1lbnVCdXR0b24pOwp9CgonAMeF1NYLsk4MdGVtcGxhdGVEcmFnAgQAx4XU1gv1a4EHQGlmICh0YWdzLnN0b3JlTW9kZSA9PSAibGltaXRlZCIpCnsKICAgIGlmICh0YWdzLmxhYmVsID09IDApCiAgICB7CiAgICAgICAgcmV0dXJuOwogICAgfQp9CgpsZXQgbmV3Qm90ID0gZ2V0TW9kKGxpbmtzLnRlbXBsYXRlKTsKCm5ld0JvdFt0aGF0LmZyb20uZGltZW5zaW9uXSA9IHRydWU7Cm5ld0JvdFt0aGF0LmZyb20uZGltZW5zaW9uICsgIlgiXSA9IHRhZ3NbdGhhdC5mcm9tLmRpbWVuc2lvbiArICJYIl07Cm5ld0JvdFt0aGF0LmZyb20uZGltZW5zaW9uICsgIlkiXSA9IHRhZ3NbdGhhdC5mcm9tLmRpbWVuc2lvbiArICJZIl07Cm5ld0JvdFt0aGF0LmZyb20uZGltZW5zaW9uICsgIloiXSA9IDA7Cm5ld0JvdC5saXN0ZW5pbmcgPSBudWxsOwpuZXdCb3QucG9pbnRhYmxlID0gbnVsbDsKbmV3Qm90LnRyYW5zZm9ybWVyID0gbnVsbDsKbmV3Qm90LmNyZWF0b3IgPSBudWxsOwpuZXdCb3QudHJhbnNmb3JtZXIgPSBudWxsOwpuZXdCb3Quc2NhbGUgPSBuZXdCb3Quc2NhbGUgPT0gMC41ID8gbnVsbCA6IG5ld0JvdC5zY2FsZSAqIDI7Cm5ld0JvdC5zY2FsZVggPSBuZXdCb3Quc2NhbGVYID09IDEgPyBudWxsIDogbmV3Qm90LnNjYWxlWCAqIDI7Cm5ld0JvdC5zY2FsZVkgPSBuZXdCb3Quc2NhbGVZID09IDEgPyBudWxsIDogbmV3Qm90LnNjYWxlWSAqIDI7Cm5ld0JvdC5zY2FsZVogPSBuZXdCb3Quc2NhbGVaID09IDEwID8gbnVsbCA6IG5ld0JvdC5zY2FsZVogLyAxMDsKbmV3Qm90LmJvdFN0b3JlSUQgPSB0YWdzLmJvdFN0b3JlSUQ7CgpsZXQgY3JlYXRlZEJvdCA9IGNyZWF0ZShuZXdCb3QpOwoKb3MucmVwbGFjZURyYWdCb3QoY3JlYXRlZEJvdCk7CgppZiAodGFncy5zdG9yZU1vZGUgPT0gImxpbWl0ZWQiKQp7CiAgICB0aGlzQm90LnJlZHVjZUxpbWl0ZWRDb3VudCgpOwp9JwDHhdTWC7JOEnJlZHVjZUxpbWl0ZWRDb3VudAIEAMeF1NYL93KNAkB0YWdzLmxhYmVsLS07CgppZiAodGFncy5sYWJlbCA9PSAwICYmICF0YWdzLnRlbXBsYXRlTG9jaykKewogICAgY2xlYXJJbnRlcnZhbCh0YWdzLnN0b3JlSW50ZXJ2YWwpOwoKICAgIGRlc3Ryb3kobGlua3MudGVtcGxhdGUpOwogICAgZGVzdHJveShsaW5rcy5oaXRCb3gpOwoKICAgIHRhZ3MudGVtcGxhdGUgPSBudWxsOwogICAgdGFncy5oaXRCb3ggPSBudWxsOwogICAgdGFncy5ib3RTdG9yZUlEID0gbnVsbDsKICAgIG1hc2tzLnN0b3JlSW50ZXJ2YWwgPSBudWxsOwp9JwDHhdTWC7JOCWFiRmFjdG9yeQIEAMeF1NYLhXUEdHJ1ZScAx4XU1guyTghhYklnbm9yZQIEAMeF1NYLinUEdHJ1ZScAx4XU1guyTglsaXN0ZW5pbmcCBADHhdTWC491BWZhbHNlJwDHhdTWC7JOEGNoYW5nZVN0b3JlU3RhdGUCBADHhdTWC5V17QRAaWYgKHRhZ3Muc3RvcmVNb2RlID09ICJ1bmxpbWl0ZWQiKQp7CiAgICB0YWdzLnN0b3JlTW9kZSA9ICJsaW1pdGVkIjsKCiAgICBjb25zdCBtYXhDb3VudCA9IGF3YWl0IG9zLnNob3dJbnB1dCgxLCB7CiAgICAgICAgdGl0bGU6ICdjaG9vc2UgbWF4JwogICAgfSk7CgogICAgaWYgKCFtYXhDb3VudCkKICAgIHsKICAgICAgICBtYXhDb3VudCA9IDE7CiAgICB9CgogICAgdGFncy5tYXhDb3VudCA9IG1heENvdW50OwoKICAgIGlmICh0YWdzLnRlbXBsYXRlKQogICAgewogICAgICAgIGxldCBuZXdTdG9yZUlEID0gdXVpZCgpOwoKICAgICAgICB0YWdzLmJvdFN0b3JlSUQgPSBuZXdTdG9yZUlEOwoKICAgICAgICBsaW5rcy50ZW1wbGF0ZS50YWdzLmJvdFN0b3JlSUQgPSBuZXdTdG9yZUlEOwoKICAgICAgICB0YWdzLmxhYmVsID0gMTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICB0YWdzLmxhYmVsID0gMDsKICAgIH0KfQplbHNlCnsKICAgIHRhZ3Muc3RvcmVNb2RlID0gInVubGltaXRlZCI7CgogICAgdGFncy5sYWJlbCA9IG51bGw7CiAgICB0YWdzLm1heENvdW50ID0gbnVsbDsKICAgIHRhZ3MudGVtcGxhdGVMb2NrID0gbnVsbDsKICAgIHRhZ3MuYm90U3RvcmVJRCA9IG51bGw7Cn0nAMeF1NYLsk4ZaW5pdGlhdGVCb3RTdG9yZUFuaW1hdGlvbgIEAMeF1NYLg3qLAUBpZiAoIXRhZ3Muc3RvcmVJbnRlcnZhbCkKewogICAgdGhpc0JvdC5hbmltYXRlQm90U3RvcmUoKTsKCiAgICBtYXNrcy5zdG9yZUludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4gdGhpc0JvdC5hbmltYXRlQm90U3RvcmUoKSwgMjAwMCk7Cn0nAMeF1NYLsk4PYW5pbWF0ZUJvdFN0b3JlAgQAx4XU1guPe5oCQGxldCByb3RaID0gY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCArICJSb3RhdGlvbloiOwpsZXQgdGFyZ2V0Um90YXRpb24gPSAzNjAgKiBNYXRoLlBJLzE4MDsKCmF3YWl0IGFuaW1hdGVUYWcobGlua3MudGVtcGxhdGUsIHJvdFosIHsKICAgIGZyb21WYWx1ZTogMCwKICAgIHRvVmFsdWU6IHRhcmdldFJvdGF0aW9uLAogICAgZWFzaW5nOnsKICAgICAgICBtb2RlOiAiaW5vdXQiLAogICAgICAgIHR5cGU6ICJsaW5lYXIiCiAgICB9LAogICAgZHVyYXRpb246IDIKfSkuY2F0Y2goZSA9PiB7fSk7JwDHhdTWC7JOD29uSW5zdFN0cmVhbWluZwIEAMeF1NYLqn1AQGlmICh0YWdzLnRlbXBsYXRlKQp7CiAgICB0aGlzQm90LmluaXRpYXRlQm90U3RvcmVBbmltYXRpb24oKTsKfScAx4XU1guyTglvbkRlc3Ryb3kCBADHhdTWC+t9I0BjbGVhckludGVydmFsKHRhZ3Muc3RvcmVJbnRlcnZhbCk7JwDHhdTWC7JOD2FiTWVudVNvcnRPcmRlcgIEAMeF1NYLj34BNScBBGJvdHMkZDE0MDIwNGMtNTVjNy00ZWMzLTkzNTQtOTNhZTc2MjZhODM2ASgAx4XU1guRfgZzY2FsZVoBez+EeuFHrhR7KADHhdTWC5F+BXNjYWxlAXs/44UeuFHrhScAx4XU1guRfgVjb2xvcgIEAMeF1NYLlH4EZ3JheScAx4XU1guRfgtzdHJva2VDb2xvcgIEAMeF1NYLmX4HIzVFNTg4MCcAx4XU1guRfglsaW5lQ29sb3ICBADHhdTWC6F+ByM1RTU4ODAoAMeF1NYLkX4IZHVyYXRpb24BfQEnAMeF1NYLkX4KZWFzaW5nVHlwZQIEAMeF1NYLqn4GbGluZWFyJwDHhdTWC5F+CmVhc2luZ01vZGUCBADHhdTWC7F+BWlub3V0JwDHhdTWC5F+CWxpbmVTdHlsZQIEAMeF1NYLt34EbGluZScAx4XU1guRfgZzeXN0ZW0CBADHhdTWC7x+EGFiLmZhY3RvcnkudHJhY2snAMeF1NYLkX4JYWJGYWN0b3J5AgQAx4XU1gvNfgR0cnVlJwDHhdTWC5F+CGFiSWdub3JlAgQAx4XU1gvSfgR0cnVlJwDHhdTWC5F+C3Rvb2xNYW5hZ2VyAgQAx4XU1gvXfijwn5SXMTRlMWZkYWMtY2ZkNy00ZTdlLWJkZDEtOTY3YTQwODVhNzU1JwDHhdTWC5F+C2ZhY3RvcnlJY29uAgQAx4XU1gv+fgh0aW1lbGluZSgAx4XU1guRfgxhYkJvdFZlcnNpb24BfRMnAMeF1NYLkX4Ib25DcmVhdGUCBADHhdTWC4h/b0B0YWdzLmNvbG9yID0gImNsZWFyIjsKCmlmICghdGFncy5saW5lVG8pCnsKICAgIHRoaXNCb3QuYWRkVHJhY2tOb2RlKHtkaW1lbnNpb246IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWx9KTsKfScAx4XU1guRfgxhZGRUcmFja05vZGUCBADHhdTWC/h/1wVAbGV0IGJvdE1vZCA9IGdldE1vZCh0aGlzQm90KTsKCmJvdE1vZFt0aGF0LmRpbWVuc2lvbiArICJZIl0gPSBib3RNb2RbdGhhdC5kaW1lbnNpb24gKyAiWSJdIC0gMzsKCmJvdE1vZC5saW5lVG8gPSB0aGlzQm90LmlkOwpib3RNb2QuY3JlYXRvciA9IHRoaXNCb3QuaWQ7CgpsZXQgbm9kZTIgPSBjcmVhdGUoYm90TW9kKTsKCnRhZ3MubGluZVRvID0gbm9kZTIuaWQ7CnRhZ3MuY3JlYXRvciA9IG5vZGUyLmlkOwoKbGV0IG5vZGUzID0gY3JlYXRlKGJvdE1vZCk7Cgpib3RNb2RbdGhhdC5kaW1lbnNpb24gKyAiWCJdID0gYm90TW9kW3RoYXQuZGltZW5zaW9uICsgIlgiXSArIDM7CgpsZXQgbm9kZTQgPSBjcmVhdGUoYm90TW9kKTsKCm5vZGUzLnRhZ3MubGluZVRvID0gbm9kZTQuaWQ7Cm5vZGUzLnRhZ3MuY3JlYXRvciA9IG5vZGU0LmlkOwpub2RlNC50YWdzLmxpbmVUbyA9IG5vZGUzLmlkOwpub2RlNC50YWdzLmNyZWF0b3IgPSBub2RlMy5pZDsKCmxldCBub2RlNSA9IGNyZWF0ZShib3RNb2QpOwoKYm90TW9kW3RoYXQuZGltZW5zaW9uICsgIlkiXSA9IGJvdE1vZFt0aGF0LmRpbWVuc2lvbiArICJZIl0gLSAzOwoKbGV0IG5vZGU2ID0gY3JlYXRlKGJvdE1vZCk7Cgpub2RlNS50YWdzLmxpbmVUbyA9IG5vZGU2LmlkOwpub2RlNS50YWdzLmNyZWF0b3IgPSBub2RlNi5pZDsKbm9kZTYudGFncy5saW5lVG8gPSBub2RlNS5pZDsKbm9kZTYudGFncy5jcmVhdG9yID0gbm9kZTUuaWQ7JwDHhdTWC5F+C2FiVHJhY2tOb2RlAgQAx4XU1gvQhQEEdHJ1ZScAx4XU1guRfglsaXN0ZW5pbmcCBADHhdTWC9WFAQVmYWxzZScAx4XU1guRfgZvbkRyb3ACBADHhdTWC9uFAZYFQGlmICh0aGF0LmRyYWdCb3QudGFncy5hYlRyYWNrTm9kZSkKewogICAgdGFnc1tjb25maWdCb3QudGFncy5ncmlkUG9ydGFsICsgIlgiXSA9IE1hdGgucm91bmQodGFnc1tjb25maWdCb3QudGFncy5ncmlkUG9ydGFsICsgIlgiXSk7CiAgICB0YWdzW2NvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgKyAiWSJdID0gTWF0aC5yb3VuZCh0YWdzW2NvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgKyAiWSJdKTsKCiAgICByZXR1cm47Cn0KZWxzZSBpZiAodGhhdC5kcmFnQm90LnRhZ3MuZmFjdG9yeUljb24gPT0gImhlbGl4IikKewogICAgdGhpc0JvdC5hcHBseU1vZFRvVHJhY2tOb2RlKHRoYXQpOwoKICAgIHRoYXQuZHJhZ0JvdC50YWdzW3RoYXQuZnJvbS5kaW1lbnNpb24gKyAiWCJdID0gdGhhdC5mcm9tLng7CiAgICB0aGF0LmRyYWdCb3QudGFnc1t0aGF0LmZyb20uZGltZW5zaW9uICsgIlkiXSA9IHRoYXQuZnJvbS55OwoKICAgIHJldHVybjsKfQoKdGhhdC5kcmFnQm90Lm1hc2tzLm9uRHJhZyA9ICJAIGNsZWFyVGltZW91dCh0YWdzLnRyYWNrVGltZW91dCk7IGNsZWFyQW5pbWF0aW9ucyh0aGlzQm90KTsiOwoKdGhpc0JvdC5hbmltYXRlVHJhY2soe2FuaW1hdGVkQm90OiB0aGF0LmRyYWdCb3QsIHRhcmdldE5vZGU6IGdldEJvdCgiaWQiLCB0YWdzLmxpbmVUbyl9KTsnAMeF1NYLkX4MYW5pbWF0ZVRyYWNrAgQAx4XU1gvyigGPDUBsZXQgY3VycmVudERpbSA9IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA/IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA6IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWw7CmxldCBhbmltYXRlZEJvdCA9IHRoYXQuYW5pbWF0ZWRCb3Q7CmxldCBuZXh0Tm9kZSA9IHRoYXQudGFyZ2V0Tm9kZTsKbGV0IG9yaWdpbk5vZGUgPSB0aGlzQm90OwoKaWYgKG5leHROb2RlLmlkID09IHRoaXNCb3QuaWQpCnsKICAgIGxldCBub2RlU3RhY2sgPSBnZXRCb3RzKGJ5TW9kKHthYlRyYWNrTm9kZTogdHJ1ZSwgW2N1cnJlbnREaW1dOiB0cnVlLCBbY3VycmVudERpbSArICJYIl06IHRhZ3NbY3VycmVudERpbSArICJYIl0sIFtjdXJyZW50RGltICsgIlkiXTogdGFnc1tjdXJyZW50RGltICsgIlkiXX0pKTsKCiAgICBpZiAobm9kZVN0YWNrLmxlbmd0aCA+PSAzKQogICAgewogICAgICAgIG9yaWdpbk5vZGUgPSBub2RlU3RhY2tbbWF0aC5yYW5kb21JbnQoMCwgbm9kZVN0YWNrLmxlbmd0aCldOwoKICAgICAgICBuZXh0Tm9kZSA9IGdldEJvdCgiaWQiLCBvcmlnaW5Ob2RlLnRhZ3MubGluZVRvKTsKICAgIH0KICAgIGVsc2UgaWYgKG5vZGVTdGFjay5sZW5ndGggPiAxKQogICAgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbm9kZVN0YWNrLmxlbmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKG5vZGVTdGFja1tpXS5pZCAhPSB0aGlzQm90LmlkKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBvcmlnaW5Ob2RlID0gbm9kZVN0YWNrW2ldOwoKICAgICAgICAgICAgICAgIG5leHROb2RlID0gZ2V0Qm90KCJpZCIsIG9yaWdpbk5vZGUudGFncy5saW5lVG8pOwoKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgZWxzZQogICAgewogICAgICAgIG5leHROb2RlID0gZ2V0Qm90KCJpZCIsIHRhZ3MubGluZVRvKTsKICAgIH0KfQoKYW5pbWF0ZWRCb3QubWFza3MudHJhY2tUaW1lb3V0ID0gc2V0VGltZW91dCgoKT0+IHdoaXNwZXIobmV4dE5vZGUsICJhbmltYXRlVHJhY2siLCB7YW5pbWF0ZWRCb3Q6IGFuaW1hdGVkQm90LCB0YXJnZXROb2RlOiBuZXh0Tm9kZX0pLCB0YWdzLmR1cmF0aW9uICogMTAwMCk7CgppZiAob3JpZ2luTm9kZS50YWdzLm1vZHMpCnsKICAgIGFwcGx5TW9kKGFuaW1hdGVkQm90LCBvcmlnaW5Ob2RlLnRhZ3MubW9kcyk7Cn0KCmF3YWl0IGFuaW1hdGVUYWcoYW5pbWF0ZWRCb3QsIHsKICAgIGZyb21WYWx1ZTogewogICAgICAgIFtjdXJyZW50RGltICsgIlgiXTogb3JpZ2luTm9kZS50YWdzW2N1cnJlbnREaW0gKyAiWCJdLAogICAgICAgIFtjdXJyZW50RGltICsgIlkiXTogb3JpZ2luTm9kZS50YWdzW2N1cnJlbnREaW0gKyAiWSJdCiAgICB9LAogICAgdG9WYWx1ZTogewogICAgICAgIFtjdXJyZW50RGltICsgIlgiXTogbmV4dE5vZGUudGFnc1tjdXJyZW50RGltICsgIlgiXSwKICAgICAgICBbY3VycmVudERpbSArICJZIl06IG5leHROb2RlLnRhZ3NbY3VycmVudERpbSArICJZIl0KICAgIH0sCiAgICBkdXJhdGlvbjogdGFncy5kdXJhdGlvbiwKICAgIGVhc2luZzp7CiAgICAgICAgdHlwZTogdGFncy5lYXNpbmdUeXBlLAogICAgICAgIG1vZGU6IHRhZ3MuZWFzaW5nTW9kZQogICAgfSwKICAgIHRhZ01hc2tTcGFjZTogInRlbXBMb2NhbCIKfSkuY2F0Y2goZSA9PiB7fSk7JwDHhdTWC5F+B29uQ2xpY2sCBADHhdTWC4KYAc0IQHNob3V0KCJhYlRyYWNrTWVudVJlc2V0Iik7Cgpjb25zdCBtZW51VHlwZSA9IHRoYXQubWVudVR5cGUgPyB0aGF0Lm1lbnVUeXBlIDogImJhc2UiOwpjb25zdCBtZW51VGFnID0gdGFnc1ttZW51VHlwZSArICJBQlRyYWNrTWVudSJdOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJUcmFja01lbnUiOwoKbWFza3Mub25HcmlkQ2xpY2sgPSBgQCBzaG91dCgiYWJUcmFja01lbnVSZXNldCIpO2A7Cm1hc2tzLmFiVHJhY2tNZW51UmVzZXQgPSBgQCBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7CgpjbGVhclRhZ01hc2tzKHRoaXNCb3QpO2A7CgpsZXQgbWVudUJ1dHRvbiA9IHt9OwoKbWVudUJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwptZW51QnV0dG9uLmFiVHJhY2tNZW51ID0gdHJ1ZTsKbWVudUJ1dHRvbi5hYlRyYWNrTWVudVJlc2V0ID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwptZW51QnV0dG9uLm1lbnVJdGVtU3R5bGUgPSB7ImJvcmRlci1yYWRpdXMiOiI4cHgiLCAibWFyZ2luLXRvcCI6IjNweCJ9OwptZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImxlZnQiOwptZW51QnV0dG9uLmxhYmVsQ29sb3IgPSAiI2ZmZmZmZiI7Cm1lbnVCdXR0b24uY29sb3IgPSB0YWdzLnN0cm9rZUNvbG9yOwptZW51QnV0dG9uLm1hbmFnZXIgPSBnZXRMaW5rKHRoaXNCb3QpOwoKZm9yIChsZXQgaSA9IDA7IGkgPCB0YWdzW21lbnVUeXBlICsgIkFCVHJhY2tNZW51Il0ubGVuZ3RoOyBpKyspCnsKICAgIGNyZWF0ZShtZW51QnV0dG9uLCB0YWdzW21lbnVUeXBlICsgIkFCVHJhY2tNZW51Il1baV0pOwp9CgppZiAodGFncy5tb2RzKQp7CiAgICBtZW51QnV0dG9uLmxhYmVsID0gInJlbW92ZSBtb2QiOwogICAgbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJoZWxpeCI7CiAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLnRhZ3MubW9kcyA9IG51bGw7CiAgICBsaW5rcy5tYW5hZ2VyLnRhZ3MuY29sb3IgPSAiY2xlYXIiOwogICAgbGlua3MubWFuYWdlci50YWdzLmZvcm0gPSBudWxsOwogICAgCiAgICBzaG91dCgnYWJUcmFja01lbnVSZXNldCcpO2A7CgogICAgY3JlYXRlKG1lbnVCdXR0b24pOwp9JwDHhdTWC5F+D2Jhc2VBQlRyYWNrTWVudQIEAMeF1NYL0KAB1QLwn6esW3sib25DbGljayI6ICJAIGxpbmtzLm1hbmFnZXIudXBkYXRlVHJhY2tEdXJhdGlvbigpOyIsICJmb3JtQWRkcmVzcyI6ICJhdl90aW1lciIsICJsYWJlbCI6ICJkdXJhdGlvbiJ9LAp7Im9uQ2xpY2siOiAiQCBsaW5rcy5tYW5hZ2VyLm9uQ2xpY2soe21lbnVUeXBlOiAnZWFzaW5nJ30pOyIsICJmb3JtQWRkcmVzcyI6ICJ0cmVuZGluZ19mbGF0IiwgImxhYmVsIjogImVhc2luZyB0eXBlIn0sCnsib25DbGljayI6ICJAIGxpbmtzLm1hbmFnZXIub25DbGljayh7bWVudVR5cGU6ICdtb2RlJ30pOyIsICJmb3JtQWRkcmVzcyI6ICJ0cmVuZGluZ191cCIsICJsYWJlbCI6ICJlYXNpbmcgbW9kZSJ9XScAx4XU1guRfhN1cGRhdGVUcmFja0R1cmF0aW9uAgQAx4XU1gukowGiAUBzaG91dCgiYWJUcmFja01lbnVSZXNldCIpOwoKbGV0IGlucHV0ID0gYXdhaXQgb3Muc2hvd0lucHV0KHRhZ3MuZHVyYXRpb24sIHsKICAgIHRpdGxlOiAiZHVyYXRpb24iCn0pOwoKaWYgKGlucHV0ICYmICFpc05hTihpbnB1dCkpCnsKICAgIHRhZ3MuZHVyYXRpb24gPSBpbnB1dDsKfScAx4XU1guRfhFlYXNpbmdBQlRyYWNrTWVudQIEAMeF1NYLx6QB7gnwn6esW3sib25DbGljayI6ICJAIGxpbmtzLm1hbmFnZXIudGFncy5lYXNpbmdUeXBlID0gdGFncy5sYWJlbDsgc2hvdXQoJ2FiVHJhY2tNZW51UmVzZXQnKTsiLCAiZm9ybUFkZHJlc3MiOiAiYXJyb3dfcmlnaHQiLCAibGFiZWwiOiAibGluZWFyIn0sCnsib25DbGljayI6ICJAIGxpbmtzLm1hbmFnZXIudGFncy5lYXNpbmdUeXBlID0gdGFncy5sYWJlbDsgc2hvdXQoJ2FiVHJhY2tNZW51UmVzZXQnKTsiLCAiZm9ybUFkZHJlc3MiOiAiYXJyb3dfcmlnaHQiLCAibGFiZWwiOiAicXVhZHJhdGljIn0sCnsib25DbGljayI6ICJAIGxpbmtzLm1hbmFnZXIudGFncy5lYXNpbmdUeXBlID0gdGFncy5sYWJlbDsgc2hvdXQoJ2FiVHJhY2tNZW51UmVzZXQnKTsiLCAiZm9ybUFkZHJlc3MiOiAiYXJyb3dfcmlnaHQiLCAibGFiZWwiOiAiY3ViaWMifSwKeyJvbkNsaWNrIjogIkAgbGlua3MubWFuYWdlci50YWdzLmVhc2luZ1R5cGUgPSB0YWdzLmxhYmVsOyBzaG91dCgnYWJUcmFja01lbnVSZXNldCcpOyIsICJmb3JtQWRkcmVzcyI6ICJhcnJvd19yaWdodCIsICJsYWJlbCI6ICJxdWFydGljIn0sCnsib25DbGljayI6ICJAIGxpbmtzLm1hbmFnZXIudGFncy5lYXNpbmdUeXBlID0gdGFncy5sYWJlbDsgc2hvdXQoJ2FiVHJhY2tNZW51UmVzZXQnKTsiLCAiZm9ybUFkZHJlc3MiOiAiYXJyb3dfcmlnaHQiLCAibGFiZWwiOiAicXVpbnRpYyJ9LAp7Im9uQ2xpY2siOiAiQCBsaW5rcy5tYW5hZ2VyLnRhZ3MuZWFzaW5nVHlwZSA9IHRhZ3MubGFiZWw7IHNob3V0KCdhYlRyYWNrTWVudVJlc2V0Jyk7IiwgImZvcm1BZGRyZXNzIjogImFycm93X3JpZ2h0IiwgImxhYmVsIjogInNpbnVzb2lkYWwifSwKeyJvbkNsaWNrIjogIkAgbGlua3MubWFuYWdlci50YWdzLmVhc2luZ1R5cGUgPSB0YWdzLmxhYmVsOyBzaG91dCgnYWJUcmFja01lbnVSZXNldCcpOyIsICJmb3JtQWRkcmVzcyI6ICJhcnJvd19yaWdodCIsICJsYWJlbCI6ICJleHBvbmVudGlhbCJ9LAp7Im9uQ2xpY2siOiAiQCBsaW5rcy5tYW5hZ2VyLnRhZ3MuZWFzaW5nVHlwZSA9IHRhZ3MubGFiZWw7IHNob3V0KCdhYlRyYWNrTWVudVJlc2V0Jyk7IiwgImZvcm1BZGRyZXNzIjogImFycm93X3JpZ2h0IiwgImxhYmVsIjogImNpcmN1bGFyIn0sCnsib25DbGljayI6ICJAIGxpbmtzLm1hbmFnZXIudGFncy5lYXNpbmdUeXBlID0gdGFncy5sYWJlbDsgc2hvdXQoJ2FiVHJhY2tNZW51UmVzZXQnKTsiLCAiZm9ybUFkZHJlc3MiOiAiYXJyb3dfcmlnaHQiLCAibGFiZWwiOiAiZWxhc3RpYyJ9XScAx4XU1guRfg9tb2RlQUJUcmFja01lbnUCBADHhdTWC7SuAZoD8J+nrFt7Im9uQ2xpY2siOiAiQCBsaW5rcy5tYW5hZ2VyLnRhZ3MuZWFzaW5nTW9kZSA9IHRhZ3MubGFiZWw7IHNob3V0KCdhYlRyYWNrTWVudVJlc2V0Jyk7IiwgImZvcm1BZGRyZXNzIjogImFycm93X3JpZ2h0IiwgImxhYmVsIjogImluIn0sCnsib25DbGljayI6ICJAIGxpbmtzLm1hbmFnZXIudGFncy5lYXNpbmdNb2RlID0gdGFncy5sYWJlbDsgc2hvdXQoJ2FiVHJhY2tNZW51UmVzZXQnKTsiLCAiZm9ybUFkZHJlc3MiOiAiYXJyb3dfcmlnaHQiLCAibGFiZWwiOiAib3V0In0sCnsib25DbGljayI6ICJAIGxpbmtzLm1hbmFnZXIudGFncy5lYXNpbmdNb2RlID0gdGFncy5sYWJlbDsgc2hvdXQoJ2FiVHJhY2tNZW51UmVzZXQnKTsiLCAiZm9ybUFkZHJlc3MiOiAiYXJyb3dfcmlnaHQiLCAibGFiZWwiOiAiaW5vdXQifV0nAMeF1NYLkX4TYXBwbHlNb2RUb1RyYWNrTm9kZQIEAMeF1NYLzbEB9QFAbGV0IGJvdE1vZCA9IHRoYXQuZHJhZ0JvdC50YWdzLm1vZHM7Cgp0YWdzLm1vZHMgPSBib3RNb2Q7CnRhZ3MuY29sb3IgPSB0YWdzLnN0cm9rZUNvbG9yOwp0YWdzLmZvcm0gPSAic3ByaXRlIjsKdGFncy5mb3JtQWRkcmVzcyA9ICJodHRwczovL2J1aWxkZXItbHRtLWZpbGVzLnMzLmFtYXpvbmF3cy5jb20vYjYzNTJlZGI4ODU5OGExOTY5YTY0OGY3ZGQ2ZDQxODIzM2VmMTE1OWJkNzhiNzM3Y2YyMGEzZGE1NDA1ZDFjNC5wbmciOycAx4XU1guRfg9hYk1lbnVTb3J0T3JkZXICBADHhdTWC8OzAQEyJwEEYm90cyRlYjc1ZjU1YS0yYmI5LTQzNzItYmY4Yy1jY2JhYzg2MzkwZmYBJwDHhdTWC8WzAQVjb2xvcgIEAMeF1NYLxrMBByM3QjY0RkYnAMeF1NYLxbMBCWRpbWVuc2lvbgIEAMeF1NYLzrMBBGhvbWUnAMeF1NYLxbMBBGZvcm0CBADHhdTWC9OzAQNoZXgoAMeF1NYLxbMBBXNjYWxlAX0CJwDHhdTWC8WzAQZzY2FsZVoCBADHhdTWC9izAQQwLjc1JwDHhdTWC8WzAQdvbkNsaWNrAgQAx4XU1gvdswEaQHRoaXNCb3Qub3BlblBvcnRhbCh0aGF0KTsnAMeF1NYLxbMBDm9uUG9pbnRlckVudGVyAgQAx4XU1gv4swETQG1hc2tzLnNjYWxlID0gMi4xOycAx4XU1gvFswELb25Ecm9wRW50ZXICBADHhdTWC4y0AWhAaWYgKHRoYXQuZHJhZ0JvdC5pZCAhPSB0aGlzQm90LmlkKSAvL01BWUJFIE1BS0UgQSBXQVkgRk9SIEFCIFRPIE5PVCBJTlRFUkFDVAp7CiAgICB0aGlzQm90Lm9uQ2xpY2soKTsKfScAx4XU1gvFswEGc3lzdGVtAgQAx4XU1gv1tAERYWIuZmFjdG9yeS5wb3J0YWwnAMeF1NYLxbMBDW9uUG9pbnRlckV4aXQCBADHhdTWC4e1ARRAbWFza3Muc2NhbGUgPSBudWxsOygAx4XU1gvFswEMYWJCb3RWZXJzaW9uAX0OJwDHhdTWC8WzAQlhYkZhY3RvcnkCBADHhdTWC521AQR0cnVlJwDHhdTWC8WzAQhhYklnbm9yZQIEAMeF1NYLorUBBHRydWUnAMeF1NYLxbMBC3Rvb2xNYW5hZ2VyAgQAx4XU1guntQEo8J+UlzE0ZTFmZGFjLWNmZDctNGU3ZS1iZGQxLTk2N2E0MDg1YTc1NScAx4XU1gvFswEJbGlzdGVuaW5nAgQAx4XU1gvOtQEFZmFsc2UnAMeF1NYLxbMBC2ZhY3RvcnlJY29uAgQAx4XU1gvUtQEFdG9waWMnAMeF1NYLxbMBCm9wZW5Qb3J0YWwCBADHhdTWC9q1AaUwQGNvbnN0IGN1cnJlbnREaW0gPSBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPyBjb25maWdCb3QudGFncy5tYXBQb3J0YWwgOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsOwpjb25zdCBhID0gTWF0aC5QSSAvIDY7CmNvbnN0IGhleFNjYWxlID0gNTsKY29uc3QgcG9ydGFsRGltZW5zaW9uID0gdGFncy5wb3J0YWxBZGRyZXNzOwoKbGV0IGhleCA9IHt9OwpsZXQgaGV4TnVtID0gMTsKCmhleC5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpoZXgucG9ydGFsUmVzZXQgPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CmhleC5mb3JtID0gImhleCI7CmhleC5jb2xvciA9IHRhZ3MuY29sb3I7CmhleC5vcmlnaW4gPSB0aGlzQm90LmlkOwpoZXgucG9ydGFsSGV4ID0gdHJ1ZTsKaGV4W2N1cnJlbnREaW0rIloiXSA9IC0xOwpoZXguYW5jaG9yUG9pbnQgPSAidG9wIjsKaGV4LnNjYWxlID0gNC41OwpoZXhbY3VycmVudERpbV0gPSB0cnVlOwpoZXgucG9pbnRhYmxlID0gZmFsc2U7CmhleC5zY2FsZVogPSAwLjAxOwpoZXguYW5pbWF0ZSA9IGBAIGFuaW1hdGVUYWcodGhpc0JvdCwgInNjYWxlIiwgewogICAgZnJvbVZhbHVlOiB0YWdzLnNjYWxlLAogICAgdG9WYWx1ZTogW3RoYXRdLAogICAgZWFzaW5nOiB7CiAgICAgICAgdHlwZTogInF1YWRyYXRpYyIsCiAgICAgICAgbW9kZTogIm91dCIKICAgIH0sCiAgICBkdXJhdGlvbjogMC4zCn0pLmNhdGNoKGUgPT4geyB9KTtgOwoKbGV0IGRpbWVuc2lvbkJvdHMgPSBnZXRCb3RzKHBvcnRhbERpbWVuc2lvbiwgdHJ1ZSk7CmxldCByaW5nTnVtOwoKaWYgKGRpbWVuc2lvbkJvdHMubGVuZ3RoID4gMCkKewogICAgbGV0IHhQYXJhbWV0ZXIgPSBkaW1lbnNpb25Cb3RzLnNvcnQoKGEsIGIpPT4gTWF0aC5hYnMoYi50YWdzW3BvcnRhbERpbWVuc2lvbisiWCJdKSAtIE1hdGguYWJzKGEudGFnc1twb3J0YWxEaW1lbnNpb24rIlgiXSkpWzBdLnRhZ3NbcG9ydGFsRGltZW5zaW9uKyJYIl07CiAgICBsZXQgeVBhcmFtZXRlciA9IGRpbWVuc2lvbkJvdHMuc29ydCgoYSwgYik9PiBNYXRoLmFicyhiLnRhZ3NbcG9ydGFsRGltZW5zaW9uKyJZIl0pIC0gTWF0aC5hYnMoYS50YWdzW3BvcnRhbERpbWVuc2lvbisiWSJdKSlbMF0udGFnc1twb3J0YWxEaW1lbnNpb24rIlkiXTsKCgogICAgbGV0IGRpc3RhbmNlID0gTWF0aC5mbG9vcihNYXRoLnNxcnQoTWF0aC5wb3coTWF0aC5mbG9vcihNYXRoLmFicyh4UGFyYW1ldGVyIC0gMCkpLCAyKSArIE1hdGgucG93KE1hdGguZmxvb3IoTWF0aC5hYnMoeVBhcmFtZXRlciAtIDApKSwgMikpIC8gaGV4U2NhbGUpICsgMTsKICAgIHJpbmdOdW0gPSA2ICogKGRpc3RhbmNlKSooZGlzdGFuY2UrMSkvMiArIDE7CgogICAgaWYgKHJpbmdOdW0gPiAzOTcpCiAgICB7CiAgICAgICAgcmluZ051bSA9IDM5NzsKICAgIH0KfQplbHNlCnsKICAgIHJpbmdOdW0gPSA3Owp9CgptYXNrcy5zY2FsZSA9IDAuMTsKbWFza3MucG9pbnRhYmxlID0gZmFsc2U7CgpsZXQgcHJldmlvdXNIZXg7Cgpmb3IgKGxldCBpID0gMDsgaSA8IHJpbmdOdW07IGkrKykKewogICAgaWYgKGkgIT0gMCkKICAgIHsKICAgICAgICBsZXQgZW1wdHlQb3MgPSBhd2FpdCBjaGVja0hleFBvcyhwcmV2aW91c0hleCwgY3VycmVudERpbSk7CgogICAgICAgIGlmIChlbXB0eVBvcyA9PSAwIHx8IGVtcHR5UG9zID09IDMpCiAgICAgICAgewogICAgICAgICAgICB2YXIgeCA9IHByZXZpb3VzSGV4LnRhZ3NbY3VycmVudERpbSsiWCJdOwogICAgICAgICAgICAKICAgICAgICAgICAgdmFyIGZsaXBYID0gMTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChlbXB0eVBvcyA9PSAwKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB2YXIgZmxpcFkgPSAwOwogICAgICAgICAgICAgICAgdmFyIHkgPSBwcmV2aW91c0hleC50YWdzW2N1cnJlbnREaW0rIlkiXSArIGhleFNjYWxlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdmFyIGZsaXBZID0gLTE7CiAgICAgICAgICAgICAgICB2YXIgeSA9IHByZXZpb3VzSGV4LnRhZ3NbY3VycmVudERpbSsiWSJdIC0gaGV4U2NhbGUvMjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICB2YXIgeCA9IHByZXZpb3VzSGV4LnRhZ3NbY3VycmVudERpbSsiWCJdICsgKGhleFNjYWxlICogMC44NSk7CiAgICAgICAgICAgIHZhciB5ID0gcHJldmlvdXNIZXgudGFnc1tjdXJyZW50RGltKyJZIl07CgogICAgICAgICAgICBpZiAoZW1wdHlQb3MgPT0gMSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdmFyIGZsaXBYID0gMTsKICAgICAgICAgICAgICAgIHZhciBmbGlwWSA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoZW1wdHlQb3MgPT0gMikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdmFyIGZsaXBYID0gMTsKICAgICAgICAgICAgICAgIHZhciBmbGlwWSA9IC0xOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGVtcHR5UG9zID09IDQpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHggPSBwcmV2aW91c0hleC50YWdzW2N1cnJlbnREaW0rIlgiXSAtIChoZXhTY2FsZSAqIDAuODUpOwoKICAgICAgICAgICAgICAgIHZhciBmbGlwWCA9IDE7CiAgICAgICAgICAgICAgICB2YXIgZmxpcFkgPSAtMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChlbXB0eVBvcyA9PSA1KQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB4ID0gcHJldmlvdXNIZXgudGFnc1tjdXJyZW50RGltKyJYIl0gLSAoaGV4U2NhbGUgKiAwLjg1KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdmFyIGZsaXBYID0gMTsKICAgICAgICAgICAgICAgIHZhciBmbGlwWSA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGhleFtjdXJyZW50RGltKyJYIl0gPSB4ICogZmxpcFg7CiAgICAgICAgaGV4W2N1cnJlbnREaW0rIlkiXSA9IHkgKyBmbGlwWSAqIGhleFNjYWxlLzI7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgaGV4W2N1cnJlbnREaW0rIlgiXSA9IHRhZ3NbY3VycmVudERpbSsiWCJdOwogICAgICAgIGhleFtjdXJyZW50RGltKyJZIl0gPSB0YWdzW2N1cnJlbnREaW0rIlkiXTsKICAgIH0KCiAgICBoZXguaGV4TnVtID0gaGV4TnVtOwoKICAgIGxldCBuZWFyYnlQb3J0YWxCb3QgPSBnZXRCb3QoYnlNb2Qoey8vYmVpbmcgbWlycm9yZWQgcmlnaHQgbm93CiAgICAgICAgW3BvcnRhbERpbWVuc2lvbl06IHRydWUsCiAgICAgICAgW3BvcnRhbERpbWVuc2lvbisiWCJdOiB4ID0+IHggPiAoaGV4W2N1cnJlbnREaW0rIlgiXSAtIHRhZ3NbY3VycmVudERpbSsiWCJdKSAtIGhleFNjYWxlICYmIHggPCAoaGV4W2N1cnJlbnREaW0rIlgiXSAtIHRhZ3NbY3VycmVudERpbSsiWCJdKSArIGhleFNjYWxlLAogICAgICAgIFtwb3J0YWxEaW1lbnNpb24rIlkiXTogeSA9PiB5ID4gKGhleFtjdXJyZW50RGltKyJZIl0gLSB0YWdzW2N1cnJlbnREaW0rIlkiXSkgLSBoZXhTY2FsZSAmJiB5IDwgKGhleFtjdXJyZW50RGltKyJZIl0gLSB0YWdzW2N1cnJlbnREaW0rIlkiXSkgKyBoZXhTY2FsZQogICAgfSkpOwoKICAgIGlmIChuZWFyYnlQb3J0YWxCb3QgfHwgaSA8IDcpCiAgICB7CiAgICAgICAgaGV4Lm9uUG9ydGFsQ29tcGxldGUgPSBmYWxzZTsKICAgICAgICBoZXguY29sb3IgPSB0YWdzLmNvbG9yOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGhleC5vblBvcnRhbENvbXBsZXRlID0gdHJ1ZTsKICAgICAgICBoZXguY29sb3IgPSAiY2xlYXIiOwogICAgfQoKICAgIGhleE51bSsrOwoKICAgIHByZXZpb3VzSGV4ID0gYXdhaXQgY3JlYXRlKGhleCk7Cn0KCmxldCBub25Qb3J0YWxIZXhlcyA9IGdldEJvdHMoIm9uUG9ydGFsQ29tcGxldGUiLCB0cnVlKTsKbGV0IHBvcnRhbEhleGVzID0gZ2V0Qm90cygib25Qb3J0YWxDb21wbGV0ZSIsIGZhbHNlKTsKCmZvciAobGV0IG4gPSAwOyBuIDwgbm9uUG9ydGFsSGV4ZXMubGVuZ3RoOyBuKyspCnsKICAgIGRlc3Ryb3kobm9uUG9ydGFsSGV4ZXNbbl0pOwp9Cgp3aGlzcGVyKHBvcnRhbEhleGVzLCAiYW5pbWF0ZSIsIGhleFNjYWxlKTsKCm1hc2tzLmZvcm0gPSAicG9ydGFsIjsKbWFza3MuZm9ybUFkZHJlc3MgPSB0YWdzLnBvcnRhbEFkZHJlc3M7Cm1hc2tzLnBvcnRhbEhleEJvdHMgPSBnZXRMaW5rKHBvcnRhbEhleGVzKTsKCnRoaXNCb3QucG9ydGFsTWVudSgpOwoKZnVuY3Rpb24gY2hlY2tIZXhQb3MoaGV4LCBkaW1lbnNpb24pCnsKICAgIGxldCBzY2FsZVZhciA9IGhleFNjYWxlLzI7CiAgICBsZXQgeFBvcyA9IGhleC50YWdzW2RpbWVuc2lvbisiWCJdOwogICAgbGV0IHlQb3MgPSBoZXgudGFnc1tkaW1lbnNpb24rIlkiXTsKICAgIGxldCBoZXhNYXRoVmFyID0gTWF0aC5QSSAvIDY7CiAgICBsZXQgeFNwYWNpbmdQbHVzID0geFBvcyArIHNjYWxlVmFyICsgKDEgKyBNYXRoLmNvcyhoZXhNYXRoVmFyKSk7CiAgICBsZXQgeFNwYWNpbmdNaW51cyA9IHhQb3MgLSAoc2NhbGVWYXIgKyAoMSArIE1hdGguY29zKGhleE1hdGhWYXIpKSk7CiAgICBsZXQgeVNwYWNpbmdUb3AgPSBNYXRoLmZsb29yKGhleC50YWdzLnNjYWxlKSArIHlQb3M7CiAgICBsZXQgeVNwYWNpbmdVcCA9IHlQb3MgKyBzY2FsZVZhciAqIE1hdGguc2luKGhleE1hdGhWYXIpOwogICAgbGV0IHlTcGFjaW5nRG93biA9IHlQb3MgLSBzY2FsZVZhciAqIE1hdGguc2luKGhleE1hdGhWYXIpOwogICAgbGV0IHlTcGFjaW5nQm90dG9tID0geVBvcyAtIE1hdGguZmxvb3IoaGV4LnRhZ3Muc2NhbGUpOwogICAgbGV0IHhDaGVjayA9IFt4UG9zLCB4U3BhY2luZ1BsdXMsIHhTcGFjaW5nUGx1cywgeFBvcywgeFNwYWNpbmdNaW51cywgeFNwYWNpbmdNaW51c107CiAgICBsZXQgeUNoZWNrID0gW3lTcGFjaW5nVG9wLCB5U3BhY2luZ1VwLCB5U3BhY2luZ0Rvd24sIHlTcGFjaW5nQm90dG9tLCB5U3BhY2luZ0Rvd24sIHlTcGFjaW5nVXBdOwogICAgbGV0IHRvdGFsTmVpZ2hib3JzID0gMDsKICAgIGxldCBuZWlnaGJvckFycmF5ID0gW10KCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDY7IGkrKykKICAgIHsKICAgICAgICBsZXQgaGV4TmVpZ2hib3IgPSBnZXRCb3QoYnlNb2QoewogICAgICAgICAgICBbZGltZW5zaW9uXTogdHJ1ZSwgCiAgICAgICAgICAgIFtkaW1lbnNpb24rIlgiXTogeCA9PiB4ID4geENoZWNrW2ldIC0gc2NhbGVWYXIgJiYgeCA8IHhDaGVja1tpXSArIHNjYWxlVmFyLCAKICAgICAgICAgICAgW2RpbWVuc2lvbisiWSJdOiB5ID0+IHkgPiB5Q2hlY2tbaV0gLSBzY2FsZVZhciAmJiB5IDwgeUNoZWNrW2ldICsgc2NhbGVWYXIsCiAgICAgICAgICAgIG9yaWdpbjogaGV4LnRhZ3Mub3JpZ2luLAogICAgICAgICAgICBwb3J0YWxIZXg6IHRydWUKICAgICAgICB9KSk7CgogICAgICAgIGlmICghaGV4TmVpZ2hib3IpCiAgICAgICAgewogICAgICAgICAgICBuZWlnaGJvckFycmF5LnB1c2goImVtcHR5Iik7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIG5laWdoYm9yQXJyYXkucHVzaChoZXhOZWlnaGJvcik7CiAgICAgICAgICAgIHRvdGFsTmVpZ2hib3JzKys7CiAgICAgICAgfQogICAgfQoKICAgIGlmICh0b3RhbE5laWdoYm9ycyA9PSAwKQogICAgewogICAgICAgIHZhciB0YXJnZXQgPSAwOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHZhciBlbXB0eSA9IGZhbHNlOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDY7IGorKykKICAgICAgICB7CiAgICAgICAgICAgIGxldCBuZXh0RW1wdHkgPSBuZWlnaGJvckFycmF5W2pdOwoKICAgICAgICAgICAgaWYgKG5leHRFbXB0eSA9PSAiZW1wdHkiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBlbXB0eSA9IHRydWU7CgogICAgICAgICAgICAgICAgaWYgKGogPT0gNSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gNTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZihuZXh0RW1wdHkgIT0gImVtcHR5IiAmJiBlbXB0eSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9IGotMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHRhcmdldDsKfScAx4XU1gvFswEJcG9pbnRhYmxlAgQAx4XU1guA5gEEdHJ1ZScAx4XU1gvFswELb25HcmlkQ2xpY2sCBADHhdTWC4XmAZMBQGlmICh0YWdzLmZvcm0gIT0gInBvcnRhbCIpCnsKICAgIHJldHVybjsKfQoKbGV0IHBvcnRhbENsaWNrID0gdGhpc0JvdC5wb3J0YWxQb3NpdGlvbkNoZWNrKHRoYXQpOwoKaWYgKCFwb3J0YWxDbGljaykKewogICAgdGhpc0JvdC5jbG9zZVBvcnRhbCgpOwp9JwDHhdTWC8WzAQtjbG9zZVBvcnRhbAIEAMeF1NYLmecBakB3aGlzcGVyKGxpbmtzLnBvcnRhbEhleEJvdHMsICJwb3J0YWxSZXNldCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOwoKY2xlYXJUYWdNYXNrcyh0aGlzQm90KTsnAMeF1NYLxbMBCnBvcnRhbE1lbnUCBADHhdTWC4ToAeIHQHNob3V0KCJhYlBvcnRhbE1lbnVSZXNldCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJQb3J0YWxNZW51IjsKCmxldCBtZW51QnV0dG9uID0ge307CgptZW51QnV0dG9uLnNwYWNlID0gInRlbXBMb2NhbCI7Cm1lbnVCdXR0b24uYWJQb3J0YWxNZW51ID0gdHJ1ZTsKbWVudUJ1dHRvbi5hYlBvcnRhbE1lbnVSZXNldCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbWVudUJ1dHRvbi5jb2xvciA9IHRhZ3MuY29sb3I7Cm1lbnVCdXR0b24ubWFuYWdlciA9IGdldExpbmsodGhpc0JvdCk7Cm1lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICI5cHggOXB4IDlweCA5cHgiLCAibWFyZ2luLXRvcCI6ICI2cHgifWA7Cm1lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAiY2VudGVyIjsKbWVudUJ1dHRvbi5sYWJlbCA9IHRhZ3MucG9ydGFsQWRkcmVzczsKCmNyZWF0ZShtZW51QnV0dG9uKTsKCm1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiZWRpdCI7Cm1lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAibGVmdCI7Cm1lbnVCdXR0b24ubGFiZWwgPSAiZWRpdCBkaW1lbnNpb24iOwptZW51QnV0dG9uLnRhcmdldCA9IHRoaXNCb3QuaWQ7Cm1lbnVCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm1hbmFnZXIucG9ydGFsQ2hhbmdlRGltZW5zaW9uKCk7YDsKCmNyZWF0ZShtZW51QnV0dG9uKTsKCm1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiYXJyb3dfZm9yd2FyZCI7Cm1lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAibGVmdCI7Cm1lbnVCdXR0b24ubGFiZWwgPSAiZ28gdG8gZGltZW5zaW9uIjsKbWVudUJ1dHRvbi50YXJnZXQgPSB0YWdzLmZvcm1BZGRyZXNzOwptZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBzaG91dCgiYWJQb3J0YWxNZW51UmVzZXQiKTsKCmNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPSBsaW5rcy5tYW5hZ2VyLnRhZ3MucG9ydGFsQWRkcmVzcztgOwoKY3JlYXRlKG1lbnVCdXR0b24pOycAx4XU1gvFswEIb25DcmVhdGUCBADHhdTWC+XvAT5AaWYgKCF0YWdzLnBvcnRhbEFkZHJlc3MpCnsKICAgIHRhZ3MucG9ydGFsQWRkcmVzcyA9IHV1aWQoKTsKfScAx4XU1gvFswETcG9ydGFsUG9zaXRpb25DaGVjawIEAMeF1NYLpPABpBZAbGV0IGN1cnJlbnREaW0gPSB0aGF0LmRpbWVuc2lvbiA/IHRoYXQuZGltZW5zaW9uIDogdGhhdC50by5kaW1lbnNpb247CmxldCBwb3NZID0gdGhhdC5wb3NpdGlvbiA/IHRoYXQucG9zaXRpb24ueSA6IHRoYXQudG8ueTsKbGV0IHBvc1ggPSB0aGF0LnBvc2l0aW9uID8gdGhhdC5wb3NpdGlvbi54IDogdGhhdC50by54OwpsZXQgcG9ydGFsSGV4Qm90cyA9IGxpbmtzLnBvcnRhbEhleEJvdHM7CmxldCBwb3J0YWxFbnRyeSA9IGZhbHNlOwoKZm9yIChsZXQgaSA9IDA7IGkgPCBwb3J0YWxIZXhCb3RzLmxlbmd0aDsgaSsrKSAKewogICAgbGV0IGN1cnJlbnRIZXggPSBwb3J0YWxIZXhCb3RzW2ldOwogICAgbGV0IG1heFkgPSBjdXJyZW50SGV4LnRhZ3NbY3VycmVudERpbSArICJZIl0gKyBjdXJyZW50SGV4LnRhZ3Muc2NhbGUgLyAyOwogICAgbGV0IG1pblkgPSBjdXJyZW50SGV4LnRhZ3NbY3VycmVudERpbSArICJZIl0gLSBjdXJyZW50SGV4LnRhZ3Muc2NhbGUgLyAyOwoKICAgIGlmIChwb3NZIDw9IG1heFkgJiYgcG9zWSA+PSBtaW5ZKSB7CgogICAgICAgIC8vU0VUVVAgQSBDSEVDSyBGT1IgV0hFTiBYID0gREVDSyBYCiAgICAgICAgbGV0IG1heFggPSBjdXJyZW50SGV4LnRhZ3NbY3VycmVudERpbSArICJYIl0gKyBjdXJyZW50SGV4LnRhZ3Muc2NhbGUgLyAyICsgMC41OwogICAgICAgIGxldCBtaW5YID0gY3VycmVudEhleC50YWdzW2N1cnJlbnREaW0gKyAiWCJdIC0gY3VycmVudEhleC50YWdzLnNjYWxlIC8gMiAtIDAuNTsKCiAgICAgICAgaWYgKHBvc1ggPD0gbWF4WCAmJiBwb3NYID49IG1pblgpIHsKICAgICAgICAgICAgaWYgKHBvc1ggPD0gY3VycmVudEhleC50YWdzW2N1cnJlbnREaW0gKyAiWCJdICsgMC4zICYmIHBvc1ggPj0gY3VycmVudEhleC50YWdzW2N1cnJlbnREaW0gKyAiWCJdIC0gMC4zKS8vbm90IHBlcmZlY3QgcGFydCBvZiBhbGcKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKHBvc1kgPj0gY3VycmVudEhleC50YWdzW2N1cnJlbnREaW0gKyAiWSJdIC0gY3VycmVudEhleC50YWdzLnNjYWxlIC8gMiAmJiBwb3NZIDw9IGN1cnJlbnRIZXgudGFnc1tjdXJyZW50RGltICsgIlkiXSArIGN1cnJlbnRIZXgudGFncy5zY2FsZSAvIDIpIAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHBvcnRhbEVudHJ5ID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCBtaWRYID0gY3VycmVudEhleC50YWdzW2N1cnJlbnREaW0gKyAiWCJdOwogICAgICAgICAgICBsZXQgbWlkWSA9IGN1cnJlbnRIZXgudGFnc1tjdXJyZW50RGltICsgIlkiXTsKICAgICAgICAgICAgY29uc3QgYSA9IE1hdGgucG93KGN1cnJlbnRIZXgudGFncy5zY2FsZSAvIDIsIDIpOwogICAgICAgICAgICBjb25zdCBiID0gTWF0aC5wb3coYSAvIDIsIDIpOwogICAgICAgICAgICBjb25zdCBtYXhEaXN0YW5jZSA9IE1hdGguc3FydChNYXRoLmFicyhhIC0gYikpOwogICAgICAgICAgICBsZXQgc2xvcGU7CgogICAgICAgICAgICBpZiAoKHBvc1ggPiBtaWRYICYmIHBvc1kgPiBtaWRZKSB8fCAocG9zWCA8IG1pZFggJiYgcG9zWSA8IG1pZFkpKSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgc2xvcGUgPSAobWF4WSAtIG1pblkpIC8gKG1heFggLSBtaW5YKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChwb3NYID4gbWlkWCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBzbG9wZSA9IChtYXhYIC0gbWluWCkgLyAobWF4WSAtIG1pblkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSAKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBzbG9wZSA9IDEgLyAobWF4WCAtIG1pblgpIC8gKG1heFkgLSBtaW5ZKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGV0IGMxID0gbWF4WSAtIChtYXhYICogc2xvcGUpOwogICAgICAgICAgICBsZXQgYzIgPSBwb3NZIC0gKHBvc1ggKiBzbG9wZSk7CiAgICAgICAgICAgIGxldCBhY3R1YWxEaXN0YW5jZSA9IE1hdGguYWJzKGMyIC0gYzEpIC8gTWF0aC5zcXJ0KE1hdGgucG93KHNsb3BlLCAyKSArIDEpOwoKICAgICAgICAgICAgaWYgKGFjdHVhbERpc3RhbmNlIDw9IG1heERpc3RhbmNlKSAKICAgICAgICAgICAgeyAgIAogICAgICAgICAgICAgICAgcG9ydGFsRW50cnkgPSB0cnVlOwoKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vTk9UIFNVUkUgT0YgVEhJUyBDT0RFUyBORUVEPwogICAgLy8gaWYgKHRoYXQucG9ydGFsSUQpIAogICAgLy8gewogICAgLy8gICAgIGlmICh0aGF0LnBvcnRhbElEID09IGN1cnJlbnRIZXgudGFncy5vcmlnaW4pIAogICAgLy8gICAgIHsKICAgIC8vICAgICAgICAgcG9ydGFsRW50cnkgPSB0cnVlOwoKICAgIC8vICAgICAgICAgYnJlYWs7CiAgICAvLyAgICAgfQogICAgLy8gfQp9CgovLyBsZXQgcG9ydGFsQm90cyA9IGdldEJvdHMoInBvcnRhbEhleEJvdHMiKTsvL0NIRUNLIFRPIFNFRSBJRiBUSEVSRSBBUkUgT1RIRVIgT1BFTiBQT1JUQUwgKG5vdCBzdXJlIEkgbmVlZCB0aGlzKQoKLy8gZm9yIChsZXQgaSA9IDA7IGkgPCBwb3J0YWxCb3RzLmxlbmd0aDsgaSsrKSAKLy8gewovLyAgICAgaWYgKHBvcnRhbEJvdHNbaV0uaWQgIT0gdGhpc0JvdC5pZCkgCi8vICAgICB7Ci8vICAgICAgICAgd2hpc3Blcihwb3J0YWxCb3RzW2ldLCAiY2xvc2VQb3J0YWwiKTsKLy8gICAgIH0KLy8gfQoKcmV0dXJuIHBvcnRhbEVudHJ5OycAx4XU1gvFswEMb25BbnlCb3REcm9wAgQAx4XU1gvJhgLVBEBpZiAodGhhdC5kcmFnQm90LmlkID09IHRoaXNCb3QuaWQpCnsKICAgIGNsZWFySW50ZXJ2YWwodGFncy5pbnRlcnZhbCk7CgogICAgbWFza3MuaW50ZXJ2YWwgPSBudWxsOwoKICAgIHJldHVybjsKfQoKaWYgKHRhZ3MuZm9ybSAhPSAicG9ydGFsIikKewogICAgcmV0dXJuOwp9Cgpjb25zdCBjdXJyZW50RGltID0gdGhhdC50by5kaW1lbnNpb247CmNvbnN0IHBvcnRhbERyb3AgPSBhd2FpdCB0aGlzQm90LnBvcnRhbFBvc2l0aW9uQ2hlY2sodGhhdCk7CgppZiAocG9ydGFsRHJvcCkgCnsKICAgIGxldCBuZXdEaW0gPSB0YWdzLnBvcnRhbEFkZHJlc3M7CgogICAgdGhhdC5kcmFnQm90LnRhZ3NbbmV3RGltXSA9IHRydWU7CiAgICB0aGF0LmRyYWdCb3QudGFnc1tuZXdEaW0gKyAiWCJdID0gdGhhdC5kcmFnQm90LnRhZ3NbY3VycmVudERpbSArICJYIl0gLSB0YWdzW2N1cnJlbnREaW0gKyAiWCJdOwogICAgdGhhdC5kcmFnQm90LnRhZ3NbbmV3RGltICsgIlkiXSA9IHRoYXQuZHJhZ0JvdC50YWdzW2N1cnJlbnREaW0gKyAiWSJdIC0gdGFnc1tjdXJyZW50RGltICsgIlkiXTsKICAgIHRoYXQuZHJhZ0JvdC50YWdzW2N1cnJlbnREaW1dID0gbnVsbDsKfScAx4XU1gvFswEGb25EcmFnAgQAx4XU1gufiwJeQGlmICghdGFncy5pbnRlcnZhbCkKewogICAgbWFza3MuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB0aGlzQm90LnBvc2l0aW9uQ2hlY2soKSwgMTAwKTsKfScAx4XU1gvFswEVcG9ydGFsQ2hhbmdlRGltZW5zaW9uAgQAx4XU1gv+iwK+AUBjb25zdCBuZXdEaW1lbnNpb24gPSBhd2FpdCBvcy5zaG93SW5wdXQodGFncy5wb3J0YWxBZGRyZXNzLCB7CiAgICB0aXRsZTogImVkaXQgZGltZW5zaW9uIgp9KTsKCmlmICghbmV3RGltZW5zaW9uKQp7CiAgICByZXR1cm47Cn07Cgp0YWdzLnBvcnRhbEFkZHJlc3MgPSBuZXdEaW1lbnNpb247Cgp0aGlzQm90LnBvcnRhbE1lbnUoKTsnAMeF1NYLxbMBDXBvc2l0aW9uQ2hlY2sCBADHhdTWC72NAqgMQGxldCBoZWlnaHQgPSBncmlkUG9ydGFsQm90LnRhZ3MucGl4ZWxIZWlnaHQ7CmxldCBib3RUaGlyZCA9IGhlaWdodCAtIChoZWlnaHQgLyA4KTsKbGV0IHBvaW50ZXJZID0gZ3JpZFBvcnRhbEJvdC50YWdzLnBvaW50ZXJQaXhlbFk7CgppZiAocG9pbnRlclkgPiBib3RUaGlyZCkKewogICAgaWYgKGNvbmZpZ0JvdC50YWdzLm1pbmlHcmlkUG9ydGFsICE9IHRhZ3MucG9ydGFsQWRkcmVzcykKICAgIHsKICAgICAgICBjb25maWdCb3QudGFncy5taW5pR3JpZFBvcnRhbCA9IHRhZ3MucG9ydGFsQWRkcmVzczsKCiAgICAgICAgbWluaUdyaWRQb3J0YWxCb3QudGFncy5taW5pUG9ydGFsV2lkdGggPSAxOwoKICAgICAgICBtaW5pR3JpZFBvcnRhbEJvdC50YWdzLnBvcnRhbENvbG9yID0gdGFncy5jb2xvcjsKICAgIH0KfQplbHNlCnsKICAgIGlmIChjb25maWdCb3QudGFncy5taW5pR3JpZFBvcnRhbCA9PSB0YWdzLnBvcnRhbEFkZHJlc3MpCiAgICB7CiAgICAgICAgY29uZmlnQm90LnRhZ3MubWluaUdyaWRQb3J0YWwgPSBudWxsOwogICAgICAgIG1pbmlHcmlkUG9ydGFsQm90LnRhZ3MucG9ydGFsQ29sb3IgPSBudWxsOwogICAgICAgIG1pbmlHcmlkUG9ydGFsQm90LnRhZ3MubWluaVBvcnRhbFdpZHRoID0gbnVsbDsKICAgIH0KfQoKCgoKLy8gaWYgKHRoYXQuYm90LnRhZ3MucHJpbWl0aXZlSUQpCi8vIHsKLy8gICAgIGlmICh0aGF0LmJvdC50YWdzLnByaW1pdGl2ZUlEID09ICJwb3J0YWwiKQovLyAgICAgewovLyAgICAgICAgIGxldCBwb3J0YWxCb3QgPSB0aGF0LmJvdDsKCi8vICAgICAgICAgY2xlYXJJbnRlcnZhbChwb3J0YWxCb3QubWFza3MuaW50ZXJ2YWwpOwovLyAgICAgICAgIGNsZWFyVGFnTWFza3MocG9ydGFsQm90KTsKCi8vICAgICAgICAgaWYgKHRoYXQudG8uZGltZW5zaW9uICE9IHRoYXQuZnJvbS5kaW1lbnNpb24pCi8vICAgICAgICAgewovLyAgICAgICAgICAgICBpZiAodGhhdC50by5kaW1lbnNpb24gPT0gcG9ydGFsQm90LnRhZ3MucG9ydGFsQWRkcmVzcykKLy8gICAgICAgICAgICAgewovLyAgICAgICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MubWluaUdyaWRQb3J0YWwgPSBwb3J0YWxCb3QudGFncy5wb3J0YWxBZGRyZXNzOwoKLy8gICAgICAgICAgICAgICAgIG1pbmlHcmlkUG9ydGFsQm90LnRhZ3MubWluaVBvcnRhbFdpZHRoID0gMTsKCi8vICAgICAgICAgICAgICAgICBwb3J0YWxCb3QudGFnc1t0aGF0LnRvLmRpbWVuc2lvbiArICJYIl0gPSAwOwovLyAgICAgICAgICAgICAgICAgcG9ydGFsQm90LnRhZ3NbdGhhdC50by5kaW1lbnNpb24gKyAiWSJdID0gMDsKLy8gICAgICAgICAgICAgfQovLyAgICAgICAgICAgICBlbHNlIGlmIChjb25maWdCb3QudGFncy5taW5pR3JpZFBvcnRhbCA9PSBwb3J0YWxCb3QudGFncy5wb3J0YWxBZGRyZXNzICYmIHRoYXQudG8uZGltZW5zaW9uICE9IHBvcnRhbEJvdC50YWdzLnBvcnRhbEFkZHJlc3MpCi8vICAgICAgICAgICAgIHsKLy8gICAgICAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLm1pbmlHcmlkUG9ydGFsID0gbnVsbDsKLy8gICAgICAgICAgICAgfQovLyAgICAgICAgIH0KLy8gICAgIH0KLy8gfScAx4XU1gvFswEPYWJNZW51U29ydE9yZGVyAgQAx4XU1gvmmQIBMAA=',
    'ASmu+rS7CAAnAQRib3RzJGI4M2Q5NzJiLTA1MzUtNDA1MS1iNTg5LTQxY2VkYTg1MzVmMQEnAK76tLsIAAZzeXN0ZW0CBACu+rS7CAEQYWIudGVzdHMubWFuYWdlcicArvq0uwgAC3J1blRlc3RDYXNlAgQArvq0uwgS/xpAY29uc3QgdGVzdENhc2UgPSBnZXRCb3QoJ2lkJywgdGhhdCk7DQppZiAoIXRlc3RDYXNlKSB7DQogICAgY29uc29sZS5sb2coJ1Rlc3QgY2FzZSBub3QgZm91bmQhJyk7DQogICAgcmV0dXJuOw0KfQ0KDQppZiAodGVzdENhc2UudGFncy5zeXN0ZW0pIHsNCiAgICBkZXN0cm95KGdldEJvdHMoDQogICAgICAgIGJ5VGFnKCdfX3Rlc3RSZXN1bHQnLCB0cnVlKQ0KICAgICkpOw0KfQ0KDQpjb25zdCBkID0gYXdhaXQgb3MuY3JlYXRlRGVidWdnZXIoew0KICAgIHBhdXNhYmxlOiB0cnVlLA0KICAgIGFsbG93QXN5bmNocm9ub3VzU2NyaXB0czogdHJ1ZQ0KfSk7DQoNCmlmICh0eXBlb2YgdGVzdENhc2UudGFncy5yYW5kb21TZWVkID09PSAnbnVtYmVyJyB8fCB0eXBlb2YgdGVzdENhc2UudGFncy5yYW5kb21TZWVkID09PSAnc3RyaW5nJykgew0KICAgIGQubWF0aC5zZXRSYW5kb21TZWVkKHRlc3RDYXNlLnRhZ3MucmFuZG9tU2VlZCk7DQp9DQpjb25zdCB0aW1lbGluZSA9IFtdOw0KYXdhaXQgYm90Lmhvb2t1cERlYnVnZ2VyKHsgZGVidWc6IGQsIHRpbWVsaW5lIH0pOw0KYXdhaXQgYm90LmFkZEJvdHNUb0RlYnVnZ2VyKGQpOw0KDQpsZXQgYWN0aW9uc1RvUGVyZm9ybSA9IFtdOw0KbGV0IGFzeW5jUmVzdWx0cyA9IHt9OyANCg0KZm9yIChsZXQgZXZlbnQgb2YgdGVzdENhc2UudGFncy50aW1lbGluZSkgew0KICAgIHByZXByb2Nlc3NFdmVudChldmVudCk7DQp9DQoNCmZ1bmN0aW9uIHByZXByb2Nlc3NFdmVudChldmVudCkgew0KICAgIGlmIChldmVudC50eXBlID09PSAndXNlcl9hY3Rpb24nKSB7DQogICAgICAgIGlmICgndGltZWxpbmUnIGluIGV2ZW50KSB7DQogICAgICAgICAgICBmb3IgKGxldCBlIG9mIGV2ZW50LnRpbWVsaW5lKSB7DQogICAgICAgICAgICAgICAgcHJlcHJvY2Vzc0V2ZW50KGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgbGV0IGFjdGlvbiA9IGV2ZW50LmFjdGlvbjsNCiAgICAgICAgICAgIGlmIChhY3Rpb24udHlwZSA9PT0gJ2FjdGlvbicgJiYgJ2tleXMnIGluIGFjdGlvbikgew0KICAgICAgICAgICAgICAgIGxldCBib3RJZHMgPSBhY3Rpb24ua2V5cy5tYXAoayA9PiB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBkLmdldElEKGQuZ2V0Qm90KA0KICAgICAgICAgICAgICAgICAgICAgICAgZWl0aGVyKA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ5VGFnKCdzeXN0ZW0nLCBrKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBieVRhZygnX19rZXknLCBrKSkNCiAgICAgICAgICAgICAgICAgICAgKSk7DQogICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgICBhY3Rpb24gPSB7DQogICAgICAgICAgICAgICAgICAgIC4uLmFjdGlvbiwNCiAgICAgICAgICAgICAgICAgICAgYm90SWRzLA0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgZGVsZXRlIGFjdGlvbi5rZXlzOw0KICAgICAgICAgICAgICAgIGFjdGlvbnNUb1BlcmZvcm0ucHVzaChhY3Rpb24pOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24udHlwZSA9PT0gJ2FzeW5jX3Jlc3VsdCcpIHsNCiAgICAgICAgICAgICAgICBhc3luY1Jlc3VsdHNbYWN0aW9uLnRhc2tJZF0gPSBhY3Rpb247DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09ICdzY3JpcHQnKSB7DQogICAgICAgIGZvciAobGV0IGUgb2YgZXZlbnQudGltZWxpbmUpIHsNCiAgICAgICAgICAgIHByZXByb2Nlc3NFdmVudChlKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KbGV0IHJlc29sdmU7DQpsZXQgcmVqZWN0Ow0KbGV0IHByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzLCByZWopID0+IHsNCiAgICByZXNvbHZlID0gcmVzOw0KICAgIHJlamVjdCA9IHJlajsNCn0pDQoNCmNvbnN0IGV4cGVjdGVkVGltZWxpbmUgPSB0ZXN0Q2FzZS50YWdzLnRpbWVsaW5lLnNsaWNlKCk7DQoNCmQub25TY3JpcHRBY3Rpb25FbnF1ZXVlZChhID0+IHsNCiAgICBpZiAoYS50eXBlICE9PSAnYXN5bmNfcmVzdWx0JyAmJiAndGFza0lkJyBpbiBhKSB7DQogICAgICAgIC8vIGFzeW5jIHRhc2sgd2FzIGVucXVldWVkDQogICAgICAgIC8vIHNlbmQgYXN5bmMgcmVzdWx0DQogICAgICAgIGxldCByZXN1bHQgPSBhc3luY1Jlc3VsdHNbYS50YXNrSWRdOw0KICAgICAgICBpZiAocmVzdWx0KSB7DQogICAgICAgICAgICBkLnBlcmZvcm1Vc2VyQWN0aW9uKHJlc3VsdCk7DQogICAgICAgIH0NCiAgICB9DQp9KTsNCg0KZm9yIChsZXQgYSBvZiBhY3Rpb25zVG9QZXJmb3JtKSB7DQogICAgY29uc29sZS5sb2coJ3BlcmZvcm0nLCBhKTsNCiAgICBhd2FpdCBkLnBlcmZvcm1Vc2VyQWN0aW9uKGEpOw0KfQ0KDQpmb3IgKGxldCBpID0gMDsgaSA8IDUwOyBpKyspIHsNCiAgICBhd2FpdCBQcm9taXNlLnJlc29sdmUoKTsNCn0NCg0KY29uc3QgcmVzdWx0VGltZWxpbmUgPSBib3QuY29tcGlsZVRpbWVsaW5lKHsgdGltZWxpbmU6IHRpbWVsaW5lIH0pOw0KDQpjb25zb2xlLmxvZygnUmVzdWx0JywgcmVzdWx0VGltZWxpbmUpOw0KDQpsZXQgcmVuZGVyZWRSZXN1bHQgPSB0aGlzQm90LnJlbmRlclRpbWVsaW5lKHsgdGltZWxpbmU6IHJlc3VsdFRpbWVsaW5lLCBuYW1lOiB0ZXN0Q2FzZS50YWdzLnRlc3ROYW1lIH0pOw0KbGV0IGV4cGVjdGVkUmVzdWx0ID0gdGhpc0JvdC5yZW5kZXJUaW1lbGluZSh7IHRpbWVsaW5lOiBleHBlY3RlZFRpbWVsaW5lLCBuYW1lOiB0ZXN0Q2FzZS50YWdzLnRlc3ROYW1lIH0pOw0KDQppZiAocmVuZGVyZWRSZXN1bHQuc3RyaW5nID09PSBleHBlY3RlZFJlc3VsdC5zdHJpbmcpIHsNCiAgICByZXR1cm4gew0KICAgICAgICBzdWNjZXNzOiB0cnVlDQogICAgfTsNCiAgICAvLyBvcy50b2FzdCgnU3VjZXNzIScpOw0KfSBlbHNlIHsNCiAgICBjb25zdCBzeXN0ZW0gPSAndGVzdC1mYWlsdXJlcy4nICsgdGVzdENhc2UudGFncy50ZXN0TmFtZTsNCiAgICBsZXQgeyByZXN1bHRCb3QgfSA9IHRoaXNCb3QuY3JlYXRlQm90c0ZvclJlbmRlcmVkVGltZWxpbmUoew0KICAgICAgICBzeXN0ZW0sDQogICAgICAgIHJlc3VsdDogcmVuZGVyZWRSZXN1bHQsDQogICAgICAgIGNyZWF0b3I6IHRlc3RDYXNlLA0KICAgICAgICBzeXN0ZW1UYWc6ICd0ZXN0U3lzdGVtJw0KICAgIH0pOw0KDQogICAgbGV0IHsgcmVzdWx0Qm90OiBleHBlY3RlZEJvdCB9ID0gdGhpc0JvdC5jcmVhdGVCb3RzRm9yUmVuZGVyZWRUaW1lbGluZSh7DQogICAgICAgIHN5c3RlbSwNCiAgICAgICAgcmVzdWx0OiBleHBlY3RlZFJlc3VsdCwNCiAgICAgICAgdGVzdENhc2UsDQogICAgICAgIHN5c3RlbVRhZzogJ3N5c3RlbScNCiAgICB9KTsNCg0KICAgIHJldHVybiB7DQogICAgICAgIHN1Y2Nlc3M6IGZhbHNlLA0KICAgICAgICBzeXN0ZW06IHN5c3RlbSwNCiAgICAgICAgZGlmZkJvdElkOiBleHBlY3RlZEJvdC5pZCwNCiAgICB9Ow0KfScArvq0uwgADmhvb2t1cERlYnVnZ2VyAgQArvq0uwiSG7g+QGNvbnN0IHsgZGVidWc6IGQsIGFkZEtleXMsIHRpbWVsaW5lLCBub1dhcm5NaXNzaW5nS2V5cyB9ID0gdGhhdDsNCmNvbnN0IGJvdFRpbWVsaW5lID0gdGltZWxpbmUgPz8gW107DQoNCmNvbnN0IGFjdGlvblRpbWVsaW5lcyA9IHt9Ow0KY29uc3Qgc2NyaXB0VGltZWxpbmVzID0ge307DQoNCmxldCBlbWl0dGVkQWN0aW9ucyA9IFtdOw0KY29uc3QgYXN5bmNSZXF1ZXN0cyA9IG5ldyBNYXAoKTsNCmxldCBhc3luY1RpbWVsaW5lID0gbnVsbDsNCmxldCBzeW5jQ291bnRlciA9IDA7DQoNCmxldCBib3RLZXlzID0ge307DQoNCmZ1bmN0aW9uIHNob3VsZFNraXBBY3Rpb24oYSkgew0KICAgIGNvbnN0IGMgPSBkLmNvbmZpZ0JvdDsNCiAgICBpZiAoIWMpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIGlmIChhLnR5cGUgIT09ICdhY3Rpb24nKSB7DQogICAgICAgIGlmIChhLnR5cGUgPT09ICd1cGRhdGVfYm90Jykgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0gZWxzZSBpZiAoYS50eXBlID09PSAnYWRkX2JvdCcpIHsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9IGVsc2UgaWYgKGEudHlwZSA9PT0gJ3JlbW92ZV9ib3QnKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIGlmIChhLnR5cGUgPT09ICdhc3luY19yZXN1bHQnKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0gZWxzZSBpZiAoYS50eXBlID09PSAnYXN5bmNfZXJyb3InKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0gZWxzZSBpZiAoYS50eXBlID09PSAnYXBwbHlfc3RhdGUnKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIGlmIChhLnR5cGUgPT09ICdyZWdpc3Rlcl9idWlsdGluX3BvcnRhbCcpIHsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9IGVsc2UgaWYoYS50eXBlID09PSAnY3VzdG9tX2FwcF9jb250YWluZXJfYXZhaWxhYmxlJykgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0gZWxzZSBpZiAoYS50eXBlID09PSAncmVnaXN0ZXJfaHRtbF9hcHAnICYmIGEuYXBwSWQgPT09ICdfcm9vdCcpIHsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9IGVsc2UgaWYgKGEudHlwZSA9PT0gJ2RlZmluZV9nbG9iYWxfYm90Jykgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQogICAgcmV0dXJuIGZhbHNlOw0KfQ0KDQpmdW5jdGlvbiBzaG91bGRTa2lwVXBkYXRlRm9yQm90KHVwZGF0ZSkgew0KICAgIGNvbnN0IGIgPSBnZXRCb3QoYnlJRCh1cGRhdGUuYm90SWQpKTsNCiAgICByZXR1cm4gKA0KICAgICAgICBiICYmICgNCiAgICAgICAgICAgIGJ5VGFnKCdhYicpKGIpIHx8IGJ5VGFnKCdhYklEJykoYikNCiAgICAgICAgKQ0KICAgICk7DQp9DQoNCmQub25CZWZvcmVVc2VyQWN0aW9uKGEgPT4gew0KICAgIGlmIChzaG91bGRTa2lwQWN0aW9uKGEpKSB7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgY29uc29sZS5sb2coJ3VzZXIgYWN0aW9uJywgYSk7DQoNCiAgICBpZiAoYS50eXBlID09PSAnYWN0aW9uJykgew0KICAgICAgICBhc3luY1RpbWVsaW5lID0gbnVsbDsNCiAgICAgICAgc3luY0NvdW50ZXIgKz0gMTsNCiAgICAgICAgYWRkQm90QWN0aW9uKGEpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIGlmIChhLnR5cGUgPT09ICdhc3luY19yZXN1bHQnKSB7DQogICAgICAgICAgICAvLyB0aGUgdGltZWxpbmUgdGhhdCBzdGFydGVkIHRoZSBhc3luYyByZXF1ZXN0Lg0KICAgICAgICAgICAgYXN5bmNUaW1lbGluZSA9IGFzeW5jUmVxdWVzdHMuZ2V0KGEudGFza0lkKTsNCiAgICAgICAgICAgIGlmICghYXN5bmNUaW1lbGluZSkgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhc3luYycsIGFzeW5jUmVxdWVzdHMsIGEpOw0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQXN5bmMgdGltZWxpbmUgbm90IGZvdW5kIGZvciB0YXNrISAodGFza0lkOiAke2EudGFza0lkfSlgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGFzeW5jVGltZWxpbmUucHVzaCh7DQogICAgICAgICAgICAgICAgdHlwZTogJ3VzZXJfYWN0aW9uJywNCiAgICAgICAgICAgICAgICBhY3Rpb246IGEsDQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGJvdFRpbWVsaW5lLnB1c2goew0KICAgICAgICAgICAgICAgIHR5cGU6ICd1c2VyX2FjdGlvbicsDQogICAgICAgICAgICAgICAgYWN0aW9uOiBhLA0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICB9DQp9KTsNCg0KZC5vblNjcmlwdEFjdGlvbkVucXVldWVkKGEgPT4gew0KICAgIGNvbnNvbGUubG9nKCdlbWl0IGFjdGlvbicsIGEpOw0KICAgIGNvbnNvbGUubG9nKCdjYWxsIHN0YWNrJywgZC5nZXRDYWxsU3RhY2soKSk7DQogICAgbGV0IHRpbWVsaW5lID0gZ2V0Q3VycmVudFNjcmlwdFRpbWVsaW5lKCk7DQoNCiAgICBpZiAodGltZWxpbmUpIHsNCiAgICAgICAgdGltZWxpbmUucHVzaCh7DQogICAgICAgICAgICB0eXBlOiAnZW1pdHRlZF9hY3Rpb24nLA0KICAgICAgICAgICAgYWN0aW9uOiBhLA0KICAgICAgICAgICAgbG9jYXRpb246IGdldEN1cnJlbnRTY3JpcHRMb2NhdGlvbigpIA0KICAgICAgICB9KTsNCiAgICB9DQoNCiAgICBpZiAoJ3Rhc2tJZCcgaW4gYSkgew0KICAgICAgICBpZiAoIXRpbWVsaW5lKSB7DQogICAgICAgICAgICBkZWJ1Z2dlcjsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHRpbWVsaW5lIGZvciB0aGUgc2NyaXB0IGFjdGlvbiBjb3VsZCBub3QgYmUgZm91bmQhJyk7DQogICAgICAgIH0NCiAgICAgICAgYXN5bmNSZXF1ZXN0cy5zZXQoYS50YXNrSWQsIHRpbWVsaW5lKTsNCiAgICB9DQp9KTsNCg0KZC5vbkFmdGVyU2NyaXB0VXBkYXRlZFRhZyh1cGRhdGUgPT4gew0KICAgIGlmIChzaG91bGRTa2lwVXBkYXRlRm9yQm90KHVwZGF0ZSkpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIGNvbnNvbGUubG9nKCd1cGRhdGUgdGFnJywgdXBkYXRlKTsNCiAgICBjb25zb2xlLmxvZygnY2FsbCBzdGFjaycsIGQuZ2V0Q2FsbFN0YWNrKCkpOw0KICAgIGxldCB0aW1lbGluZSA9IGdldEN1cnJlbnRTY3JpcHRUaW1lbGluZSgpOw0KDQogICAgaWYgKHRpbWVsaW5lKSB7DQogICAgICAgIGxldCB7IGJvdElkLCAuLi5yZXN0IH0gPSB1cGRhdGU7DQoNCiAgICAgICAgdGltZWxpbmUucHVzaCh7DQogICAgICAgICAgICB0eXBlOiAndXBkYXRlX3RhZycsDQogICAgICAgICAgICB1cGRhdGU6IHsNCiAgICAgICAgICAgICAgICAuLi5yZXN0LA0KICAgICAgICAgICAgICAgIGJvdElkOiBnZXRCb3RLZXkoYm90SWQpID8/IGJvdElkDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgbG9jYXRpb246IGdldEN1cnJlbnRTY3JpcHRMb2NhdGlvbigpDQogICAgICAgIH0pOw0KICAgIH0NCn0pOw0KDQpkLm9uQWZ0ZXJTY3JpcHRVcGRhdGVkVGFnTWFzayh1cGRhdGUgPT4gew0KICAgIGlmIChzaG91bGRTa2lwVXBkYXRlRm9yQm90KHVwZGF0ZSkpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIGNvbnNvbGUubG9nKCd1cGRhdGUgdGFnIG1hc2snLCB1cGRhdGUpOw0KICAgIGNvbnNvbGUubG9nKCdjYWxsIHN0YWNrJywgZC5nZXRDYWxsU3RhY2soKSk7DQogICAgbGV0IHRpbWVsaW5lID0gZ2V0Q3VycmVudFNjcmlwdFRpbWVsaW5lKCk7DQoNCiAgICBpZiAodGltZWxpbmUpIHsNCiAgICAgICAgbGV0IHsgYm90SWQsIC4uLnJlc3QgfSA9IHVwZGF0ZTsNCg0KICAgICAgICB0aW1lbGluZS5wdXNoKHsNCiAgICAgICAgICAgIHR5cGU6ICd1cGRhdGVfdGFnX21hc2snLA0KICAgICAgICAgICAgdXBkYXRlOiB7DQogICAgICAgICAgICAgICAgLi4ucmVzdCwNCiAgICAgICAgICAgICAgICBib3RJZDogZ2V0Qm90S2V5KGJvdElkKSA/PyBib3RJZA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGxvY2F0aW9uOiBnZXRDdXJyZW50U2NyaXB0TG9jYXRpb24oKQ0KICAgICAgICB9KTsNCiAgICB9DQp9KTsNCg0KZnVuY3Rpb24gZ2V0Q3VycmVudFNjcmlwdFRpbWVsaW5lKCkgew0KICAgIGlmICghYXN5bmNUaW1lbGluZSkgew0KICAgICAgICBsZXQgY3VycmVudFNjcmlwdCA9IGdldEN1cnJlbnRTY3JpcHQoKTsNCiAgICAgICAgaWYgKGN1cnJlbnRTY3JpcHQpIHsNCiAgICAgICAgICAgIHJldHVybiBnZXRTY3JpcHRUaW1lbGluZShjdXJyZW50U2NyaXB0LmJvdElkLCBjdXJyZW50U2NyaXB0LnRhZywgc3luY0NvdW50ZXIpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBudWxsOw0KICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiBhc3luY1RpbWVsaW5lOw0KICAgIH0NCn0NCg0KZnVuY3Rpb24gZ2V0U2NyaXB0VGltZWxpbmUoYm90SWQsIHRhZywgc3luY0NvdW50ZXIpIHsNCiAgICBjb25zdCBrZXkgPSBgJHtib3RJZH0uJHt0YWd9OiR7c3luY0NvdW50ZXJ9YDsNCiAgICBsZXQgdGltZWxpbmUgPSBzY3JpcHRUaW1lbGluZXNba2V5XTsNCiAgICBpZiAoIXRpbWVsaW5lKSB7DQogICAgICAgIHNjcmlwdFRpbWVsaW5lc1trZXldID0gdGltZWxpbmUgPSBbXTsNCiAgICAgICAgbGV0IGFjdGlvblRpbWVsaW5lID0gYWN0aW9uVGltZWxpbmVzW3N5bmNDb3VudGVyXTsNCg0KICAgICAgICBpZiAoYWN0aW9uVGltZWxpbmUpIHsNCiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsQm90SWQgPSBnZXRPcmlnaW5hbEJvdElkKGJvdElkKTsNCiAgICAgICAgICAgIGFjdGlvblRpbWVsaW5lLnB1c2goew0KICAgICAgICAgICAgICAgIHR5cGU6ICdzY3JpcHQnLA0KICAgICAgICAgICAgICAgIGJvdElkOiBnZXRCb3RLZXkoYm90SWQpLA0KICAgICAgICAgICAgICAgIHRhZzogdGFnLA0KICAgICAgICAgICAgICAgIGNvdW50OiBzeW5jQ291bnRlciwNCiAgICAgICAgICAgICAgICB0aW1lbGluZSwNCiAgICAgICAgICAgICAgICBsb2NhdGlvbjogew0KICAgICAgICAgICAgICAgICAgICBib3RJZDogb3JpZ2luYWxCb3RJZCwNCiAgICAgICAgICAgICAgICAgICAgdGFnLA0KICAgICAgICAgICAgICAgICAgICBsaW5lOiAwLA0KICAgICAgICAgICAgICAgICAgICBjb2x1bW46IDANCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gdGltZWxpbmU7DQp9DQoNCmZ1bmN0aW9uIGdldEN1cnJlbnRTY3JpcHQoKSB7DQogICAgY29uc3QgY2FsbFN0YWNrID0gZC5nZXRDYWxsU3RhY2soKTsNCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNhbGxTdGFjay5sZW5ndGg7IGkrKykgew0KICAgICAgICBsZXQgZnJhbWUgPSBjYWxsU3RhY2tbaV07DQogICAgICAgIGlmIChmcmFtZS5sb2NhdGlvbj8uYm90SWQgJiYgZnJhbWUubG9jYXRpb24/LnRhZykgew0KICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICBib3RJZDogZnJhbWUubG9jYXRpb24uYm90SWQsDQogICAgICAgICAgICAgICAgdGFnOiBmcmFtZS5sb2NhdGlvbi50YWcNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICByZXR1cm4gbnVsbDsNCn0NCg0KZnVuY3Rpb24gZ2V0Q3VycmVudFNjcmlwdExvY2F0aW9uKCkgew0KICAgIGNvbnN0IGNhbGxTdGFjayA9IGQuZ2V0Q2FsbFN0YWNrKCk7DQogICAgZm9yIChsZXQgaSA9IGNhbGxTdGFjay5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgew0KICAgICAgICBsZXQgZnJhbWUgPSBjYWxsU3RhY2tbaV07DQogICAgICAgIGlmIChmcmFtZS5sb2NhdGlvbj8uYm90SWQgJiYgZnJhbWUubG9jYXRpb24/LnRhZykgew0KICAgICAgICAgICAgY29uc3QgYm90SWQgPSBnZXRPcmlnaW5hbEJvdElkKGZyYW1lLmxvY2F0aW9uLmJvdElkKTsNCiAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgICAgYm90SWQ6IGJvdElkLA0KICAgICAgICAgICAgICAgIHRhZzogZnJhbWUubG9jYXRpb24udGFnLA0KICAgICAgICAgICAgICAgIGxpbmU6IGZyYW1lLmxvY2F0aW9uLmxpbmVOdW1iZXIsDQogICAgICAgICAgICAgICAgY29sdW1uOiBmcmFtZS5sb2NhdGlvbi5jb2x1bW5OdW1iZXINCiAgICAgICAgICAgIH07DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgcmV0dXJuIG51bGw7DQp9DQoNCmFzeW5jIGZ1bmN0aW9uIGFkZEJvdEFjdGlvbihhKSB7DQogICAgbGV0IGFjdGlvbjsNCiAgICBpZiAoYS5ib3RJZHMpIHsNCiAgICAgICAgbGV0IGtleXMgPSBbXTsNCiAgICAgICAgZm9yIChsZXQgYm90SWQgb2YgYS5ib3RJZHMpIHsNCiAgICAgICAgICAgIGNvbnN0IGtleSA9IGdldEJvdEtleShib3RJZCk7DQogICAgICAgICAgICBpZiAoIWtleSkgew0KICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBrZXlzLnB1c2goa2V5KTsNCiAgICAgICAgfQ0KDQogICAgICAgIGFjdGlvbiA9IHsNCiAgICAgICAgICAgIC4uLmEsDQogICAgICAgICAgICBrZXlzDQogICAgICAgIH07DQogICAgICAgIGRlbGV0ZSBhY3Rpb24uYm90SWRzOw0KICAgIH0gZWxzZSB7DQogICAgICAgIGFjdGlvbiA9IGE7DQogICAgfQ0KDQogICAgY29uc3QgdGltZWxpbmUgPSBhY3Rpb25UaW1lbGluZXNbc3luY0NvdW50ZXJdID0gWw0KICAgICAgICB7DQogICAgICAgICAgICB0eXBlOiAndXNlcl9hY3Rpb24nLA0KICAgICAgICAgICAgYWN0aW9uOiBhY3Rpb24sDQogICAgICAgIH0NCiAgICBdOw0KICAgIGJvdFRpbWVsaW5lLnB1c2goew0KICAgICAgICB0eXBlOiAndXNlcl9hY3Rpb24nLA0KICAgICAgICB0aW1lbGluZTogdGltZWxpbmUNCiAgICB9KTsNCn0NCg0KZnVuY3Rpb24gZ2V0T3JpZ2luYWxCb3RJZChib3RJZCkgew0KICAgIGxldCBib3QgPSBkLmdldEJvdCgnaWQnLCBib3RJZCk7DQogICAgaWYgKCFib3QgfHwgIWJvdC50YWdzLl9fb3JpZ2luYWxCb3RJZCkgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgbGV0IG9yaWdpbmFsQm90ID0gZ2V0Qm90KCdpZCcsIGJvdC50YWdzLl9fb3JpZ2luYWxCb3RJZCk7DQogICAgaWYgKCFvcmlnaW5hbEJvdCkgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQoNCiAgICByZXR1cm4gb3JpZ2luYWxCb3QuaWQ7DQp9DQoNCmZ1bmN0aW9uIGdldEJvdEtleShib3RJZCkgew0KICAgIGxldCBib3QgPSBkLmdldEJvdCgnaWQnLCBib3RJZCk7DQogICAgaWYgKCFib3QgfHwgIWJvdC50YWdzLl9fb3JpZ2luYWxCb3RJZCkgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgbGV0IG9yaWdpbmFsQm90ID0gZ2V0Qm90KCdpZCcsIGJvdC50YWdzLl9fb3JpZ2luYWxCb3RJZCk7DQogICAgaWYgKCFvcmlnaW5hbEJvdCkgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgbGV0IGtleSA9IGJvdC50YWdzLl9fa2V5ID8/IGJvdC50YWdzLnN5c3RlbSA/PyBib3RLZXlzW2JvdElkXTsNCiAgICBpZiAoIWtleSkgew0KICAgICAgICBpZiAoYWRkS2V5cykgew0KICAgICAgICAgICAga2V5ID0gYm90S2V5c1tib3RJZF0gPSBvcmlnaW5hbEJvdC50YWdzLl9fa2V5ID0gdXVpZCgpOw0KICAgICAgICB9IGVsc2UgaWYgKG5vV2Fybk1pc3NpbmdLZXlzKSB7DQogICAgICAgICAgICBrZXkgPSBvcmlnaW5hbEJvdC5pZDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGNvbnNvbGUud2FybihgTm8ga2V5IGNvdWxkIGJlIGRldGVybWluZWQgZm9yICR7Ym90SWR9ISBTZXQgdGhlIHN5c3RlbSB0YWcgb3IgdGhlIF9fa2V5IHRhZyB0byBlbmFibGUgY29uc2lzdGVudCB0ZXN0cy5gKTsNCiAgICAgICAgICAgIG9zLnRvYXN0KGBObyBrZXkgY291bGQgYmUgZGV0ZXJtaW5lZCBmb3IgJHtib3RJZH0hIFNldCB0aGUgc3lzdGVtIHRhZyBvciB0aGUgX19rZXkgdGFnIHRvIGVuYWJsZSBjb25zaXN0ZW50IHRlc3RzLmApOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBrZXk7DQp9JwCu+rS7CAAPY29tcGlsZVRpbWVsaW5lAgQArvq0uwjLWdoEQGxldCBmaW5hbFRpbWVsaW5lID0gW107DQpsZXQgaGFzVXNlckFjdGlvbiA9IGZhbHNlOw0KbGV0IHRpbWVsaW5lID0gdGhhdC50aW1lbGluZTsNCg0KZm9yKGxldCBpID0gMDsgaSA8IHRpbWVsaW5lLmxlbmd0aDsgaSsrKSB7DQogICAgY29uc3QgZXZlbnQgPSB0aW1lbGluZVtpXTsNCg0KICAgIGlmIChldmVudC50eXBlID09PSAndXNlcl9hY3Rpb24nKSB7DQogICAgICAgIGhhc1VzZXJBY3Rpb24gPSB0cnVlOw0KDQogICAgICAgIGlmICgndGltZWxpbmUnIGluIGV2ZW50KSB7DQogICAgICAgICAgICBpZiAoZXZlbnQudGltZWxpbmUubGVuZ3RoIDw9IDEpIHsNCiAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0gZWxzZSBpZiAoIWhhc1VzZXJBY3Rpb24pIHsNCiAgICAgICAgY29udGludWU7DQogICAgfQ0KDQogICAgZmluYWxUaW1lbGluZS5wdXNoKGV2ZW50KTsNCn0NCg0KY29uc29sZS5sb2coJ1tkZWJ1Z10gVGltZWxpbmUnLCB0aW1lbGluZS5zbGljZSgpKTsNCmNvbnNvbGUubG9nKCdbZGVidWddIEZpbmFsIFRpbWVsaW5lJywgZmluYWxUaW1lbGluZSk7DQpyZXR1cm4gZmluYWxUaW1lbGluZTsnAK76tLsIABFhZGRCb3RzVG9EZWJ1Z2dlcgIEAK76tLsIpl7kCEBjb25zdCBkID0gdGhhdDsNCmNvbnN0IHRlc3RhYmxlQm90cyA9IGdldEJvdHMoDQogICAgbm90KGJ5VGFnKCdfX3Rlc3QnKSksDQogICAgbm90KGJ5VGFnKCdhYicpKSwNCiAgICBub3QoYnlUYWcoJ2FiSUQnKSksDQogICAgbm90KGJ5SUQoZ2V0SUQodGhpc0JvdCkpKSwNCiAgICBub3QoYnlUYWcoJ2FiVGVzdFRvb2xzJykpLA0KICAgIG5vdChieVNwYWNlKCdib290c3RyYXAnKSkNCik7DQoNCmlmICh0ZXN0YWJsZUJvdHMubGVuZ3RoIDw9IDApIHsNCiAgICB0aHJvdyBuZXcgRXJyb3IoJ1VuYWJsZSB0byBjcmVhdGUgdGVzdCB3aXRoIG5vIGJvdHMhJyk7DQp9DQpmb3IgKGxldCBiIG9mIHRlc3RhYmxlQm90cykgew0KICAgIGlmIChiLmlkID09PSBncmlkUG9ydGFsQm90LmlkIHx8IA0KICAgICAgICBiLmlkID09PSBjb25maWdCb3QuaWQgfHwNCiAgICAgICAgYi5pZCA9PT0gbWluaUdyaWRQb3J0YWxCb3QuaWQgfHwNCiAgICAgICAgYi5pZCA9PT0gbWFwUG9ydGFsQm90LmlkIHx8DQogICAgICAgIGIuaWQgPT09IHN5c3RlbVBvcnRhbEJvdC5pZCB8fA0KICAgICAgICBiLmlkID09PSBzaGVldFBvcnRhbEJvdC5pZCB8fA0KICAgICAgICBiLmlkID09PSB0YWdQb3J0YWxCb3QuaWQgfHwNCiAgICAgICAgYi5pZCA9PT0gbWVudVBvcnRhbEJvdC5pZCB8fA0KICAgICAgICBiLmlkID09PSBpZGVQb3J0YWxCb3QuaWQgfHwNCiAgICAgICAgYi5pZCA9PT0gbWVldFBvcnRhbEJvdC5pZCB8fA0KICAgICAgICBiLmlkID09PSBib3RQb3J0YWxCb3QuaWQgfHwNCiAgICAgICAgYi5pZCA9PT0gbWluaU1hcFBvcnRhbEJvdC5pZCB8fA0KICAgICAgICBiLmlkID09PSBsZWZ0V3Jpc3RQb3J0YWxCb3QuaWQgfHwNCiAgICAgICAgYi5pZCA9PT0gcmlnaHRXcmlzdFBvcnRhbEJvdC5pZCkgew0KICAgICAgICBjb250aW51ZTsNCiAgICB9DQoNCiAgICBsZXQgdGFncyA9IE9iamVjdC5rZXlzKGIudGFncyk7DQoNCiAgICBpZiAodGFncy5sZW5ndGggPD0gMCkgew0KICAgICAgICBjb25zb2xlLmxvZygnbm8gdGFncyEnLCBiKTsNCiAgICAgICAgY29udGludWU7DQogICAgfQ0KICAgIGF3YWl0IGQuY3JlYXRlKGIsIHsNCiAgICAgICAgX19vcmlnaW5hbEJvdElkOiBiLmlkDQogICAgfSk7DQp9JwCu+rS7CAAEYWJJRAIEAK76tLsIi2cNdGVzdHMtbWFuYWdlcicArvq0uwgABWNvbG9yAgQArvq0uwiZZwcjZjFmZjNhJwCu+rS7CAAPb25Qb3J0YWxDaGFuZ2VkAgQArvq0uwihZ5EEQGlmICh0aGF0LnBvcnRhbCA9PT0gJ3N5c3RlbVBvcnRhbCcpIHsNCiAgICBpZiAoIWNvbmZpZ0JvdC50YWdzLmNvZGVUb29sc1BvcnRhbCkgew0KICAgICAgICBjb25maWdCb3QubWFza3MuY29kZVRvb2xzUG9ydGFsID0gJ2FiVGVzdFRvb2xzJzsNCg0KICAgICAgICBkZXN0cm95KGdldEJvdHMoDQogICAgICAgICAgICBieVRhZygnYWJUZXN0VG9vbHMnLCB0cnVlKSwNCiAgICAgICAgICAgIGJ5U3BhY2UoJ3RlbXBMb2NhbCcpDQogICAgICAgICkpOw0KDQogICAgICAgIGNvbnN0IHJ1blRlc3RzQnV0dG9uID0gY3JlYXRlKHsNCiAgICAgICAgICAgIHNwYWNlOiAndGVtcExvY2FsJywNCiAgICAgICAgICAgIGFiVGVzdFRvb2xzOiB0cnVlLA0KICAgICAgICAgICAgbGFiZWw6ICdSdW4gVGVzdHMnLA0KICAgICAgICAgICAgb25DbGljazogYEBzaG91dCgiYWJSdW5UZXN0cyIpYCwNCiAgICAgICAgfSk7DQoNCiAgICAgICAgdGhpc0JvdC5tYXNrcy5ydW5UZXN0c0J1dHRvbiA9IHJ1blRlc3RzQnV0dG9uLmxpbms7DQogICAgfQ0KfScArvq0uwgADGFiUmVjb3JkVGVzdAIEAK76tLsIs2uUDEBjb25zdCB0ZXN0TmFtZSA9IGF3YWl0IG9zLnNob3dJbnB1dCgnJywgew0KICAgIHRpdGxlOiAnRW50ZXIgdGVzdCBuYW1lJw0KfSk7DQoNCmlmICghdGVzdE5hbWUpIHsNCiAgICBvcy50b2FzdCgiWW91IG11c3QgcHJvdmlkZSBhIHRlc3QgbmFtZSBpbiBvcmRlciB0byByZWNvcmQgYSB0ZXN0LiIpOw0KICAgIHJldHVybjsNCn0NCg0KY29uc3QgZCA9IGF3YWl0IG9zLmNyZWF0ZURlYnVnZ2VyKHsNCiAgICBwYXVzYWJsZTogdHJ1ZSwNCiAgICBhbGxvd0FzeW5jaHJvbm91c1NjcmlwdHM6IHRydWUNCn0pOw0KDQpjb25zdCBzZWVkID0gbWF0aC5yYW5kb21JbnQoLTIxNDc0ODM2NDgsIDIxNDc0ODM2NDcpOw0KYm90LnZhcnMudHJhY2luZyA9IG51bGw7DQpib3QudmFycy50ZXN0TmFtZSA9IHRlc3ROYW1lOw0KYm90LnZhcnMucmFuZG9tU2VlZCA9IHNlZWQ7DQpib3QudmFycy5kZWJ1ZyA9IGQ7DQpkLm1hdGguc2V0UmFuZG9tU2VlZChzZWVkKTsNCmJvdC52YXJzLnRpbWVsaW5lID0gW107DQphd2FpdCBib3QuaG9va3VwRGVidWdnZXIoeyBkZWJ1ZzogZCwgYWRkS2V5czogdHJ1ZSwgdGltZWxpbmU6IGJvdC52YXJzLnRpbWVsaW5lIH0pOw0KYXdhaXQgYm90LmFkZEJvdHNUb0RlYnVnZ2VyKGQpOw0KDQphd2FpdCBvcy5hdHRhY2hEZWJ1Z2dlcihkLCB7DQogICAgdGFnTmFtZU1hcHBlcjogew0KICAgICAgICBmb3J3YXJkOiBmb3J3YXJkTWFwVGFnTmFtZSwNCiAgICAgICAgcmV2ZXJzZTogcmV2ZXJzZU1hcFRhZ05hbWUNCiAgICB9LA0KfSk7DQoNCmF3YWl0IG9zLnNsZWVwKDEwMDApOw0KDQppZiAoY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCkgew0KICAgIGJvdC52YXJzLm9yaWdpbmFsR3JpZFBvcnRhbCA9IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWw7DQogICAgZC5jb25maWdCb3QudGFncy5ncmlkUG9ydGFsID0gY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9ICd0ZXN0LScgKyBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsOw0KfQ0KDQpzaG91dCgiYWJTbGVlcCIsICJzbGVlcCIpOw0Kc2hvdXQoJ2FiUmVzZXQnKTsNCg0KZnVuY3Rpb24gZm9yd2FyZE1hcFRhZ05hbWUobmFtZSkgew0KICAgIGNvbnN0IGJ1aWx0aW5UYWdzID0gb3MubGlzdEJ1aWx0aW5UYWdzKCk7DQogICAgaWYgKGJ1aWx0aW5UYWdzLnNvbWUodCA9PiB0ID09PSBuYW1lKSkgew0KICAgICAgICByZXR1cm4gbmFtZTsNCiAgICB9DQoNCiAgICByZXR1cm4gJ3Rlc3QtJyArIG5hbWU7DQp9DQoNCmZ1bmN0aW9uIHJldmVyc2VNYXBUYWdOYW1lKG5hbWUpIHsNCiAgICBjb25zdCBidWlsdGluVGFncyA9IG9zLmxpc3RCdWlsdGluVGFncygpOw0KICAgIGlmIChidWlsdGluVGFncy5zb21lKHQgPT4gdCA9PT0gbmFtZSkpIHsNCiAgICAgICAgcmV0dXJuIG5hbWU7DQogICAgfQ0KDQogICAgbGV0IHdpdGhvdXRUZXN0ID0gbmFtZS5zdWJzdHJpbmcoJ3Rlc3QtJy5sZW5ndGgpOw0KICAgIHJldHVybiB3aXRob3V0VGVzdDsNCn0NCg0KYXdhaXQgb3MucmVnaXN0ZXJBcHAoJ2FiVGVzdGluZ0FwcCcsIHRoaXNCb3QpOw0KdGhpc0JvdC5yZW5kZXJUZXN0aW5nQXBwKCk7JwCu+rS7CAAQcmVuZGVyVGVzdGluZ0FwcAIEAK76tLsIyHesA0BsZXQgcmVzdWx0Ow0KDQppZiAgKHRoaXNCb3QudmFycy5kZWJ1Zykgew0KICAgIGlmICh0aGlzQm90LnZhcnMudHJhY2luZykgew0KICAgICAgICByZXN1bHQgPSA8ZGl2Pg0KICAgICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXsoKSA9PiB0aGlzQm90LmFiU3RvcFRyYWNpbmcoKX0+U3RvcCBUcmFjaW5nPC9idXR0b24+DQogICAgICAgIDwvZGl2Pg0KICAgIH0gZWxzZSB7DQogICAgICAgIHJlc3VsdCA9IDxkaXY+DQogICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9eygpID0+IHRoaXNCb3QuYWJTdG9wUmVjb3JkaW5nKCl9PlN0b3AgUmVjb3JkaW5nPC9idXR0b24+DQogICAgICAgIDwvZGl2Pg0KICAgIH0NCn0gZWxzZSB7DQogICAgcmVzdWx0ID0gPGRpdj48L2Rpdj47DQp9DQoNCm9zLmNvbXBpbGVBcHAoJ2FiVGVzdGluZ0FwcCcsIHJlc3VsdCk7JwCu+rS7CAAPYWJTdG9wUmVjb3JkaW5nAgQArvq0uwj1etIFQGlmIChib3QudmFycy5kZWJ1Zykgew0KICAgIGF3YWl0IG9zLmRldGFjaERlYnVnZ2VyKGJvdC52YXJzLmRlYnVnKTsNCn0NCg0KYm90LnZhcnMuZGVidWcgPSBudWxsOw0KYm90LnZhcnMudHJhY2luZyA9IG51bGw7DQoNCmlmIChib3QudmFycy5vcmlnaW5hbEdyaWRQb3J0YWwpIHsNCiAgICBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID0gYm90LnZhcnMub3JpZ2luYWxHcmlkUG9ydGFsOw0KICAgIGJvdC52YXJzLm9yaWdpbmFsR3JpZFBvcnRhbCA9IG51bGw7DQp9DQoNCmNvbnNvbGUubG9nKCdbZGVidWddIERvbmUhJyk7DQpsZXQgZmluYWxUaW1lbGluZSA9IGJvdC5jb21waWxlVGltZWxpbmUoeyB0aW1lbGluZTogYm90LnZhcnMudGltZWxpbmUgfSk7DQoNCmNyZWF0ZSh7DQogICAgX190ZXN0OiB0cnVlLA0KICAgIF9fdGVzdENhc2U6IHRydWUsDQogICAgdGltZWxpbmU6ICfwn6esJyArIGdldEZvcm1hdHRlZEpTT04oZmluYWxUaW1lbGluZS5zbGljZSgpKSwNCiAgICBvbkNsaWNrOiBgQHNob3V0KCdydW5UZXN0Q2FzZScsIHRoaXNCb3QuaWQpYCwNCiAgICBzeXN0ZW06ICd0ZXN0cy4nICsgYm90LnZhcnMudGVzdE5hbWUsDQogICAgcmFuZG9tU2VlZDogYm90LnZhcnMucmFuZG9tU2VlZCwNCiAgICB0ZXN0TmFtZTogYm90LnZhcnMudGVzdE5hbWUNCn0pOw0KDQpzaG91dCgiYWJTbGVlcCIsICJ3YWtlIik7DQp0aGlzQm90LnJlbmRlclRlc3RpbmdBcHAoKTsnAK76tLsIAAphYlJ1blRlc3RzAgQArvq0uwjGgAGfDUBjb25zdCB0ZXN0Q2FzZXMgPSBnZXRCb3RzKA0KICAgIGJ5VGFnKCdfX3Rlc3QnLCB0cnVlKSwNCiAgICBieVRhZygnX190ZXN0Q2FzZScsIHRydWUpDQopOw0KDQpsZXQgdG90YWxDb3VudCA9IHRlc3RDYXNlcy5sZW5ndGg7DQpsZXQgY29tcGxldGVkQ291bnQgPSAwOw0KbGV0IHN1Y2Nlc3NDb3VudCA9IDA7DQpsZXQgZmFpbHVyZUNvdW50ID0gMDsNCmxldCBwcm9taXNlcyA9IFtdOw0KZm9yKGxldCB0ZXN0Q2FzZSBvZiB0ZXN0Q2FzZXMpIHsNCiAgICBpZiAodGVzdENhc2UudGFncy5za2lwKSB7DQogICAgICAgIGNvbnRpbnVlOw0KICAgIH0NCg0KICAgIGNvbnN0IHByb21pc2UgPSB0aGlzQm90LnJ1blRlc3RDYXNlKGdldElEKHRlc3RDYXNlKSkudGhlbigocmVzdWx0KSA9PiB7DQogICAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykgew0KICAgICAgICAgICAgc3VjY2Vzc0NvdW50ICs9IDE7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBmYWlsdXJlQ291bnQgKz0gMTsNCiAgICAgICAgfQ0KICAgICAgICBjb21wbGV0ZWRDb3VudCArPSAxOw0KICAgICAgICBpZiAodGhpc0JvdC5saW5rcy5ydW5UZXN0c0J1dHRvbikgew0KICAgICAgICAgICAgdGhpc0JvdC5saW5rcy5ydW5UZXN0c0J1dHRvbi5tYXNrcy5sYWJlbCA9IGAke2NvbXBsZXRlZENvdW50fS8ke3RvdGFsQ291bnR9YDsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfSk7DQogICAgcHJvbWlzZXMucHVzaChwcm9taXNlKTsNCn0NCg0KY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKHByb21pc2VzKTsNCg0KbGV0IHN1Y2Nlc3MgPSB0cnVlOw0KbGV0IGZpcnN0VW5zdWNlc3NmdWxSZXN1bHQgPSBudWxsOw0KZm9yKGxldCByZXN1bHQgb2YgcmVzdWx0cykgew0KICAgIGlmIChyZXN1bHQuc3VjY2Vzcykgew0KICAgICAgICBjb250aW51ZTsNCiAgICB9DQogICAgc3VjY2VzcyA9IGZhbHNlOw0KICAgIGZpcnN0VW5zdWNlc3NmdWxSZXN1bHQgPSByZXN1bHQ7DQogICAgYnJlYWs7DQp9DQoNCmlmIChzdWNjZXNzKSB7DQogICAgb3MudG9hc3QoIlN1Y2Nlc3MhIik7DQoNCiAgICBpZiAodGhpc0JvdC5saW5rcy5ydW5UZXN0c0J1dHRvbikgew0KICAgICAgICB0aGlzQm90LmxpbmtzLnJ1blRlc3RzQnV0dG9uLm1hc2tzLmxhYmVsID0gYOKckyAke3N1Y2Nlc3NDb3VudH0vJHt0b3RhbENvdW50fWA7DQogICAgfQ0KDQogICAgcmV0dXJuIHRydWU7DQp9IGVsc2Ugew0KICAgIGNvbmZpZ0JvdC50YWdzLnN5c3RlbVBvcnRhbERpZmYgPSAndGVzdFN5c3RlbSc7DQogICAgY29uZmlnQm90LnRhZ3Muc3lzdGVtUG9ydGFsID0gZmlyc3RVbnN1Y2Vzc2Z1bFJlc3VsdC5zeXN0ZW07DQogICAgY29uZmlnQm90LnRhZ3Muc3lzdGVtUG9ydGFsUGFuZSA9ICdkaWZmJzsNCiAgICBjb25maWdCb3QudGFncy5zeXN0ZW1Qb3J0YWxEaWZmQm90ID0gZmlyc3RVbnN1Y2Vzc2Z1bFJlc3VsdC5kaWZmQm90SWQ7DQogICAgY29uZmlnQm90LnRhZ3Muc3lzdGVtUG9ydGFsRGlmZlRhZyA9ICd0aW1lbGluZSc7DQoNCiAgICBpZiAodGhpc0JvdC5saW5rcy5ydW5UZXN0c0J1dHRvbikgew0KICAgICAgICB0aGlzQm90LmxpbmtzLnJ1blRlc3RzQnV0dG9uLm1hc2tzLmxhYmVsID0gYOKdjCAke3N1Y2Nlc3NDb3VudH0vJHt0b3RhbENvdW50fWA7DQogICAgfQ0KDQogICAgcmV0dXJuIGZhbHNlOw0KfScArvq0uwgADWFiUmVjb3JkVHJhY2UCBACu+rS7COKNAb8KQGNvbnN0IGQgPSBhd2FpdCBvcy5jcmVhdGVEZWJ1Z2dlcih7DQogICAgcGF1c2FibGU6IHRydWUsDQogICAgYWxsb3dBc3luY2hyb25vdXNTY3JpcHRzOiB0cnVlDQp9KTsNCg0KaWYgKCFib3QudmFycy50cmFjZUNvdW50ZXIpIHsNCiAgICBib3QudmFycy50cmFjZUNvdW50ZXIgPSAwOw0KfQ0KYm90LnZhcnMudHJhY2VDb3VudGVyICs9IDE7DQpib3QudmFycy5kZWJ1ZyA9IGQ7DQpib3QudmFycy50cmFjaW5nID0gdHJ1ZTsNCmJvdC52YXJzLnRpbWVsaW5lID0gW107DQphd2FpdCBib3QuaG9va3VwRGVidWdnZXIoeyBkZWJ1ZzogZCwgYWRkS2V5czogZmFsc2UsIHRpbWVsaW5lOiBib3QudmFycy50aW1lbGluZSwgbm9XYXJuTWlzc2luZ0tleXM6IHRydWUgfSk7DQphd2FpdCBib3QuYWRkQm90c1RvRGVidWdnZXIoZCk7DQoNCmF3YWl0IG9zLmF0dGFjaERlYnVnZ2VyKGQsIHsNCiAgICB0YWdOYW1lTWFwcGVyOiB7DQogICAgICAgIGZvcndhcmQ6IGZvcndhcmRNYXBUYWdOYW1lLA0KICAgICAgICByZXZlcnNlOiByZXZlcnNlTWFwVGFnTmFtZQ0KICAgIH0sDQp9KTsNCg0KYXdhaXQgb3Muc2xlZXAoMTAwMCk7DQoNCmlmIChjb25maWdCb3QudGFncy5ncmlkUG9ydGFsKSB7DQogICAgYm90LnZhcnMub3JpZ2luYWxHcmlkUG9ydGFsID0gY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbDsNCiAgICBkLmNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPSBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsID0gJ3Rlc3QtJyArIGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWw7DQp9DQoNCnNob3V0KCJhYlNsZWVwIiwgInNsZWVwIik7DQpzaG91dCgnYWJSZXNldCcpOw0KDQpmdW5jdGlvbiBmb3J3YXJkTWFwVGFnTmFtZShuYW1lKSB7DQogICAgY29uc3QgYnVpbHRpblRhZ3MgPSBvcy5saXN0QnVpbHRpblRhZ3MoKTsNCiAgICBpZiAoYnVpbHRpblRhZ3Muc29tZSh0ID0+IHQgPT09IG5hbWUpKSB7DQogICAgICAgIHJldHVybiBuYW1lOw0KICAgIH0NCg0KICAgIHJldHVybiAndGVzdC0nICsgbmFtZTsNCn0NCg0KZnVuY3Rpb24gcmV2ZXJzZU1hcFRhZ05hbWUobmFtZSkgew0KICAgIGNvbnN0IGJ1aWx0aW5UYWdzID0gb3MubGlzdEJ1aWx0aW5UYWdzKCk7DQogICAgaWYgKGJ1aWx0aW5UYWdzLnNvbWUodCA9PiB0ID09PSBuYW1lKSkgew0KICAgICAgICByZXR1cm4gbmFtZTsNCiAgICB9DQoNCiAgICBsZXQgd2l0aG91dFRlc3QgPSBuYW1lLnN1YnN0cmluZygndGVzdC0nLmxlbmd0aCk7DQogICAgcmV0dXJuIHdpdGhvdXRUZXN0Ow0KfQ0KDQphd2FpdCBvcy5yZWdpc3RlckFwcCgnYWJUZXN0aW5nQXBwJywgdGhpc0JvdCk7DQp0aGlzQm90LnJlbmRlclRlc3RpbmdBcHAoKTsnAK76tLsIAA1hYlN0b3BUcmFjaW5nAgQArvq0uwiimAG4CEBpZiAoYm90LnZhcnMuZGVidWcpIHsNCiAgICBhd2FpdCBvcy5kZXRhY2hEZWJ1Z2dlcihib3QudmFycy5kZWJ1Zyk7DQp9DQoNCmJvdC52YXJzLmRlYnVnID0gbnVsbDsNCmJvdC52YXJzLnRyYWNpbmcgPSBudWxsOw0KDQppZiAoYm90LnZhcnMub3JpZ2luYWxHcmlkUG9ydGFsKSB7DQogICAgY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9IGJvdC52YXJzLm9yaWdpbmFsR3JpZFBvcnRhbDsNCiAgICBib3QudmFycy5vcmlnaW5hbEdyaWRQb3J0YWwgPSBudWxsOw0KfQ0KDQpjb25zb2xlLmxvZygnW2RlYnVnXSBEb25lIScpOw0KbGV0IGZpbmFsVGltZWxpbmUgPSBib3QuY29tcGlsZVRpbWVsaW5lKHsgdGltZWxpbmU6IGJvdC52YXJzLnRpbWVsaW5lIH0pOw0KDQpjb25zdCB0cmFjZU5hbWUgPSAndHJhY2VzLicgKyBwYWQoYm90LnZhcnMudHJhY2VDb3VudGVyLnRvU3RyaW5nKCkpOw0KY29uc3QgcmVuZGVyZWQgPSB0aGlzQm90LnJlbmRlclRpbWVsaW5lKHsgdGltZWxpbmU6IGZpbmFsVGltZWxpbmUsIG5hbWU6IHRyYWNlTmFtZSB9KTsNCmNvbnN0IHsgcmVzdWx0Qm90IH0gPSB0aGlzQm90LmNyZWF0ZUJvdHNGb3JSZW5kZXJlZFRpbWVsaW5lKHsgcmVzdWx0OiByZW5kZXJlZCwgc3lzdGVtOiB0cmFjZU5hbWUgfSk7DQoNCnNob3V0KCJhYlNsZWVwIiwgIndha2UiKTsNCnRoaXNCb3QucmVuZGVyVGVzdGluZ0FwcCgpOw0KDQpvcy5mb2N1c09uKHJlc3VsdEJvdCwgew0KICAgIHRhZzogJ3RpbWVsaW5lJywNCiAgICBwb3J0YWw6ICdzeXN0ZW0nLA0KICAgIGxpbmVOdW1iZXI6IDAsDQogICAgY29sdW1uTnVtYmVyOiAwDQp9KTsNCg0KZnVuY3Rpb24gcGFkKHN0cikgew0KDQogICAgbGV0IHJlbWFpbmluZyA9IDYgLSBzdHIubGVuZ3RoOw0KICAgIGlmIChyZW1haW5pbmcgPiAwKSB7DQogICAgICAgIGxldCBwYWRkZWQgPSAnMCcucmVwZWF0KHJlbWFpbmluZyk7DQogICAgICAgIHJldHVybiBwYWRkZWQgKyBzdHI7DQogICAgfQ0KDQogICAgLy8gd2hpbGUoc3RyLmxlbmd0aCA8IDYpIHsNCiAgICAvLyAgICAgc3RyICs9ICcwJyArIHN0cjsNCiAgICAvLyB9DQoNCiAgICByZXR1cm4gc3RyOw0KfScArvq0uwgADnJlbmRlclRpbWVsaW5lAgQArvq0uwjboAGWJUBjbGFzcyBTdHJpbmdCdWlsZGVyIHsNCiAgICBjb25zdHJ1Y3RvcihzdHIpIHsNCiAgICAgICAgdGhpcy5pbmRlbnQgPSAwOw0KICAgICAgICB0aGlzLm1hcmtlcnMgPSBbXTsNCiAgICAgICAgdGhpcy5zdHIgPSBzdHI7DQogICAgICAgIHRoaXMubG9jID0gbG9jKHN0cik7DQogICAgfQ0KDQogICAgYXBwZW5kTGluZShzKSB7DQogICAgICAgIGlmICh0aGlzLmluZGVudCA+IDApIHsNCiAgICAgICAgICAgIHRoaXMuc3RyICs9IGluZGVudChzLCB0aGlzLmluZGVudCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB0aGlzLnN0ciArPSBzOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuc3RyICs9ICdcbic7DQogICAgICAgIHRoaXMubG9jID0gbG9jKHRoaXMuc3RyKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KDQogICAgYXBwZW5kKHMpIHsNCiAgICAgICAgdGhpcy5zdHIgKz0gczsNCiAgICAgICAgdGhpcy5sb2MgPSBsb2ModGhpcy5zdHIpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQp9DQoNCmZ1bmN0aW9uIGxvYyhzdHIpIHsNCiAgICBjb25zdCBsaW5lcyA9IHN0ci5zcGxpdCgnXG4nKTsNCiAgICBjb25zdCBsaW5lID0gbGluZXMubGVuZ3RoOw0KICAgIGNvbnN0IGNvbCA9IGxpbmVzW2xpbmVzLmxlbmd0aCAtIDFdLmxlbmd0aDsNCiAgICByZXR1cm4gew0KICAgICAgICBsaW5lLA0KICAgICAgICBjb2wNCiAgICB9Ow0KfQ0KDQpmdW5jdGlvbiByZW5kZXJUaW1lbGluZSh0aW1lbGluZSwgbmFtZSkgew0KICAgIGxldCBidWlsZGVyID0gbmV3IFN0cmluZ0J1aWxkZXIoJ0AnKTsNCiAgICBidWlsZGVyLmFwcGVuZExpbmUoJy8vIE5vdGU6IHRoaXMgaXMgYSB2aXN1YWxpemF0aW9uIG9mIHRoZSB0ZXN0IHRpbWVsaW5lLicpOw0KICAgIGJ1aWxkZXIuYXBwZW5kTGluZSgnLy8gSXQgZG9lcyBub3QgY29udGFpbiB3b3JraW5nIGNvZGUuXG4nKTsNCiAgICBidWlsZGVyLmFwcGVuZExpbmUoYHN0YXJ0KCcke25hbWV9JylgKTsNCiAgICBmb3IobGV0IGV2ZW50IG9mIHRpbWVsaW5lKSB7DQogICAgICAgIHJlbmRlckV2ZW50KGV2ZW50LCBidWlsZGVyKTsNCiAgICB9DQoNCiAgICBjb25zb2xlLmxvZyhidWlsZGVyLnN0cik7DQogICAgYnVpbGRlci5hcHBlbmRMaW5lKCdlbmQoKScpOw0KICAgIHJldHVybiB7DQogICAgICAgIHN0cmluZzogYnVpbGRlci5zdHIsDQogICAgICAgIG1hcmtlcnM6IGJ1aWxkZXIubWFya2Vycw0KICAgIH07DQp9DQoNCmZ1bmN0aW9uIHJlbmRlckV2ZW50KGV2ZW50LCBidWlsZGVyKSB7DQogICAgY29uc29sZS5sb2coJ3JlbmRlcicsIGV2ZW50KTsNCiAgICBpZiAoZXZlbnQudHlwZSA9PT0gJ3VzZXJfYWN0aW9uJykgew0KICAgICAgICByZW5kZXJVc2VyQWN0aW9uKGV2ZW50LCBidWlsZGVyKTsNCiAgICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09ICdlbWl0dGVkX2FjdGlvbicpIHsNCiAgICAgICAgcmVuZGVyRW1pdHRlZEFjdGlvbihldmVudCwgYnVpbGRlcik7DQogICAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSAnY2hlY2snKSB7DQogICAgICAgIGJ1aWxkZXIuYXBwZW5kTGluZShgY2hlY2s6ICR7Z2V0Rm9ybWF0dGVkSlNPTihldmVudC5kaWZmKX1gKTsNCiAgICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09ICd1cGRhdGVfdGFnJykgew0KICAgICAgICByZW5kZXJVcGRhdGVUYWcoZXZlbnQsIGJ1aWxkZXIpOw0KICAgIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gJ3VwZGF0ZV90YWdfbWFzaycpIHsNCiAgICAgICAgcmVuZGVyVXBkYXRlVGFnTWFzayhldmVudCwgYnVpbGRlcik7DQogICAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSAnc2NyaXB0Jykgew0KICAgICAgICByZW5kZXJTY3JpcHQoZXZlbnQsIGJ1aWxkZXIpOw0KICAgIH0NCn0NCg0KZnVuY3Rpb24gcmVuZGVyU2hvdXQoZXZlbnQsIGJ1aWxkZXIpIHsNCiAgICBidWlsZGVyLmFwcGVuZExpbmUoYC8vIEAke2V2ZW50LmFjdGlvbi5ldmVudE5hbWV9YCk7DQogICAgaWYgKGV2ZW50LmFjdGlvbi5rZXlzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgYnVpbGRlci5hcHBlbmRMaW5lKGB3aGlzcGVyLiR7ZXZlbnQuYWN0aW9uLmV2ZW50TmFtZX0oJyR7ZXZlbnQuYWN0aW9uLmtleXMuam9pbignLCcpfScpYCk7DQogICAgfSBlbHNlIHsNCiAgICAgICAgYnVpbGRlci5hcHBlbmRMaW5lKGBzaG91dC4ke2V2ZW50LmFjdGlvbi5ldmVudE5hbWV9KClgKTsNCiAgICB9DQp9DQoNCmZ1bmN0aW9uIHJlbmRlckVtaXR0ZWRBY3Rpb24oZXZlbnQsIGJ1aWxkZXIpIHsNCiAgICBsZXQgcHJlZml4ID0gJyc7DQogICAgaWYgKCd0YXNrSWQnIGluIGV2ZW50LmFjdGlvbikgew0KICAgICAgICBwcmVmaXggPSBgXCQke2V2ZW50LmFjdGlvbi50YXNrSWR9OiBgOw0KICAgIH0NCiAgICBsZXQgeyB0YXNrSWQsIHR5cGUsIC4uLnJlc3QgfSA9IGV2ZW50LmFjdGlvbjsNCg0KICAgIGlmIChldmVudC5sb2NhdGlvbikgew0KICAgICAgICBidWlsZGVyLm1hcmtlcnMucHVzaCh7DQogICAgICAgICAgICBsaW5lOiBidWlsZGVyLmxvYy5saW5lLA0KICAgICAgICAgICAgbGFiZWw6ICdHbyB0byBhY3Rpb24nLA0KICAgICAgICAgICAgbG9jYXRpb246IGV2ZW50LmxvY2F0aW9uDQogICAgICAgIH0pOw0KICAgIH0NCg0KICAgIGJ1aWxkZXIuYXBwZW5kTGluZShgJHtwcmVmaXh9JHt0eXBlfSgke2dldEZvcm1hdHRlZEpTT04ocmVzdCl9KWApOw0KfQ0KDQpmdW5jdGlvbiByZW5kZXJVcGRhdGVUYWcoZXZlbnQsIGJ1aWxkZXIpIHsNCiAgICBpZiAoZXZlbnQubG9jYXRpb24pIHsNCiAgICAgICAgYnVpbGRlci5tYXJrZXJzLnB1c2goew0KICAgICAgICAgICAgbGluZTogYnVpbGRlci5sb2MubGluZSwNCiAgICAgICAgICAgIGxhYmVsOiAnR28gdG8gVGFnIFVwZGF0ZScsDQogICAgICAgICAgICBsb2NhdGlvbjogZXZlbnQubG9jYXRpb24NCiAgICAgICAgfSk7DQogICAgfQ0KDQogICAgYnVpbGRlci5hcHBlbmRMaW5lKGB1cGRhdGVUYWcoJHtldmVudC51cGRhdGUudGFnfSwgJHtnZXRGb3JtYXR0ZWRKU09OKGV2ZW50LnVwZGF0ZS5uZXdWYWx1ZSl9KWApOw0KfQ0KDQpmdW5jdGlvbiByZW5kZXJVcGRhdGVUYWdNYXNrKGV2ZW50LCBidWlsZGVyKSB7DQogICAgaWYgKGV2ZW50LmxvY2F0aW9uKSB7DQogICAgICAgIGJ1aWxkZXIubWFya2Vycy5wdXNoKHsNCiAgICAgICAgICAgIGxpbmU6IGJ1aWxkZXIubG9jLmxpbmUsDQogICAgICAgICAgICBsYWJlbDogJ0dvIHRvIFRhZyBNYXNrIFVwZGF0ZScsDQogICAgICAgICAgICBsb2NhdGlvbjogZXZlbnQubG9jYXRpb24NCiAgICAgICAgfSk7DQogICAgfQ0KDQogICAgYnVpbGRlci5hcHBlbmRMaW5lKGB1cGRhdGVUYWdNYXNrKCR7ZXZlbnQudXBkYXRlLnRhZ30sICR7ZXZlbnQudXBkYXRlLnNwYWNlfSwgJHtnZXRGb3JtYXR0ZWRKU09OKGV2ZW50LnVwZGF0ZS5uZXdWYWx1ZSl9KWApOw0KfQ0KDQpmdW5jdGlvbiByZW5kZXJTY3JpcHQoZXZlbnQsIGJ1aWxkZXIpIHsNCiAgICBpZiAoZXZlbnQubG9jYXRpb24pIHsNCiAgICAgICAgYnVpbGRlci5tYXJrZXJzLnB1c2goew0KICAgICAgICAgICAgbGluZTogYnVpbGRlci5sb2MubGluZSwNCiAgICAgICAgICAgIGxhYmVsOiAnR28gdG8gU2NyaXB0JywNCiAgICAgICAgICAgIGxvY2F0aW9uOiBldmVudC5sb2NhdGlvbg0KICAgICAgICB9KTsNCiAgICB9DQoNCiAgICBidWlsZGVyLmFwcGVuZExpbmUoYHJ1bl9zY3JpcHQoJyR7ZXZlbnQuYm90SWR9JywgJyR7ZXZlbnQudGFnfScsICgpID0+IHtgKTsNCiAgICBidWlsZGVyLmluZGVudCArPSA0Ow0KICAgIGZvciAobGV0IGUgb2YgZXZlbnQudGltZWxpbmUpIHsNCiAgICAgICAgcmVuZGVyRXZlbnQoZSwgYnVpbGRlcik7DQogICAgfQ0KICAgIGJ1aWxkZXIuaW5kZW50IC09IDQ7DQogICAgYnVpbGRlci5hcHBlbmRMaW5lKCdcbn0pJyk7DQp9DQoNCmZ1bmN0aW9uIHJlbmRlclVzZXJBY3Rpb24oZXZlbnQsIGJ1aWxkZXIpIHsNCiAgICBpZiAoJ3RpbWVsaW5lJyBpbiBldmVudCkgew0KICAgICAgICBmb3IgKGxldCBlIG9mIGV2ZW50LnRpbWVsaW5lKSB7DQogICAgICAgICAgICByZW5kZXJFdmVudChlLCBidWlsZGVyKTsNCiAgICAgICAgfQ0KICAgIH0gZWxzZSBpZiAoZXZlbnQuYWN0aW9uLnR5cGUgPT09ICdhY3Rpb24nKSB7DQogICAgICAgIHJlbmRlclNob3V0KGV2ZW50LCBidWlsZGVyKTsNCiAgICB9IGVsc2UgaWYgKGV2ZW50LmFjdGlvbi50eXBlID09PSAnYXN5bmNfcmVzdWx0Jykgew0KICAgICAgICBsZXQgZm9ybWF0dGVkID0gZ2V0Rm9ybWF0dGVkSlNPTihldmVudC5hY3Rpb24ucmVzdWx0KTsNCiAgICAgICAgbGV0IGNvbW1lbnRlZCA9IGZvcm1hdHRlZC5zcGxpdCgnXG4nKS5tYXAobGluZSA9PiBgLy8gJHtsaW5lfWApLmpvaW4oJ1xuJyk7DQoNCiAgICAgICAgYnVpbGRlci5hcHBlbmRMaW5lKGAke2NvbW1lbnRlZH0gLT4gXCQke2V2ZW50LmFjdGlvbi50YXNrSWR9YCk7DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBpbmRlbnQoc3RyLCBsZXZlbCkgew0KICAgIGxldCBsaW5lcyA9IHN0ci5zcGxpdCgnXG4nKTsNCiAgICBsZXQgaW5kZW50U3RyaW5nID0gJyAnLnJlcGVhdChsZXZlbCk7DQogICAgbGV0IGluZGVudGVkID0gbGluZXMubWFwKGwgPT4gbC5sZW5ndGggPiAwID8gaW5kZW50U3RyaW5nICsgbCA6IGwpOw0KICAgIHJldHVybiBpbmRlbnRlZC5qb2luKCdcbicpOw0KfQ0KDQpjb25zdCB7IHRpbWVsaW5lLCBuYW1lIH0gPSB0aGF0Ow0KDQpyZXR1cm4gcmVuZGVyVGltZWxpbmUodGltZWxpbmUsIG5hbWUpOycArvq0uwgAHWNyZWF0ZUJvdHNGb3JSZW5kZXJlZFRpbWVsaW5lAgQArvq0uwjyxQGRB0Bjb25zdCB7IHN5c3RlbSwgcmVzdWx0LCBjcmVhdG9yLCBzeXN0ZW1UYWcgfSA9IHRoYXQ7DQoNCi8vIGNvbnN0IHN5c3RlbSA9IHN5c3RlbVByZWZpeCArIHRlc3RDYXNlLnRhZ3MudGVzdE5hbWU7DQoNCmxldCByZXN1bHRCb3QgPSBjcmVhdGUoew0KICAgIHNwYWNlOiAndGVtcExvY2FsJywNCiAgICBjcmVhdG9yOiBjcmVhdG9yPy5pZCwNCiAgICBfX3Rlc3Q6IHRydWUsDQogICAgX190ZXN0UmVzdWx0OiB0cnVlLA0KICAgIHRpbWVsaW5lOiByZXN1bHQuc3RyaW5nLA0KICAgIFtzeXN0ZW1UYWcgPz8gJ3N5c3RlbSddOiBzeXN0ZW0NCn0pOw0KDQpjb25zdCBtYXJrZXJNb2QgPSB7DQogICAgc3BhY2U6ICd0ZW1wTG9jYWwnLA0KICAgIGNyZWF0b3I6IHJlc3VsdEJvdC5pZCwNCiAgICBfX3Rlc3Q6IHRydWUsDQogICAgX190ZXN0UmVzdWx0OiB0cnVlLA0KICAgIGZvcm06ICdjb2RlQnV0dG9uJywNCiAgICBvbkNsaWNrOiBgQG9zLmZvY3VzT24oYm90LnRhZ3MubG9jYXRpb24uYm90SWQsIHsgcG9ydGFsOiAnc3lzdGVtJywgdGFnOiBib3QudGFncy5sb2NhdGlvbi50YWcsIGxpbmVOdW1iZXI6IGJvdC50YWdzLmxvY2F0aW9uLmxpbmUsIGNvbHVtbk51bWJlcjogYm90LnRhZ3MubG9jYXRpb24uY29sdW1uIH0pYA0KfTsNCg0KZm9yIChsZXQgbWFya2VyIG9mIHJlc3VsdC5tYXJrZXJzKSB7DQogICAgY3JlYXRlKG1hcmtlck1vZCwgew0KICAgICAgICBbYCR7cmVzdWx0Qm90LmlkfS50aW1lbGluZWBdOiB0cnVlLA0KICAgICAgICBbYCR7cmVzdWx0Qm90LmlkfS50aW1lbGluZVN0YXJ0YF06IG1hcmtlci5saW5lLA0KICAgICAgICBsYWJlbDogbWFya2VyLmxhYmVsLA0KICAgICAgICBsb2NhdGlvbjogbWFya2VyLmxvY2F0aW9uLA0KICAgIH0pOw0KfQ0KDQpyZXR1cm4gew0KICAgIHJlc3VsdEJvdA0KfTsnAK76tLsIAAdhYlRlc3RzAgQArvq0uwiEzQEEdHJ1ZScArvq0uwgABGZvcm0CBACu+rS7CInNAQdub3RoaW5nKACu+rS7CAAMYWJCb3RWZXJzaW9uAX0DJwCu+rS7CAAIYWJJZ25vcmUCBACu+rS7CJLNAQR0cnVlKACu+rS7CAANYWIxQm90VmVyc2lvbgF7f/gAAAAAAAAA',
    'AQHJrdmmCxWo8o3XzAroAgF5AfKN18wKAegCAQ==',
    'AQXJrdmmCxantp6erQrK0gECBADJrdmmCxYFQXdha2Wo8o3XzArCAgF4p/KN18wKwwICBADJrdmmCx0kZTk1MTgzZmItNjk3Ni00NTIyLWJkMjItM2I0NjBiZGEwNGI1AvKN18wKAcICJraenq0KAcrSAQc=',
    'AQK9gf3qBgCnya3ZpgsdAgQAvYH96gYAJDlhNGQ4YjA5LTE0ZTctNDdhZC05ZmYwLTJhYzljMmNmYWRiZAHJrdmmCwEdJQ==',
    'AQKir6UuAKe9gf3qBgACBACir6UuACQ3ODE5NTk1NC01MDY2LTRlNzktODNmYi0wYmU4NTIwMTI3NmEBvYH96gYBACU=',
    'AQK836jpAgCnoq+lLgACBAC836jpAgAkNGYzMzY2YzUtNjVmOS00NmRmLWIxOWUtMzBkYTVjODExYmUxAaKvpS4BACU=',
    'AQL/85I7AKe836jpAgACBAD/85I7ACQ2ZTVmNzI5YS05MjhmLTQ1ZTktYmIyZi01YjZkN2U2N2JlZDQBvN+o6QIBACU=',
    'AQKC6Ma1BACn//OSOwACBACC6Ma1BAAkZDg3MTM5ZjMtNmE3MC00YWU4LTk2NzctNDZkYmRkYjZjNDM5Af/zkjsBACU=',
    'AQLepMyCCgCngujGtQQAAgQA3qTMggoAJDg2NmE3NjY1LWM3YjYtNDc2NC1iZmVkLTdjYTNiMzZjMTE5YQGC6Ma1BAEAJQ==',
    'AQLdsLaUBACn3qTMggoAAgQA3bC2lAQAJGIwZGY2ZWM4LWU3MWUtNDNjYi1iZGViLWM5NTcxNjI1OTZiZAHepMyCCgEAJQ==',
    'AQLaotrODACn3bC2lAQAAgQA2qLazgwAJDY4ZjkzOGY4LThhY2MtNDdhZi05YThmLTIwYmQ2NmQ1MmQ2NQHdsLaUBAEAJQ==',
];
