{"version":2,"updates":[{"id":0,"timestamp":1686590474100,"update":"ASjD/6H+BAAnAQRib3RzJGI4M2Q5NzJiLTA1MzUtNDA1MS1iNTg5LTQxY2VkYTg1MzVmMQEnAMP/of4EAAZzeXN0ZW0CBADD/6H+BAESYWItMS50ZXN0cy5tYW5hZ2VyJwDD/6H+BAALcnVuVGVzdENhc2UCBADD/6H+BBT/GkBjb25zdCB0ZXN0Q2FzZSA9IGdldEJvdCgnaWQnLCB0aGF0KTsNCmlmICghdGVzdENhc2UpIHsNCiAgICBjb25zb2xlLmxvZygnVGVzdCBjYXNlIG5vdCBmb3VuZCEnKTsNCiAgICByZXR1cm47DQp9DQoNCmlmICh0ZXN0Q2FzZS50YWdzLnN5c3RlbSkgew0KICAgIGRlc3Ryb3koZ2V0Qm90cygNCiAgICAgICAgYnlUYWcoJ19fdGVzdFJlc3VsdCcsIHRydWUpDQogICAgKSk7DQp9DQoNCmNvbnN0IGQgPSBhd2FpdCBvcy5jcmVhdGVEZWJ1Z2dlcih7DQogICAgcGF1c2FibGU6IHRydWUsDQogICAgYWxsb3dBc3luY2hyb25vdXNTY3JpcHRzOiB0cnVlDQp9KTsNCg0KaWYgKHR5cGVvZiB0ZXN0Q2FzZS50YWdzLnJhbmRvbVNlZWQgPT09ICdudW1iZXInIHx8IHR5cGVvZiB0ZXN0Q2FzZS50YWdzLnJhbmRvbVNlZWQgPT09ICdzdHJpbmcnKSB7DQogICAgZC5tYXRoLnNldFJhbmRvbVNlZWQodGVzdENhc2UudGFncy5yYW5kb21TZWVkKTsNCn0NCmNvbnN0IHRpbWVsaW5lID0gW107DQphd2FpdCBib3QuaG9va3VwRGVidWdnZXIoeyBkZWJ1ZzogZCwgdGltZWxpbmUgfSk7DQphd2FpdCBib3QuYWRkQm90c1RvRGVidWdnZXIoZCk7DQoNCmxldCBhY3Rpb25zVG9QZXJmb3JtID0gW107DQpsZXQgYXN5bmNSZXN1bHRzID0ge307IA0KDQpmb3IgKGxldCBldmVudCBvZiB0ZXN0Q2FzZS50YWdzLnRpbWVsaW5lKSB7DQogICAgcHJlcHJvY2Vzc0V2ZW50KGV2ZW50KTsNCn0NCg0KZnVuY3Rpb24gcHJlcHJvY2Vzc0V2ZW50KGV2ZW50KSB7DQogICAgaWYgKGV2ZW50LnR5cGUgPT09ICd1c2VyX2FjdGlvbicpIHsNCiAgICAgICAgaWYgKCd0aW1lbGluZScgaW4gZXZlbnQpIHsNCiAgICAgICAgICAgIGZvciAobGV0IGUgb2YgZXZlbnQudGltZWxpbmUpIHsNCiAgICAgICAgICAgICAgICBwcmVwcm9jZXNzRXZlbnQoZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBsZXQgYWN0aW9uID0gZXZlbnQuYWN0aW9uOw0KICAgICAgICAgICAgaWYgKGFjdGlvbi50eXBlID09PSAnYWN0aW9uJyAmJiAna2V5cycgaW4gYWN0aW9uKSB7DQogICAgICAgICAgICAgICAgbGV0IGJvdElkcyA9IGFjdGlvbi5rZXlzLm1hcChrID0+IHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQuZ2V0SUQoZC5nZXRCb3QoDQogICAgICAgICAgICAgICAgICAgICAgICBlaXRoZXIoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnlUYWcoJ3N5c3RlbScsIGspLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ5VGFnKCdfX2tleScsIGspKQ0KICAgICAgICAgICAgICAgICAgICApKTsNCiAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgIGFjdGlvbiA9IHsNCiAgICAgICAgICAgICAgICAgICAgLi4uYWN0aW9uLA0KICAgICAgICAgICAgICAgICAgICBib3RJZHMsDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICBkZWxldGUgYWN0aW9uLmtleXM7DQogICAgICAgICAgICAgICAgYWN0aW9uc1RvUGVyZm9ybS5wdXNoKGFjdGlvbik7DQogICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbi50eXBlID09PSAnYXN5bmNfcmVzdWx0Jykgew0KICAgICAgICAgICAgICAgIGFzeW5jUmVzdWx0c1thY3Rpb24udGFza0lkXSA9IGFjdGlvbjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gJ3NjcmlwdCcpIHsNCiAgICAgICAgZm9yIChsZXQgZSBvZiBldmVudC50aW1lbGluZSkgew0KICAgICAgICAgICAgcHJlcHJvY2Vzc0V2ZW50KGUpOw0KICAgICAgICB9DQogICAgfQ0KfQ0KDQpsZXQgcmVzb2x2ZTsNCmxldCByZWplY3Q7DQpsZXQgcHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXMsIHJlaikgPT4gew0KICAgIHJlc29sdmUgPSByZXM7DQogICAgcmVqZWN0ID0gcmVqOw0KfSkNCg0KY29uc3QgZXhwZWN0ZWRUaW1lbGluZSA9IHRlc3RDYXNlLnRhZ3MudGltZWxpbmUuc2xpY2UoKTsNCg0KZC5vblNjcmlwdEFjdGlvbkVucXVldWVkKGEgPT4gew0KICAgIGlmIChhLnR5cGUgIT09ICdhc3luY19yZXN1bHQnICYmICd0YXNrSWQnIGluIGEpIHsNCiAgICAgICAgLy8gYXN5bmMgdGFzayB3YXMgZW5xdWV1ZWQNCiAgICAgICAgLy8gc2VuZCBhc3luYyByZXN1bHQNCiAgICAgICAgbGV0IHJlc3VsdCA9IGFzeW5jUmVzdWx0c1thLnRhc2tJZF07DQogICAgICAgIGlmIChyZXN1bHQpIHsNCiAgICAgICAgICAgIGQucGVyZm9ybVVzZXJBY3Rpb24ocmVzdWx0KTsNCiAgICAgICAgfQ0KICAgIH0NCn0pOw0KDQpmb3IgKGxldCBhIG9mIGFjdGlvbnNUb1BlcmZvcm0pIHsNCiAgICBjb25zb2xlLmxvZygncGVyZm9ybScsIGEpOw0KICAgIGF3YWl0IGQucGVyZm9ybVVzZXJBY3Rpb24oYSk7DQp9DQoNCmZvciAobGV0IGkgPSAwOyBpIDwgNTA7IGkrKykgew0KICAgIGF3YWl0IFByb21pc2UucmVzb2x2ZSgpOw0KfQ0KDQpjb25zdCByZXN1bHRUaW1lbGluZSA9IGJvdC5jb21waWxlVGltZWxpbmUoeyB0aW1lbGluZTogdGltZWxpbmUgfSk7DQoNCmNvbnNvbGUubG9nKCdSZXN1bHQnLCByZXN1bHRUaW1lbGluZSk7DQoNCmxldCByZW5kZXJlZFJlc3VsdCA9IHRoaXNCb3QucmVuZGVyVGltZWxpbmUoeyB0aW1lbGluZTogcmVzdWx0VGltZWxpbmUsIG5hbWU6IHRlc3RDYXNlLnRhZ3MudGVzdE5hbWUgfSk7DQpsZXQgZXhwZWN0ZWRSZXN1bHQgPSB0aGlzQm90LnJlbmRlclRpbWVsaW5lKHsgdGltZWxpbmU6IGV4cGVjdGVkVGltZWxpbmUsIG5hbWU6IHRlc3RDYXNlLnRhZ3MudGVzdE5hbWUgfSk7DQoNCmlmIChyZW5kZXJlZFJlc3VsdC5zdHJpbmcgPT09IGV4cGVjdGVkUmVzdWx0LnN0cmluZykgew0KICAgIHJldHVybiB7DQogICAgICAgIHN1Y2Nlc3M6IHRydWUNCiAgICB9Ow0KICAgIC8vIG9zLnRvYXN0KCdTdWNlc3MhJyk7DQp9IGVsc2Ugew0KICAgIGNvbnN0IHN5c3RlbSA9ICd0ZXN0LWZhaWx1cmVzLicgKyB0ZXN0Q2FzZS50YWdzLnRlc3ROYW1lOw0KICAgIGxldCB7IHJlc3VsdEJvdCB9ID0gdGhpc0JvdC5jcmVhdGVCb3RzRm9yUmVuZGVyZWRUaW1lbGluZSh7DQogICAgICAgIHN5c3RlbSwNCiAgICAgICAgcmVzdWx0OiByZW5kZXJlZFJlc3VsdCwNCiAgICAgICAgY3JlYXRvcjogdGVzdENhc2UsDQogICAgICAgIHN5c3RlbVRhZzogJ3Rlc3RTeXN0ZW0nDQogICAgfSk7DQoNCiAgICBsZXQgeyByZXN1bHRCb3Q6IGV4cGVjdGVkQm90IH0gPSB0aGlzQm90LmNyZWF0ZUJvdHNGb3JSZW5kZXJlZFRpbWVsaW5lKHsNCiAgICAgICAgc3lzdGVtLA0KICAgICAgICByZXN1bHQ6IGV4cGVjdGVkUmVzdWx0LA0KICAgICAgICB0ZXN0Q2FzZSwNCiAgICAgICAgc3lzdGVtVGFnOiAnc3lzdGVtJw0KICAgIH0pOw0KDQogICAgcmV0dXJuIHsNCiAgICAgICAgc3VjY2VzczogZmFsc2UsDQogICAgICAgIHN5c3RlbTogc3lzdGVtLA0KICAgICAgICBkaWZmQm90SWQ6IGV4cGVjdGVkQm90LmlkLA0KICAgIH07DQp9JwDD/6H+BAAOaG9va3VwRGVidWdnZXICBADD/6H+BJQbuj5AY29uc3QgeyBkZWJ1ZzogZCwgYWRkS2V5cywgdGltZWxpbmUsIG5vV2Fybk1pc3NpbmdLZXlzIH0gPSB0aGF0Ow0KY29uc3QgYm90VGltZWxpbmUgPSB0aW1lbGluZSA/PyBbXTsNCg0KY29uc3QgYWN0aW9uVGltZWxpbmVzID0ge307DQpjb25zdCBzY3JpcHRUaW1lbGluZXMgPSB7fTsNCg0KbGV0IGVtaXR0ZWRBY3Rpb25zID0gW107DQpjb25zdCBhc3luY1JlcXVlc3RzID0gbmV3IE1hcCgpOw0KbGV0IGFzeW5jVGltZWxpbmUgPSBudWxsOw0KbGV0IHN5bmNDb3VudGVyID0gMDsNCg0KbGV0IGJvdEtleXMgPSB7fTsNCg0KZnVuY3Rpb24gc2hvdWxkU2tpcEFjdGlvbihhKSB7DQogICAgY29uc3QgYyA9IGQuY29uZmlnQm90Ow0KICAgIGlmICghYykgew0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgaWYgKGEudHlwZSAhPT0gJ2FjdGlvbicpIHsNCiAgICAgICAgaWYgKGEudHlwZSA9PT0gJ3VwZGF0ZV9ib3QnKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIGlmIChhLnR5cGUgPT09ICdhZGRfYm90Jykgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0gZWxzZSBpZiAoYS50eXBlID09PSAncmVtb3ZlX2JvdCcpIHsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9IGVsc2UgaWYgKGEudHlwZSA9PT0gJ2FzeW5jX3Jlc3VsdCcpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfSBlbHNlIGlmIChhLnR5cGUgPT09ICdhc3luY19lcnJvcicpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfSBlbHNlIGlmIChhLnR5cGUgPT09ICdhcHBseV9zdGF0ZScpIHsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9IGVsc2UgaWYgKGEudHlwZSA9PT0gJ3JlZ2lzdGVyX2J1aWx0aW5fcG9ydGFsJykgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0gZWxzZSBpZihhLnR5cGUgPT09ICdjdXN0b21fYXBwX2NvbnRhaW5lcl9hdmFpbGFibGUnKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIGlmIChhLnR5cGUgPT09ICdyZWdpc3Rlcl9odG1sX2FwcCcgJiYgYS5hcHBJZCA9PT0gJ19yb290Jykgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0gZWxzZSBpZiAoYS50eXBlID09PSAnZGVmaW5lX2dsb2JhbF9ib3QnKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQoNCiAgICByZXR1cm4gZmFsc2U7DQp9DQoNCmZ1bmN0aW9uIHNob3VsZFNraXBVcGRhdGVGb3JCb3QodXBkYXRlKSB7DQogICAgY29uc3QgYiA9IGdldEJvdChieUlEKHVwZGF0ZS5ib3RJZCkpOw0KICAgIHJldHVybiAoDQogICAgICAgIGIgJiYgKA0KICAgICAgICAgICAgYnlUYWcoJ2FiMScpKGIpIHx8IGJ5VGFnKCdhYjFJRCcpKGIpDQogICAgICAgICkNCiAgICApOw0KfQ0KDQpkLm9uQmVmb3JlVXNlckFjdGlvbihhID0+IHsNCiAgICBpZiAoc2hvdWxkU2tpcEFjdGlvbihhKSkgew0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIGNvbnNvbGUubG9nKCd1c2VyIGFjdGlvbicsIGEpOw0KDQogICAgaWYgKGEudHlwZSA9PT0gJ2FjdGlvbicpIHsNCiAgICAgICAgYXN5bmNUaW1lbGluZSA9IG51bGw7DQogICAgICAgIHN5bmNDb3VudGVyICs9IDE7DQogICAgICAgIGFkZEJvdEFjdGlvbihhKTsNCiAgICB9IGVsc2Ugew0KICAgICAgICBpZiAoYS50eXBlID09PSAnYXN5bmNfcmVzdWx0Jykgew0KICAgICAgICAgICAgLy8gdGhlIHRpbWVsaW5lIHRoYXQgc3RhcnRlZCB0aGUgYXN5bmMgcmVxdWVzdC4NCiAgICAgICAgICAgIGFzeW5jVGltZWxpbmUgPSBhc3luY1JlcXVlc3RzLmdldChhLnRhc2tJZCk7DQogICAgICAgICAgICBpZiAoIWFzeW5jVGltZWxpbmUpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnYXN5bmMnLCBhc3luY1JlcXVlc3RzLCBhKTsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEFzeW5jIHRpbWVsaW5lIG5vdCBmb3VuZCBmb3IgdGFzayEgKHRhc2tJZDogJHthLnRhc2tJZH0pYCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBhc3luY1RpbWVsaW5lLnB1c2goew0KICAgICAgICAgICAgICAgIHR5cGU6ICd1c2VyX2FjdGlvbicsDQogICAgICAgICAgICAgICAgYWN0aW9uOiBhLA0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBib3RUaW1lbGluZS5wdXNoKHsNCiAgICAgICAgICAgICAgICB0eXBlOiAndXNlcl9hY3Rpb24nLA0KICAgICAgICAgICAgICAgIGFjdGlvbjogYSwNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgfQ0KfSk7DQoNCmQub25TY3JpcHRBY3Rpb25FbnF1ZXVlZChhID0+IHsNCiAgICBjb25zb2xlLmxvZygnZW1pdCBhY3Rpb24nLCBhKTsNCiAgICBjb25zb2xlLmxvZygnY2FsbCBzdGFjaycsIGQuZ2V0Q2FsbFN0YWNrKCkpOw0KICAgIGxldCB0aW1lbGluZSA9IGdldEN1cnJlbnRTY3JpcHRUaW1lbGluZSgpOw0KDQogICAgaWYgKHRpbWVsaW5lKSB7DQogICAgICAgIHRpbWVsaW5lLnB1c2goew0KICAgICAgICAgICAgdHlwZTogJ2VtaXR0ZWRfYWN0aW9uJywNCiAgICAgICAgICAgIGFjdGlvbjogYSwNCiAgICAgICAgICAgIGxvY2F0aW9uOiBnZXRDdXJyZW50U2NyaXB0TG9jYXRpb24oKSANCiAgICAgICAgfSk7DQogICAgfQ0KDQogICAgaWYgKCd0YXNrSWQnIGluIGEpIHsNCiAgICAgICAgaWYgKCF0aW1lbGluZSkgew0KICAgICAgICAgICAgZGVidWdnZXI7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSB0aW1lbGluZSBmb3IgdGhlIHNjcmlwdCBhY3Rpb24gY291bGQgbm90IGJlIGZvdW5kIScpOw0KICAgICAgICB9DQogICAgICAgIGFzeW5jUmVxdWVzdHMuc2V0KGEudGFza0lkLCB0aW1lbGluZSk7DQogICAgfQ0KfSk7DQoNCmQub25BZnRlclNjcmlwdFVwZGF0ZWRUYWcodXBkYXRlID0+IHsNCiAgICBpZiAoc2hvdWxkU2tpcFVwZGF0ZUZvckJvdCh1cGRhdGUpKSB7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICBjb25zb2xlLmxvZygndXBkYXRlIHRhZycsIHVwZGF0ZSk7DQogICAgY29uc29sZS5sb2coJ2NhbGwgc3RhY2snLCBkLmdldENhbGxTdGFjaygpKTsNCiAgICBsZXQgdGltZWxpbmUgPSBnZXRDdXJyZW50U2NyaXB0VGltZWxpbmUoKTsNCg0KICAgIGlmICh0aW1lbGluZSkgew0KICAgICAgICBsZXQgeyBib3RJZCwgLi4ucmVzdCB9ID0gdXBkYXRlOw0KDQogICAgICAgIHRpbWVsaW5lLnB1c2goew0KICAgICAgICAgICAgdHlwZTogJ3VwZGF0ZV90YWcnLA0KICAgICAgICAgICAgdXBkYXRlOiB7DQogICAgICAgICAgICAgICAgLi4ucmVzdCwNCiAgICAgICAgICAgICAgICBib3RJZDogZ2V0Qm90S2V5KGJvdElkKSA/PyBib3RJZA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGxvY2F0aW9uOiBnZXRDdXJyZW50U2NyaXB0TG9jYXRpb24oKQ0KICAgICAgICB9KTsNCiAgICB9DQp9KTsNCg0KZC5vbkFmdGVyU2NyaXB0VXBkYXRlZFRhZ01hc2sodXBkYXRlID0+IHsNCiAgICBpZiAoc2hvdWxkU2tpcFVwZGF0ZUZvckJvdCh1cGRhdGUpKSB7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICBjb25zb2xlLmxvZygndXBkYXRlIHRhZyBtYXNrJywgdXBkYXRlKTsNCiAgICBjb25zb2xlLmxvZygnY2FsbCBzdGFjaycsIGQuZ2V0Q2FsbFN0YWNrKCkpOw0KICAgIGxldCB0aW1lbGluZSA9IGdldEN1cnJlbnRTY3JpcHRUaW1lbGluZSgpOw0KDQogICAgaWYgKHRpbWVsaW5lKSB7DQogICAgICAgIGxldCB7IGJvdElkLCAuLi5yZXN0IH0gPSB1cGRhdGU7DQoNCiAgICAgICAgdGltZWxpbmUucHVzaCh7DQogICAgICAgICAgICB0eXBlOiAndXBkYXRlX3RhZ19tYXNrJywNCiAgICAgICAgICAgIHVwZGF0ZTogew0KICAgICAgICAgICAgICAgIC4uLnJlc3QsDQogICAgICAgICAgICAgICAgYm90SWQ6IGdldEJvdEtleShib3RJZCkgPz8gYm90SWQNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBsb2NhdGlvbjogZ2V0Q3VycmVudFNjcmlwdExvY2F0aW9uKCkNCiAgICAgICAgfSk7DQogICAgfQ0KfSk7DQoNCmZ1bmN0aW9uIGdldEN1cnJlbnRTY3JpcHRUaW1lbGluZSgpIHsNCiAgICBpZiAoIWFzeW5jVGltZWxpbmUpIHsNCiAgICAgICAgbGV0IGN1cnJlbnRTY3JpcHQgPSBnZXRDdXJyZW50U2NyaXB0KCk7DQogICAgICAgIGlmIChjdXJyZW50U2NyaXB0KSB7DQogICAgICAgICAgICByZXR1cm4gZ2V0U2NyaXB0VGltZWxpbmUoY3VycmVudFNjcmlwdC5ib3RJZCwgY3VycmVudFNjcmlwdC50YWcsIHN5bmNDb3VudGVyKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gYXN5bmNUaW1lbGluZTsNCiAgICB9DQp9DQoNCmZ1bmN0aW9uIGdldFNjcmlwdFRpbWVsaW5lKGJvdElkLCB0YWcsIHN5bmNDb3VudGVyKSB7DQogICAgY29uc3Qga2V5ID0gYCR7Ym90SWR9LiR7dGFnfToke3N5bmNDb3VudGVyfWA7DQogICAgbGV0IHRpbWVsaW5lID0gc2NyaXB0VGltZWxpbmVzW2tleV07DQogICAgaWYgKCF0aW1lbGluZSkgew0KICAgICAgICBzY3JpcHRUaW1lbGluZXNba2V5XSA9IHRpbWVsaW5lID0gW107DQogICAgICAgIGxldCBhY3Rpb25UaW1lbGluZSA9IGFjdGlvblRpbWVsaW5lc1tzeW5jQ291bnRlcl07DQoNCiAgICAgICAgaWYgKGFjdGlvblRpbWVsaW5lKSB7DQogICAgICAgICAgICBjb25zdCBvcmlnaW5hbEJvdElkID0gZ2V0T3JpZ2luYWxCb3RJZChib3RJZCk7DQogICAgICAgICAgICBhY3Rpb25UaW1lbGluZS5wdXNoKHsNCiAgICAgICAgICAgICAgICB0eXBlOiAnc2NyaXB0JywNCiAgICAgICAgICAgICAgICBib3RJZDogZ2V0Qm90S2V5KGJvdElkKSwNCiAgICAgICAgICAgICAgICB0YWc6IHRhZywNCiAgICAgICAgICAgICAgICBjb3VudDogc3luY0NvdW50ZXIsDQogICAgICAgICAgICAgICAgdGltZWxpbmUsDQogICAgICAgICAgICAgICAgbG9jYXRpb246IHsNCiAgICAgICAgICAgICAgICAgICAgYm90SWQ6IG9yaWdpbmFsQm90SWQsDQogICAgICAgICAgICAgICAgICAgIHRhZywNCiAgICAgICAgICAgICAgICAgICAgbGluZTogMCwNCiAgICAgICAgICAgICAgICAgICAgY29sdW1uOiAwDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIHRpbWVsaW5lOw0KfQ0KDQpmdW5jdGlvbiBnZXRDdXJyZW50U2NyaXB0KCkgew0KICAgIGNvbnN0IGNhbGxTdGFjayA9IGQuZ2V0Q2FsbFN0YWNrKCk7DQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjYWxsU3RhY2subGVuZ3RoOyBpKyspIHsNCiAgICAgICAgbGV0IGZyYW1lID0gY2FsbFN0YWNrW2ldOw0KICAgICAgICBpZiAoZnJhbWUubG9jYXRpb24/LmJvdElkICYmIGZyYW1lLmxvY2F0aW9uPy50YWcpIHsNCiAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgICAgYm90SWQ6IGZyYW1lLmxvY2F0aW9uLmJvdElkLA0KICAgICAgICAgICAgICAgIHRhZzogZnJhbWUubG9jYXRpb24udGFnDQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgcmV0dXJuIG51bGw7DQp9DQoNCmZ1bmN0aW9uIGdldEN1cnJlbnRTY3JpcHRMb2NhdGlvbigpIHsNCiAgICBjb25zdCBjYWxsU3RhY2sgPSBkLmdldENhbGxTdGFjaygpOw0KICAgIGZvciAobGV0IGkgPSBjYWxsU3RhY2subGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsNCiAgICAgICAgbGV0IGZyYW1lID0gY2FsbFN0YWNrW2ldOw0KICAgICAgICBpZiAoZnJhbWUubG9jYXRpb24/LmJvdElkICYmIGZyYW1lLmxvY2F0aW9uPy50YWcpIHsNCiAgICAgICAgICAgIGNvbnN0IGJvdElkID0gZ2V0T3JpZ2luYWxCb3RJZChmcmFtZS5sb2NhdGlvbi5ib3RJZCk7DQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgIGJvdElkOiBib3RJZCwNCiAgICAgICAgICAgICAgICB0YWc6IGZyYW1lLmxvY2F0aW9uLnRhZywNCiAgICAgICAgICAgICAgICBsaW5lOiBmcmFtZS5sb2NhdGlvbi5saW5lTnVtYmVyLA0KICAgICAgICAgICAgICAgIGNvbHVtbjogZnJhbWUubG9jYXRpb24uY29sdW1uTnVtYmVyDQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQogICAgfTsNCg0KICAgIHJldHVybiBudWxsOw0KfQ0KDQphc3luYyBmdW5jdGlvbiBhZGRCb3RBY3Rpb24oYSkgew0KICAgIGxldCBhY3Rpb247DQogICAgaWYgKGEuYm90SWRzKSB7DQogICAgICAgIGxldCBrZXlzID0gW107DQogICAgICAgIGZvciAobGV0IGJvdElkIG9mIGEuYm90SWRzKSB7DQogICAgICAgICAgICBjb25zdCBrZXkgPSBnZXRCb3RLZXkoYm90SWQpOw0KICAgICAgICAgICAgaWYgKCFrZXkpIHsNCiAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAga2V5cy5wdXNoKGtleSk7DQogICAgICAgIH0NCg0KICAgICAgICBhY3Rpb24gPSB7DQogICAgICAgICAgICAuLi5hLA0KICAgICAgICAgICAga2V5cw0KICAgICAgICB9Ow0KICAgICAgICBkZWxldGUgYWN0aW9uLmJvdElkczsNCiAgICB9IGVsc2Ugew0KICAgICAgICBhY3Rpb24gPSBhOw0KICAgIH0NCg0KICAgIGNvbnN0IHRpbWVsaW5lID0gYWN0aW9uVGltZWxpbmVzW3N5bmNDb3VudGVyXSA9IFsNCiAgICAgICAgew0KICAgICAgICAgICAgdHlwZTogJ3VzZXJfYWN0aW9uJywNCiAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uLA0KICAgICAgICB9DQogICAgXTsNCiAgICBib3RUaW1lbGluZS5wdXNoKHsNCiAgICAgICAgdHlwZTogJ3VzZXJfYWN0aW9uJywNCiAgICAgICAgdGltZWxpbmU6IHRpbWVsaW5lDQogICAgfSk7DQp9DQoNCmZ1bmN0aW9uIGdldE9yaWdpbmFsQm90SWQoYm90SWQpIHsNCiAgICBsZXQgYm90ID0gZC5nZXRCb3QoJ2lkJywgYm90SWQpOw0KICAgIGlmICghYm90IHx8ICFib3QudGFncy5fX29yaWdpbmFsQm90SWQpIHsNCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KICAgIGxldCBvcmlnaW5hbEJvdCA9IGdldEJvdCgnaWQnLCBib3QudGFncy5fX29yaWdpbmFsQm90SWQpOw0KICAgIGlmICghb3JpZ2luYWxCb3QpIHsNCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KDQogICAgcmV0dXJuIG9yaWdpbmFsQm90LmlkOw0KfQ0KDQpmdW5jdGlvbiBnZXRCb3RLZXkoYm90SWQpIHsNCiAgICBsZXQgYm90ID0gZC5nZXRCb3QoJ2lkJywgYm90SWQpOw0KICAgIGlmICghYm90IHx8ICFib3QudGFncy5fX29yaWdpbmFsQm90SWQpIHsNCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KICAgIGxldCBvcmlnaW5hbEJvdCA9IGdldEJvdCgnaWQnLCBib3QudGFncy5fX29yaWdpbmFsQm90SWQpOw0KICAgIGlmICghb3JpZ2luYWxCb3QpIHsNCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KICAgIGxldCBrZXkgPSBib3QudGFncy5fX2tleSA/PyBib3QudGFncy5zeXN0ZW0gPz8gYm90S2V5c1tib3RJZF07DQogICAgaWYgKCFrZXkpIHsNCiAgICAgICAgaWYgKGFkZEtleXMpIHsNCiAgICAgICAgICAgIGtleSA9IGJvdEtleXNbYm90SWRdID0gb3JpZ2luYWxCb3QudGFncy5fX2tleSA9IHV1aWQoKTsNCiAgICAgICAgfSBlbHNlIGlmIChub1dhcm5NaXNzaW5nS2V5cykgew0KICAgICAgICAgICAga2V5ID0gb3JpZ2luYWxCb3QuaWQ7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBjb25zb2xlLndhcm4oYE5vIGtleSBjb3VsZCBiZSBkZXRlcm1pbmVkIGZvciAke2JvdElkfSEgU2V0IHRoZSBzeXN0ZW0gdGFnIG9yIHRoZSBfX2tleSB0YWcgdG8gZW5hYmxlIGNvbnNpc3RlbnQgdGVzdHMuYCk7DQogICAgICAgICAgICBvcy50b2FzdChgTm8ga2V5IGNvdWxkIGJlIGRldGVybWluZWQgZm9yICR7Ym90SWR9ISBTZXQgdGhlIHN5c3RlbSB0YWcgb3IgdGhlIF9fa2V5IHRhZyB0byBlbmFibGUgY29uc2lzdGVudCB0ZXN0cy5gKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4ga2V5Ow0KfScAw/+h/gQAD2NvbXBpbGVUaW1lbGluZQIEAMP/of4Ez1naBEBsZXQgZmluYWxUaW1lbGluZSA9IFtdOw0KbGV0IGhhc1VzZXJBY3Rpb24gPSBmYWxzZTsNCmxldCB0aW1lbGluZSA9IHRoYXQudGltZWxpbmU7DQoNCmZvcihsZXQgaSA9IDA7IGkgPCB0aW1lbGluZS5sZW5ndGg7IGkrKykgew0KICAgIGNvbnN0IGV2ZW50ID0gdGltZWxpbmVbaV07DQoNCiAgICBpZiAoZXZlbnQudHlwZSA9PT0gJ3VzZXJfYWN0aW9uJykgew0KICAgICAgICBoYXNVc2VyQWN0aW9uID0gdHJ1ZTsNCg0KICAgICAgICBpZiAoJ3RpbWVsaW5lJyBpbiBldmVudCkgew0KICAgICAgICAgICAgaWYgKGV2ZW50LnRpbWVsaW5lLmxlbmd0aCA8PSAxKSB7DQogICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9IGVsc2UgaWYgKCFoYXNVc2VyQWN0aW9uKSB7DQogICAgICAgIGNvbnRpbnVlOw0KICAgIH0NCg0KICAgIGZpbmFsVGltZWxpbmUucHVzaChldmVudCk7DQp9DQoNCmNvbnNvbGUubG9nKCdbZGVidWddIFRpbWVsaW5lJywgdGltZWxpbmUuc2xpY2UoKSk7DQpjb25zb2xlLmxvZygnW2RlYnVnXSBGaW5hbCBUaW1lbGluZScsIGZpbmFsVGltZWxpbmUpOw0KcmV0dXJuIGZpbmFsVGltZWxpbmU7JwDD/6H+BAARYWRkQm90c1RvRGVidWdnZXICBADD/6H+BKpe5whAY29uc3QgZCA9IHRoYXQ7DQpjb25zdCB0ZXN0YWJsZUJvdHMgPSBnZXRCb3RzKA0KICAgIG5vdChieVRhZygnX190ZXN0JykpLA0KICAgIG5vdChieVRhZygnYWIxJykpLA0KICAgIG5vdChieVRhZygnYWIxSUQnKSksDQogICAgbm90KGJ5SUQoZ2V0SUQodGhpc0JvdCkpKSwNCiAgICBub3QoYnlUYWcoJ2FiMVRlc3RUb29scycpKSwNCiAgICBub3QoYnlTcGFjZSgnYm9vdHN0cmFwJykpDQopOw0KDQppZiAodGVzdGFibGVCb3RzLmxlbmd0aCA8PSAwKSB7DQogICAgdGhyb3cgbmV3IEVycm9yKCdVbmFibGUgdG8gY3JlYXRlIHRlc3Qgd2l0aCBubyBib3RzIScpOw0KfQ0KZm9yIChsZXQgYiBvZiB0ZXN0YWJsZUJvdHMpIHsNCiAgICBpZiAoYi5pZCA9PT0gZ3JpZFBvcnRhbEJvdC5pZCB8fCANCiAgICAgICAgYi5pZCA9PT0gY29uZmlnQm90LmlkIHx8DQogICAgICAgIGIuaWQgPT09IG1pbmlHcmlkUG9ydGFsQm90LmlkIHx8DQogICAgICAgIGIuaWQgPT09IG1hcFBvcnRhbEJvdC5pZCB8fA0KICAgICAgICBiLmlkID09PSBzeXN0ZW1Qb3J0YWxCb3QuaWQgfHwNCiAgICAgICAgYi5pZCA9PT0gc2hlZXRQb3J0YWxCb3QuaWQgfHwNCiAgICAgICAgYi5pZCA9PT0gdGFnUG9ydGFsQm90LmlkIHx8DQogICAgICAgIGIuaWQgPT09IG1lbnVQb3J0YWxCb3QuaWQgfHwNCiAgICAgICAgYi5pZCA9PT0gaWRlUG9ydGFsQm90LmlkIHx8DQogICAgICAgIGIuaWQgPT09IG1lZXRQb3J0YWxCb3QuaWQgfHwNCiAgICAgICAgYi5pZCA9PT0gYm90UG9ydGFsQm90LmlkIHx8DQogICAgICAgIGIuaWQgPT09IG1pbmlNYXBQb3J0YWxCb3QuaWQgfHwNCiAgICAgICAgYi5pZCA9PT0gbGVmdFdyaXN0UG9ydGFsQm90LmlkIHx8DQogICAgICAgIGIuaWQgPT09IHJpZ2h0V3Jpc3RQb3J0YWxCb3QuaWQpIHsNCiAgICAgICAgY29udGludWU7DQogICAgfQ0KDQogICAgbGV0IHRhZ3MgPSBPYmplY3Qua2V5cyhiLnRhZ3MpOw0KDQogICAgaWYgKHRhZ3MubGVuZ3RoIDw9IDApIHsNCiAgICAgICAgY29uc29sZS5sb2coJ25vIHRhZ3MhJywgYik7DQogICAgICAgIGNvbnRpbnVlOw0KICAgIH0NCiAgICBhd2FpdCBkLmNyZWF0ZShiLCB7DQogICAgICAgIF9fb3JpZ2luYWxCb3RJZDogYi5pZA0KICAgIH0pOw0KfScAw/+h/gQABWFiMUlEAgQAw/+h/gSSZw10ZXN0cy1tYW5hZ2VyJwDD/6H+BAAFY29sb3ICBADD/6H+BKBnByNmMWZmM2EnAMP/of4EAA9vblBvcnRhbENoYW5nZWQCBADD/6H+BKhnlQRAaWYgKHRoYXQucG9ydGFsID09PSAnc3lzdGVtUG9ydGFsJykgew0KICAgIGlmICghY29uZmlnQm90LnRhZ3MuY29kZVRvb2xzUG9ydGFsKSB7DQogICAgICAgIGNvbmZpZ0JvdC5tYXNrcy5jb2RlVG9vbHNQb3J0YWwgPSAnYWIxVGVzdFRvb2xzJzsNCg0KICAgICAgICBkZXN0cm95KGdldEJvdHMoDQogICAgICAgICAgICBieVRhZygnYWIxVGVzdFRvb2xzJywgdHJ1ZSksDQogICAgICAgICAgICBieVNwYWNlKCd0ZW1wTG9jYWwnKQ0KICAgICAgICApKTsNCg0KICAgICAgICBjb25zdCBydW5UZXN0c0J1dHRvbiA9IGNyZWF0ZSh7DQogICAgICAgICAgICBzcGFjZTogJ3RlbXBMb2NhbCcsDQogICAgICAgICAgICBhYjFUZXN0VG9vbHM6IHRydWUsDQogICAgICAgICAgICBsYWJlbDogJ1J1biBUZXN0cycsDQogICAgICAgICAgICBvbkNsaWNrOiBgQHNob3V0KCJhYjFSdW5UZXN0cyIpYCwNCiAgICAgICAgfSk7DQoNCiAgICAgICAgdGhpc0JvdC5tYXNrcy5ydW5UZXN0c0J1dHRvbiA9IHJ1blRlc3RzQnV0dG9uLmxpbms7DQogICAgfQ0KfScAw/+h/gQADWFiMVJlY29yZFRlc3QCBADD/6H+BL5rlwxAY29uc3QgdGVzdE5hbWUgPSBhd2FpdCBvcy5zaG93SW5wdXQoJycsIHsNCiAgICB0aXRsZTogJ0VudGVyIHRlc3QgbmFtZScNCn0pOw0KDQppZiAoIXRlc3ROYW1lKSB7DQogICAgb3MudG9hc3QoIllvdSBtdXN0IHByb3ZpZGUgYSB0ZXN0IG5hbWUgaW4gb3JkZXIgdG8gcmVjb3JkIGEgdGVzdC4iKTsNCiAgICByZXR1cm47DQp9DQoNCmNvbnN0IGQgPSBhd2FpdCBvcy5jcmVhdGVEZWJ1Z2dlcih7DQogICAgcGF1c2FibGU6IHRydWUsDQogICAgYWxsb3dBc3luY2hyb25vdXNTY3JpcHRzOiB0cnVlDQp9KTsNCg0KY29uc3Qgc2VlZCA9IG1hdGgucmFuZG9tSW50KC0yMTQ3NDgzNjQ4LCAyMTQ3NDgzNjQ3KTsNCmJvdC52YXJzLnRyYWNpbmcgPSBudWxsOw0KYm90LnZhcnMudGVzdE5hbWUgPSB0ZXN0TmFtZTsNCmJvdC52YXJzLnJhbmRvbVNlZWQgPSBzZWVkOw0KYm90LnZhcnMuZGVidWcgPSBkOw0KZC5tYXRoLnNldFJhbmRvbVNlZWQoc2VlZCk7DQpib3QudmFycy50aW1lbGluZSA9IFtdOw0KYXdhaXQgYm90Lmhvb2t1cERlYnVnZ2VyKHsgZGVidWc6IGQsIGFkZEtleXM6IHRydWUsIHRpbWVsaW5lOiBib3QudmFycy50aW1lbGluZSB9KTsNCmF3YWl0IGJvdC5hZGRCb3RzVG9EZWJ1Z2dlcihkKTsNCg0KYXdhaXQgb3MuYXR0YWNoRGVidWdnZXIoZCwgew0KICAgIHRhZ05hbWVNYXBwZXI6IHsNCiAgICAgICAgZm9yd2FyZDogZm9yd2FyZE1hcFRhZ05hbWUsDQogICAgICAgIHJldmVyc2U6IHJldmVyc2VNYXBUYWdOYW1lDQogICAgfSwNCn0pOw0KDQphd2FpdCBvcy5zbGVlcCgxMDAwKTsNCg0KaWYgKGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwpIHsNCiAgICBib3QudmFycy5vcmlnaW5hbEdyaWRQb3J0YWwgPSBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsOw0KICAgIGQuY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPSAndGVzdC0nICsgY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbDsNCn0NCg0Kc2hvdXQoImFiMVNsZWVwIiwgInNsZWVwIik7DQpzaG91dCgnYWIxUmVzZXQnKTsNCg0KZnVuY3Rpb24gZm9yd2FyZE1hcFRhZ05hbWUobmFtZSkgew0KICAgIGNvbnN0IGJ1aWx0aW5UYWdzID0gb3MubGlzdEJ1aWx0aW5UYWdzKCk7DQogICAgaWYgKGJ1aWx0aW5UYWdzLnNvbWUodCA9PiB0ID09PSBuYW1lKSkgew0KICAgICAgICByZXR1cm4gbmFtZTsNCiAgICB9DQoNCiAgICByZXR1cm4gJ3Rlc3QtJyArIG5hbWU7DQp9DQoNCmZ1bmN0aW9uIHJldmVyc2VNYXBUYWdOYW1lKG5hbWUpIHsNCiAgICBjb25zdCBidWlsdGluVGFncyA9IG9zLmxpc3RCdWlsdGluVGFncygpOw0KICAgIGlmIChidWlsdGluVGFncy5zb21lKHQgPT4gdCA9PT0gbmFtZSkpIHsNCiAgICAgICAgcmV0dXJuIG5hbWU7DQogICAgfQ0KDQogICAgbGV0IHdpdGhvdXRUZXN0ID0gbmFtZS5zdWJzdHJpbmcoJ3Rlc3QtJy5sZW5ndGgpOw0KICAgIHJldHVybiB3aXRob3V0VGVzdDsNCn0NCg0KYXdhaXQgb3MucmVnaXN0ZXJBcHAoJ2FiMVRlc3RpbmdBcHAnLCB0aGlzQm90KTsNCnRoaXNCb3QucmVuZGVyVGVzdGluZ0FwcCgpOycAw/+h/gQAEHJlbmRlclRlc3RpbmdBcHACBADD/6H+BNZ3rwNAbGV0IHJlc3VsdDsNCg0KaWYgICh0aGlzQm90LnZhcnMuZGVidWcpIHsNCiAgICBpZiAodGhpc0JvdC52YXJzLnRyYWNpbmcpIHsNCiAgICAgICAgcmVzdWx0ID0gPGRpdj4NCiAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17KCkgPT4gdGhpc0JvdC5hYjFTdG9wVHJhY2luZygpfT5TdG9wIFRyYWNpbmc8L2J1dHRvbj4NCiAgICAgICAgPC9kaXY+DQogICAgfSBlbHNlIHsNCiAgICAgICAgcmVzdWx0ID0gPGRpdj4NCiAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17KCkgPT4gdGhpc0JvdC5hYjFTdG9wUmVjb3JkaW5nKCl9PlN0b3AgUmVjb3JkaW5nPC9idXR0b24+DQogICAgICAgIDwvZGl2Pg0KICAgIH0NCn0gZWxzZSB7DQogICAgcmVzdWx0ID0gPGRpdj48L2Rpdj47DQp9DQoNCm9zLmNvbXBpbGVBcHAoJ2FiMVRlc3RpbmdBcHAnLCByZXN1bHQpOycAw/+h/gQAEGFiMVN0b3BSZWNvcmRpbmcCBADD/6H+BIZ70wVAaWYgKGJvdC52YXJzLmRlYnVnKSB7DQogICAgYXdhaXQgb3MuZGV0YWNoRGVidWdnZXIoYm90LnZhcnMuZGVidWcpOw0KfQ0KDQpib3QudmFycy5kZWJ1ZyA9IG51bGw7DQpib3QudmFycy50cmFjaW5nID0gbnVsbDsNCg0KaWYgKGJvdC52YXJzLm9yaWdpbmFsR3JpZFBvcnRhbCkgew0KICAgIGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPSBib3QudmFycy5vcmlnaW5hbEdyaWRQb3J0YWw7DQogICAgYm90LnZhcnMub3JpZ2luYWxHcmlkUG9ydGFsID0gbnVsbDsNCn0NCg0KY29uc29sZS5sb2coJ1tkZWJ1Z10gRG9uZSEnKTsNCmxldCBmaW5hbFRpbWVsaW5lID0gYm90LmNvbXBpbGVUaW1lbGluZSh7IHRpbWVsaW5lOiBib3QudmFycy50aW1lbGluZSB9KTsNCg0KY3JlYXRlKHsNCiAgICBfX3Rlc3Q6IHRydWUsDQogICAgX190ZXN0Q2FzZTogdHJ1ZSwNCiAgICB0aW1lbGluZTogJ/Cfp6wnICsgZ2V0Rm9ybWF0dGVkSlNPTihmaW5hbFRpbWVsaW5lLnNsaWNlKCkpLA0KICAgIG9uQ2xpY2s6IGBAc2hvdXQoJ3J1blRlc3RDYXNlJywgdGhpc0JvdC5pZClgLA0KICAgIHN5c3RlbTogJ3Rlc3RzLicgKyBib3QudmFycy50ZXN0TmFtZSwNCiAgICByYW5kb21TZWVkOiBib3QudmFycy5yYW5kb21TZWVkLA0KICAgIHRlc3ROYW1lOiBib3QudmFycy50ZXN0TmFtZQ0KfSk7DQoNCnNob3V0KCJhYjFTbGVlcCIsICJ3YWtlIik7DQp0aGlzQm90LnJlbmRlclRlc3RpbmdBcHAoKTsnAMP/of4EAAthYjFSdW5UZXN0cwIEAMP/of4E2IABnw1AY29uc3QgdGVzdENhc2VzID0gZ2V0Qm90cygNCiAgICBieVRhZygnX190ZXN0JywgdHJ1ZSksDQogICAgYnlUYWcoJ19fdGVzdENhc2UnLCB0cnVlKQ0KKTsNCg0KbGV0IHRvdGFsQ291bnQgPSB0ZXN0Q2FzZXMubGVuZ3RoOw0KbGV0IGNvbXBsZXRlZENvdW50ID0gMDsNCmxldCBzdWNjZXNzQ291bnQgPSAwOw0KbGV0IGZhaWx1cmVDb3VudCA9IDA7DQpsZXQgcHJvbWlzZXMgPSBbXTsNCmZvcihsZXQgdGVzdENhc2Ugb2YgdGVzdENhc2VzKSB7DQogICAgaWYgKHRlc3RDYXNlLnRhZ3Muc2tpcCkgew0KICAgICAgICBjb250aW51ZTsNCiAgICB9DQoNCiAgICBjb25zdCBwcm9taXNlID0gdGhpc0JvdC5ydW5UZXN0Q2FzZShnZXRJRCh0ZXN0Q2FzZSkpLnRoZW4oKHJlc3VsdCkgPT4gew0KICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHsNCiAgICAgICAgICAgIHN1Y2Nlc3NDb3VudCArPSAxOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgZmFpbHVyZUNvdW50ICs9IDE7DQogICAgICAgIH0NCiAgICAgICAgY29tcGxldGVkQ291bnQgKz0gMTsNCiAgICAgICAgaWYgKHRoaXNCb3QubGlua3MucnVuVGVzdHNCdXR0b24pIHsNCiAgICAgICAgICAgIHRoaXNCb3QubGlua3MucnVuVGVzdHNCdXR0b24ubWFza3MubGFiZWwgPSBgJHtjb21wbGV0ZWRDb3VudH0vJHt0b3RhbENvdW50fWA7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0pOw0KICAgIHByb21pc2VzLnB1c2gocHJvbWlzZSk7DQp9DQoNCmNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7DQoNCmxldCBzdWNjZXNzID0gdHJ1ZTsNCmxldCBmaXJzdFVuc3VjZXNzZnVsUmVzdWx0ID0gbnVsbDsNCmZvcihsZXQgcmVzdWx0IG9mIHJlc3VsdHMpIHsNCiAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHsNCiAgICAgICAgY29udGludWU7DQogICAgfQ0KICAgIHN1Y2Nlc3MgPSBmYWxzZTsNCiAgICBmaXJzdFVuc3VjZXNzZnVsUmVzdWx0ID0gcmVzdWx0Ow0KICAgIGJyZWFrOw0KfQ0KDQppZiAoc3VjY2Vzcykgew0KICAgIG9zLnRvYXN0KCJTdWNjZXNzISIpOw0KDQogICAgaWYgKHRoaXNCb3QubGlua3MucnVuVGVzdHNCdXR0b24pIHsNCiAgICAgICAgdGhpc0JvdC5saW5rcy5ydW5UZXN0c0J1dHRvbi5tYXNrcy5sYWJlbCA9IGDinJMgJHtzdWNjZXNzQ291bnR9LyR7dG90YWxDb3VudH1gOw0KICAgIH0NCg0KICAgIHJldHVybiB0cnVlOw0KfSBlbHNlIHsNCiAgICBjb25maWdCb3QudGFncy5zeXN0ZW1Qb3J0YWxEaWZmID0gJ3Rlc3RTeXN0ZW0nOw0KICAgIGNvbmZpZ0JvdC50YWdzLnN5c3RlbVBvcnRhbCA9IGZpcnN0VW5zdWNlc3NmdWxSZXN1bHQuc3lzdGVtOw0KICAgIGNvbmZpZ0JvdC50YWdzLnN5c3RlbVBvcnRhbFBhbmUgPSAnZGlmZic7DQogICAgY29uZmlnQm90LnRhZ3Muc3lzdGVtUG9ydGFsRGlmZkJvdCA9IGZpcnN0VW5zdWNlc3NmdWxSZXN1bHQuZGlmZkJvdElkOw0KICAgIGNvbmZpZ0JvdC50YWdzLnN5c3RlbVBvcnRhbERpZmZUYWcgPSAndGltZWxpbmUnOw0KDQogICAgaWYgKHRoaXNCb3QubGlua3MucnVuVGVzdHNCdXR0b24pIHsNCiAgICAgICAgdGhpc0JvdC5saW5rcy5ydW5UZXN0c0J1dHRvbi5tYXNrcy5sYWJlbCA9IGDinYwgJHtzdWNjZXNzQ291bnR9LyR7dG90YWxDb3VudH1gOw0KICAgIH0NCg0KICAgIHJldHVybiBmYWxzZTsNCn0nAMP/of4EAA5hYjFSZWNvcmRUcmFjZQIEAMP/of4E9I0BwgpAY29uc3QgZCA9IGF3YWl0IG9zLmNyZWF0ZURlYnVnZ2VyKHsNCiAgICBwYXVzYWJsZTogdHJ1ZSwNCiAgICBhbGxvd0FzeW5jaHJvbm91c1NjcmlwdHM6IHRydWUNCn0pOw0KDQppZiAoIWJvdC52YXJzLnRyYWNlQ291bnRlcikgew0KICAgIGJvdC52YXJzLnRyYWNlQ291bnRlciA9IDA7DQp9DQpib3QudmFycy50cmFjZUNvdW50ZXIgKz0gMTsNCmJvdC52YXJzLmRlYnVnID0gZDsNCmJvdC52YXJzLnRyYWNpbmcgPSB0cnVlOw0KYm90LnZhcnMudGltZWxpbmUgPSBbXTsNCmF3YWl0IGJvdC5ob29rdXBEZWJ1Z2dlcih7IGRlYnVnOiBkLCBhZGRLZXlzOiBmYWxzZSwgdGltZWxpbmU6IGJvdC52YXJzLnRpbWVsaW5lLCBub1dhcm5NaXNzaW5nS2V5czogdHJ1ZSB9KTsNCmF3YWl0IGJvdC5hZGRCb3RzVG9EZWJ1Z2dlcihkKTsNCg0KYXdhaXQgb3MuYXR0YWNoRGVidWdnZXIoZCwgew0KICAgIHRhZ05hbWVNYXBwZXI6IHsNCiAgICAgICAgZm9yd2FyZDogZm9yd2FyZE1hcFRhZ05hbWUsDQogICAgICAgIHJldmVyc2U6IHJldmVyc2VNYXBUYWdOYW1lDQogICAgfSwNCn0pOw0KDQphd2FpdCBvcy5zbGVlcCgxMDAwKTsNCg0KaWYgKGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwpIHsNCiAgICBib3QudmFycy5vcmlnaW5hbEdyaWRQb3J0YWwgPSBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsOw0KICAgIGQuY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9IGNvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWwgPSAndGVzdC0nICsgY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbDsNCn0NCg0Kc2hvdXQoImFiMVNsZWVwIiwgInNsZWVwIik7DQpzaG91dCgnYWIxUmVzZXQnKTsNCg0KZnVuY3Rpb24gZm9yd2FyZE1hcFRhZ05hbWUobmFtZSkgew0KICAgIGNvbnN0IGJ1aWx0aW5UYWdzID0gb3MubGlzdEJ1aWx0aW5UYWdzKCk7DQogICAgaWYgKGJ1aWx0aW5UYWdzLnNvbWUodCA9PiB0ID09PSBuYW1lKSkgew0KICAgICAgICByZXR1cm4gbmFtZTsNCiAgICB9DQoNCiAgICByZXR1cm4gJ3Rlc3QtJyArIG5hbWU7DQp9DQoNCmZ1bmN0aW9uIHJldmVyc2VNYXBUYWdOYW1lKG5hbWUpIHsNCiAgICBjb25zdCBidWlsdGluVGFncyA9IG9zLmxpc3RCdWlsdGluVGFncygpOw0KICAgIGlmIChidWlsdGluVGFncy5zb21lKHQgPT4gdCA9PT0gbmFtZSkpIHsNCiAgICAgICAgcmV0dXJuIG5hbWU7DQogICAgfQ0KDQogICAgbGV0IHdpdGhvdXRUZXN0ID0gbmFtZS5zdWJzdHJpbmcoJ3Rlc3QtJy5sZW5ndGgpOw0KICAgIHJldHVybiB3aXRob3V0VGVzdDsNCn0NCg0KYXdhaXQgb3MucmVnaXN0ZXJBcHAoJ2FiMVRlc3RpbmdBcHAnLCB0aGlzQm90KTsNCnRoaXNCb3QucmVuZGVyVGVzdGluZ0FwcCgpOycAw/+h/gQADmFiMVN0b3BUcmFjaW5nAgQAw/+h/gS3mAG5CEBpZiAoYm90LnZhcnMuZGVidWcpIHsNCiAgICBhd2FpdCBvcy5kZXRhY2hEZWJ1Z2dlcihib3QudmFycy5kZWJ1Zyk7DQp9DQoNCmJvdC52YXJzLmRlYnVnID0gbnVsbDsNCmJvdC52YXJzLnRyYWNpbmcgPSBudWxsOw0KDQppZiAoYm90LnZhcnMub3JpZ2luYWxHcmlkUG9ydGFsKSB7DQogICAgY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA9IGJvdC52YXJzLm9yaWdpbmFsR3JpZFBvcnRhbDsNCiAgICBib3QudmFycy5vcmlnaW5hbEdyaWRQb3J0YWwgPSBudWxsOw0KfQ0KDQpjb25zb2xlLmxvZygnW2RlYnVnXSBEb25lIScpOw0KbGV0IGZpbmFsVGltZWxpbmUgPSBib3QuY29tcGlsZVRpbWVsaW5lKHsgdGltZWxpbmU6IGJvdC52YXJzLnRpbWVsaW5lIH0pOw0KDQpjb25zdCB0cmFjZU5hbWUgPSAndHJhY2VzLicgKyBwYWQoYm90LnZhcnMudHJhY2VDb3VudGVyLnRvU3RyaW5nKCkpOw0KY29uc3QgcmVuZGVyZWQgPSB0aGlzQm90LnJlbmRlclRpbWVsaW5lKHsgdGltZWxpbmU6IGZpbmFsVGltZWxpbmUsIG5hbWU6IHRyYWNlTmFtZSB9KTsNCmNvbnN0IHsgcmVzdWx0Qm90IH0gPSB0aGlzQm90LmNyZWF0ZUJvdHNGb3JSZW5kZXJlZFRpbWVsaW5lKHsgcmVzdWx0OiByZW5kZXJlZCwgc3lzdGVtOiB0cmFjZU5hbWUgfSk7DQoNCnNob3V0KCJhYjFTbGVlcCIsICJ3YWtlIik7DQp0aGlzQm90LnJlbmRlclRlc3RpbmdBcHAoKTsNCg0Kb3MuZm9jdXNPbihyZXN1bHRCb3QsIHsNCiAgICB0YWc6ICd0aW1lbGluZScsDQogICAgcG9ydGFsOiAnc3lzdGVtJywNCiAgICBsaW5lTnVtYmVyOiAwLA0KICAgIGNvbHVtbk51bWJlcjogMA0KfSk7DQoNCmZ1bmN0aW9uIHBhZChzdHIpIHsNCg0KICAgIGxldCByZW1haW5pbmcgPSA2IC0gc3RyLmxlbmd0aDsNCiAgICBpZiAocmVtYWluaW5nID4gMCkgew0KICAgICAgICBsZXQgcGFkZGVkID0gJzAnLnJlcGVhdChyZW1haW5pbmcpOw0KICAgICAgICByZXR1cm4gcGFkZGVkICsgc3RyOw0KICAgIH0NCg0KICAgIC8vIHdoaWxlKHN0ci5sZW5ndGggPCA2KSB7DQogICAgLy8gICAgIHN0ciArPSAnMCcgKyBzdHI7DQogICAgLy8gfQ0KDQogICAgcmV0dXJuIHN0cjsNCn0nAMP/of4EAA5yZW5kZXJUaW1lbGluZQIEAMP/of4E8aABliVAY2xhc3MgU3RyaW5nQnVpbGRlciB7DQogICAgY29uc3RydWN0b3Ioc3RyKSB7DQogICAgICAgIHRoaXMuaW5kZW50ID0gMDsNCiAgICAgICAgdGhpcy5tYXJrZXJzID0gW107DQogICAgICAgIHRoaXMuc3RyID0gc3RyOw0KICAgICAgICB0aGlzLmxvYyA9IGxvYyhzdHIpOw0KICAgIH0NCg0KICAgIGFwcGVuZExpbmUocykgew0KICAgICAgICBpZiAodGhpcy5pbmRlbnQgPiAwKSB7DQogICAgICAgICAgICB0aGlzLnN0ciArPSBpbmRlbnQocywgdGhpcy5pbmRlbnQpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdGhpcy5zdHIgKz0gczsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLnN0ciArPSAnXG4nOw0KICAgICAgICB0aGlzLmxvYyA9IGxvYyh0aGlzLnN0cik7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCg0KICAgIGFwcGVuZChzKSB7DQogICAgICAgIHRoaXMuc3RyICs9IHM7DQogICAgICAgIHRoaXMubG9jID0gbG9jKHRoaXMuc3RyKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBsb2Moc3RyKSB7DQogICAgY29uc3QgbGluZXMgPSBzdHIuc3BsaXQoJ1xuJyk7DQogICAgY29uc3QgbGluZSA9IGxpbmVzLmxlbmd0aDsNCiAgICBjb25zdCBjb2wgPSBsaW5lc1tsaW5lcy5sZW5ndGggLSAxXS5sZW5ndGg7DQogICAgcmV0dXJuIHsNCiAgICAgICAgbGluZSwNCiAgICAgICAgY29sDQogICAgfTsNCn0NCg0KZnVuY3Rpb24gcmVuZGVyVGltZWxpbmUodGltZWxpbmUsIG5hbWUpIHsNCiAgICBsZXQgYnVpbGRlciA9IG5ldyBTdHJpbmdCdWlsZGVyKCdAJyk7DQogICAgYnVpbGRlci5hcHBlbmRMaW5lKCcvLyBOb3RlOiB0aGlzIGlzIGEgdmlzdWFsaXphdGlvbiBvZiB0aGUgdGVzdCB0aW1lbGluZS4nKTsNCiAgICBidWlsZGVyLmFwcGVuZExpbmUoJy8vIEl0IGRvZXMgbm90IGNvbnRhaW4gd29ya2luZyBjb2RlLlxuJyk7DQogICAgYnVpbGRlci5hcHBlbmRMaW5lKGBzdGFydCgnJHtuYW1lfScpYCk7DQogICAgZm9yKGxldCBldmVudCBvZiB0aW1lbGluZSkgew0KICAgICAgICByZW5kZXJFdmVudChldmVudCwgYnVpbGRlcik7DQogICAgfQ0KDQogICAgY29uc29sZS5sb2coYnVpbGRlci5zdHIpOw0KICAgIGJ1aWxkZXIuYXBwZW5kTGluZSgnZW5kKCknKTsNCiAgICByZXR1cm4gew0KICAgICAgICBzdHJpbmc6IGJ1aWxkZXIuc3RyLA0KICAgICAgICBtYXJrZXJzOiBidWlsZGVyLm1hcmtlcnMNCiAgICB9Ow0KfQ0KDQpmdW5jdGlvbiByZW5kZXJFdmVudChldmVudCwgYnVpbGRlcikgew0KICAgIGNvbnNvbGUubG9nKCdyZW5kZXInLCBldmVudCk7DQogICAgaWYgKGV2ZW50LnR5cGUgPT09ICd1c2VyX2FjdGlvbicpIHsNCiAgICAgICAgcmVuZGVyVXNlckFjdGlvbihldmVudCwgYnVpbGRlcik7DQogICAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSAnZW1pdHRlZF9hY3Rpb24nKSB7DQogICAgICAgIHJlbmRlckVtaXR0ZWRBY3Rpb24oZXZlbnQsIGJ1aWxkZXIpOw0KICAgIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gJ2NoZWNrJykgew0KICAgICAgICBidWlsZGVyLmFwcGVuZExpbmUoYGNoZWNrOiAke2dldEZvcm1hdHRlZEpTT04oZXZlbnQuZGlmZil9YCk7DQogICAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSAndXBkYXRlX3RhZycpIHsNCiAgICAgICAgcmVuZGVyVXBkYXRlVGFnKGV2ZW50LCBidWlsZGVyKTsNCiAgICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09ICd1cGRhdGVfdGFnX21hc2snKSB7DQogICAgICAgIHJlbmRlclVwZGF0ZVRhZ01hc2soZXZlbnQsIGJ1aWxkZXIpOw0KICAgIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gJ3NjcmlwdCcpIHsNCiAgICAgICAgcmVuZGVyU2NyaXB0KGV2ZW50LCBidWlsZGVyKTsNCiAgICB9DQp9DQoNCmZ1bmN0aW9uIHJlbmRlclNob3V0KGV2ZW50LCBidWlsZGVyKSB7DQogICAgYnVpbGRlci5hcHBlbmRMaW5lKGAvLyBAJHtldmVudC5hY3Rpb24uZXZlbnROYW1lfWApOw0KICAgIGlmIChldmVudC5hY3Rpb24ua2V5cy5sZW5ndGggPiAwKSB7DQogICAgICAgIGJ1aWxkZXIuYXBwZW5kTGluZShgd2hpc3Blci4ke2V2ZW50LmFjdGlvbi5ldmVudE5hbWV9KCcke2V2ZW50LmFjdGlvbi5rZXlzLmpvaW4oJywnKX0nKWApOw0KICAgIH0gZWxzZSB7DQogICAgICAgIGJ1aWxkZXIuYXBwZW5kTGluZShgc2hvdXQuJHtldmVudC5hY3Rpb24uZXZlbnROYW1lfSgpYCk7DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiByZW5kZXJFbWl0dGVkQWN0aW9uKGV2ZW50LCBidWlsZGVyKSB7DQogICAgbGV0IHByZWZpeCA9ICcnOw0KICAgIGlmICgndGFza0lkJyBpbiBldmVudC5hY3Rpb24pIHsNCiAgICAgICAgcHJlZml4ID0gYFwkJHtldmVudC5hY3Rpb24udGFza0lkfTogYDsNCiAgICB9DQogICAgbGV0IHsgdGFza0lkLCB0eXBlLCAuLi5yZXN0IH0gPSBldmVudC5hY3Rpb247DQoNCiAgICBpZiAoZXZlbnQubG9jYXRpb24pIHsNCiAgICAgICAgYnVpbGRlci5tYXJrZXJzLnB1c2goew0KICAgICAgICAgICAgbGluZTogYnVpbGRlci5sb2MubGluZSwNCiAgICAgICAgICAgIGxhYmVsOiAnR28gdG8gYWN0aW9uJywNCiAgICAgICAgICAgIGxvY2F0aW9uOiBldmVudC5sb2NhdGlvbg0KICAgICAgICB9KTsNCiAgICB9DQoNCiAgICBidWlsZGVyLmFwcGVuZExpbmUoYCR7cHJlZml4fSR7dHlwZX0oJHtnZXRGb3JtYXR0ZWRKU09OKHJlc3QpfSlgKTsNCn0NCg0KZnVuY3Rpb24gcmVuZGVyVXBkYXRlVGFnKGV2ZW50LCBidWlsZGVyKSB7DQogICAgaWYgKGV2ZW50LmxvY2F0aW9uKSB7DQogICAgICAgIGJ1aWxkZXIubWFya2Vycy5wdXNoKHsNCiAgICAgICAgICAgIGxpbmU6IGJ1aWxkZXIubG9jLmxpbmUsDQogICAgICAgICAgICBsYWJlbDogJ0dvIHRvIFRhZyBVcGRhdGUnLA0KICAgICAgICAgICAgbG9jYXRpb246IGV2ZW50LmxvY2F0aW9uDQogICAgICAgIH0pOw0KICAgIH0NCg0KICAgIGJ1aWxkZXIuYXBwZW5kTGluZShgdXBkYXRlVGFnKCR7ZXZlbnQudXBkYXRlLnRhZ30sICR7Z2V0Rm9ybWF0dGVkSlNPTihldmVudC51cGRhdGUubmV3VmFsdWUpfSlgKTsNCn0NCg0KZnVuY3Rpb24gcmVuZGVyVXBkYXRlVGFnTWFzayhldmVudCwgYnVpbGRlcikgew0KICAgIGlmIChldmVudC5sb2NhdGlvbikgew0KICAgICAgICBidWlsZGVyLm1hcmtlcnMucHVzaCh7DQogICAgICAgICAgICBsaW5lOiBidWlsZGVyLmxvYy5saW5lLA0KICAgICAgICAgICAgbGFiZWw6ICdHbyB0byBUYWcgTWFzayBVcGRhdGUnLA0KICAgICAgICAgICAgbG9jYXRpb246IGV2ZW50LmxvY2F0aW9uDQogICAgICAgIH0pOw0KICAgIH0NCg0KICAgIGJ1aWxkZXIuYXBwZW5kTGluZShgdXBkYXRlVGFnTWFzaygke2V2ZW50LnVwZGF0ZS50YWd9LCAke2V2ZW50LnVwZGF0ZS5zcGFjZX0sICR7Z2V0Rm9ybWF0dGVkSlNPTihldmVudC51cGRhdGUubmV3VmFsdWUpfSlgKTsNCn0NCg0KZnVuY3Rpb24gcmVuZGVyU2NyaXB0KGV2ZW50LCBidWlsZGVyKSB7DQogICAgaWYgKGV2ZW50LmxvY2F0aW9uKSB7DQogICAgICAgIGJ1aWxkZXIubWFya2Vycy5wdXNoKHsNCiAgICAgICAgICAgIGxpbmU6IGJ1aWxkZXIubG9jLmxpbmUsDQogICAgICAgICAgICBsYWJlbDogJ0dvIHRvIFNjcmlwdCcsDQogICAgICAgICAgICBsb2NhdGlvbjogZXZlbnQubG9jYXRpb24NCiAgICAgICAgfSk7DQogICAgfQ0KDQogICAgYnVpbGRlci5hcHBlbmRMaW5lKGBydW5fc2NyaXB0KCcke2V2ZW50LmJvdElkfScsICcke2V2ZW50LnRhZ30nLCAoKSA9PiB7YCk7DQogICAgYnVpbGRlci5pbmRlbnQgKz0gNDsNCiAgICBmb3IgKGxldCBlIG9mIGV2ZW50LnRpbWVsaW5lKSB7DQogICAgICAgIHJlbmRlckV2ZW50KGUsIGJ1aWxkZXIpOw0KICAgIH0NCiAgICBidWlsZGVyLmluZGVudCAtPSA0Ow0KICAgIGJ1aWxkZXIuYXBwZW5kTGluZSgnXG59KScpOw0KfQ0KDQpmdW5jdGlvbiByZW5kZXJVc2VyQWN0aW9uKGV2ZW50LCBidWlsZGVyKSB7DQogICAgaWYgKCd0aW1lbGluZScgaW4gZXZlbnQpIHsNCiAgICAgICAgZm9yIChsZXQgZSBvZiBldmVudC50aW1lbGluZSkgew0KICAgICAgICAgICAgcmVuZGVyRXZlbnQoZSwgYnVpbGRlcik7DQogICAgICAgIH0NCiAgICB9IGVsc2UgaWYgKGV2ZW50LmFjdGlvbi50eXBlID09PSAnYWN0aW9uJykgew0KICAgICAgICByZW5kZXJTaG91dChldmVudCwgYnVpbGRlcik7DQogICAgfSBlbHNlIGlmIChldmVudC5hY3Rpb24udHlwZSA9PT0gJ2FzeW5jX3Jlc3VsdCcpIHsNCiAgICAgICAgbGV0IGZvcm1hdHRlZCA9IGdldEZvcm1hdHRlZEpTT04oZXZlbnQuYWN0aW9uLnJlc3VsdCk7DQogICAgICAgIGxldCBjb21tZW50ZWQgPSBmb3JtYXR0ZWQuc3BsaXQoJ1xuJykubWFwKGxpbmUgPT4gYC8vICR7bGluZX1gKS5qb2luKCdcbicpOw0KDQogICAgICAgIGJ1aWxkZXIuYXBwZW5kTGluZShgJHtjb21tZW50ZWR9IC0+IFwkJHtldmVudC5hY3Rpb24udGFza0lkfWApOw0KICAgIH0NCn0NCg0KZnVuY3Rpb24gaW5kZW50KHN0ciwgbGV2ZWwpIHsNCiAgICBsZXQgbGluZXMgPSBzdHIuc3BsaXQoJ1xuJyk7DQogICAgbGV0IGluZGVudFN0cmluZyA9ICcgJy5yZXBlYXQobGV2ZWwpOw0KICAgIGxldCBpbmRlbnRlZCA9IGxpbmVzLm1hcChsID0+IGwubGVuZ3RoID4gMCA/IGluZGVudFN0cmluZyArIGwgOiBsKTsNCiAgICByZXR1cm4gaW5kZW50ZWQuam9pbignXG4nKTsNCn0NCg0KY29uc3QgeyB0aW1lbGluZSwgbmFtZSB9ID0gdGhhdDsNCg0KcmV0dXJuIHJlbmRlclRpbWVsaW5lKHRpbWVsaW5lLCBuYW1lKTsnAMP/of4EAB1jcmVhdGVCb3RzRm9yUmVuZGVyZWRUaW1lbGluZQIEAMP/of4EiMYBkQdAY29uc3QgeyBzeXN0ZW0sIHJlc3VsdCwgY3JlYXRvciwgc3lzdGVtVGFnIH0gPSB0aGF0Ow0KDQovLyBjb25zdCBzeXN0ZW0gPSBzeXN0ZW1QcmVmaXggKyB0ZXN0Q2FzZS50YWdzLnRlc3ROYW1lOw0KDQpsZXQgcmVzdWx0Qm90ID0gY3JlYXRlKHsNCiAgICBzcGFjZTogJ3RlbXBMb2NhbCcsDQogICAgY3JlYXRvcjogY3JlYXRvcj8uaWQsDQogICAgX190ZXN0OiB0cnVlLA0KICAgIF9fdGVzdFJlc3VsdDogdHJ1ZSwNCiAgICB0aW1lbGluZTogcmVzdWx0LnN0cmluZywNCiAgICBbc3lzdGVtVGFnID8/ICdzeXN0ZW0nXTogc3lzdGVtDQp9KTsNCg0KY29uc3QgbWFya2VyTW9kID0gew0KICAgIHNwYWNlOiAndGVtcExvY2FsJywNCiAgICBjcmVhdG9yOiByZXN1bHRCb3QuaWQsDQogICAgX190ZXN0OiB0cnVlLA0KICAgIF9fdGVzdFJlc3VsdDogdHJ1ZSwNCiAgICBmb3JtOiAnY29kZUJ1dHRvbicsDQogICAgb25DbGljazogYEBvcy5mb2N1c09uKGJvdC50YWdzLmxvY2F0aW9uLmJvdElkLCB7IHBvcnRhbDogJ3N5c3RlbScsIHRhZzogYm90LnRhZ3MubG9jYXRpb24udGFnLCBsaW5lTnVtYmVyOiBib3QudGFncy5sb2NhdGlvbi5saW5lLCBjb2x1bW5OdW1iZXI6IGJvdC50YWdzLmxvY2F0aW9uLmNvbHVtbiB9KWANCn07DQoNCmZvciAobGV0IG1hcmtlciBvZiByZXN1bHQubWFya2Vycykgew0KICAgIGNyZWF0ZShtYXJrZXJNb2QsIHsNCiAgICAgICAgW2Ake3Jlc3VsdEJvdC5pZH0udGltZWxpbmVgXTogdHJ1ZSwNCiAgICAgICAgW2Ake3Jlc3VsdEJvdC5pZH0udGltZWxpbmVTdGFydGBdOiBtYXJrZXIubGluZSwNCiAgICAgICAgbGFiZWw6IG1hcmtlci5sYWJlbCwNCiAgICAgICAgbG9jYXRpb246IG1hcmtlci5sb2NhdGlvbiwNCiAgICB9KTsNCn0NCg0KcmV0dXJuIHsNCiAgICByZXN1bHRCb3QNCn07JwDD/6H+BAAIYWIxVGVzdHMCBADD/6H+BJrNAQR0cnVlJwDD/6H+BAAEZm9ybQIEAMP/of4En80BB25vdGhpbmcoAMP/of4EAA1hYjFCb3RWZXJzaW9uAX0CJwDD/6H+BAAJYWIxSWdub3JlAgQAw/+h/gSozQEEdHJ1ZQA="}]}