{"version":2,"updates":[{"id":0,"timestamp":1703089037192,"update":"AaoB9KXalw0AJwEEYm90cyQwMjgzNjVhNC0wMzZmLTQxZDAtOWFmMS03MTVhZDRmMmFhN2EBJwD0pdqXDQAGc3lzdGVtAgQA9KXalw0BEWFiLnNoZWxsLnJlZ3VsYXRlJwD0pdqXDQAEZm9ybQIEAPSl2pcNEwdub3RoaW5nJwD0pdqXDQAMb25BbnlCb3REcmFnAgQA9KXalw0buwFALy9jb250cm9scyBncmlkIHNuYXAKaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlKQp7CiAgICBvcy5hZGREcm9wU25hcCgiZ3JpZCIpOwp9CgovL2NvbnRyb2xzIGJvdCBzbmFwCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlKQp7CiAgICBvcy5hZGREcm9wU25hcCgiZmFjZSIpOwp9JwD0pdqXDQAIcmVtZW1iZXICBAD0pdqXDdcBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAPSl2pcNAAhhYklnbm9yZQIEAPSl2pcN/gEEdHJ1ZSgA9KXalw0ADGFiQm90VmVyc2lvbgF9jgInAPSl2pcNAAdhYlNoZWxsAgQA9KXalw2EAgR0cnVlJwEEYm90cyQzNGMzYzIxMC01YmYxLTQ5Y2YtYjE1MS1lZTJkMDdmMGU2NzMBJwD0pdqXDYkCBnN5c3RlbQIEAPSl2pcNigIPYWIuc2hlbGwuY3JlYXRlJwD0pdqXDYkCBGZvcm0CBAD0pdqXDZoCB25vdGhpbmcnAPSl2pcNiQILZGVzY3JpcHRpb24CBAD0pdqXDaICPUJvdCB1c2VkIHRvIGNyZWF0ZS9tYW5pZmVzdCBib3RzIGludG8gYW4gYWN0dWFsIHNjZW5lL3BvcnRhbC4nAPSl2pcNiQIMYWJDcmVhdGVCb3RzAgQA9KXalw3gAq0aQC8vREVWIE5PVEU6IE5FRUQgVE8gVU5ERVJTVEFORCBXSEFUIFRPIERPIElGIEFOIEFSUkFZIElTIEdJVkVOCgovL2NoZWNrcyBmb3IgaW5pdGlhbCBib290IGJvb2xlYW4KbGV0IGluaXRpYWxCb290ID0gdGhhdC5pbml0aWFsQm9vdDsKLy9ib3RzIHRvIGJlIGdlbmVyYXRlZApsZXQgYm90RGF0YSA9IHRoYXQuYm90czsKLy93aGVyZSBkaWQgdGhlIGRhdGEgY29tZSBmcm9tIChvcHRpb25hbCkKbGV0IG9yaWdpbiA9IHRoYXQub3JpZ2luOwovL3ZlcnNpb24gb2YgdGhlIGRhdGEgKG9wdGlvbmFsKQpsZXQgdmVyc2lvbiA9IHRoYXQudmVyc2lvbjsKLy9pZE1hcCBhbmQgbmV3Qm90cyBhcmUgdXNlZCB0byBtYW5hZ2UgdGhlIGluY29taW5nIGJvdCBkYXRhCmxldCBpZE1hcCA9IG5ldyBNYXAoKTsKbGV0IG5ld0JvdHMgPSBbXTsKCi8vdGhpcyBsb29wIGNyZWF0ZXMgdGhlIG5ldyBib3RzIGFuZCB0aGVuIHBhY2thZ2VzIHRoZW0gZm9yIGFkZGl0aW9uYWwgcHJvY2Vzc2luZywgd2hpbGUgYWRkaW5nIGFueSBuZWVkZWQgYWRkaXRpb25hbCB0YWdzCmZvciAoY29uc3QgcHJvcGVydHkgaW4gYm90RGF0YSkKewogICAgY29uc3QgbmV3Qm90ID0gYm90RGF0YVtwcm9wZXJ0eV07CiAgICBjb25zdCBib3RUb3RhbCA9IE9iamVjdC5rZXlzKGJvdERhdGEpLmxlbmd0aDsKICAgIGNvbnN0IGFiSURPcmlnaW4gPSB7YWJJRE9yaWdpbjogb3JpZ2lufTsKICAgIGNvbnN0IGFiR3JpZEZvY3VzID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsKCiAgICBpZiAobmV3Qm90LnRhZ3MpIAogICAgewogICAgICAgIGlmIChuZXdCb3QudGFncy5jcmVhdG9yKSAKICAgICAgICB7CiAgICAgICAgICAgIGFiSURPcmlnaW4ub2xkQ3JlYXRvciA9IG5ld0JvdC50YWdzLmNyZWF0b3I7CiAgICAgICAgfQoKICAgICAgICBsZXQgdGFyZ2V0UG9zaXRpb247CgogICAgICAgIHRyeSAKICAgICAgICB7CiAgICAgICAgICAgIGlmICgoYm90VG90YWwgPCAyIHx8IGJvdFRvdGFsIDwgMyAmJiBib3REYXRhLmFiWFBCb3QgIT0gbnVsbCkgJiYgYWJHcmlkRm9jdXMpIAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsZXQgdGFyZ2V0RGltZW5zaW9uID0gYWJHcmlkRm9jdXMuZGltZW5zaW9uOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0YXJnZXRQb3NpdGlvbiA9IHsgW3RhcmdldERpbWVuc2lvbl06IHRydWUsIFt0YXJnZXREaW1lbnNpb24gKyAiWCJdOiBhYkdyaWRGb2N1cy5wb3NpdGlvbi54LCBbdGFyZ2V0RGltZW5zaW9uICsgIlkiXTogYWJHcmlkRm9jdXMucG9zaXRpb24ueSB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBsZXQgYiA9IGNyZWF0ZShuZXdCb3QudGFncywgdGFyZ2V0UG9zaXRpb24sIGFiSURPcmlnaW4pOwoKICAgICAgICAgICAgaWRNYXAuc2V0KHByb3BlcnR5LCBiLmlkKTsKICAgICAgICAgICAgbmV3Qm90cy5wdXNoKGIpOwoKICAgICAgICAgICAgaWYgKGIudGFncy5jcmVhdG9yID09IHRoaXNCb3QuaWQpIAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBiLnRhZ3MuY3JlYXRvciA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2F0Y2ggKGVycm9yKSAKICAgICAgICB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJpbnZhbGlkIGJvdCIsIGVycm9yKTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlIAogICAgewogICAgICAgIGNvbnNvbGUubG9nKCJza2lwcGVkIGJvdDogIiArIG5ld0JvdCk7CiAgICB9Cn0KCi8vYXJyYXkgb2YgdGFnIHJlbGF0aW9uc2hpcHMgdG8gYmUgcHJlc2VydmVkCmxldCBsaW5rVGFncyA9IFsibGluayIsICJjcmVhdG9yIiwgImNvbmZpZ0JvdCIsICJsaW5lVG8iLCAidHJhbnNmb3JtZXIiXTsKCi8vdGhpcyBsb29wIGNvbnRhaW5zIHRoZSBsb2dpYyBmb3IgcHJlc2VydmluZyB0aGUgbGlua1RhZ3MKZm9yIChsZXQgbmV3Qm90IG9mIG5ld0JvdHMpIAp7CiAgICBmb3IgKGxldCB0YWcgb2YgbGlua1RhZ3MpIAogICAgewogICAgICAgIGxldCB2YWx1ZSA9IG5ld0JvdC50YWdzW3RhZ107CgogICAgICAgIGlmICh0YWcgPT0gImNyZWF0b3IiKSAKICAgICAgICB7CiAgICAgICAgICAgIHZhbHVlID0gbmV3Qm90LnRhZ3Mub2xkQ3JlYXRvcjsKICAgICAgICAgICAgbmV3Qm90LnRhZ3Mub2xkQ3JlYXRvciA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICB1cGRhdGVCb3RMaW5rcyhuZXdCb3QsIGlkTWFwKTsKCiAgICAgICAgaWYgKHZhbHVlKSAKICAgICAgICB7CiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxldCBuZXdWYWx1ZSA9IHZhbHVlLm1hcChpZCA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlkTWFwLmdldChpZCkgfHwgaWQ7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIG5ld0JvdC5yYXdbdGFnXSA9IG5ld1ZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld0lEID0gaWRNYXAuZ2V0KHZhbHVlKTsKCiAgICAgICAgICAgICAgICBpZiAobmV3SUQpIAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG5ld0JvdC5yYXdbdGFnXSA9IG5ld0lEOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgovL3RvYXN0cyBmb3IgaGF0Y2hlcywgYnV0IG9ubHkgb24gYnVpbGRlcgppZiAoY29uZmlnQm90LnRhZ3MuYWJTaWxlbnRNb2RlID09IG51bGwgJiYgIWNvbmZpZ0JvdC50YWdzLnBoICYmIGJ1aWxkZXJWZXJzaW9uID09ICJidWlsZGVyIikgCnsKICAgIG9zLnRvYXN0KCJoYXRjaGVkICIgKyBvcmlnaW4gKyAiIHYiICsgdmVyc2lvbik7Cn0KCi8vYWRkaXRpb25hbCBoYXRjaCBkYXRhCmNvbmZpZ0JvdC50YWdzLmxhc3RFZ2dIYXRjaGVkID0gb3JpZ2luOwoKLy9pbml0aWFsIGJvb3QgbG9naWMKaWYgKGluaXRpYWxCb290KSAKewogICAgbGV0IHByZWhhdGNoID0gYXdhaXQgc2hvdXQoIm9uUHJlSGF0Y2giLCB7IGFiOiBvcmlnaW4gfSlbMF07CgogICAgaWYgKCFwcmVoYXRjaCkgCiAgICB7CiAgICAgICAgYWJJbnN0TWVtb3J5LnRhZ3MuYmFzZUFCID0gb3JpZ2luOwogICAgfQogICAgbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIgPSBvcmlnaW47Cn0KCi8vb25FZ2dIYXRjaCBmb3IgYWxsIGp1c3QgaGF0Y2hlZCBib3RzCndoaXNwZXIobmV3Qm90cywgIm9uRWdnSGF0Y2giLCB7YWI6IG9yaWdpbiwgdmVyc2lvbjogdmVyc2lvbn0pOwoKLy9vbkFiQWRkZWQgZm9yIGFsbCBib3RzIGluIHRoZSBleHBlcmllbmNlCnNob3V0KCJvbkFiQWRkZWQiLCB7YWI6IG9yaWdpbiwgdmVyc2lvbjogdmVyc2lvbn0pOycA9KXalw2JAghyZW1lbWJlcgIEAPSl2pcNjh0o8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycA9KXalw2JAglvbkFiQWRkZWQCBAD0pdqXDbUdckAvL3Nob3V0KCJvbkFiQWRkZWQiLCB7YWI6IG9yaWdpbiwgdmVyc2lvbjogdmVyc2lvbn0pOwoKY29uc29sZS5sb2coImFiOiAiICsgdGhhdC5hYiwgInZlcnNpb246ICIgKyB0aGF0LnZlcnNpb24pOycA9KXalw2JAghhYklnbm9yZQIEAPSl2pcNqB4EdHJ1ZSgA9KXalw2JAgxhYkJvdFZlcnNpb24BfY4CJwD0pdqXDYkCB2FiU2hlbGwCBAD0pdqXDa4eBHRydWUnAQRib3RzJDc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZgEnAPSl2pcNsx4Gc3lzdGVtAgQA9KXalw20Hg5hYi5zaGVsbC5zdG9yZScA9KXalw2zHgRmb3JtAgQA9KXalw3DHgdub3RoaW5nJwD0pdqXDbMeC2Rlc2NyaXB0aW9uAgQA9KXalw3LHj9UaGlzIHNraWxsIGlzIG1lYW50IHRvIGJlIGEgY29uZmlndXJhYmxlIG1lYW5zIHRvIHB1Ymxpc2ggZGF0YS4nAPSl2pcNsx4PYWJQdWJsaXNoUmVjb3JkAgQA9KXalw2LH+UGQGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90KCk7CgpsZXQgcHVibGljID0gdGhhdC5wdWJsaWM7CmxldCByZWNvcmREYXRhID0gdGhhdC5kYXRhOwpsZXQgcmVjb3JkTmFtZSA9IHRoYXQucmVjb3JkTmFtZTsKbGV0IGVuZHBvaW50ID0gdGhhdC5lbmRwb2ludCA/IHRoYXQuZW5kcG9pbnQgOiBsaW5rcy5yZW1lbWJlci50YWdzLmFiRW5kcG9pbnQ7CmxldCB1c2VyUmVjb3JkID0gY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQgPz8gYXV0aEJvdC5pZDsKCmlmICghcmVjb3JkRGF0YSkKewogICAgcmV0dXJuICJubyBkYXRhIHN1cHBsaWVkIjsKfQoKaWYgKHB1YmxpYykKewogICAgcmVjb3JkRGF0YSA9IGF3YWl0IG9zLnJlY29yZERhdGEodXNlclJlY29yZCwgcmVjb3JkTmFtZSwgcmVjb3JkRGF0YSwge2VuZHBvaW50OiBlbmRwb2ludCwgbWFya2VyczogWyJwdWJsaWNSZWFkIl19KTsKfQplbHNlCnsKICAgIGxldCBwZXJtaXNzaW9uID0gewogICAgICAgIHR5cGU6ICdkYXRhLnJlYWQnLAogICAgICAgIHJvbGU6IHJlY29yZE5hbWUsCiAgICAgICAgYWRkcmVzc2VzOiB0cnVlCiAgICB9OwoKICAgIGF3YWl0IG9zLmdyYW50UmVjb3JkTWFya2VyUGVybWlzc2lvbih1c2VyUmVjb3JkLCByZWNvcmROYW1lLCBwZXJtaXNzaW9uKTsKCiAgICBhd2FpdCBvcy5ncmFudFJlY29yZE1hcmtlclBlcm1pc3Npb24odXNlclJlY29yZCwgcmVjb3JkTmFtZSwgcGVybWlzc2lvbik7CiAgICAKICAgIHJlY29yZERhdGEgPSBhd2FpdCBvcy5yZWNvcmREYXRhKHVzZXJSZWNvcmQsIHJlY29yZE5hbWUsIHJlY29yZERhdGEsIHtlbmRwb2ludDogZW5kcG9pbnQsIG1hcmtlcnM6IFtyZWNvcmROYW1lXX0pOwp9CgpyZXR1cm4gcmVjb3JkRGF0YTsnAPSl2pcNsx4NYWJQdWJsaXNoRmlsZQIEAPSl2pcN8SXUBEBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwoKbGV0IGZpbGUgPSB0aGF0LmZpbGU7CmxldCBmaWxlTmFtZSA9IHRoYXQuZmlsZU5hbWU7CmxldCBtaW1lVHlwZSA9IHRoYXQubWltZVR5cGU7CmxldCB1c2VyUmVjb3JkID0gY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQgPz8gYXV0aEJvdC5pZDsKCmlmICghZmlsZSkKewogICAgcmV0dXJuICJubyBmaWxlIHN1cHBsaWVkIjsKfQoKbGV0IGZpbGVVcGxvYWQgPSBhd2FpdCBvcy5yZWNvcmRGaWxlKHVzZXJSZWNvcmQsIGZpbGUsIHtkZXNjcmlwdGlvbjogZmlsZU5hbWUsIG1pbWVUeXBlOiBtaW1lVHlwZX0sIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJFbmRwb2ludCk7CiAgICAKaWYgKCFmaWxlVXBsb2FkLnN1Y2Nlc3MpIAp7CiAgICBhd2FpdCBvcy5ncmFudEluc3RBZG1pblBlcm1pc3Npb24odXNlclJlY29yZCk7CgogICAgZmlsZVVwbG9hZCA9IGF3YWl0IG9zLnJlY29yZEZpbGUodXNlclJlY29yZCwgZmlsZSwge2Rlc2NyaXB0aW9uOiBmaWxlTmFtZSwgbWltZVR5cGU6IG1pbWVUeXBlfSwgbGlua3MucmVtZW1iZXIudGFncy5hYkVuZHBvaW50KTsKfQoKcmV0dXJuIGZpbGVVcGxvYWQ7JwD0pdqXDbMeEGFiQ29yZU1lbnVBY3Rpb24CBAD0pdqXDcYqTUBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwoKLy9zZXQgdXAgdGhlIHB1Ymxpc2ggbWVudQp0aGlzQm90Lm9uU3RvcmVNZW51KCk7JwD0pdqXDbMeC29uU3RvcmVNZW51AgQA9KXalw2UK5pJQGxldCBwb3NzaWJsZVB1Ymxpc2hCb3QgPSBsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzOwoKc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgpsaW5rcy5tZW51Lm1hc2tzLm9uR3JpZENsaWNrID0gIkAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7IjsKCmNvbnN0IHV1YWIgPSBsaW5rcy5yZW1lbWJlci50YWdzLnV1YWIgPyB0cnVlIDogZmFsc2U7CgpsZXQgbWVudUJ1dHRvbiA9IHt9OwoKbWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwptZW51QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IDk7Cm1lbnVCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbWVudUJ1dHRvbi5sYWJlbCA9ICJkb3dubG9hZCI7Cm1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiZ2V0X2FwcCI7Cm1lbnVCdXR0b24uY29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yOwptZW51QnV0dG9uLm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwptZW51QnV0dG9uLm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247Cm1lbnVCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm1hbmFnZXIuYWJEb3dubG9hZCgpO2A7CgovL2NyZWF0ZSBkb3dubG9hZCBidXR0b24KbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7CgppZiAoIXV1YWIpCnsKICAgIGxldCB1c2VyU3R1ZGlvcyA9IGNvbmZpZ0JvdC50YWdzLnVzZXJfc3R1ZGlvczsKCiAgICBpZiAoIXVzZXJTdHVkaW9zKQogICAgewogICAgICAgIHVzZXJTdHVkaW9zID0gYXdhaXQgb3MubGlzdFVzZXJTdHVkaW9zKCk7CiAgICB9CiAgICAKICAgIGlmICh1c2VyU3R1ZGlvcy5zdWNjZXNzKQogICAgewogICAgICAgIGNvbnN0IGFjdGl2ZVN0dWRpbyA9IHVzZXJTdHVkaW9zLnN0dWRpb3MuZmluZEluZGV4KHN0dWRpbyA9PiBzdHVkaW8uc3R1ZGlvSWQgPT0gY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQpOwogICAgICAgIAogICAgICAgIG1lbnVCdXR0b24ubGFiZWwgPSBhY3RpdmVTdHVkaW8gPT0gLTEgPyAibXkgc3R1ZGlvIiA6IHVzZXJTdHVkaW9zLnN0dWRpb3NbYWN0aXZlU3R1ZGlvXS5kaXNwbGF5TmFtZTsKICAgICAgICBtZW51QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IC0zOwogICAgICAgIG1lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAiY2VudGVyIjsKICAgICAgICBtZW51QnV0dG9uLnN0dWRpb0luZm9ybWF0aW9uID0gdXNlclN0dWRpb3M7CiAgICAgICAgbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9IG51bGw7CiAgICAgICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggOXB4IDlweCIsICJtYXJnaW4tdG9wIjogIjZweCJ9YDsKICAgICAgICBtZW51QnV0dG9uLmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvcjsKICAgICAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLnN0dWRpb1NlbGVjdCh0YWdzLnN0dWRpb0luZm9ybWF0aW9uKTtgOwogICAgICAgIAogICAgICAgIC8vY3JlYXRlIHN0dWRpbyBzZWxlY3QgYnV0dG9uCiAgICAgICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7CgogICAgICAgIG1lbnVCdXR0b24uc3R1ZGlvSW5mb3JtYXRpb24gPSBudWxsOwogICAgfQoKICAgIG1lbnVCdXR0b24ubGFiZWwgPSAicHVibGlzaCBwYXR0ZXJuIjsgCiAgICBtZW51QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IDE7CiAgICBtZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImNlbnRlciI7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gbnVsbDsKICAgIG1lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICI5cHggOXB4IDBweCAwcHgiLCAibWFyZ2luLXRvcCI6ICI2cHgifWA7CiAgICBtZW51QnV0dG9uLmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvcjsKICAgIG1lbnVCdXR0b24ucG9pbnRhYmxlID0gZmFsc2U7CiAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBudWxsOwogICAgbWVudUJ1dHRvbi5zY2FsZVkgPSAwLjc1OwogICAgCiAgICAvL2NyZWF0ZSBwdWJsaXNoIGxhYmVsIGJ1dHRvbgogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7CgogICAgbWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSAxOwogICAgbWVudUJ1dHRvbi5sYWJlbCA9ICJlbmNyeXB0IjsKICAgIG1lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAibGVmdCI7CiAgICBtZW51QnV0dG9uLm1lbnVJdGVtU3R5bGUgPSBg8J+nrCB7ImJvcmRlci1yYWRpdXMiOiAiMHB4IDBweCAwcHggMHB4IiwgIm1hcmdpbi10b3AiOiAiMHB4In1gOwogICAgbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjaGVja19ib3hfb3V0bGluZV9ibGFuayI7CiAgICBtZW51QnV0dG9uLmVuY3J5cHRTdGF0ZSA9IGZhbHNlOwogICAgbWVudUJ1dHRvbi5jb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3I7CiAgICBtZW51QnV0dG9uLnNjYWxlWSA9IDE7CiAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBpZih0YWdzLmVuY3J5cHRTdGF0ZSkKICAgIHsKICAgICAgICB0YWdzLmVuY3J5cHRTdGF0ZSA9IGZhbHNlOwogICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgICAgIGNvbmZpZ0JvdC50YWdzLmVuY3J5cHRpb24gPSBudWxsOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHRhZ3MuZW5jcnlwdFN0YXRlID0gdHJ1ZTsKICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveCc7CiAgICAgICAgY29uZmlnQm90LnRhZ3MuZW5jcnlwdGlvbiA9IHRydWU7CiAgICB9YDsKCiAgICAvL2NyZWF0ZSBlbmNyeXB0IGJ1dHRvbgogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7CgogICAgbWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSAyOwogICAgbWVudUJ1dHRvbi5sYWJlbCA9ICJpc1B1YmxpYyI7CiAgICBtZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImxlZnQiOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjBweCAwcHggMHB4IDBweCIsICJtYXJnaW4tdG9wIjogIjBweCJ9YDsKICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiY2hlY2tfYm94X291dGxpbmVfYmxhbmsiOwogICAgbWVudUJ1dHRvbi5wdWJsaWNTdGF0ZSA9IGZhbHNlOwogICAgbWVudUJ1dHRvbi5jb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3I7CiAgICBtZW51QnV0dG9uLnNjYWxlWSA9IDE7CiAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBpZih0YWdzLnB1YmxpY1N0YXRlKQogICAgewogICAgICAgIHRhZ3MucHVibGljU3RhdGUgPSBmYWxzZTsKICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsKICAgICAgICBjb25maWdCb3QudGFncy5wdWJsaWMgPSBudWxsOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHRhZ3MucHVibGljU3RhdGUgPSB0cnVlOwogICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94JzsKICAgICAgICBjb25maWdCb3QudGFncy5wdWJsaWMgPSB0cnVlOwogICAgfWA7CgogICAgLy9jcmVhdGUgcHVibGljIGJ1dHRvbgogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7CgogICAgbWVudUJ1dHRvbi5hYk1lbnUgPSBudWxsOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggOXB4IDlweCIsICJtYXJnaW4tdG9wIjogIjZweCJ9YDsKICAgIG1lbnVCdXR0b24uZGltZW5zaW9uID0gImFiTWVudSI7CiAgICBtZW51QnV0dG9uLm9uS2V5RG93biA9IGBACiAgICAgICAgaWYgKHRoYXQua2V5c1swXSA9PSAiU2hpZnQiKQogICAgICAgIHsKICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSB0cnVlOwogICAgICAgIH1gOwogICAgbWVudUJ1dHRvbi5vbktleVVwID0gYEAKICAgICAgICBpZiAodGhhdC5rZXlzWzBdID09ICJTaGlmdCIpCiAgICAgICAgewogICAgICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IGZhbHNlOwogICAgICAgIH1gOwogICAgbWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSAtNDsKICAgIG1lbnVCdXR0b24uYnV0dG9uU3RhdGUgPSAiYXV0b21hdGljIjsKICAgIG1lbnVCdXR0b24uY29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yOwogICAgbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjaGVja19ib3giOwogICAgbWVudUJ1dHRvbi5sYWJlbCA9ICJhdXRvbWF0aWMgdmVyc2lvbiI7CiAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQAogICAgICAgIGlmKHRhZ3MuYnV0dG9uU3RhdGUgPT0gJ2F1dG9tYXRpYycpCiAgICAgICAgewogICAgICAgICAgICB0YWdzLmJ1dHRvblN0YXRlID0gJ21hbnVhbCc7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgICAgICAgICBjb25maWdCb3QudGFncy52ZXJzaW9uRGVmaW5lZCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIHRhZ3MuYnV0dG9uU3RhdGUgPSAnYXV0b21hdGljJzsKICAgICAgICAgICAgdGFncy5sYWJlbCA9ICdhdXRvbWF0aWMgdmVyc2lvbic7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94JzsKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MudmVyc2lvbkRlZmluZWQgPSBudWxsOwogICAgICAgIH1gOwoKICAgIC8vY3JlYXRlIHZlcnNpb24gYnV0dG9uCiAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKfQoKbWVudUJ1dHRvbi5kaW1lbnNpb24gPSBudWxsOwptZW51QnV0dG9uLmFiTWVudSA9IHRydWU7Cm1lbnVCdXR0b24ub25LZXlEb3duID0gbnVsbDsKbWVudUJ1dHRvbi5vbktleVVwID0gbnVsbDsKbWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSAyOwptZW51QnV0dG9uLmJ1dHRvblN0YXRlID0gbnVsbDsKbWVudUJ1dHRvbi5jb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3I7Cm1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiZWdnIjsKCmlmICh1dWFiKQp7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gInFyX2NvZGVfc2Nhbm5lciI7CiAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQAogICAgICAgIHRyeQogICAgICAgIHsKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MudXVhYlNjYW4gPSB0cnVlOwoKICAgICAgICAgICAgb3Mub3BlblFSQ29kZVNjYW5uZXIoKTsKCiAgICAgICAgICAgIG9zLnRvYXN0KCJwbGVhc2Ugc2NhbiB5b3VyIHByYWN0aWNlIHBlcm1pdCIpOwogICAgICAgIH0KICAgICAgICBjYXRjaAogICAgICAgIHsKICAgICAgICAgICAgb3MudG9hc3QoInFyIGNvZGUgc2NhbiBub3Qgc3VwcG9ydGVkIG9uIHRoaXMgZGV2aWNlIik7CgogICAgICAgICAgICBjb25maWdCb3QudGFncy51dWFiU2NhbiA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsKICAgIGA7CiAgICBtZW51QnV0dG9uLmxhYmVsID0gInB1Ymxpc2ggYWIiOwp9CmVsc2UKewogICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjBweCAwcHggOXB4IDlweCIsICJtYXJnaW4tdG9wIjogIjBweCJ9YDsKICAgIG1lbnVCdXR0b24uZm9ybSA9ICJpbnB1dCI7CiAgICBtZW51QnV0dG9uLm1lbnVJdGVtU2hvd1N1Ym1pdFdoZW5FbXB0eSA9IHRydWU7CiAgICBtZW51QnV0dG9uLm1lbnVJdGVtVGV4dCA9ICFsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzID8gbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIgOiBsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzLmlkOwogICAgbWVudUJ1dHRvbi50YXJnZXRCb3QgPSBnZXRMaW5rKHBvc3NpYmxlUHVibGlzaEJvdCk7CiAgICBtZW51QnV0dG9uLm9uU3VibWl0ID0gYEAgY29uZmlnQm90LnRhZ3MubWFudWFsUHVibGlzaCA9IHRydWU7ICAgCgogICAgICAgIGlmICh0aGF0LnRleHQgPT0gbnVsbCAmJiBsaW5rcy5yZW1lbWJlci50YWdzLmJhc2VBQiAmJiAhbGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1cykKICAgICAgICB7CiAgICAgICAgICAgIHRoYXQudGV4dCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoYXQudGV4dCkKICAgICAgICB7CiAgICAgICAgICAgIGxpbmtzLm1hbmFnZXIuYWJQdWJsaXNoQUIoe2FiOiB0aGF0LnRleHQsIG1hbnVhbFB1Ymxpc2g6IHRydWUsIGJvdDogbGlua3MudGFyZ2V0Qm90fSk7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIG9zLnRvYXN0KCJhYiBub3Qgc3BlY2lmaWVkIik7CgogICAgICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKICAgICAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CiAgICAgICAgfQogICAgYDsKfQoKLy9jcmVhdGUgcHVibGlzaCBidXR0b24KbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7CgppZiAobGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1cykKewogICAgbWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSA4OwogICAgbWVudUJ1dHRvbi5mb3JtID0gbnVsbDsKICAgIG1lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICI5cHggOXB4IDlweCA5cHgiLCAibWFyZ2luLXRvcCI6ICI2cHgifWA7CiAgICBtZW51QnV0dG9uLmxhYmVsID0gImNvcHkgdG8gY2xpcGJvYXJkIjsKICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiZmlsZV9jb3B5IjsKICAgIG1lbnVCdXR0b24uY29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yOwogICAgbWVudUJ1dHRvbi50YXJnZXRCb3QgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90Rm9jdXM7CiAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBsZXQgc2VsZWN0ZWRCb3QgPSBsaW5rcy50YXJnZXRCb3Q7CiAgICBsZXQgcHJlcHBlZEJvdCA9IEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkQm90KTsKICAgIGxldCBzdGF0ZSA9IHt9CgogICAgc3RhdGVbYWJJbnN0TWVtb3J5LnRhZ3MuYWJGb2N1c0RhdGFdID0gc2VsZWN0ZWRCb3Q7CgogICAgbGV0IG5ld0ZpbGUgPSB7fQogICAgbmV3RmlsZS52ZXJzaW9uID0gMTsKICAgIG5ld0ZpbGUuc3RhdGUgPSBzdGF0ZTsKCiAgICB2YXIgZm9ybWF0dGVkRmlsZSA9IEpTT04uc3RyaW5naWZ5KG5ld0ZpbGUpOwoKICAgIG9zLnNldENsaXBib2FyZChmb3JtYXR0ZWRGaWxlKTsKCiAgICBvcy50b2FzdCgiYm90IGNvcGllZCB0byBjbGlwYm9hcmQiKTsKCiAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwogICAgYDsKICAgIAogICAgLy9jcmVhdGUgIGNvcHkgdG8gY2xpcGJvYXJkIGJ1dHRvbgogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7Cn0KZWxzZSBpZiAoIXV1YWIpCnsKICAgIG1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gMTA7CiAgICBtZW51QnV0dG9uLmZvcm0gPSBudWxsOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggOXB4IDlweCIsICJtYXJnaW4tdG9wIjogIjNweCJ9YDsKICAgIG1lbnVCdXR0b24ubGFiZWwgPSAic2NhbiI7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gInFyX2NvZGVfc2Nhbm5lciI7CiAgICBtZW51QnV0dG9uLmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvcjsKICAgIG1lbnVCdXR0b24ub25DbGljayA9IGBAIGNvbmZpZ0JvdC50YWdzLnB1Ymxpc2hTY2FuID0gdHJ1ZTsgb3Mub3BlblFSQ29kZVNjYW5uZXIoKTtgOwoKICAgIC8vY3JlYXRlICBzY2FuIGJ1dHRvbgogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7CgogICAgLy9ORUVEIFRPIFVQREFURQogICAgaWYgKGNvbmZpZ0JvdC50YWdzLmdpZykKICAgIHsKICAgICAgICBtZW51QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IC01OwogICAgICAgIG1lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICI5cHggOXB4IDlweCA5cHgiLCAibWFyZ2luLXRvcCI6ICIzcHgifWA7CiAgICAgICAgbWVudUJ1dHRvbi5sYWJlbCA9ICJzdWJtaXQgZ2lnIjsKICAgICAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gInNlbmQiOwogICAgICAgIG1lbnVCdXR0b24uY29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yOwogICAgICAgIG1lbnVCdXR0b24ub25DbGljayA9IGBAIHNob3V0KCJhYkNvbGxhYlN1Ym1pdCIpO2A7CgogICAgICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwogICAgfQp9CgpsZXQgaG9zdEJ1dHRvbiA9IHt9OwoKaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEKQp7CiAgICBob3N0QnV0dG9uLmxhYmVsID0gImpvaW4gY29kZTogIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElELnN1YnN0cmluZygwLDMpICsgIi0iICsgbGlua3MucmVtZW1iZXIudGFncy5ob3N0SUQuc3Vic3RyaW5nKDMpOwp9CmVsc2UKewogICAgaG9zdEJ1dHRvbi5sYWJlbCA9ICJnZW5lcmF0ZSBqb2luIGNvZGUiOwp9Cgpob3N0QnV0dG9uLmFiTWVudSA9IHRydWU7Cmhvc3RCdXR0b24uYWJNZW51U29ydE9yZGVyID0gNTA7Cmhvc3RCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKaG9zdEJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJncm91cF9hZGQiOwpob3N0QnV0dG9uLmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvcjsKaG9zdEJ1dHRvbi5sZWFybiA9IHRhZ3MubGVhcm47Cmhvc3RCdXR0b24ucmVtZW1iZXIgPSB0YWdzLnJlbWVtYmVyOwpob3N0QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5sZWFybi5hYkNyZWF0ZUhvc3QodGhpc0JvdCk7CgppZiAoIWxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEKQp7CiAgICB0YWdzLmxhYmVsID0gJ2dlbmVyYXRpbmcgY29kZSBub3cnOwp9YDsKCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKGhvc3RCdXR0b24pOy8vZ2VuZXJhdGUgYSBob3N0IGJ1dHRvbicA9KXalw2zHg5hYkNvcmVNZW51SWNvbgIEAPSl2pcNm3QJaW9zX3NoYXJlJwD0pdqXDbMeD2FiQ29yZU1lbnVMYWJlbAIEAPSl2pcNpXQFc2hhcmUnAPSl2pcNsx4TYWJDb3JlTWVudVNvcnRPcmRlcgIEAPSl2pcNq3QBMycA9KXalw2zHghyZW1lbWJlcgIEAPSl2pcNrXQo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycA9KXalw2zHgthYlB1Ymxpc2hBQgIEAPSl2pcN1HSBJkAvL3Nob3V0KCJhYlB1Ymxpc2hBQiIsIHthYjogIiIsIGtleTogIiIsIHRhcmdldDogIiJ9KTsKYWIubG9nKCJhYiBwdWJsaXNoaW5nIik7CgpsZXQgcHJvZ3Jlc3NCdXR0b247CgovL2Rlc3Ryb3kgcHJldmlvdXMgeHAgYm90CmlmIChnZXRCb3QoInN5c3RlbSIsICJhYi5wYXR0ZXJuLmFiWFBCb3QiKSkKewogICAgZGVzdHJveShnZXRCb3QoInN5c3RlbSIsICJhYi5wYXR0ZXJuLmFiWFBCb3QiKSk7Cn0KCnNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgovL2NsZWFyIGFiIGJ1aWxkZXIKaWYgKGxpbmtzLm1hbmlmZXN0YXRpb24pCnsKICAgIGlmIChsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KQogICAgewogICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICB9Cn0KCi8vcHJvZ3Jlc3MgYmFyIGZvciBtYW51YWwgcHVibGlzaGluZyBjb25maXJtYXRpb24KaWYgKGNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2gpCnsKICAgIHByb2dyZXNzQnV0dG9uID0gYXdhaXQgbGlua3MuaW5wdXQuYWJQcm9ncmVzc0JhcihgdXBsb2FkaW5nICR7dGhhdC5hYn1gKTsKfQoKLy9hYiB2YXJpYWJsZXMKbGV0IGFiSUQgPSB0aGF0LmFiOwpsZXQga2V5ID0gdGhhdC5rZXk7CmxldCB0YXJnZXQgPSB0aGF0LnRhcmdldCA/IHRoYXQudGFyZ2V0IDogdGhhdC5ib3Q7CmxldCByZXR1cm5UeXBlID0gdGhhdC5yZXR1cm5UeXBlOwpsZXQgcHVibGljID0gY29uZmlnQm90LnRhZ3MucHVibGljOwpsZXQgc3RhdGUgPSB7fTsKbGV0IGZvcm1hdHRlZEZpbGUgPSB7fTsKCmNvbmZpZ0JvdC50YWdzLnB1YmxpYyA9IG51bGw7CgovL3RoaXMgbG9naWMgZm9ybWF0cyB0aGUgc3BlY2lmaWVkIGJvdHMgYW5kIHBhY2thZ2VzIHRoZW0gZm9yIHB1Ymxpc2hpbmcKaWYgKCFBcnJheS5pc0FycmF5KHRhcmdldCkgJiYgdGFyZ2V0ICE9IG51bGwgJiYgdGFyZ2V0ICE9IHVuZGVmaW5lZCkKewoKfQplbHNlIGlmICghdGFyZ2V0IHx8IHRhcmdldC5sZW5ndGggPCAxKQp7CiAgICB0YXJnZXQgPSBnZXRCb3RzKGJ5TW9kKHtzcGFjZTogInNoYXJlZCIsIGFiSWdub3JlOiBudWxsfSkpOwoKICAgIGlmICh0YXJnZXQubGVuZ3RoIDwgMSkKICAgIHsKICAgICAgICBvcy50b2FzdCgiTm8gYm90cyBmb3VuZCB0byBwdWJsaXNoIik7CgogICAgICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgogICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwoKICAgICAgICByZXR1cm47CiAgICB9Cn0KCi8vdGhpcyBsb2dpYyBoYW5kbGVzIGdlbmVyYXRpbmcgYSBrZXkgZm9yIGVuY3J5cHRpb24gKG9wdGlvbmFsKQppZiAoY29uZmlnQm90LnRhZ3MuZW5jcnlwdGlvbikKewogICAgbGV0IGtleUNoZWNrOwoKICAgIGNvbmZpZ0JvdC50YWdzLmVuY3J5cHRpb24gPSBudWxsOwoKICAgIGtleSA9IGF3YWl0IG9zLnNob3dJbnB1dCgiIiwgewogICAgICAgIHR5cGU6ICdzZWNyZXQnLAogICAgICAgIHRpdGxlOiAnZW50ZXIgYSBzZWNyZXQga2V5JwogICAgfSk7CgogICAgaWYgKGtleSkKICAgIHsKICAgICAgICBrZXlDaGVjayA9IGF3YWl0IG9zLnNob3dJbnB1dCgiIiwgewogICAgICAgICAgICB0eXBlOiAnc2VjcmV0JywKICAgICAgICAgICAgdGl0bGU6ICdjb25maXJtIHNlY3JldCBrZXknCiAgICAgICAgfSk7CiAgICB9CgogICAgaWYgKGtleSAhPSBrZXlDaGVjaykgewogICAgICAgIGlmICgha2V5Q2hlY2spCiAgICAgICAgewogICAgICAgICAgICBvcy50b2FzdCgibm8ga2V5IGVudGVyZWQiKTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgb3MudG9hc3QoImtleXMgZG8gbm90IG1hdGNoIik7CiAgICAgICAgfQoKICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQp9CgovL2Zvcm1hdHRpbmcgYm90cyBmb3IgZmlsZSBzdG9yYWdlCmlmIChBcnJheS5pc0FycmF5KHRhcmdldCkpIAp7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRhcmdldC5sZW5ndGg7IGkrKykgewogICAgICAgIGxldCBjdXJyZW50Qm90SUQgPSB0YXJnZXRbaV0uaWQ7CiAgICAgICAgbGV0IGN1cnJlbnRCb3QgPSB0YXJnZXRbaV07CiAgICAgICAgCiAgICAgICAgc3RhdGVbY3VycmVudEJvdElEXSA9IGN1cnJlbnRCb3Q7CiAgICB9Cn0KZWxzZSAKewogICAgc3RhdGVbdGFyZ2V0LmlkXSA9IHRhcmdldDsKfQoKLy9jaGVja3MgZm9yIHByZXZpb3VzIGVnZ3MgYW5kIHJldHVybnMgZGF0YSBmb3IgcHJldmlvdXNseSBwdWJsaXNoZWQgYWIncwpsZXQgZWdnQ2hlY2sgPSBhd2FpdCB0aGlzQm90LmFiUHJldmlvdXNFZ2dDaGVjayh7YWJJRDogYWJJRH0pOwoKLy9hZGQgeHAgYm90IGhlcmUKY29uc3QgeHBWZXJzaW9uQm90ID0ge307Cgp4cFZlcnNpb25Cb3Quc3BhY2UgPSAic2hhcmVkIjsKeHBWZXJzaW9uQm90LmlkID0gImFiWFBCb3QiOwp4cFZlcnNpb25Cb3QudGFncyA9IHt9OwoKeHBWZXJzaW9uQm90LnRhZ3MuZm9ybSA9ICJub3RoaW5nIjsKeHBWZXJzaW9uQm90LnRhZ3Muc3lzdGVtID0gImFiLnBhdHRlcm4uYWJYUEJvdCI7CnhwVmVyc2lvbkJvdC50YWdzLmF1dGhvcklEID0gYXV0aEJvdC5pZDsKeHBWZXJzaW9uQm90LnRhZ3MudmVyc2lvbiA9IGVnZ0NoZWNrLmVnZ0RhdGEubWF4VmVyc2lvbjsKeHBWZXJzaW9uQm90LnRhZ3MueHAgPSBsaW5rcy5sZWFybi50YWdzLmFiWFA7CnhwVmVyc2lvbkJvdC50YWdzLnNpZ25hdHVyZSA9IGVnZ0NoZWNrLnNpZ25hdHVyZTsKCnN0YXRlLmFiWFBCb3QgPSB4cFZlcnNpb25Cb3Q7CgovL2FkZGl0aW9uYWwgZmlsZSBkYXRhCmZvcm1hdHRlZEZpbGUudmVyc2lvbiA9IDE7CmZvcm1hdHRlZEZpbGUuc2lnbmF0dXJlID0gZWdnQ2hlY2suc2lnbmF0dXJlOwpmb3JtYXR0ZWRGaWxlLnN0YXRlID0gc3RhdGU7CgovL2FjdHVhbCBlbmNyeXB0aW9uIGlmIGNob3NlbgppZiAoa2V5KSAKewogICAgZm9ybWF0dGVkRmlsZSA9IEpTT04uc3RyaW5naWZ5KGZvcm1hdHRlZEZpbGUpOwoKICAgIGZvcm1hdHRlZEZpbGUgPSBjcnlwdG8uZW5jcnlwdChrZXksIGZvcm1hdHRlZEZpbGUpOwp9CgovL3B1Ymxpc2ggdGhlIGZpbGUKbGV0IHB1Ymxpc2hGaWxlID0gYXdhaXQgdGhpc0JvdC5hYlB1Ymxpc2hGaWxlKHtmaWxlOiBmb3JtYXR0ZWRGaWxlLCBmaWxlTmFtZTogYWJJRH0pOwoKLy9nYXRoZXIgYWRkaW9uYWwgZWdnIGRhdGEKZWdnQ2hlY2suZWdnRGF0YS5lZ2dWZXJzaW9uSGlzdG9yeS5wdXNoKHB1Ymxpc2hGaWxlLnVybCk7CmVnZ0NoZWNrLmVnZ0RhdGEubWF4VmVyc2lvbiA9IGVnZ0NoZWNrLmVnZ0RhdGEuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RoOwplZ2dDaGVjay5lZ2dEYXRhLnRhcmdldFZlcnNpb24gPSBlZ2dDaGVjay5lZ2dEYXRhLmVnZ1ZlcnNpb25IaXN0b3J5Lmxlbmd0aDsKCi8vcHVibGlzaCBlZ2cvYWIgcmVjb3JkCmxldCBwdWJsaXNoUmVjb3JkID0gYXdhaXQgdGhpc0JvdC5hYlB1Ymxpc2hSZWNvcmQoe2RhdGE6IGVnZ0NoZWNrLmVnZ0RhdGEsIHJlY29yZE5hbWU6IGFiSUQsIHB1YmxpYzogcHVibGljfSk7CmxldCBzaXRlT3JpZ2luID0gbmV3IFVSTChjb25maWdCb3QudGFncy51cmwpLm9yaWdpbjsKCi8vcHVibGlzaGluZyBzaG91dApzaG91dCgib25BQlB1Ymxpc2hlZCIsIHtzdWNjZXNzOiBwdWJsaXNoRmlsZS5zdWNjZXNzLCBhYjogYWJJRCwgZmlsZUFkZHJlc3M6IHB1Ymxpc2hGaWxlLnVybH0pOwoKY29uc3Qgc3R1ZGlvTGluayA9IGNvbmZpZ0JvdC50YWdzLnNlbGVjdGVkX3N0dWRpb0lEID8/IGF1dGhCb3QuaWQ7CgovL3NlbmQgZGF0YSBhbmQgZm9ybWF0IHVybCBpZiBkYXRhIHN1Y2Nlc3NmdWxseSBzZW50CmlmIChwdWJsaXNoUmVjb3JkLnN1Y2Nlc3MpCnsKICAgIGNvbnN0IGJpb3MgPSBwdWJsaWMgPyAicHVibGljJTIwaW5zdCIgOiAicHJpdmF0ZSUyMGluc3QiOwoKICAgIHNldFRhZ01hc2sobGlua3MubGVhcm4sICJhYlhQIiwgIjAiLCAibG9jYWwiKTsKCiAgICBpZiAoa2V5ICYmIGNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2gpIAogICAgewogICAgICAgIGlmIChwdWJsaWMgPT09IHRydWUpCiAgICAgICAgewogICAgICAgICAgICBvcy5zZXRDbGlwYm9hcmQoc2l0ZU9yaWdpbiArICIvP3BhdHRlcm49IiArIGFiSUQgKyAiJmtleT0iICsga2V5ICsgIiZzdHVkaW89IiArIHN0dWRpb0xpbmsgKyAiJmJpb3M9IiArIGJpb3MpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBvcy50b2FzdCgidXJsIGNvcGllZCB0byBjbGlwYm9hcmQiKTsKICAgIH0KICAgIGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2gpCiAgICB7CiAgICAgICAgb3Muc2V0Q2xpcGJvYXJkKHNpdGVPcmlnaW4gKyAiLz9wYXR0ZXJuPSIgKyBhYklEICsgIiZzdHVkaW89IiArIHN0dWRpb0xpbmsgKyAiJmJpb3M9IiArIGJpb3MpOwoKICAgICAgICBvcy50b2FzdCgidXJsIGNvcGllZCB0byBjbGlwYm9hcmQiKTsKICAgIH0KCiAgICB0cnkgCiAgICB7CiAgICAgICAgYXdhaXQgYW5hbHl0aWNzLnJlY29yZEV2ZW50KCdhYl9lZ2dfcHVibGlzaCcsIHsgYWI6IGFiSUQsIHZlcnNpb246IGVnZ0NoZWNrLmVnZ0RhdGEuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RoIH0pOwogICAgfQogICAgY2F0Y2ggKGUpIAogICAgewogICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgfQp9CmVsc2UKewogICAgY29uc29sZS5sb2cocHVibGlzaFJlY29yZCk7Cn0KCi8vY2xlYXIgcHJvZ3Jlc3MgYmFyCmlmIChwcm9ncmVzc0J1dHRvbikKewogICAgZGVzdHJveShwcm9ncmVzc0J1dHRvbik7Cn0KCmNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2ggPSBudWxsOwoKcmV0dXJuIHB1Ymxpc2hSZWNvcmQ7JwD0pdqXDbMeCGFiSWdub3JlAgQA9KXalw3WmgEEdHJ1ZScA9KXalw2zHgphYkRvd25sb2FkAgQA9KXalw3bmgHIA0AvL2Rvd25sb2FkIGJvdHMgKGVpdGhlciBzZWxlY3RlZCBvciBhbGwgZXhwZXJpZW5jZSkKbGV0IGRvd25sb2FkQm90czsKCmlmIChsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzKQp7CiAgICBkb3dubG9hZEJvdHMgPSBbbGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1c107CgogICAgYWIubG9nKCJkb3dubG9hZGluZyBib3QiKTsKfQplbHNlCnsKICAgIGRvd25sb2FkQm90cyA9IGdldEJvdHMoYnlNb2QoeyJhYklnbm9yZSI6IG51bGwsICJzcGFjZSI6ICJzaGFyZWQifSkpOwoKICAgIGFiLmxvZygiZG93bmxvYWRpbmcgaW5zdCIpOwp9CgpsZXQgY3VycmVudEluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpOwoKb3MuZG93bmxvYWRCb3RzKGRvd25sb2FkQm90cywgY3VycmVudEluc3QpOwoKc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOycA9KXalw2zHg1tYW5pZmVzdGF0aW9uAgQA9KXalw2kngEo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcA9KXalw2zHgRtZW51AgQA9KXalw3LngEo8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicA9KXalw2zHhJhYlByZXZpb3VzRWdnQ2hlY2sCBAD0pdqXDfKeAfEPQC8vdGhpcyBmdW5jdGlvbiBjaGVja3MgZm9yIHByZXZpb3VzIGVnZ3MgYXQgYSBzcGVjaWZpZWQgYWIsIHJldHVybmluZyBhbnkgZGF0YSB0aGF0IGl0IGZpbmRzCmNvbnN0IGFiSUQgPSB0aGF0LmFiSUQ7Cgphd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwoKbGV0IGVnZ0hpc3Rvcnk7CmxldCBlZ2dJRDsKbGV0IHRhcmdldFZlcnNpb25OdW07CmxldCBsYXN0SGFzaDsKbGV0IG1heFZlcnNpb25OdW07CmxldCBwcmV2aW91c1hQOwpsZXQgdXNlclJlY29yZCA9IGNvbmZpZ0JvdC50YWdzLnNlbGVjdGVkX3N0dWRpb0lEID8gY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQgOiBjb25maWdCb3QudGFncy5zdHVkaW8gPyBjb25maWdCb3QudGFncy5zdHVkaW8gOiBhdXRoQm90LmlkOwpsZXQgcmVjb3JkTG9va3VwID0gYXdhaXQgb3MuZ2V0RGF0YSh1c2VyUmVjb3JkLCBhYklELCBsaW5rcy5yZW1lbWJlci50YWdzLmFiRW5kcG9pbnQpLmNhdGNoKGUgPT4ge30pOwoKaWYgKHJlY29yZExvb2t1cC5zdWNjZXNzKSAKewogICAgZWdnSGlzdG9yeSA9IHJlY29yZExvb2t1cC5kYXRhLmVnZ1ZlcnNpb25IaXN0b3J5OwogICAgZWdnSUQgPSByZWNvcmRMb29rdXAuZGF0YS5lZ2dJRDsKICAgIHByZXZpb3VzWFAgPSByZWNvcmRMb29rdXAuZGF0YS54cCA/PyAwOwogICAgdGFyZ2V0VmVyc2lvbk51bSA9IGVnZ0hpc3RvcnkubGVuZ3RoICsgMTsKICAgIGxhc3RIYXNoID0gZWdnSGlzdG9yeVt0YXJnZXRWZXJzaW9uTnVtIC0gMV07CiAgICBtYXhWZXJzaW9uTnVtID0gZWdnSGlzdG9yeS5sZW5ndGggKyAxOwp9IAplbHNlIAp7CiAgICBlZ2dIaXN0b3J5ID0gW107CiAgICBlZ2dJRCA9IHV1aWQoKTsKICAgIHRhcmdldFZlcnNpb25OdW0gPSAxOwogICAgbGFzdEhhc2ggPSAibm9uZSI7CiAgICBtYXhWZXJzaW9uTnVtID0gMTsKICAgIHByZXZpb3VzWFAgPSAwOwp9CgppZiAoY29uZmlnQm90LnRhZ3MudmVyc2lvbkRlZmluZWQpIAp7CiAgICBjb25zdCBkZWZpbmVkVmVyc2lvbiA9IGF3YWl0IG9zLnNob3dJbnB1dChtYXhWZXJzaW9uTnVtLCB7CiAgICAgICAgdGl0bGU6ICdzZXQgZGVmYXVsdCB2ZXJzaW9uJywKICAgICAgICBwbGFjZWhvbGRlcjogYDEgdG8gJHttYXhWZXJzaW9uTnVtfSAobGVhdmUgYXMgJHttYXhWZXJzaW9uTnVtfSBmb3IgbGF0ZXN0KWAKICAgIH0pOwoKICAgIHRhcmdldFZlcnNpb25OdW0gPSBkZWZpbmVkVmVyc2lvbjsKICAgIGNvbmZpZ0JvdC50YWdzLnZlcnNpb25EZWZpbmVkID0gbnVsbDsKfQplbHNlIGlmIChjb25maWdCb3QudGFncy50YXJnZXRWZXJzaW9uKSAKewogICAgdGFyZ2V0VmVyc2lvbk51bSA9IGNvbmZpZ0JvdC50YWdzLnRhcmdldFZlcnNpb247CiAgICBjb25maWdCb3QudGFncy50YXJnZXRWZXJzaW9uID0gbnVsbDsKfQoKbGV0IGVnZyA9IHt9OwoKZWdnLmVnZ1ZlcnNpb25IaXN0b3J5ID0gZWdnSGlzdG9yeTsKZWdnLmVnZ0Zvcm1hdFZlcnNpb24gPSBlZ2dJRDsKZWdnLnRhcmdldFZlcnNpb24gPSB0YXJnZXRWZXJzaW9uTnVtOwplZ2cubWF4VmVyc2lvbiA9IG1heFZlcnNpb25OdW07CmVnZy5sYWJlbCA9ICJ2Iit0YXJnZXRWZXJzaW9uTnVtOwplZ2cuYWJJRCA9IGFiSUQ7CmVnZy54cCA9IGxpbmtzLmxlYXJuLnRhZ3MuYWJYUDsKCmxldCBzaWduYXR1cmUgPSB7fTsKbGV0IGRhdGUgPSBuZXcgRGF0ZSgpOwpsZXQgdGltZSA9IGRhdGUuZ2V0VGltZSgpOwoKc2lnbmF0dXJlLnByZXZpb3VzSGFzaCA9IGxhc3RIYXNoOwpzaWduYXR1cmUuYWJWZXJzaW9uID0gbGlua3MucmVtZW1iZXIudGFncy5hYkNvcmVWZXJzaW9uKyIuIitsaW5rcy5yZW1lbWJlci50YWdzLmFiQ29yZUl0ZXJhdGlvbjsKc2lnbmF0dXJlLmVnZ1ZlcnNpb24gPSB0YWdzLmVnZ1VVSUQ7CnNpZ25hdHVyZS5lZ2dWZXJzaW9uTnVtID0gdGFncy5vdm9WZXJzaW9uOwpzaWduYXR1cmUudGltZVN0YW1wID0gdGltZTsKc2lnbmF0dXJlLmNhc3VhbE9TVmVyc2lvbiA9IFtvcy52ZXJzaW9uKCldOwoKcmV0dXJuIHtzaWduYXR1cmU6IHNpZ25hdHVyZSwgZWdnRGF0YTogZWdnfTsoAPSl2pcNsx4MYWJCb3RWZXJzaW9uAX2OAicA9KXalw2zHg9hYkJvdE1lbnVBY3Rpb24CBAD0pdqXDeWuAU1AYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsKCi8vc2V0IHVwIHRoZSBwdWJsaXNoIG1lbnUKdGhpc0JvdC5vblN0b3JlTWVudSgpOycA9KXalw2zHg5hYkJvdE1lbnVMYWJlbAIEAPSl2pcNs68BBXNoYXJlJwD0pdqXDbMeDWFiQm90TWVudUljb24CBAD0pdqXDbmvAQlpb3Nfc2hhcmUnAPSl2pcNsx4SYWJCb3RNZW51U29ydE9yZGVyAgQA9KXalw3DrwEBMycA9KXalw2zHgVsZWFybgIEAPSl2pcNxa8BKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAPSl2pcNsx4NYWJQdWJsaXNoVVVBQgIEAPSl2pcN7K8B5w9AY29uZmlnQm90LnRhZ3MudXVhYlNjYW4gPSBudWxsOwoKbGV0IHV1YWJDb25maWcgPSBhd2FpdCBsaW5rcy5zZWFyY2gub25Mb29rdXBBQkVnZ3Moe2FiSUQ6IGNvbmZpZ0JvdC50YWdzLnV1YWIsIHJldHVyblR5cGU6ICJkYXRhIn0pOwoKbGV0IHBpbiA9IGF3YWl0IG9zLnNob3dJbnB1dChudWxsLHsKICAgIHRpdGxlOiAiZW50ZXIgcGluIiwKICAgIHR5cGU6ICJzZWNyZXQiCn0pOwoKaWYgKHBpbikKewogICAgbGV0IHBoID0gY3J5cHRvLnNoYTI1NihwaW4pLnN1YnN0cmluZygwLDQpOwoKICAgIGlmIChwaCA9PSBjb25maWdCb3QudGFncy5waCkKICAgIHsKICAgICAgICBsZXQgcmVjb3JkS2V5OwogICAgICAgIGxldCBlZ2dEYXRhQ2hlY2s7CiAgICAgICAgbGV0IGVnZ0RhdGE7CgogICAgICAgIGZvciAodGFnIGluIHV1YWJDb25maWcuc3RhdGUpCiAgICAgICAgewogICAgICAgICAgICBpZiAodGFnKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICByZWNvcmRLZXkgPSB1dWFiQ29uZmlnLnN0YXRlW3RhZ10udGFncy5yZWNvcmRLZXk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh0aGF0KQogICAgICAgIHsKICAgICAgICAgICAgZWdnRGF0YUNoZWNrID0gYXdhaXQgb3MuZ2V0RGF0YShyZWNvcmRLZXksIHRoYXQudGFyZ2V0UmVjb3JkLCBsaW5rcy5yZW1lbWJlci50YWdzLmFiRW5kcG9pbnQpOwoKICAgICAgICAgICAgaWYgKGVnZ0RhdGFDaGVjay5zdWNjZXNzKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoZWdnRGF0YUNoZWNrLmRhdGEuZWdncykKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICB0cnkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVnZ0RhdGEgPSBKU09OLnBhcnNlKGVnZ0RhdGFDaGVjay5kYXRhLmVnZ3MpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVnZ0RhdGEubGVuZ3RoID49IDEyKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcy50b2FzdCgicHJhY3RpY2UgcGVybWl0IGZ1bGwiKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG91dCgiYWJSZWZyZXNoIik7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhdGNoCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiZWdnIGRhdGEgbm90IHJlYWRhYmxlIik7CgogICAgICAgICAgICAgICAgICAgICAgICBlZ2dEYXRhID0gW107CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJSZWNvcmRLZXkgPSByZWNvcmRLZXk7CgogICAgICAgIGNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2ggPSB0cnVlOwoKICAgICAgICB0aGlzQm90LmFiUHVibGlzaEFCKHthYjogY29uZmlnQm90LnRhZ3MuYWIsIGtleTogY29uZmlnQm90LnRhZ3Mua2V5fSk7CgogICAgICAgIGVnZ0RhdGEucHVzaChjb25maWdCb3QudGFncy5hYik7CgogICAgICAgIGVnZ0RhdGFUb1B1Ymxpc2ggPSB7ZWdnczogSlNPTi5zdHJpbmdpZnkoZWdnRGF0YSl9OwoKICAgICAgICBhd2FpdCBvcy5yZWNvcmREYXRhKHJlY29yZEtleSwgdGhhdC50YXJnZXRSZWNvcmQsIGVnZ0RhdGFUb1B1Ymxpc2gsIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJFbmRwb2ludCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgYXdhaXQgb3MudG9hc3QoInBpbiBkb2VzIG5vdCBtYXRjaCIsIDIpOwoKICAgICAgICBzaG91dCgiYWJSZWZyZXNoIik7CiAgICB9Cn0KZWxzZQp7CiAgICBhd2FpdCBvcy50b2FzdCgibm8gcGluIGdpdmVuIiwgMik7CgogICAgc2hvdXQoImFiUmVmcmVzaCIpOwoKICAgIHJldHVybgp9JwD0pdqXDbMeC2FiUVJQdWJsaXNoAgQA9KXalw3UvwHvBEBjb25maWdCb3QudGFncy5wdWJsaXNoU2NhbiA9IG51bGw7CgpsZXQgc2Nhbm5lZFVSTDsKCnRyeSAKewogICAgc2Nhbm5lZFVSTCA9IG5ldyBVUkwodGhhdCk7Cn0KY2F0Y2ggKGUpIHsKICAgIHNob3V0KCJhYlB1Ymxpc2hBQiIsIHthYjogdGhhdH0pOwoKICAgIHRoaXNCb3QuYWJQdWJsaXNoQUIoe2FiOiB0aGF0fSk7CgogICAgcmV0dXJuOwp9CgppZiAoc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJwaCIpKSAKewogICAgbGV0IHRhcmdldFJlY29yZCA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmdldCgiaW5zdCIpOwoKICAgIGNvbmZpZ0JvdC50YWdzLnV1YWIgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5nZXQoImFiIik7CiAgICBjb25maWdCb3QudGFncy5waCA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmdldCgicGgiKTsKICAgIGNvbmZpZ0JvdC50YWdzLmFiID0gdXVpZCgpOwogICAgY29uZmlnQm90LnRhZ3Mua2V5ID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJwaCIpOwoKICAgIHRoaXNCb3QuYWJQdWJsaXNoVVVBQih7dGFyZ2V0UmVjb3JkOiB0YXJnZXRSZWNvcmR9KTsKfQplbHNlIAp7CiAgICBvcy50b2FzdCgidW5zdXBwb3J0ZWQgdXJsIGZvcm1hdCIpOwp9JwD0pdqXDbMeBnNlYXJjaAIEAPSl2pcNxMQBKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAPSl2pcNsx4HYWJTaGVsbAIEAPSl2pcN68QBBHRydWUnAPSl2pcNsx4OYWJQdWJsaXNoQXNrSUQCBAD0pdqXDfDEAfQEQGxldCBwcm9ncmVzc0J1dHRvbiA9IGF3YWl0IGxpbmtzLmlucHV0LmFiUHJvZ3Jlc3NCYXIoYHB1Ymxpc2hpbmcgJHt0aGF0LmFza0lEfWApOwoKYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsKCmNvbnN0IHBhdHRlcm5JRCA9IHRoYXQucGF0dGVybklEOwpjb25zdCBzdHVkaW9JRCA9IHRoYXQuc3R1ZGlvSUQgPyB0aGF0LnN0dWRpb0lEIDogY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQgPyBjb25maWdCb3QudGFncy5zZWxlY3RlZF9zdHVkaW9JRCA6IGF1dGhCb3QuaWQ7CmNvbnN0IGFza0lEID0gImFza18iICsgdGhhdC5hc2tJRC5yZXBsYWNlQWxsKCItIiwgIiIpOwpjb25zdCBlbmRwb2ludCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJFbmRwb2ludDsKY29uc3QgcHVibGlzaEFzayA9IGF3YWl0IG9zLnJlY29yZERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYlJlY29yZEtleSwgYXNrSUQsIHtwYXR0ZXJuSUQ6IHBhdHRlcm5JRCwgc3R1ZGlvSUQ6IHN0dWRpb0lEfSwge2VuZHBvaW50OiBlbmRwb2ludCwgdXBkYXRlUG9saWN5OiBbYXV0aEJvdC5pZF19KTsKCmlmIChwcm9ncmVzc0J1dHRvbikKewogICAgZGVzdHJveShwcm9ncmVzc0J1dHRvbik7Cn0KCnJldHVybiBwdWJsaXNoQXNrOycA9KXalw2zHgVpbnB1dAIEAPSl2pcN5ckBKPCflJdmODYwMjg3OC1jMmVmLTQ4YmQtODVhMC04ZDYzNTFlYjQxMjAnAPSl2pcNsx4LYWJFbWJlZExpbmsCBAD0pdqXDYzKAaQDQGNvbnN0IGFiID0gdGhhdCA/IHRydWUgOiBmYWxzZTsKY29uc3QgZW1iZWRMaW5rID0gYWIgPyAiYWI9IiArIHRoYXQgOiAiaW5zdD0iICsgY29uZmlnQm90LnRhZ3MuaW5zdDsKY29uc3Qgc2l0ZU9yaWdpbiA9IG5ldyBVUkwoY29uZmlnQm90LnRhZ3MudXJsKS5vcmlnaW47CmNvbnN0IGVtYmVkVGV4dCA9IGA8IURPQ1RZUEUgaHRtbD4KwqDCoMKgwqA8aHRtbD4KwqDCoMKgwqDCoMKgwqDCoDxoZWFkPjwvaGVhZD4KwqDCoMKgwqDCoMKgwqDCoDxib2R5PgrCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqA8aWZyYW1lIHNyYz0iJHtzaXRlT3JpZ2luICsgIi8/IiArIGVtYmVkTGlua30iIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjQwMCIgLz4KwqDCoMKgwqDCoMKgwqDCoDwvYm9keT4KwqDCoMKgwqA8L2h0bWw+YDsKCnJldHVybiBlbWJlZFRleHQ7JwD0pdqXDbMeFGFiQ29yZU1lbnVPbkdlbmVyYXRlAgQA9KXalw2FzQGfBEBpZiAoIWF1dGhCb3QpCnsKICAgIGxldCBtZW51QnV0dG9uID0ge307CgogICAgbWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwogICAgbWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSA5OwogICAgbWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwogICAgbWVudUJ1dHRvbi5sYWJlbCA9ICJkb3dubG9hZCI7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImdldF9hcHAiOwogICAgbWVudUJ1dHRvbi5jb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3I7CiAgICBtZW51QnV0dG9uLm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwogICAgbWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwogICAgbWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MubWFuYWdlci5hYkRvd25sb2FkKCk7YDsKCiAgICAvL2NyZWF0ZSBkb3dubG9hZCBidXR0b24KICAgIGxpbmtzLmJhc2VTa2lsbC5saW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKfScA9KXalw2zHhNhYkJvdE1lbnVPbkdlbmVyYXRlAgQA9KXalw2j0QGfBEBpZiAoIWF1dGhCb3QpCnsKICAgIGxldCBtZW51QnV0dG9uID0ge307CgogICAgbWVudUJ1dHRvbi5hYk1lbnUgPSB0cnVlOwogICAgbWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSA5OwogICAgbWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwogICAgbWVudUJ1dHRvbi5sYWJlbCA9ICJkb3dubG9hZCI7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImdldF9hcHAiOwogICAgbWVudUJ1dHRvbi5jb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3I7CiAgICBtZW51QnV0dG9uLm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwogICAgbWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwogICAgbWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgbGlua3MubWFuYWdlci5hYkRvd25sb2FkKCk7YDsKCiAgICAvL2NyZWF0ZSBkb3dubG9hZCBidXR0b24KICAgIGxpbmtzLmJhc2VTa2lsbC5saW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKfScA9KXalw2zHgxzdHVkaW9TZWxlY3QCBAD0pdqXDcHVAcwIQHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGlua3MubWVudS5tYXNrcy5vbkdyaWRDbGljayA9ICJAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOyI7Cgpjb25zdCBzdHVkaW9zID0gdGhhdC5zdHVkaW9zOwpjb25zdCBtZW51QnV0dG9uID0ge307CgptZW51QnV0dG9uLmFiTWVudSA9IHRydWU7Cm1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gMDsKbWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwptZW51QnV0dG9uLmxhYmVsID0gIm15IHN0dWRpbyI7Cm1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSBjb25maWdCb3QudGFncy5zdHVkaW8gPT0gYXV0aEJvdC5pZCA/ICJyYWRpb19idXR0b25fY2hlY2tlZCIgOiAicmFkaW9fYnV0dG9uX3VuY2hlY2tlZCI7Cm1lbnVCdXR0b24uY29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yOwptZW51QnV0dG9uLm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwptZW51QnV0dG9uLnN0dWRpb0lEID0gYXV0aEJvdC5pZDsKbWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQgPSB0YWdzLnN0dWRpb0lEOwoKbGlua3MubWFuYWdlci5vblN0b3JlTWVudSgpO2A7CgpsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKCmZvciAobGV0IGkgPSAwOyBpIDwgc3R1ZGlvcy5sZW5ndGg7IGkrKykKewogICAgbGV0IGFjdGl2ZVN0dWRpbyA9IHN0dWRpb3NbaV07CgogICAgbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9IGNvbmZpZ0JvdC50YWdzLnN0dWRpbyA9PSBhY3RpdmVTdHVkaW8uc3R1ZGlvSWQgPyAicmFkaW9fYnV0dG9uX2NoZWNrZWQiIDogInJhZGlvX2J1dHRvbl91bmNoZWNrZWQiOwogICAgbWVudUJ1dHRvbi5sYWJlbCA9IGFjdGl2ZVN0dWRpby5kaXNwbGF5TmFtZTsKICAgIG1lbnVCdXR0b24uc3R1ZGlvSUQgPSBhY3RpdmVTdHVkaW8uc3R1ZGlvSWQ7CgogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7Cn0nAQRib3RzJGQ4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNQEnAPSl2pcNjN4BBnN5c3RlbQIEAPSl2pcNjd4BD2FiLnNoZWxsLnNlYXJjaCcA9KXalw2M3gEEZm9ybQIEAPSl2pcNnd4BB25vdGhpbmcnAPSl2pcNjN4BDmFiUmV0cmlldmVGaWxlAgQA9KXalw2l3gGCAUAvL3B1bGwgZG93biBmaWxlIGRhdGEKaWYgKCF0aGF0LnVybCkKewogICAgcmV0dXJuICJubyBmaWxlIHVybCBzdXBwbGllZCI7Cn0KCmxldCBkYXRhID0gYXdhaXQgb3MuZ2V0RmlsZSh0aGF0LnVybCk7CgpyZXR1cm4gZGF0YTsnAPSl2pcNjN4BEGFiUmV0cmlldmVSZWNvcmQCBAD0pdqXDajfAewEQC8vcmV0cmlldmUgc3BlY2lmaWVkIHJlY29yZApsZXQgcmVjb3JkTmFtZSA9IHRoYXQucmVjb3JkTmFtZTsKCmxldCByZWNvcmRLZXkgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiUmVjb3JkS2V5OwoKaWYgKHRoYXQucmVjb3JkS2V5KQp7CiAgICByZWNvcmRLZXkgPSB0aGF0LnJlY29yZEtleTsKfQplbHNlIGlmIChhdXRoQm90KQp7CiAgICBpZiAoYXV0aEJvdC5pZCA9PSBjb25maWdCb3QudGFncy5zdHVkaW8pCiAgICB7CiAgICAgICAgcmVjb3JkS2V5ID0gYXV0aEJvdC5pZDsKCiAgICAgICAgYXdhaXQgb3MuZ3JhbnRJbnN0QWRtaW5QZXJtaXNzaW9uKHJlY29yZEtleSk7CiAgICB9Cn0KCmxldCByZWNvcmRFbmRwb2ludCA9IHRoYXQucmVjb3JkRW5kcG9pbnQgPyB0aGF0LnJlY29yZEVuZHBvaW50IDogbGlua3MucmVtZW1iZXIudGFncy5hYkVuZHBvaW50OwoKaWYgKCFyZWNvcmROYW1lKQp7CiAgICByZXR1cm4gIm5vIHJlY29yZCBuYW1lIHN1cHBsaWVkIjsKfQoKbGV0IGdldFJlY29yZCA9IGF3YWl0IG9zLmdldERhdGEocmVjb3JkS2V5LCByZWNvcmROYW1lLCByZWNvcmRFbmRwb2ludCk7CgovL0FERCBhZGRpdGlvbmFsIGVycm9yIGhhbmRsaW5nPwoKcmV0dXJuIGdldFJlY29yZDsnAPSl2pcNjN4BCHJlbWVtYmVyAgQA9KXalw2V5AEo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycA9KXalw2M3gENbWFuaWZlc3RhdGlvbgIEAPSl2pcNvOQBKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAPSl2pcNjN4BDm9uTG9va3VwQUJFZ2dzAgQA9KXalw3j5AGwH0AvL3Nob3V0KCJvbkxvb2t1cEFCRWdncyIsIHthYklEOiBhYklELCBrZXk6IGtleSwgYXV0b0hhdGNoOiBib29sZWFuLCByZXR1cm5UeXBlOiBkYXRhL251bGx9KTsKYWIubG9nKCJhYiBsb2FkZWQ6ICIgKyB0aGF0KTsKCi8vY2xlYXIgYWItMQppZiAobGlua3MubWFuaWZlc3RhdGlvbikKewogICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7Cn0KCmxldCBwcm9ncmVzc0J1dHRvbiA9IGF3YWl0IGxpbmtzLmlucHV0LmFiUHJvZ3Jlc3NCYXIoYGxvYWRpbmcgJHt0aGF0LmFiSUR9YCk7CgovL2NvbnN0YW50cyBpbiByZWdhcmRzIHRvIHRoZSBhYiB0byBiZSBsb29rZWQgdXAKY29uc3QgYWJJRCA9IHRoYXQuYWJJRDsKY29uc3QgaW5pdGlhbEJvb3QgPSB0aGF0LmluaXRpYWxCb290Owpjb25zdCBhdXRvSGF0Y2ggPSB0aGF0LmF1dG9IYXRjaDsKCi8vcmVjb3JkS2V5IGlzIHZhcmlhYmxlIGRlcGVuZGluZyBvbiBpZiBwdWJsaWMKbGV0IHJlY29yZEtleSA9IHRoYXQucmVjb3JkS2V5ID8/IGNvbmZpZ0JvdC50YWdzLnN0dWRpbzsKbGV0IHBvc3NpYmxlQXV0aCA9IGF1dGhCb3QgPyBhdXRoQm90IDogdHJ1ZTsKbGV0IGdldFJlY29yZCA9IGF3YWl0IG9zLmdldERhdGEocmVjb3JkS2V5LCBhYklELCBsaW5rcy5yZW1lbWJlci50YWdzLmFiRW5kcG9pbnQpOwoKLy92YXJpYWJsZXMgZm9yIGVnZy9hYiBoYXRjaGluZwpsZXQgcmV0dXJuVHlwZSA9IHRoYXQucmV0dXJuVHlwZTsKbGV0IGtleSA9IHRoYXQua2V5OwpsZXQgbmV3RWdnOwoKLy90aGlzIGxvZ2ljIGhhbmRsZXMgdGhlIHJldHJpZXZlZCBkYXRhLCBzZWFyY2hlcyBhZ2FpbiBpZiBub25lIGNhbWUgdGhyb3VnaAppZiAoIWdldFJlY29yZC5zdWNjZXNzICYmICghcmVjb3JkS2V5IHx8IHBvc3NpYmxlQXV0aCAhPSByZWNvcmRLZXkpKQp7CiAgICBpZiAoIXJlY29yZEtleSkKICAgIHsKICAgICAgICBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwoKICAgICAgICByZWNvcmRLZXkgPSBhdXRoQm90LmlkOwogICAgfQoKICAgIGF3YWl0IG9zLmdyYW50SW5zdEFkbWluUGVybWlzc2lvbihyZWNvcmRLZXkpOwoKICAgIGdldFJlY29yZCA9IGF3YWl0IG9zLmdldERhdGEocmVjb3JkS2V5LCBhYklELCBsaW5rcy5yZW1lbWJlci50YWdzLmFiRW5kcG9pbnQpOwp9CgppZiAoIWdldFJlY29yZC5zdWNjZXNzKQp7CiAgICBvcy50b2FzdChgbm8gZGF0YSBmb3VuZCBpbiAke2FiSUR9YCk7CgogICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICBpZiAocHJvZ3Jlc3NCdXR0b24pCiAgICB7CiAgICAgICAgZGVzdHJveShwcm9ncmVzc0J1dHRvbik7CiAgICB9CgogICAgcmV0dXJuIHtzdWNjZXNzOiBmYWxzZX07Cn0KZWxzZQp7CiAgICAvL3BhY2thZ2UgdGhlIHJlY29yZCBkYXRhCiAgICBuZXdFZ2cgPSBnZXRSZWNvcmQuZGF0YTsKfQoKLy90aGlzIGxvZ2ljIHBhcnNlcyB0aGUgZGF0YSBkZXBlbmRhbnQgb24gaG93IGl0IHdhcyBhY2Nlc3NlZC9nYWluZWQKaWYgKHJldHVyblR5cGUgPT0gImRhdGEiICYmIGdldFJlY29yZC5zdWNjZXNzKQp7CiAgICBsZXQgdmVyc2lvbiA9IGdldFJlY29yZC5kYXRhLnRhcmdldFZlcnNpb24gLSAxOwoKICAgIGlmICh0aGF0LmFiVmVyc2lvbikKICAgIHsKICAgICAgICBpZiAoIWlzTmFOKHRoYXQuYWJWZXJzaW9uKSkKICAgICAgICB7CiAgICAgICAgICAgIHZlcnNpb24gPSB0aGF0LmFiVmVyc2lvbiAtIDE7CiAgICAgICAgfQogICAgfQoKICAgIGxldCBlZ2dEYXRhVVJMID0gZ2V0UmVjb3JkLmRhdGEuZWdnVmVyc2lvbkhpc3RvcnlbdmVyc2lvbl07CiAgICBsZXQgcmV0dXJuRGF0YSA9IGF3YWl0IG9zLmdldEZpbGUoZWdnRGF0YVVSTCk7CgogICAgaWYgKHByb2dyZXNzQnV0dG9uKQogICAgewogICAgICAgIGRlc3Ryb3kocHJvZ3Jlc3NCdXR0b24pOwogICAgfQoKICAgIHJldHVybiByZXR1cm5EYXRhOwp9CmVsc2UgaWYgKHJldHVyblR5cGUgPT0gImRhdGEiKQp7CiAgICBsZXQgdmVyc2lvbkFycmF5ID0gSlNPTi5wYXJzZShuZXdFZ2cuZWdnVmVyc2lvbkhpc3RvcnkpOwogICAgbGV0IGZpbGVVVUlEID0gdmVyc2lvbkFycmF5W25ld0VnZy5tYXhWZXJzaW9uIC0gMV07CiAgICBsZXQgZmlsZW5hbWVoYXNoTFRNID0gY3J5cHRvLnNoYTI1NihmaWxlVVVJRCk7CiAgICBsZXQgZmlsZXVybGhhc2hMVE0gPSAiYXV4XyIgKyBmaWxlbmFtZWhhc2hMVE0gKyAnLmF1eCc7CiAgICBsZXQgdGFyZ2V0TFRNVVJMID0gImh0dHBzOi8vYnVpbGRlci1sdG0tZmlsZXMuczMuYW1hem9uYXdzLmNvbS8iICsgZmlsZXVybGhhc2hMVE07CiAgICBsZXQgbyA9IHt9OwogICAgby5tZXRob2QgPSAiR0VUIjsKICAgIG8udXJsID0gdGFyZ2V0TFRNVVJMOwoKICAgIGZpbGVHZXQgPSBhd2FpdCB3ZWJob29rKG8pOwoKICAgIGlmIChwcm9ncmVzc0J1dHRvbikKICAgIHsKICAgICAgICBkZXN0cm95KHByb2dyZXNzQnV0dG9uKTsKICAgIH0KCiAgICBpZiAoZmlsZUdldC5zdGF0dXMgIT0gMjAwKQogICAgewogICAgICAgIG9zLnRvYXN0KCJubyBmaWxlIGZvdW5kIik7CgogICAgICAgIHNob3V0KCJhYlJlZnJlc2giKTsKCiAgICAgICAgcmV0dXJuIHtzdWNjZXNzOiBmYWxzZX07CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgZmlsZUdldCA9IGZpbGVHZXQuZGF0YTsKICAgIH0KCiAgICByZXR1cm4gZmlsZUdldDsKfQoKLy9hYiBzcGVjaWZpYyB2YXJpYWJsZXMgZm9yIHVuZGVyc3RhbmRpbmcgaWYgYSBwb3NpdGlvbiBpcyBzcGVjaWZpZWQKbGV0IGN1cnJlbnREaW07CmxldCBzcGFjZU1vZDsKbGV0IGRpbWVuc2lvblg7CmxldCBkaW1lbnNpb25ZOwpsZXQgZGltTW9kOwoKLy9oYW5kbGUgZGltZW5zaW9uIGlkZW50aWZpY2F0aW9uCmlmIChsaW5rcy5tYW5pZmVzdGF0aW9uKQp7CiAgICBpZiAobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCkKICAgIHsKICAgICAgICBjb25zdCBhYkJvdCA9IGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3Q7CgogICAgICAgIGN1cnJlbnREaW0gPSBhYkJvdC50YWdzLmRpbWVuc2lvbjsKICAgIH0KfQplbHNlCnsKICAgIGN1cnJlbnREaW0gPSBvcy5nZXRDdXJyZW50RGltZW5zaW9uKCk7Cn0KCi8vY2hlY2tzIGZvciBncmlkIGZvY3VzCmlmICghbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1cykgCnsKICAgIGRpbWVuc2lvblggPSBudWxsOwogICAgZGltZW5zaW9uWSA9IG51bGw7Cn0KZWxzZQp7CiAgICBsZXQgaGF0Y2hQb2ludCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXM7CgogICAgY3VycmVudERpbSA9IGhhdGNoUG9pbnQuZGltZW5zaW9uOwogICAgZGltZW5zaW9uWCA9IGhhdGNoUG9pbnQucG9zaXRpb24ueDsKICAgIGRpbWVuc2lvblkgPSBoYXRjaFBvaW50LnBvc2l0aW9uLnk7CiAgICBzcGFjZU1vZCA9IHtzcGFjZTogInNoYXJlZCJ9Owp9CgovL3RoaXMgbG9naWMgaGFuZGxlcyBsb2dpYyBhcm91bmQgYXV0b0hhdGNoIHZzIG1hbnVhbCBoYXRjaGluZwppZiAoIWF1dG9IYXRjaCAmJiBjb25maWdCb3QudGFncy5wYXR0ZXJuID09IG51bGwpCnsKICAgIGRpbU1vZCA9IHtbY3VycmVudERpbV06IHRydWUsIFtjdXJyZW50RGltKyJYIl06IGRpbWVuc2lvblgsIFtjdXJyZW50RGltKyJZIl06IGRpbWVuc2lvblksIGRpbWVuc2lvbjogY3VycmVudERpbX07Cn0KZWxzZQp7CiAgICBpZiAoY29uZmlnQm90LnRhZ3Mua2V5ICYmICF0aGF0LmtleSkKICAgIHsKICAgICAgICBrZXkgPSBjb25maWdCb3QudGFncy5rZXkKICAgIH0KCiAgICBkaW1Nb2QgPSB7YXV0b0hhdGNoOiB0cnVlLCBrZXk6IGtleX07Cn0KCi8vY2FsbCBmb3Igb3ZvIHdpdGggaW5mb3JtYXRpb24gcHJvdmlkZWQKdGhpc0JvdC5tYW5pZmVzdE92byh7YWJJRDogYWJJRCwgZGltTW9kOiBkaW1Nb2QsIHNwYWNlTW9kOiBzcGFjZU1vZCwgZWdnRGF0YTogbmV3RWdnLCBpbml0aWFsQm9vdDogaW5pdGlhbEJvb3R9KTsKCmlmIChwcm9ncmVzc0J1dHRvbikKewogICAgZGVzdHJveShwcm9ncmVzc0J1dHRvbik7Cn0KCnJldHVybiB7c3VjY2VzczogdHJ1ZX07JwD0pdqXDYzeAQttYW5pZmVzdE92bwIEAPSl2pcNlIQC5wpALy9lZ2cgdmlzdWFsaXphdGlvbgpzaG91dCgiYWJNZW51UmVzZXQiKTsKCmlmIChsaW5rcy5tYW5pZmVzdGF0aW9uKQp7CiAgICBpZiAobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCkKICAgIHsKICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgfQp9CgppZiAobGlua3Mub3ZvQm90KQp7CiAgICBkZXN0cm95KGxpbmtzLm92b0JvdCk7Cn0KCmxldCBzcGFjZU1vZCA9IHRoYXQuc3BhY2VNb2Q7CmxldCBkaW1Nb2QgPSB0aGF0LmRpbU1vZDsKbGV0IGVnZ0RhdGEgPSB0aGF0LmVnZ0RhdGE7CmxldCBlZ2dNb2QgPSB7fTsKCmVnZ01vZC5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwplZ2dNb2QuaW5pdGlhbFRpbWVyID0gdHJ1ZTsKZWdnTW9kLmFiSUQgPSB0aGF0LmFiSUQ7CmVnZ01vZC5pbml0aWFsQm9vdCA9IHRoYXQuaW5pdGlhbEJvb3Q7CmVnZ01vZC5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKZWdnTW9kLm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLmludGVyYWN0T3ZvKCk7YDsKZWdnTW9kLm9uQ3JlYXRlID0gYEAgaWYgKHRhZ3MuYXV0b0hhdGNoKQp7CiAgICBsaW5rcy5tYW5hZ2VyLmhhdGNoT3ZvKHRoaXNCb3QpOwp9CmVsc2UKewogICAgdGFncy5wcm9ncmVzc0JhciA9IDA7IAoKICAgIHNldFRpbWVvdXQoKCkgPT4ge3doaXNwZXIodGhpc0JvdCwgImVnZ1RpbWVyIik7fSwgNzUpOwp9YDsKZWdnTW9kLmZvcm0gPSAiZWdnIjsKZWdnTW9kLnByb2dyZXNzQmFyQ29sb3IgPSAiI0JGNUU2NiI7CmVnZ01vZC5wcm9ncmVzc0JhckJhY2tncm91bmRDb2xvciA9ICIjNTkyOTg5IjsKZWdnTW9kLmxhYmVsU2l6ZSA9IDAuNTsKZWdnTW9kLmxhYmVsQ29sb3IgPSAiIzQwNDA0MCI7CmVnZ01vZC5vblBvaW50ZXJFbnRlciA9ICJAIG9zLnRvYXN0KHRhZ3MuYWJJRCArICcgdicrdGFncy50YXJnZXRWZXJzaW9uKTsiOwplZ2dNb2QubGFiZWxQb3NpdGlvbiA9ICJmcm9udCI7CmVnZ01vZC5vcmllbnRhdGlvbk1vZGUgPSAiYmlsbGJvYXJkRnJvbnQiOwplZ2dNb2Qub25EZXN0cm95ID0gYEAgbGlua3MubWFuYWdlci5tYXNrcy5vdm9Cb3QgPSBudWxsO2A7CmVnZ01vZC5lZ2dUaW1lciA9IGBAIGlmICh0YWdzLnByb2dyZXNzQmFyIDwgMSkgCnsKICAgIHRhZ3MucHJvZ3Jlc3NCYXIgKz0gMC4xOwoKICAgIHNldFRpbWVvdXQoKCkgPT4ge3doaXNwZXIodGhpc0JvdCwgImVnZ1RpbWVyIik7fSwgNzUpOwp9CmVsc2UKewogICAgdGhpc0JvdC5vbkNsaWNrKCk7CiAgICAKICAgIHRhZ3MucHJvZ3Jlc3NCYXIgPSBudWxsOwp9YDsKCmxldCBvdm8gPSBjcmVhdGUoZWdnRGF0YSwgZWdnTW9kLCBkaW1Nb2QsIHNwYWNlTW9kKTsKCm1hc2tzLm92b0JvdCA9ICLwn5SXIiArIG92by5pZDsnAPSl2pcNjN4BCW9uS2V5RG93bgIEAPSl2pcN+I4C2gVALy9oaWRkZW4gdmVyc2lvbiBidXR0b24gZm9yIGhhdGNoIG1lbnUKaWYgKCFsaW5rcy5vdm9Cb3QgfHwgY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCAhPSAib3ZvIikKewogICAgcmV0dXJuOwp9CgppZiAodGhhdC5rZXlzID09ICJTaGlmdCIpCnsKICAgIGxldCB2ZXJzaW9uQnV0dG9uID0ge307CgogICAgdmVyc2lvbkJ1dHRvbi5vdm8gPSB0cnVlOwogICAgdmVyc2lvbkJ1dHRvbi5vdm9Tb3J0T3JkZXIgPSAtMTsKICAgIHZlcnNpb25CdXR0b24ubWF4VmVyc2lvbiA9IGxpbmtzLm92b0JvdC50YWdzLm1heFZlcnNpb247CiAgICB2ZXJzaW9uQnV0dG9uLm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwogICAgdmVyc2lvbkJ1dHRvbi5sYWJlbCA9ICJjaGFuZ2UgZWdnIHZlcnNpb24iOwogICAgdmVyc2lvbkJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJjZW50ZXIiOwogICAgdmVyc2lvbkJ1dHRvbi5vdm9NZW51UmVzZXQgPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CiAgICB2ZXJzaW9uQnV0dG9uLmNvbG9yID0gIiNGRkZGRkYiOwogICAgdmVyc2lvbkJ1dHRvbi5vbktleVVwID0gIkAgaWYodGhhdC5rZXlzID09ICdTaGlmdCcpe2Rlc3Ryb3kodGhpc0JvdCl9OyI7CiAgICB2ZXJzaW9uQnV0dG9uLm9uQ2xpY2sgPSAiQCBsaW5rcy5tYW5hZ2VyLmNoYW5nZU92b1ZlcnNpb24oKTsiOwoKICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHZlcnNpb25CdXR0b24pOwp9JwD0pdqXDYzeAQhoYXRjaE92bwIEAPSl2pcN0ZQCvAtALy9sb2dpYyBmb3IgaGF0Y2hpbmcgb2YgYW4gYWIKc2hvdXQoJ292b01lbnVSZXNldCcpOwoKLy9kYXRhIGluIHJlZ2FyZHMgdG8gd2hhdCBhYiBpcyBnb2luZyB0byBiZSBoYXRjaGVkCmNvbnN0IG92byA9IHRoYXQ7CgovL2hhdGNoIHNwZWNpZmljIHZhcmlhYmxlcwpsZXQgaW5pdGlhbEJvb3QgPSBvdm8udGFncy5pbml0aWFsQm9vdDsKbGV0IHRhcmdldFZlcnNpb24gPSBvdm8udGFncy50YXJnZXRWZXJzaW9uOwoKaWYgKGNvbmZpZ0JvdC50YWdzLmFiVmVyc2lvbiB8fCBjb25maWdCb3QudGFncy5wYXR0ZXJuVmVyc2lvbikKewogICAgaWYgKGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4gPT0gb3ZvLnRhZ3MuYWJJRCkKICAgIHsKICAgICAgICB0YXJnZXRWZXJzaW9uID0gY29uZmlnQm90LnRhZ3MuYWJWZXJzaW9uID8/IGNvbmZpZ0JvdC50YWdzLnBhdHRlcm5WZXJzaW9uOwogICAgfQp9CgpsZXQgdmVyc2lvbkFycmF5ID0gb3ZvLnRhZ3MuZWdnVmVyc2lvbkhpc3Rvcnk7CmxldCBmaWxlVVJMID0gdmVyc2lvbkFycmF5W3RhcmdldFZlcnNpb24gLSAxXTsKbGV0IGtleSA9IG92by50YWdzLmtleSA/IG92by50YWdzLmtleSA6IGNvbmZpZ0JvdC50YWdzLmtleTsKbGV0IGZpbGVHZXQ7CgovL2FjdHVhbCBmaWxlIHJldHJpZXZhbAp0cnkKewogICAgZmlsZUdldCA9IGF3YWl0IG9zLmdldEZpbGUoZmlsZVVSTCk7Cn0KY2F0Y2ggKGVycm9yKQp7CiAgICBjb25zb2xlLmxvZyhlcnJvcik7CgogICAgb3MudG9hc3QoIm5vIGZpbGUgZm91bmQiKTsKCiAgICByZXR1cm47Cn0KCi8vaGFuZGxpbmcgZm9yIGVuY3J5cHRlZCBhYiBmaWxlCmlmIChjcnlwdG8uaXNFbmNyeXB0ZWQoZmlsZUdldCkpCnsKICAgIGlmICgha2V5KQogICAgewogICAgICAgIGtleSA9IGF3YWl0IG9zLnNob3dJbnB1dCgnJywgewogICAgICAgICAgICB0eXBlOiAnc2VjcmV0JywKICAgICAgICAgICAgdGl0bGU6ICdFbnRlciBrZXknCiAgICAgICAgfSk7CiAgICB9CgogICAgdHJ5CiAgICB7CiAgICAgICAgZmlsZUdldCA9IGNyeXB0by5kZWNyeXB0KGtleSwgZmlsZUdldCk7CiAgICB9CiAgICBjYXRjaCAoZXJyb3IpCiAgICB7CiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpCgogICAgICAgIG9zLnRvYXN0KCJrZXkgZG9lcyBub3QgbWF0Y2ggZmlsZSIpOwoKICAgICAgICByZXR1cm47CiAgICB9CiAgIAogICAgZmlsZUdldCA9IEpTT04ucGFyc2UoZmlsZUdldCk7CgogICAgZmlsZUdldCA9IGZpbGVHZXQuc3RhdGU7Cn0KZWxzZQp7CiAgICBmaWxlR2V0ID0gZmlsZUdldC5zdGF0ZTsKfQoKLy9jbGVhbiB1cApkZXN0cm95KG92byk7CgovL2dlbmVyYXRlIGJvdHMgYmFzZWQgb24gdGhlIGZpbGUgcmV0cmlldmVkCmxpbmtzLmNyZWF0ZS5hYkNyZWF0ZUJvdHMoe2JvdHM6IGZpbGVHZXQsIG9yaWdpbjogb3ZvLnRhZ3MuYWJJRCwgdmVyc2lvbjogdGFyZ2V0VmVyc2lvbiwgaW5pdGlhbEJvb3Q6IGluaXRpYWxCb290fSk7JwD0pdqXDYzeAQtpbnRlcmFjdE92bwIEAPSl2pcNjqACjgdALy9tYW51YWwgaGF0Y2ggbWVudQpjb25zdCBvdm9Cb3QgPSB0aGF0ID8gdGhhdCA6IGxpbmtzLm92b0JvdDsKCmlmICghb3ZvQm90KQp7CiAgICByZXR1cm47Cn0KCnNob3V0KCJvdm9NZW51UmVzZXQiKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gIm92byI7CgptYXNrcy5vbkdyaWRDbGljayA9IGBAIHNob3V0KCJvdm9NZW51UmVzZXQiKTtgOwptYXNrcy5vdm9NZW51UmVzZXQgPSBgQCBtYXNrcy5vbkdyaWRDbGljayA9IG51bGw7Cm1hc2tzLm92b01lbnVSZXNldCA9IG51bGw7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7CmA7CgpsZXQgZWdnTWVudUJ1dHRvbiA9IHt9OwoKb3MudHdlZW5Ubyhvdm9Cb3QsIDE1LDQ1LDQ1LCA1KTsKCmVnZ01lbnVCdXR0b24ub3ZvID0gdHJ1ZTsKZWdnTWVudUJ1dHRvbi5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKZWdnTWVudUJ1dHRvbi5vdm9Cb3QgPSAi8J+UlyIgKyBvdm9Cb3QuaWQ7CmVnZ01lbnVCdXR0b24udGFyZ2V0VmVyc2lvbiA9IG92b0JvdC50YWdzLnRhcmdldFZlcnNpb247CmVnZ01lbnVCdXR0b24ubGFiZWwgPSAiaGF0Y2ggIiArIG92b0JvdC50YWdzLmFiSUQgKyAiIHYiICsgb3ZvQm90LnRhZ3MudGFyZ2V0VmVyc2lvbiArICIgb2YgIiArIG92b0JvdC50YWdzLm1heFZlcnNpb247CmVnZ01lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAiY2VudGVyIjsKZWdnTWVudUJ1dHRvbi5vdm9NZW51UmVzZXQgPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CmVnZ01lbnVCdXR0b24uY29sb3IgPSAiI0ZGRkZGRiI7CmVnZ01lbnVCdXR0b24ub25DbGljayA9ICJAIGxpbmtzLm1hbmFnZXIuaGF0Y2hPdm8obGlua3Mub3ZvQm90KTsiOwoKbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oZWdnTWVudUJ1dHRvbik7JwD0pdqXDYzeAQZjcmVhdGUCBAD0pdqXDZmnAijwn5SXMzRjM2MyMTAtNWJmMS00OWNmLWIxNTEtZWUyZDA3ZjBlNjczJwD0pdqXDYzeARBjaGFuZ2VPdm9WZXJzaW9uAgQA9KXalw3ApwLKAkAvL2xvZ2ljIGZvciB2ZXJzaW9uIGNoYW5naW5nIHdoZW4gbWFudWFsbHkgaGF0Y2hpbmcgYW4gYWIKY29uc3Qgb3ZvQm90ID0gbGlua3Mub3ZvQm90OwoKbGV0IG5ld1ZlcnNpb24gPSBhd2FpdCBvcy5zaG93SW5wdXQob3ZvQm90LnRhZ3MudGFyZ2V0VmVyc2lvbiwgewogICAgcGxhY2Vob2xkZXI6ICJlbnRlciBhIHZlcnNpb24gZnJvbSAxIHRvICIgKyBvdm9Cb3QudGFncy5tYXhWZXJzaW9uCn0pOwoKb3ZvQm90LnRhZ3MudGFyZ2V0VmVyc2lvbiA9IG5ld1ZlcnNpb247Cm92b0JvdC50YWdzLmxhYmVsID0gJ3YnKyBuZXdWZXJzaW9uOwoKc2hvdXQoIm92b01lbnVSZXNldCIpOycA9KXalw2M3gEEbWVudQIEAPSl2pcNi6oCKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAPSl2pcNjN4BCGFiSWdub3JlAgQA9KXalw2yqgIEdHJ1ZSgA9KXalw2M3gEMYWJCb3RWZXJzaW9uAX2OAicA9KXalw2M3gEHYWJTaGVsbAIEAPSl2pcNuKoCBHRydWUnAPSl2pcNjN4BDGFiMUxUTVNlYXJjaAIEAPSl2pcNvaoCM0AvL3N1cHBvcnQgb2xkIHN5bnRheAp0aGlzQm90Lm9uTG9va3VwQUJFZ2dzKHRoYXQpOycA9KXalw2M3gENb25Mb29rdXBBc2tJRAIEAPSl2pcN8aoC7QRAbGV0IHByb2dyZXNzQnV0dG9uID0gYXdhaXQgbGlua3MuaW5wdXQuYWJQcm9ncmVzc0JhcihgbG9va2luZyB1cCAke3RoYXQuYXNrSUR9YCk7Cgpjb25zdCBhc2tJRCA9ICJhc2tfIiArIHRoYXQuYXNrSUQ7CmNvbnN0IGVuZHBvaW50ID0gbGlua3MucmVtZW1iZXIudGFncy5hYkVuZHBvaW50OwpsZXQgbG9va3VwQXNrOyAKCnRyeQp7CiAgICBsb29rdXBBc2sgPSBhd2FpdCBvcy5nZXREYXRhKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSZWNvcmRLZXksIGFza0lELCBlbmRwb2ludCk7Cn0KY2F0Y2gKewogICAgbG9va3VwQXNrID0gYXdhaXQgb3MuZ2V0RGF0YShsaW5rcy5yZW1lbWJlci50YWdzLmFiUmVjb3JkS2V5LCB0aGF0LmFza0lELCBlbmRwb2ludCk7Cn0KCmlmIChsb29rdXBBc2suc3VjY2VzcyAmJiBsb29rdXBBc2suZGF0YS5wYXR0ZXJuSUQpCnsKICAgIHRoaXNCb3Qub25Mb29rdXBBQkVnZ3Moe2FiSUQ6IGxvb2t1cEFzay5kYXRhLnBhdHRlcm5JRCwgcmVjb3JkS2V5OiBsb29rdXBBc2suZGF0YS5zdHVkaW9JRCwgYXV0b0hhdGNoOiB0cnVlfSk7ICAKfQoKaWYgKHByb2dyZXNzQnV0dG9uKQp7CiAgICBkZXN0cm95KHByb2dyZXNzQnV0dG9uKTsKfQoKcmV0dXJuIGxvb2t1cEFzazsnAPSl2pcNjN4BBWlucHV0AgQA9KXalw3frwIo8J+Ul2Y4NjAyODc4LWMyZWYtNDhiZC04NWEwLThkNjM1MWViNDEyMCcBBGJvdHMkZjg2MDI4NzgtYzJlZi00OGJkLTg1YTAtOGQ2MzUxZWI0MTIwAScA9KXalw2GsAIGc3lzdGVtAgQA9KXalw2HsAIOYWIuc2hlbGwuaW5wdXQnAPSl2pcNhrACBGZvcm0CBAD0pdqXDZawAgdub3RoaW5nJwD0pdqXDYawAglvbktleURvd24CBAD0pdqXDZ6wAm1ALy9hbGxvdyBwdWxsaW5nIHVwIGNoYXQgaW4gYnVpbGRlciB2ZXJzaW9uCmlmICh0aGF0LmtleXMgPT0gImAiICYmIGJ1aWxkZXJWZXJzaW9uKQp7CiAgICBvcy5zaG93Q2hhdCgiPiIpOwp9JwD0pdqXDYawAgZvbkNoYXQCBAD0pdqXDYyxAoMgQC8vbm90IHN1cHBvcnRlZCBvdXRzaWRlIG9mIGJ1aWxkZXIgdmVyc2lvbgppZiAoIWJ1aWxkZXJWZXJzaW9uKQp7CiAgICByZXR1cm47Cn0KCi8vdGhpcyBsb29wIGlkZW50aWZpZXMgcG9zc2libGUgYWIgc3BlY2lmaWMgbWVzc2FnZXMsIGFuZCBjYWxscyBhIHNldCBsaXN0IG9mIGNvbW1hbmRzCmlmICh0aGF0Lm1lc3NhZ2VbMF0gPT0gIi4iKSAKewogICAgb3MuaGlkZUNoYXQoKTsKCiAgICBzd2l0Y2ggKHRoYXQubWVzc2FnZSkKICAgIHsKICAgICAgICBjYXNlICcuZG93bmxvYWRBQic6CiAgICAgICAgICAgIGNoYW5nZVN0YXRlKGxpbmtzLm1hbmlmZXN0YXRpb24sICJBc2xlZXAiLCAiYWJNYW5pZmVzdFN0YXRlIik7CgogICAgICAgICAgICBjb25zdCBncm91cCA9IGF3YWl0IG9zLnNob3dJbnB1dCgiZ3JvdXAiKTsKCiAgICAgICAgICAgIGlmIChncm91cCA9PSAiYWJDb25maWciKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmFiQ29yZUl0ZXJhdGlvbisrOwogICAgICAgICAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5pbml0aWFsQm9vdCA9IHRydWU7CiAgICAgICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmNvcmVBQiA9IG51bGw7CiAgICAgICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRCA9IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IGFiR3JvdXAgPSBnZXRCb3RzKGdyb3VwKTsKCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWJHcm91cC5sZW5ndGg7IGkrKykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgYWJHcm91cFtpXS50YWdzLmFiQm90VmVyc2lvbisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBvcy5kb3dubG9hZEJvdHNBc0luaXRpYWx6YXRpb25VcGRhdGUoYWJHcm91cCwgZ3JvdXApOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAubG9hZFNraWxsYDoKICAgICAgICAgICAgbGV0IHNraWxsID0gYXdhaXQgb3Muc2hvd0lucHV0KCJza2lsbCIpOwoKICAgICAgICAgICAgbGlua3MubGVhcm4uYWJBZGFwdChza2lsbCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC5zeXN0ZW1gOgogICAgICAgICAgICBjb25maWdCb3QudGFncy5zeXN0ZW1Qb3J0YWwgPSB0cnVlOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLnNoZWV0YDoKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3Muc2hlZXRQb3J0YWwgPSAhY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA6IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbDsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC5tZW51U2hlZXRgOgogICAgICAgICAgICBjb25maWdCb3QudGFncy5zaGVldFBvcnRhbCA9IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWw7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAuZG93bmxvYWRgOgogICAgICAgICAgICBvcy5kb3dubG9hZEJvdHMoZ2V0Qm90cyhieU1vZCh7c3BhY2U6ICJzaGFyZWQiLCBhYklnbm9yZTogbnVsbH0pKSwgY29uZmlnQm90LnRhZ3MuaW5zdCk7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAudXBsb2FkYDoKICAgICAgICAgICAgb3Muc2hvd1VwbG9hZEF1eEZpbGUoKTsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC5zbGVlcGA6CiAgICAgICAgICAgIGNoYW5nZVN0YXRlKGxpbmtzLm1hbmlmZXN0YXRpb24sICJBc2xlZXAiLCAiYWJNYW5pZmVzdFN0YXRlIik7CgogICAgICAgICAgICBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7CiAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWwgPSBudWxsOwogICAgICAgICAgICBjb25maWdCb3QubWFza3MudGFnUG9ydGFsU3BhY2UgPSBudWxsOwoKICAgICAgICAgICAgdGFnUG9ydGFsQm90Lm1hc2tzLnRhZ1BvcnRhbEFuY2hvclBvaW50ID0gbnVsbDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLi5gOgogICAgICAgIGNhc2UgYC53YWtlYDoKCiAgICAgICAgICAgIGxldCBza2lsbEFycmF5ID0gWyJhYkludGVyZmFjZSIsICJhYkFjdGlvbiIsICJhYlRlc3RzIl07CgogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNraWxsQXJyYXkubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGF3YWl0IGxpbmtzLmxlYXJuLmFiQWRhcHQoc2tpbGxBcnJheVtpXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGF3YWl0IG9zLnNsZWVwKDMwMCk7CgogICAgICAgICAgICAvL2tlZXAgYWIgYXdha2UKICAgICAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5hYkF3YWtlU3RhdGUgPSB0cnVlOwoKICAgICAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4pCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCID0gY29uZmlnQm90LnRhZ3MucGF0dGVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCID0gdXVpZCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjaGFuZ2VTdGF0ZShsaW5rcy5tYW5pZmVzdGF0aW9uLCAiQXdha2UiLCAiYWJNYW5pZmVzdFN0YXRlIik7CiAgICAgICAgICAgIAogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICcubG9nJzoKICAgICAgICAgICAgaWYgKGNvbmZpZ0JvdC50YWdzLnRhZ1BvcnRhbCA9PSBhYi5pZCArICIuYXNrTG9nIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbCA9IG51bGw7CiAgICAgICAgICAgICAgICBjb25maWdCb3QubWFza3MudGFnUG9ydGFsU3BhY2UgPSBudWxsOwoKICAgICAgICAgICAgICAgIHRhZ1BvcnRhbEJvdC5tYXNrcy50YWdQb3J0YWxBbmNob3JQb2ludCA9IG51bGw7CgogICAgICAgICAgICAgICAgb3MuaGlkZUNoYXQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWwgPSBhYi5pZCArICIuYXNrTG9nIjsKICAgICAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWxTcGFjZSA9ICJ0ZW1wTG9jYWwiOwoKICAgICAgICAgICAgICAgIGlmIChncmlkUG9ydGFsQm90LnRhZ3MucGl4ZWxXaWR0aCA+IGdyaWRQb3J0YWxCb3QudGFncy5waXhlbEhlaWdodCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICB0YWdQb3J0YWxCb3QubWFza3MudGFnUG9ydGFsQW5jaG9yUG9pbnQgPSAibGVmdCI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdGFnUG9ydGFsQm90Lm1hc2tzLnRhZ1BvcnRhbEFuY2hvclBvaW50ID0gInRvcCI7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy9vcy5zaG93Q2hhdCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJy5oaWRlTG9nJzoKICAgICAgICAgICAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbCA9IG51bGw7CiAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWxTcGFjZSA9IG51bGw7CgogICAgICAgICAgICB0YWdQb3J0YWxCb3QubWFza3MudGFnUG9ydGFsQW5jaG9yUG9pbnQgPSBudWxsOwoKICAgICAgICAgICAgb3MuaGlkZUNoYXQoKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSB0aGF0Lm1lc3NhZ2U7CiAgICAgICAgICAgIGxldCBleGVjdXRhYmxlID0gbWVzc2FnZS5zbGljZSgxKTsKCiAgICAgICAgICAgIHRyeQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBvcy5ydW4oZXhlY3V0YWJsZSk7ICAKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoZSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICAgIH0KICAgIH0KfScA9KXalw2GsAILZGVzY3JpcHRpb24CBAD0pdqXDZDRAkJUaGlzIGlzIG1lYW50IHRvIGhhbmRsZSBhbnkgbm9uZSBtZW51IHJlbGF0ZWQgaW5wdXRzL2ludGVyYWN0aW9ucy4nAPSl2pcNhrACDG9uRmlsZVVwbG9hZAIEAPSl2pcN09EC5xJALy9maWx0ZXIgb3V0IHRpbWVzIHdoZW4gZmlsZSBsb2FkaW5nIGlzIG5vdCBhbGxvd2VkCmlmICghYnVpbGRlclZlcnNpb24gfHwgbGlua3MucmVtZW1iZXIudGFncy5hYkxpc3RlbmluZ0ZvckZpbGVVcGxvYWRzICE9PSB0cnVlKQp7CiAgICByZXR1cm47Cn0KCi8vdmFyaW91cyBmaWxlIHNwZWNpZmljIHZhcmlhYmxlcwpsZXQgZmlsZUV4dGVuc2lvbiA9IHRoYXQuZmlsZS5uYW1lLnNwbGl0KCcuJykucG9wKCk7CmxldCBmaWxlTmFtZSA9IHRoYXQuZmlsZS5uYW1lLnNwbGl0KCcuJykuc2hpZnQoKTsKbGV0IHNpemUgPSB0aGF0LmZpbGUuc2l6ZTsKbGV0IG1pbWVUeXBlOwpsZXQgYm90SW5mbyA9IHt9OwoKLy9oYXJkIGxpbWl0IGJhc2VkIG9uIGZpbGUgc2l6ZQppZiAoc2l6ZSA+IDIwMDAwMDAwMCkKewogIG9zLnRvYXN0KCJtYXhpbXVtIGZpbGUgc2l6ZSBleGNlZWRlZCAoMjAwIG1iKSIpOwoKICByZXR1cm47Cn0KCi8vdGhpcyBzd2l0Y2ggaGFuZGxlcyBwb3NzaWJsZSBmaWxlcyBleHRlbnNpb25zLCB3aGlsZSByZWplY3RpbmcgYW55IGl0IGRvZXMgbm90IHJlY29nbml6ZQpzd2l0Y2goZmlsZUV4dGVuc2lvbikKewogIGNhc2UgJ2pwZyc6CiAgY2FzZSAnanBlZyc6CiAgY2FzZSAnd2VicCc6CiAgY2FzZSAnZ2lmJzoKICBjYXNlICdwbmcnOgogICAgbWltZVR5cGUgPSAiaW1hZ2UvIiArIGZpbGVFeHRlbnNpb247CiAgICBib3RJbmZvLmZvcm0gPSAic3ByaXRlIjsKICAgIGJyZWFrOwogIGNhc2UgJ3N2Zyc6CiAgICBtaW1lVHlwZSA9ICJpbWFnZS9zdmcreG1sIjsKICAgIGJvdEluZm8uZm9ybSA9ICJzcHJpdGUiOwogICAgYnJlYWs7CiAgY2FzZSAnZ2xiJzoKICBjYXNlICdnbHRmJzoKICAgIG1pbWVUeXBlID0gInRleHQveG1sIjsKICAgIGJvdEluZm8uZm9ybSA9ICJtZXNoIjsKICAgIGJvdEluZm8uZm9ybVN1YnR5cGUgPSAiZ2x0ZiI7CiAgICBicmVhazsKICBjYXNlICdhdXgnOgogIGNhc2UgJ3BkZic6CiAgICBsZXQgYm90RGF0YSA9IGZpbGVFeHRlbnNpb24gPT0gIi5hdXgiID8gSlNPTi5wYXJzZSh0aGF0LmZpbGUuZGF0YSkuc3RhdGUgOiBvcy5wYXJzZUJvdHNGcm9tRGF0YSh0aGF0LmZpbGUuZGF0YSk7CgogICAgbGlua3MuY3JlYXRlLmFiQ3JlYXRlQm90cyh7Ym90czogYm90RGF0YSwgb3JpZ2luOiBmaWxlTmFtZX0pOwoKICAgIHJldHVybjsKLy8gICBjYXNlICdwZGYnOgovLyAgICAgYnJlYWs7CiAgY2FzZSAnbXAzJzoKICAgIG1pbWVUeXBlID0gJ2F1ZGlvL21wZWcnOwogICAgYm90SW5mby5vbkNsaWNrID0gIkAgb3MucGxheVNvdW5kKHRhZ3MuZm9ybUFkZHJlc3MpOyI7CiAgICBib3RJbmZvLmxhYmVsID0gIkNsaWNrIHRvIFBsYXkiOwogICAgYnJlYWs7CiAgY2FzZSAnbXA0JzoKICAgIG1pbWVUeXBlID0gJ3ZpZGVvL21wNCc7CiAgICBib3RJbmZvLmZvcm0gPSAiaWZyYW1lIjsKICAgIGJvdEluZm8uZm9ybVN1YnR5cGUgPSAic3JjIjsKICAgIGJyZWFrOwogIGRlZmF1bHQ6CiAgICBsZXQgcmVzdWx0ID0gbmV3IEVycm9yKCJ1bmhhbmRsZWQgZmlsZSB0eXBlOiAiICsgZmlsZUV4dGVuc2lvbik7CiAgICBvcy50b2FzdCgiZmlsZSB0eXBlIG5vdCBzdXBwb3J0ZWQiKTsKICAgIGNvbnNvbGUud2FybihyZXN1bHQpCiAgICByZXR1cm4gcmVzdWx0Owp9CgovL3RoZSBmb2xsb3dpbmcgdmFyaWFibGVzIGFuZCBvYmplY3RzIHNldCB1cCBhIGxvYWRpbmcgYmFyIGJ1dHRvbgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGV0IHVwbG9hZFJlc3VsdDsKbGV0IHByb2dyZXNzQnV0dG9uID0gYXdhaXQgdGhpc0JvdC5hYlByb2dyZXNzQmFyKGB1cGxvYWRpbmdgKTsKCi8vdGhpcyBpcyB0aGUgYWN0dWFsIHVwbG9hZCBmdW5jdGlvbmFsaXR5CnVwbG9hZFJlc3VsdCA9IGF3YWl0IGxpbmtzLnN0b3JlLmFiUHVibGlzaEZpbGUoe2ZpbGU6IHRoYXQuZmlsZS5kYXRhLCBmaWxlTmFtZTogZmlsZU5hbWUsIG1pbWVUeXBlOiBtaW1lVHlwZX0pOwoKLy9pZiB0aGUgZmlsZSBzaG91bGQgYmUgaW5jbHVkZWQgYXMgYSBib3Qgd2l0aCBhIGxpbmssIHRoaXMgbG9naWMgaGFuZGxlcyB0aGF0CmlmIChPYmplY3Qua2V5cyhib3RJbmZvKS5sZW5ndGggPiAwKQp7CiAgICBib3RJbmZvW2NvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWxdID0gdHJ1ZTsKICAgIGJvdEluZm8uZm9ybUFkZHJlc3MgPSB1cGxvYWRSZXN1bHQudXJsID8gdXBsb2FkUmVzdWx0LnVybCA6IHVwbG9hZFJlc3VsdC5leGlzdGluZ0ZpbGVVcmw7CgogICAgY3JlYXRlKGJvdEluZm8pOwp9CgovL2NsZWFyIHRoZSBwcm9ncmVzcyBiYXIgYnV0dG9uCi8vY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOwoKaWYgKHByb2dyZXNzQnV0dG9uKQp7CiAgZGVzdHJveShwcm9ncmVzc0J1dHRvbik7Cn0KCnJldHVybiB1cGxvYWRSZXN1bHQ7JwD0pdqXDYawAgVsZWFybgIEAPSl2pcNu+QCKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAPSl2pcNhrACCHJlbWVtYmVyAgQA9KXalw3i5AIo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycA9KXalw2GsAINbWFuaWZlc3RhdGlvbgIEAPSl2pcNieUCKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAPSl2pcNhrACCGFiSWdub3JlAgQA9KXalw2w5QIEdHJ1ZSgA9KXalw2GsAIMYWJCb3RWZXJzaW9uAX2OAicA9KXalw2GsAIGY3JlYXRlAgQA9KXalw225QIo8J+UlzM0YzNjMjEwLTViZjEtNDljZi1iMTUxLWVlMmQwN2YwZTY3MycA9KXalw2GsAIFc3RvcmUCBAD0pdqXDd3lAijwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwD0pdqXDYawAgRtZW51AgQA9KXalw2E5gIo8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicA9KXalw2GsAIHYWJTaGVsbAIEAPSl2pcNq+YCBHRydWUnAPSl2pcNhrACDWFiUHJvZ3Jlc3NCYXICBAD0pdqXDbDmAtcIQGlmICghY29uZmlnQm90LnRhZ3MuYWJTaWxlbnQpCnsKICAgIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7Cn0KCmxldCBsb2FkTGFiZWwgPSB0aGF0ID8/ICJ1cGRhdGluZyI7CmxldCBtZW51QnV0dG9uID0ge307CgptZW51QnV0dG9uLnNwYWNlID0gInRlbXBMb2NhbCI7Cm1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0geyAiYm9yZGVyLXJhZGl1cyI6IjhweCIsICJtYXJnaW4tdG9wIjoiM3B4In07Cm1lbnVCdXR0b24udHJhY2tOdW0gPSAtMTsKbWVudUJ1dHRvbi5vbkNyZWF0ZSA9IGBACiAgICBpZiAodGFncy50cmFja051bSA9PSAyKQogICAgewogICAgICAgIHRhZ3MudHJhY2tOdW0gPSAwOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHRhZ3MudHJhY2tOdW0rKzsKICAgIH0KCiAgICB0YWdzLmxhYmVsID0gdGFnc1sibGFiZWwiK3RhZ3MudHJhY2tOdW1dOwogICAgdGFncy5mb3JtQWRkcmVzcyA9IHRhZ3NbImZvcm0iK3RhZ3MudHJhY2tOdW1dOwoKICAgIHNldFRpbWVvdXQoKCkgPT4gd2hpc3Blcih0aGlzQm90LCAib25DcmVhdGUiKSwgNTAwKTtgOwptZW51QnV0dG9uLmxhYmVsMCA9IGxvYWRMYWJlbCArICIuIjsKbWVudUJ1dHRvbi5sYWJlbDEgPSBsb2FkTGFiZWwgKyAiLi4iOwptZW51QnV0dG9uLmxhYmVsMiA9IGxvYWRMYWJlbCArICIuLi4iOwptZW51QnV0dG9uLmZvcm0wID0gImhvdXJnbGFzc19ib3R0b20iOwptZW51QnV0dG9uLmZvcm0xID0gImhvdXJnbGFzc190b3AiOwptZW51QnV0dG9uLmZvcm0yID0gImhvdXJnbGFzc19ib3R0b20iOwptZW51QnV0dG9uLmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VDb2xvcjsKbWVudUJ1dHRvbi5sYWJlbENvbG9yID0gImJsYWNrIjsKbWVudUJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJjZW50ZXIiOwptZW51QnV0dG9uLmFiUHJvZ3Jlc3NSZXNldCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKLy9tZW51QnV0dG9uLm9uRGVzdHJveSA9ICJAIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsiOwoKbWVudUJ1dHRvbiA9IGNyZWF0ZShtZW51QnV0dG9uKTsKCnJldHVybiBtZW51QnV0dG9uOwA="}]}