{"version":2,"updates":[{"id":0,"timestamp":1704916461890,"update":"AZIBjvWYgAwAJwEEYm90cyQxNzQxMGQ4My03ZWVlLTRhMWUtYjYzOC02NTQ2Mzc0ZDE3YzMBJwCO9ZiADAAGc3lzdGVtAgQAjvWYgAwBEWFiLmludGVyZmFjZS5zY2FuJwCO9ZiADAAEZm9ybQIEAI71mIAMEwdub3RoaW5nJwCO9ZiADAALYWJJbnRlcmZhY2UCBACO9ZiADBsEdHJ1ZScAjvWYgAwACGFiSWdub3JlAgQAjvWYgAwgBHRydWUoAI71mIAMAAxhYkJvdFZlcnNpb24BfTsnAI71mIAMAA9vblFSQ29kZVNjYW5uZWQCBACO9ZiADCaNDUBpZiAoIWJ1aWxkZXJWZXJzaW9uKQp7CiAgICByZXR1cm47Cn0KCmFiLmxvZygiYWI6IHNjYW5uZWQgIiArIHRoYXQpOwoKaWYgKGNvbmZpZ0JvdC50YWdzLnV1YWJTY2FuKQp7CiAgICBvcy5jbG9zZVFSQ29kZVNjYW5uZXIoKTsKCiAgICBsaW5rcy5zdG9yZS5hYlB1Ymxpc2hVVUFCKHRoYXQpOwp9CmVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnB1Ymxpc2hTY2FuKQp7CiAgICBvcy5jbG9zZVFSQ29kZVNjYW5uZXIoKTsKCiAgICBsaW5rcy5zdG9yZS5hYlFSUHVibGlzaCh0aGF0KTsKfQplbHNlIGlmIChjb25maWdCb3QudGFncy5wcmFjdGljZVBlcm1pdFNjYW4pCnsKICAgIGxldCBzY2FubmVkVVJMOwoKICAgIGNvbmZpZ0JvdC50YWdzLnByYWN0aWNlUGVybWl0U2NhbiA9IG51bGw7CgogICAgb3MuY2xvc2VRUkNvZGVTY2FubmVyKCk7CgogICAgdHJ5CiAgICB7CiAgICAgICAgc2Nhbm5lZFVSTCA9IG5ldyBVUkwodGhhdCk7CiAgICB9CiAgICBjYXRjaCAoZSkKICAgIHsKICAgICAgICBvcy50b2FzdCgibm90IGEgcmVjb2duaXplZCBwcmFjdGljZSBwZXJtaXQiKTsKCiAgICAgICAgY29uc29sZS5sb2coZSk7CgogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBsZXQgcGhDaGVjayA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmhhcygicGgiKTsKICAgIGxldCBpbnN0Q2hlY2sgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5oYXMoImluc3QiKTsKICAgIGxldCBhYkNoZWNrID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuaGFzKCJhYiIpOwogICAgbGV0IGN3Q2hlY2sgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5oYXMoImN3Iik7CgogICAgaWYgKHBoQ2hlY2sgJiYgaW5zdENoZWNrICYmIGFiQ2hlY2sgJiYgY3dDaGVjaykKICAgIHsKICAgICAgICBvcy5nb1RvVVJMKHRoYXQpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIG9zLnRvYXN0KCJub3QgYSByZWNvZ25pemVkIHByYWN0aWNlIHBlcm1pdCIpOwogICAgfQoKICAgIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cn0KZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MuYWJTY2FuKQp7CiAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKICAgIGNvbmZpZ0JvdC50YWdzLmFiU2NhbiA9IG51bGw7CiAgICAKICAgIG9zLmNsb3NlUVJDb2RlU2Nhbm5lcigpOwoKICAgIGxldCBzY2FubmVkVVJMOwoKICAgIHRyeSAKICAgIHsKICAgICAgICBzY2FubmVkVVJMID0gbmV3IFVSTCh0aGF0KTsKICAgIH0KICAgIGNhdGNoIChlKSAKICAgIHsKICAgICAgICBsaW5rcy5zZWFyY2guYWJMVE1TZWFyY2goe2FiSUQ6IHRoYXR9KTsKCiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmKHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmdldCgiYWIiKSA9PSAiZWdnQ2FydG9uIikKICAgIHsKICAgICAgICBvcy5nb1RvVVJMKHRoYXQpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHsKICAgICAgICAgICAgbGV0IG5ld1RhZyA9IGtleTsKICAgICAgICAgICAgbGV0IG5ld1ZhbHVlID0gdmFsdWU7CgogICAgICAgICAgICBjb25maWdCb3QudGFnc1tuZXdUYWddID0gbmV3VmFsdWU7CiAgICAgICAgfSk7CgogICAgICAgIGxpbmtzLnNlYXJjaC5hYkxUTVNlYXJjaCh7YWJJRDogY29uZmlnQm90LnRhZ3MuYWJ9KTsKICAgIH0KfScAjvWYgAwABXN0b3JlAgQAjvWYgAy0DSjwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwCO9ZiADAAGc2VhcmNoAgQAjvWYgAzbDSjwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwCO9ZiADAAQYWJDb3JlTWVudUFjdGlvbgIEAI71mIAMgg43QG9zLm9wZW5RUkNvZGVTY2FubmVyKCk7Cgpjb25maWdCb3QudGFncy5hYlNjYW4gPSB0cnVlOycAjvWYgAwAD2FiQ29yZU1lbnVMYWJlbAIEAI71mIAMug4Ec2NhbicAjvWYgAwADmFiQ29yZU1lbnVJY29uAgQAjvWYgAy/Dg9xcl9jb2RlX3NjYW5uZXInAI71mIAMABNhYkNvcmVNZW51U29ydE9yZGVyAgQAjvWYgAzPDgEzJwEEYm90cyQ0YWFmNjk5ZS1hYmJmLTQ0YTgtODVlMS02OGNiYjVkZjBlMWYBJwCO9ZiADNEOBnN5c3RlbQIEAI71mIAM0g4TYWIuaW50ZXJmYWNlLm51Z2dldCcAjvWYgAzRDgRmb3JtAgQAjvWYgAzmDgdub3RoaW5nJwCO9ZiADNEOC2FiSW50ZXJmYWNlAgQAjvWYgAzuDgR0cnVlJwCO9ZiADNEOCGFiSWdub3JlAgQAjvWYgAzzDgR0cnVlKACO9ZiADNEODGFiQm90VmVyc2lvbgF9PCcAjvWYgAzRDgxhYkxvYWROdWdnZXQCBACO9ZiADPkOmAJAbGV0IG51Z2dldE5hbWUgPSB0aGF0Lm51Z2dldE5hbWU7CmxldCBmb3JtYXR0ZWROdWdnZXRBQiA9ICJudWdfIitudWdnZXROYW1lOwpsZXQgbG9hZGVkTnVnZ2V0ID0gYXdhaXQgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBmb3JtYXR0ZWROdWdnZXRBQiwgYWJWZXJzaW9uOiB0aGF0LnZlcnNpb24sIHJldHVyblR5cGU6ICJkYXRhIn0pOwoKbG9hZGVkTnVnZ2V0ID0gbG9hZGVkTnVnZ2V0LnN0YXRlW251Z2dldE5hbWVdLm51Z2dldDsKCnJldHVybiBsb2FkZWROdWdnZXQ7JwCO9ZiADNEOD2FiUHVibGlzaE51Z2dldAIEAI71mIAMkhHtAkAvL3Nob3V0KCJhYlB1Ymxpc2hOdWdnZXQiLCB7bnVnOiAibnVnTmFtZSIsIGRhdGE6IGRhdGF9KTsgIEFERCBFR0cgSUQgRVZFTlRVQUxMWQpsZXQgdGVzdE51Z2dldCA9IHRoYXQuZGF0YTsKbGV0IGZvcm1hdHRlZE51Z2dldCA9IHtpZDogdGhhdC5udWcsIG51Z2dldDogdGVzdE51Z2dldH07CmxldCB0ZXN0TnVnZ2V0TmFtZSA9IHRoYXQubnVnOwpsZXQgZm9ybWF0dGVkTnVnZ2V0QUIgPSAibnVnXyIrdGVzdE51Z2dldE5hbWU7CgptYXNrcy5udWdnZXRUb1B1Ymxpc2ggPSBmb3JtYXR0ZWROdWdnZXRBQjsKCmxpbmtzLnN0b3JlLmFiUHVibGlzaEFCKHthYjogZm9ybWF0dGVkTnVnZ2V0QUIsIHRhcmdldDogZm9ybWF0dGVkTnVnZ2V0fSk7JwCO9ZiADNEOD2ltcGxlbWVudE51Z2dldAIEAI71mIAMgBSxB0BsZXQgbnVnZ2V0TmFtZSA9IHRoYXQubnVnZ2V0OwpsZXQgbnVnZ2V0VmVyc2lvbkNoZWNrID0gbnVnZ2V0TmFtZS5pbmRleE9mKCIudiIpOwpsZXQgdmVyc2lvbjsKCmlmIChudWdnZXRWZXJzaW9uQ2hlY2sgIT0gLTEpCnsKICAgIG51Z2dldE5hbWUgPSBudWdnZXROYW1lLnN1YnN0cmluZygwLCBudWdnZXRWZXJzaW9uQ2hlY2spOwoKICAgIGxldCB2ZXJzaW9uQ2hlY2sgPSB0aGF0Lm51Z2dldC5zdWJzdHJpbmcobnVnZ2V0VmVyc2lvbkNoZWNrICsgMik7CgogICAgaWYgKGlzTmFOKHZlcnNpb25DaGVjaykpCiAgICB7CiAgICAgICAgY29uc29sZS5sb2codmVyc2lvbkNoZWNrLCAidmVyc2lvbiBpcyBub3QgYSBudW1iZXIiKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICB2ZXJzaW9uID0gTnVtYmVyKHZlcnNpb25DaGVjayk7CiAgICB9Cn0KY29uc29sZS5sb2cobnVnZ2V0TmFtZSwgdmVyc2lvbik7CmxldCBudWdEYXRhID0gYXdhaXQgdGhpc0JvdC5hYkxvYWROdWdnZXQoe251Z2dldE5hbWU6IG51Z2dldE5hbWUsIHZlcnNpb246IHZlcnNpb259KTsKCmlmIChudWdEYXRhID09ICJhYklEIG5vdCBmb3VuZCIpCnsKICAgIG9zLnRvYXN0KCJudWdnZXQgbm90IGZvdW5kIik7Cn0KZWxzZQp7CiAgICBsZXQgdGFyZ2V0Qm90ID0gZ2V0Qm90KCJpZCIsIHRoYXQuYm90KTsKICAgIGxldCB0YXJnZXRUYWcgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXS50b1N0cmluZygpOwogICAgbGV0IHRhcmdldE51ZyA9ICJ7IiArIHRoYXQubnVnZ2V0ICsgIn0iOyAKICAgIGxldCBudWdQb3MgPSB0YXJnZXRUYWcuaW5kZXhPZih0YXJnZXROdWcpOwoKICAgIGRlbGV0ZVRhZ1RleHQodGFyZ2V0Qm90LCB0aGF0LnRhZywgbnVnUG9zLCB0YXJnZXROdWcubGVuZ3RoKTsKICAgIGluc2VydFRhZ1RleHQodGFyZ2V0Qm90LCB0aGF0LnRhZywgbnVnUG9zLCBudWdEYXRhKTsKfScAjvWYgAzRDgxudWdnZXRCdXR0b24CBACO9ZiADLIb9QxAbGV0IHRhZ1ZhbHVlID0gdGhhdC50YWdWYWx1ZTsKbGV0IHJlZ2V4ID0gL1xuL2dpOwpsZXQgYnJlYWtDaGVjazsKbGV0IGJyZWFrQXJyYXkgPSBbMF07Ci8vbGV0IGNyZWF0ZWRCdXR0b25zID0gW107Cgp3aGlsZSAoYnJlYWtDaGVjayA9IHJlZ2V4LmV4ZWModGFnVmFsdWUpKQp7CiAgICBicmVha0FycmF5LnB1c2goYnJlYWtDaGVjay5pbmRleCk7Cn0KCmxldCBuZXdOdWdnZXRCdXR0b24gPSB7fTsKCm5ld051Z2dldEJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpuZXdOdWdnZXRCdXR0b24uZm9ybSA9ICJjb2RlQnV0dG9uIjsKbmV3TnVnZ2V0QnV0dG9uLnRhcmdldEJvdCA9IHRoYXQuYm90LmlkOwpuZXdOdWdnZXRCdXR0b24udGFyZ2V0VGFnID0gdGhhdC50YWc7Cm5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJsb2FkIG51Z2dldCI7Cm5ld051Z2dldEJ1dHRvbi5udWdnZXRSZXNldCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbmV3TnVnZ2V0QnV0dG9uW3RoYXQuYm90LmlkICsgIi4iICsgdGhhdC50YWddID0gdHJ1ZTsKbmV3TnVnZ2V0QnV0dG9uLm51Z2dldE1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwpuZXdOdWdnZXRCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm51Z2dldE1hbmFnZXIuaW1wbGVtZW50TnVnZ2V0KHtib3Q6IHRhZ3MudGFyZ2V0Qm90LCBudWdnZXQ6IHRhZ3MudGFyZ2V0TnVnZ2V0LCB0YWc6IHRhZ3MudGFyZ2V0VGFnfSk7CgpkZXN0cm95KHRoaXNCb3QpO2A7Cgpmb3IgKGxldCBudWdzID0gMDsgbnVncyA8IHRoYXQubnVnZ2V0Lmxlbmd0aDsgbnVncysrKQp7CiAgICBsZXQgY3VycmVudE51Z2dldCA9IHRoYXQubnVnZ2V0W251Z3NdOwogICAgLy9sZXQgYnV0dG9uQ2hlY2sgPSBjcmVhdGVkQnV0dG9ucy5pbmRleE9mKGN1cnJlbnROdWdnZXQubnVnTmFtZSk7CgogICAgaWYgKCFjdXJyZW50TnVnZ2V0IHx8IGN1cnJlbnROdWdnZXQgPT0gdW5kZWZpbmVkKSAvL3x8IGJ1dHRvbkNoZWNrICE9IC0xCiAgICB7CiAgICAgICAgY29udGludWU7CiAgICB9CgogICAgaWYgKGN1cnJlbnROdWdnZXQubnVnUHVibGlzaCkKICAgIHsKICAgICAgICBuZXdOdWdnZXRCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLm51Z2dldE1hbmFnZXIucGFja2FnZU51Z2dldCh7Ym90OiB0YWdzLnRhcmdldEJvdCwgbnVnZ2V0OiB0YWdzLnRhcmdldE51Z2dldCwgdGFnOiB0YWdzLnRhcmdldFRhZ30pOwoKICAgICAgICBkZXN0cm95KHRoaXNCb3QpO2A7CgogICAgICAgIG5ld051Z2dldEJ1dHRvbi5sYWJlbCA9ICJwdWJsaXNoICIgKyBjdXJyZW50TnVnZ2V0Lm51Z05hbWUgKyAiIG51Z2dldCI7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbmV3TnVnZ2V0QnV0dG9uLmxhYmVsID0gImxvYWQgIiArIGN1cnJlbnROdWdnZXQubnVnTmFtZSArICIgbnVnZ2V0IjsKICAgIH0KCiAgICBuZXdOdWdnZXRCdXR0b24udGFyZ2V0TnVnZ2V0ID0gY3VycmVudE51Z2dldC5udWdOYW1lOwogICAgbmV3TnVnZ2V0QnV0dG9uW3RoYXQuYm90LmlkICsgIi4iICsgdGhhdC50YWcgKyAiU3RhcnQiXSA9IGN1cnJlbnROdWdnZXQubnVnU3RhcnQ7CgogICAgY3JlYXRlKG5ld051Z2dldEJ1dHRvbik7CgogICAgLy9jcmVhdGVkQnV0dG9ucy5wdXNoKGN1cnJlbnROdWdnZXQubnVnTmFtZSk7Cn0KCnJldHVybjsnAI71mIAM0Q4LbnVnZ2V0UGFyc2UCBACO9ZiADKYopw9AY29uc3Qgb3JpZ2luYWxUYWdWYWx1ZSA9IHRoYXQuZWRpdGVkQm90LnJhd1t0aGF0LmVkaXRlZFRhZ107CmxldCB0YWdWYWx1ZSA9IG9yaWdpbmFsVGFnVmFsdWU7CgppZiAoIXRhZ1ZhbHVlKSAKewogICAgcmV0dXJuOwp9CmVsc2UgaWYgKHR5cGVvZiB0YWdWYWx1ZSAhPT0gInN0cmluZyIpIAp7CiAgICB0YWdWYWx1ZSA9IHRhZ1ZhbHVlLnRvU3RyaW5nKCk7Cn0KCmxldCBpbml0aWFsUG9zc2libGVOdWdQb3MgPSAwOwoKaWYgKGluaXRpYWxQb3NzaWJsZU51Z1BvcyA9PSAtMSkgCnsKICAgIHJldHVybjsKfQplbHNlCnsKICAgIHRhZ1ZhbHVlID0gdGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxQb3NzaWJsZU51Z1Bvcyk7Cn0KCmxldCBwb3NzaWJsZU51Z3MgPSBvcmlnaW5hbFRhZ1ZhbHVlLnJlcGxhY2UoL1tee10vZywgIiIpLmxlbmd0aDsKbGV0IHRvdGFsTnVnQnJlYWtzID0gb3JpZ2luYWxUYWdWYWx1ZS5yZXBsYWNlKC9bXlxuXS9nLCAiIikubGVuZ3RoOwpsZXQgYnJlYWtMZXZlbCA9IDA7CmxldCBudWdzVG9DaGVjayA9IFtdOwoKZm9yIChsZXQgaSA9IDA7IGkgPCBwb3NzaWJsZU51Z3M7IGkrKykKewogICAgbGV0IGluaXRpYWxOdWdQb3MgPSB0YWdWYWx1ZS5pbmRleE9mKCJ7IikgKyAxOwogICAgbGV0IHBvc3NpYmxlTnVnRW5kID0gdGFnVmFsdWUuaW5kZXhPZigifSIpOwogICAgbGV0IHBvc3NpYmxlTnVnID0gdGFnVmFsdWUuc3Vic3RyaW5nKGluaXRpYWxOdWdQb3MsIHBvc3NpYmxlTnVnRW5kKTsKCiAgICBpZiAocG9zc2libGVOdWcuaW5kZXhPZigiICIpID09IC0xICYmIC9cbi9nLnRlc3QocG9zc2libGVOdWcpICE9IHRydWUgJiYgcG9zc2libGVOdWcubGVuZ3RoID4gMCAmJiBwb3NzaWJsZU51Zy5pbmRleE9mKCI6IikgPT0gLTEpCiAgICB7CiAgICAgICAgbGV0IG51Z0JyZWFrcyA9IHRhZ1ZhbHVlLnN1YnN0cmluZygwLCB0YWdWYWx1ZS5pbmRleE9mKCJ7Iitwb3NzaWJsZU51ZysifSIpKS5yZXBsYWNlKC9bXlxuXS9nLCAiIikubGVuZ3RoOwogICAgICAgIGxldCBwdWJsaXNoQ2hlY2sgPSB0YWdWYWx1ZS5zdWJzdHJpbmcoaW5pdGlhbE51Z1BvcyAtIDYsIGluaXRpYWxOdWdQb3MgLSAyKTsKICAgICAgICBsZXQgbnVnUHVibGlzaCA9IG51bGw7CgogICAgICAgIGlmIChwdWJsaXNoQ2hlY2sgPT0gIi5udWciKQogICAgICAgIHsKICAgICAgICAgICAgbnVnUHVibGlzaCA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBicmVha0xldmVsICs9IG51Z0JyZWFrczsKCiAgICAgICAgbnVnQnJlYWtzID0gdG90YWxOdWdCcmVha3MgLSAodG90YWxOdWdCcmVha3MgLSBicmVha0xldmVsKTsKICAgICAgICAKICAgICAgICAvL0NIRUNLIElGICQgYmVmb3JlIG51Z2dldAogICAgICAgIGlmICh0YWdWYWx1ZS5zdWJzdHJpbmcoaW5pdGlhbE51Z1BvcyAtIDIsIGluaXRpYWxOdWdQb3MgLSAxKSAhPSAiJCIpCiAgICAgICAgewogICAgICAgICAgICBudWdzVG9DaGVjay5wdXNoKHtudWdOYW1lOiBwb3NzaWJsZU51ZywgbnVnU3RhcnQ6IG51Z0JyZWFrcyArIDEsIG51Z1B1Ymxpc2g6IG51Z1B1Ymxpc2h9KTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbGV0IG51Z0JyZWFrcyA9IHRhZ1ZhbHVlLnN1YnN0cmluZygwLCB0YWdWYWx1ZS5pbmRleE9mKCJ9IikpLnJlcGxhY2UoL1teXG5dL2csICIiKS5sZW5ndGg7CgogICAgICAgIGJyZWFrTGV2ZWwgKz0gbnVnQnJlYWtzOwoKICAgICAgICBudWdCcmVha3MgPSB0b3RhbE51Z0JyZWFrcyAtICh0b3RhbE51Z0JyZWFrcyAtIGJyZWFrTGV2ZWwpOwogICAgfQoKICAgIHRhZ1ZhbHVlID0gdGFnVmFsdWUuc3Vic3RyaW5nKHBvc3NpYmxlTnVnRW5kICsgMSk7Cn0KCnRoaXNCb3QubnVnZ2V0QnV0dG9uKHsgbnVnZ2V0OiBudWdzVG9DaGVjaywgYm90OiB0aGF0LmVkaXRlZEJvdCwgdGFnOiB0aGF0LmVkaXRlZFRhZywgdGFnVmFsdWU6IG9yaWdpbmFsVGFnVmFsdWV9KTsnAI71mIAM0Q4Nb25BQlB1Ymxpc2hlZAIEAI71mIAMzjfBAUBjb25zb2xlLmxvZyh0aGF0LmFiLCB0YWdzLm51Z2dldFRvUHVibGlzaCkKCmlmICh0aGF0LmFiID09IHRhZ3MubnVnZ2V0VG9QdWJsaXNoKQp7CiAgICBvcy50b2FzdCgibnVnZ2V0IHB1Ymxpc2hlZCIpOwoKICAgIG1hc2tzLm51Z2dldFRvUHVibGlzaCA9IG51bGw7CgogICAgY29uZmlnQm90Lm1hc2tzLmFiVmVyc2lvbiA9IG51bGw7Cn0nAI71mIAM0Q4Qb25BbnlCb3RzQ2hhbmdlZAIEAI71mIAMkDm3BEBpZiAoY29uZmlnQm90ICYmIHRoYXRbMF0uYm90LmlkICE9IHRoaXNCb3QuaWQpIAp7CiAgICBpZiAoIWNvbmZpZ0JvdC50YWdzLmVkaXRpbmdCb3QpIHJldHVybjsgLy8gSWdub3JlIGlmIHRoZSBjb25maWdCb3QgaXNuJ3QgcmVhZHkgeWV0LgoKICAgIGNvbnN0IGVkaXRlZEJvdElEID0gY29uZmlnQm90LnRhZ3MuZWRpdGluZ0JvdC5yZXBsYWNlKCLwn5SXIiwgIiIpOwoKICAgIGlmICghdGhhdC5maW5kKHggPT4geC5ib3QuaWQgPT0gZWRpdGVkQm90SUQpKSByZXR1cm47IC8vIElmIHRoZSBib3QgY2hhbmdlZCB3YXNuJ3QgYmVpbmcgZWRpdGVkIGJ5IHRoZSB1c2VyIGlnbm9yZSBpdC4KCiAgICBjb25zdCBlZGl0ZWRUYWcgPSBjb25maWdCb3QudGFncy5lZGl0aW5nVGFnOwogICAgY29uc3QgZWRpdGVkQm90ID0gZ2V0Qm90KCJpZCIsIGVkaXRlZEJvdElEKTsKCiAgICBpZiAoZWRpdGVkQm90ICYmIGVkaXRlZFRhZykgCiAgICB7CiAgICAgICAgc2hvdXQoIm51Z2dldFJlc2V0Iik7CgogICAgICAgIHRoaXNCb3QubnVnZ2V0UGFyc2UoeyBlZGl0ZWRCb3QsIGVkaXRlZFRhZyB9KTsKICAgIH0KfScAjvWYgAzRDghvbkNyZWF0ZQIEAI71mIAMxj1MQHRhZ3MubGlzdGVuaW5nID0gZmFsc2U7CgovL3NldFRhZ01hc2sodGhpc0JvdCwgImxpc3RlbmluZyIsIHRydWUsICJsb2NhbCIpOycAjvWYgAzRDg1wYWNrYWdlTnVnZ2V0AgQAjvWYgAyTPvgGQGNvbnN0IHRhcmdldEJvdCA9IGdldEJvdCgiaWQiLCB0aGF0LmJvdCk7CmNvbnN0IHRhZ1RleHQgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXTsKCmlmIChjb25maWdCb3QudGFncy5jdXJzb3JTdGFydEluZGV4IHx8IGNvbmZpZ0JvdC50YWdzLmN1cnNvckVuZEluZGV4KQp7CiAgICBsZXQgc3RhcnRQb3MgPSBjb25maWdCb3QudGFncy5jdXJzb3JTdGFydEluZGV4OwogICAgbGV0IGVuZFBvcyA9IGNvbmZpZ0JvdC50YWdzLmN1cnNvckVuZEluZGV4OwoKICAgIGlmIChzdGFydFBvcyA9PSBlbmRQb3MpCiAgICB7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgZWxzZSBpZiAoc3RhcnRQb3MgPiBlbmRQb3MpCiAgICB7CiAgICAgICAgbGV0IG5ld1N0YXJ0UG9zID0gZW5kUG9zOwogICAgICAgIGxldCBuZXdFbmRQb3MgPSBzdGFydFBvczsKCiAgICAgICAgc3RhcnRQb3MgPSBuZXdTdGFydFBvczsKICAgICAgICBlbmRQb3MgPSBuZXdFbmRQb3M7CiAgICB9CgogICAgbGV0IGRhdGEgPSB0YWdUZXh0LnN1YnN0cmluZyhzdGFydFBvcywgZW5kUG9zICsgMSk7CgogICAgc2hvdXQoImFiUHVibGlzaE51Z2dldCIsIHtudWc6IHRoYXQubnVnZ2V0LCBkYXRhOiBkYXRhfSk7CgogICAgb3MudG9hc3QoIm51ZyBpcyBwdWJsaXNoaW5nIiwgMTApOwoKICAgIGxldCB0YXJnZXROdWcgPSAiLm51ZyB7IiArIHRoYXQubnVnZ2V0ICsgIn0iOyAKICAgIGxldCBudWdQb3MgPSB0YXJnZXRCb3QucmF3W3RoYXQudGFnXS5pbmRleE9mKHRhcmdldE51Zyk7CgogICAgZGVsZXRlVGFnVGV4dCh0YXJnZXRCb3QsIHRoYXQudGFnLCBudWdQb3MsIHRhcmdldE51Zy5sZW5ndGgpOwp9CmVsc2UKewogICAgb3MudG9hc3QoImNhbm5vdCByZWFkIG51Z2dldCB0byBiZSBwdWJsaXNoZWQiKQp9JwCO9ZiADNEOCHJlbWVtYmVyAgQAjvWYgAyMRSjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwCO9ZiADNEOBnNlYXJjaAIEAI71mIAMs0Uo8J+Ul2Q4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNScAjvWYgAzRDgVzdG9yZQIEAI71mIAM2kUo8J+Ulzc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZicAjvWYgAzRDglsaXN0ZW5pbmcCBACO9ZiADIFGBWZhbHNlJwEEYm90cyRiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2IBJwCO9ZiADIdGBnN5c3RlbQIEAI71mIAMiEYRYWIuaW50ZXJmYWNlLm1lbnUnAI71mIAMh0YEZm9ybQIEAI71mIAMmkYHbm90aGluZycAjvWYgAyHRgtkZXNjcmlwdGlvbgIEAI71mIAMokYmVGhpcyBza2lsbCBpcyBkZXNpZ25lZCBmb3IgbWVudSBzdHVmZi4oAI71mIAMh0YLYWJJbnRlcmZhY2UBeCcAjvWYgAyHRgphYk9wZW5NZW51AgQAjvWYgAzKRtsKQGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90SW5CYWNrZ3JvdW5kKCk7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGV0IG1lbnVUeXBlID0gdGhhdCA/ICJhYiIgKyB0aGF0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdGhhdC5zbGljZSgxKSArICJNZW51IjogImFiQ29yZU1lbnUiOyAvL3NldCB1cCBhIGNoZWNrIHRvIHNlZSB3aGF0IHR5cGUgb2YgbWVudSBzaG91bGQgYmUgb2NjdXJpbmcgW2NvcmUsIGJvdCwgZ3JpZCwgaW5zdF0KbGV0IG1lbnVTa2lsbHMgPSBnZXRCb3RzKG1lbnVUeXBlICsgIkFjdGlvbiIpOwpsZXQgbWF4T3B0aW9ucyA9IG1lbnVUeXBlID09ICJpbnN0IiA/IDcgOiA1OwpsZXQgYWJNZW51QnV0dG9uID0ge307CgphYk1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKYWJNZW51QnV0dG9uLnJlbWVtYmVyID0gdGFncy5yZW1lbWJlcjsKYWJNZW51QnV0dG9uLm1hbmlmZXN0YXRpb24gPSB0YWdzLm1hbmlmZXN0YXRpb247CmFiTWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwphYk1lbnVCdXR0b24ub25DbGljayA9IGBAIGxpbmtzLmJhc2VTa2lsbC4ke21lbnVUeXBlICsgIkFjdGlvbiJ9KCk7YDsKCmZvciAobGV0IGkgPSAwOyBpIDwgbWVudVNraWxscy5sZW5ndGg7IGkrKykvL0FERCBMT0dJQyBGT1IgTU9SRSBPUFRJT05TIFRIQU4gNSA6IG1heE9wdGlvbnMKewogICAgbGV0IGN1cnJlbnRTa2lsbCA9IG1lbnVTa2lsbHNbaV07CgogICAgYWJNZW51QnV0dG9uLmJhc2VTa2lsbCA9ICLwn5SXIiArIGN1cnJlbnRTa2lsbC5pZDsKICAgIGFiTWVudUJ1dHRvbi5sYWJlbCA9IGN1cnJlbnRTa2lsbC50YWdzW21lbnVUeXBlICsgIkxhYmVsIl07CiAgICBhYk1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJJY29uIl07CiAgICBhYk1lbnVCdXR0b24ub25DcmVhdGUgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJPbkdlbmVyYXRlIl07CiAgICBhYk1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiU29ydE9yZGVyIl07CiAgICBhYk1lbnVCdXR0b24uY29sb3IgPSBjdXJyZW50U2tpbGwudGFnc1ttZW51VHlwZSArICJDb2xvciJdID8gY3VycmVudFNraWxsLnRhZ3NbbWVudVR5cGUgKyAiQ29sb3IiXSA6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CgogICAgdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24oYWJNZW51QnV0dG9uKTsKfQoKdGhpc0JvdC5tYXNrcy5vbkdyaWRDbGljayA9ICJAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOyI7JwCO9ZiADIdGEmFiQ3JlYXRlTWVudUJ1dHRvbgIEAI71mIAMpFG/A0BsZXQgYWRkaXRpb25hbFRhZ3MgPSB0aGF0OwpsZXQgbmV3TWVudUJ1dHRvbiA9IHt9OwoKbmV3TWVudUJ1dHRvbi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwpuZXdNZW51QnV0dG9uLmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKbmV3TWVudUJ1dHRvbi5sYWJlbENvbG9yID0gImJsYWNrIjsKbmV3TWVudUJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJsZWZ0IjsKbmV3TWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0geyAiYm9yZGVyLXJhZGl1cyI6IjhweCIsICJtYXJnaW4tdG9wIjoiM3B4In07Cgpmb3IgKGNvbnN0IHRhZyBpbiBhZGRpdGlvbmFsVGFncykKewogICAgbmV3TWVudUJ1dHRvblt0YWddID0gYWRkaXRpb25hbFRhZ3NbdGFnXTsKfQoKbmV3TWVudUJ1dHRvbiA9IGNyZWF0ZShuZXdNZW51QnV0dG9uKTsKCnJldHVybiBuZXdNZW51QnV0dG9uOycAjvWYgAyHRg1hYk1lbnVSZWZyZXNoAgQAjvWYgAzkVD5AY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOwoKbWFza3Mub25HcmlkQ2xpY2sgPSBudWxsOycAjvWYgAyHRghyZW1lbWJlcgIEAI71mIAMo1Uo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycAjvWYgAyHRg1tYW5pZmVzdGF0aW9uAgQAjvWYgAzKVSjwn5SXZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkJwCO9ZiADIdGEWFiRW52aXJvbm1lbnRNZW51AgQAjvWYgAzxVdAGQHNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGV0IGFiTWVudUJ1dHRvbiA9IHt9OwoKYWJNZW51QnV0dG9uLmFiTWVudSA9IHRydWU7CmFiTWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwphYk1lbnVCdXR0b24ubWFuaWZlc3RhdGlvbiA9IHRhZ3MubWFuaWZlc3RhdGlvbjsKYWJNZW51QnV0dG9uLnJlbWVtYmVyID0gdGFncy5yZW1lbWJlcjsKYWJNZW51QnV0dG9uLmxlYXJuID0gdGFncy5sZWFybjsKCmJ1dHRvbkxvb3A6CmZvciAobGV0IGkgPSAwOyBpIDwgdGFncy5hYkVudmlyb25tZW50QXJyYXkubGVuZ3RoOyBpKyspCnsKICAgIGxldCBhY3RpdmVCdXR0b24gPSB0YWdzLmFiRW52aXJvbm1lbnRBcnJheVtpXTsKCiAgICBhYk1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gYWN0aXZlQnV0dG9uLmFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyOwoKICAgIGlmIChhY3RpdmVCdXR0b24uYWJFbnZpcm9ubWVudEdhdGUpCiAgICB7CiAgICAgICAgaWYgKCFsaW5rc1thY3RpdmVCdXR0b24uYWJFbnZpcm9ubWVudEdhdGVdKQogICAgICAgIHsKICAgICAgICAgICAgY29udGludWUgYnV0dG9uTG9vcDsKICAgICAgICB9CiAgICB9CgogICAgbGV0IG5ld0J1dHRvbkRhdGEgPSB7Li4uYWJNZW51QnV0dG9uLCAuLi5hY3RpdmVCdXR0b259OwoKICAgIHRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG5ld0J1dHRvbkRhdGEpOwp9Cgp0aGlzQm90Lm1hc2tzLm9uR3JpZENsaWNrID0gIkAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7IjsnAI71mIAMh0YFbGVhcm4CBACO9ZiADMJcKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAI71mIAMh0YDZ3B0AgQAjvWYgAzpXCjwn5SXZWM4NWMxZDYtOWYxYS00MGQ0LTgyZTEtNWJkNjgwMzQ5YzI3JwCO9ZiADIdGCGFiSWdub3JlAgQAjvWYgAyQXQR0cnVlKACO9ZiADIdGDGFiQm90VmVyc2lvbgF9gAEnAI71mIAMh0YRYWJJbml0aWFsQm9vdE1lbnUCBACO9ZiADJZdvwpAY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJJbml0aWFsTWVudSI7CgptYXNrcy5lID0gIkAgbWFza3Mub25HcmlkQ2xpY2sgPSBudWxsOyI7Cm1hc2tzLm9uR3JpZENsaWNrID0gIkAgbWFza3Mub25HcmlkQ2xpY2sgPSBudWxsOyBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7IjsKCmxldCBtZW51QnV0dG9uID0ge307CgptZW51QnV0dG9uLmFiSW5pdGlhbE1lbnUgPSB0cnVlOwptZW51QnV0dG9uLmdyaWRDbGljayA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwptZW51QnV0dG9uLmxlYXJuID0gdGFncy5sZWFybjsKbWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwptZW51QnV0dG9uLnNlYXJjaCA9IHRhZ3Muc2VhcmNoOwptZW51QnV0dG9uLmFzayA9IHRhZ3MuYXNrOwptZW51QnV0dG9uLmxhYmVsID0gImJ1aWxkIjsKbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjdWJlIjsKbWVudUJ1dHRvbi5jb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7Cm1lbnVCdXR0b24ub25DbGljayA9IGBAIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgpsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTtgOwoKLy90aGlzQm90LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKCm1lbnVCdXR0b24ubGFiZWwgPSAiYXNrICIgKyBsaW5rcy5yZW1lbWJlci50YWdzLmFiQnVpbGRlcklkZW50aXR5OwptZW51QnV0dG9uLmZvcm0gPSAiaW5wdXQiOwptZW51QnV0dG9uLmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJjdWJlIjsKbWVudUJ1dHRvbi5vblN1Ym1pdCA9IGBAIHNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgogICAgbGlua3MuYXNrLmFiQ29yZU1lbnVBY3Rpb24odGhhdC50ZXh0KTtgOwoKdGhpc0JvdC5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7CgptZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gInFyX2NvZGVfc2Nhbm5lciI7Cm1lbnVCdXR0b24uZm9ybSA9IG51bGw7Cm1lbnVCdXR0b24ubGFiZWwgPSAic2NhbiI7Cm1lbnVCdXR0b24uY29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwptZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKY29uZmlnQm90LnRhZ3MucHJhY3RpY2VQZXJtaXRTY2FuID0gdHJ1ZTsKCm9zLm9wZW5RUkNvZGVTY2FubmVyKCk7YDsKCnRoaXNCb3QuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOycAjvWYgAyHRgZzZWFyY2gCBACO9ZiADNZnKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAI71mIAMh0YGbnVnZ2V0AgQAjvWYgAz9Zyjwn5SXNGFhZjY5OWUtYWJiZi00NGE4LTg1ZTEtNjhjYmI1ZGYwZTFmJwCO9ZiADIdGBXRlc3RzAgQAjvWYgAykaCjwn5SXYjgzZDk3MmItMDUzNS00MDUxLWI1ODktNDFjZWRhODUzNWYxJwCO9ZiADIdGD29uUG9ydGFsQ2hhbmdlZAIEAI71mIAMy2huQGlmICh0aGF0LnBvcnRhbCA9PSAic3lzdGVtUG9ydGFsIiAmJiAhdGhhdC5kaW1lbnNpb24gJiYgIWxpbmtzLnRlc3RzKQp7CiAgICBsaW5rcy5sZWFybi5hYkFkYXB0KCJhYlRlc3RzIik7Cn0nAI71mIAMh0YDYXNrAgQAjvWYgAy6aSjwn5SXZWM4NWMxZDYtOWYxYS00MGQ0LTgyZTEtNWJkNjgwMzQ5YzI3JwCO9ZiADIdGEmFiRW52aXJvbm1lbnRBcnJheQIEAI71mIAM4WmbHvCfp6xbeyJsYWJlbCI6ICJoaWRlIiwgImZvcm1BZGRyZXNzIjogInZpc2liaWxpdHlfb2ZmIiwgIm9uQ2xpY2siOiAiQCBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOyBsaW5rcy5tYW5pZmVzdGF0aW9uLm1hc2tzLmFiQm90ID0gbnVsbDsiLCAiYWJFbnZpcm9ubWVudE1lbnVTb3J0T3JkZXIiOiAwfSwKeyJsYWJlbCI6ICJjb2xvciIsICJmb3JtQWRkcmVzcyI6ICJwYWxldHRlIiwgIm9uQ2xpY2siOiAiQCBvcy5zaG93SW5wdXRGb3JUYWcobGlua3MucmVtZW1iZXIsJ2FiQmFzZUNvbG9yJywge3R5cGU6ICdjb2xvcicsdGl0bGU6ICdwaWNrIGEgY29sb3InfSk7IGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7bGlua3MubWFuaWZlc3RhdGlvbi5tYXNrcy5hYkJvdCA9IG51bGw7IiwgImFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyIjogMX0sCnsibGFiZWwiOiAic2xlZXAiLCAiZm9ybUFkZHJlc3MiOiAibmlnaHRzX3N0YXkiLCAib25DbGljayI6ICJAZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsgbGlua3MubWFuaWZlc3RhdGlvbi5tYXNrcy5hYkJvdCA9IG51bGw7IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJBd2FrZVN0YXRlID0gZmFsc2U7IiwgImFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyIjogMn0sCnsibGFiZWwiOiAiY2hhdCIsICJmb3JtQWRkcmVzcyI6ICJjaGF0IiwgIm9uQ2xpY2siOiAiQCBvcy5zaG93Q2hhdCgpOyIsICJhYkVudmlyb25tZW50TWVudVNvcnRPcmRlciI6IDN9LAp7ImxhYmVsIjogIm51Z2dldHMiLCAib25DcmVhdGUiOiAiQCB0YWdzLm51Z01hbmFnZXIgPSBnZXRMaW5rKGdldEJvdCgnc3lzdGVtJywgJ2FiLmludGVyZmFjZS5udWdnZXQnKSk7IGlmIChsaW5rcy5udWdNYW5hZ2VyLnRhZ3MubGlzdGVuaW5nKXt0YWdzLm9uQ2xpY2sgPSBgQCBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsgc2V0VGFnTWFzayhsaW5rcy5udWdNYW5hZ2VyLCAnbGlzdGVuaW5nJywgbnVsbCk7YDt0YWdzLmZvcm1BZGRyZXNzID0gYGNoZWNrX2JveGA7fWVsc2V7ICAgIHRhZ3Mub25DbGljayA9IGBAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOyBzZXRUYWdNYXNrKGxpbmtzLm51Z01hbmFnZXIsICdsaXN0ZW5pbmcnLCB0cnVlLCAnbG9jYWwnKTtgOyAgICB0YWdzLmZvcm1BZGRyZXNzID0gYGNoZWNrX2JveF9vdXRsaW5lX2JsYW5rYDt9IiwgImFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyIjogNH0sCnsibGFiZWwiOiAic3lzdGVtUG9ydGFsPXRydWUiLCAiZm9ybUFkZHJlc3MiOiAic2V0dGluZ3NfYXBwbGljYXRpb25zIiwgIm9uQ2xpY2siOiAiQCBjb25zdCBzdGF0ZSA9IG9zLmdldElucHV0U3RhdGUoJ2tleWJvYXJkJywgJ1NoaWZ0Jyk7IGlmIChzdGF0ZSl7b3Mub3BlblVSTChjb25maWdCb3QudGFncy5wZXJtYWxpbmsgKyBgJnN5c3RlbVBvcnRhbD10cnVlYCk7fWVsc2V7Y29uZmlnQm90LnRhZ3Muc3lzdGVtUG9ydGFsID0gdHJ1ZTt9IiwgImFiRW52aXJvbm1lbnRNZW51U29ydE9yZGVyIjogNX0sCnsiYWJFbnZpcm9ubWVudEdhdGUiOiAiZ3B0IiwgIm9uQ3JlYXRlIjogIkAgIGlmICghYXV0aEJvdCl7ZGVzdHJveSh0aGlzQm90KTt9ZWxzZSBpZiAoYXV0aEJvdC50YWdzLnN1YnNjcmlwdGlvblRpZXIgPT0gJ0ZyZWVQbGF5JyB8fCBhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSB1bmRlZmluZWQpe2Rlc3Ryb3kodGhpc0JvdCk7fTsgdGFncy5sYWJlbCA9ICdlZGl0ICcgKyBsaW5rcy5yZW1lbWJlci50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgJyBwcm9tcHQnOyB0YWdzLmdwdEJvdCA9IGdldExpbmsoZ2V0Qm90KCdzeXN0ZW0nLCAnYWIuYWN0aW9uLmFzaycpKTsiLCAiZm9ybUFkZHJlc3MiOiAiZWRpdF9ub3RlIiwgIm9uQ2xpY2siOiAiQCBsaW5rcy5ncHRCb3QuZWRpdFByb21wdCgpOyIsICJhYkVudmlyb25tZW50TWVudVNvcnRPcmRlciI6IDZ9LAp7ImxhYmVsIjogImdyaWQgc25hcCIsICJvbkNyZWF0ZSI6ICJAIHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZFNuYXBTdGF0ZSA/ICdjaGVja19ib3gnIDogJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJyIsICJvbkNsaWNrIjogIkAgbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGUgPSAhbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGU7dGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkU25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOyIsICJhYkVudmlyb25tZW50TWVudVNvcnRPcmRlciI6IDd9LAp7ImxhYmVsIjogImJvdCBzbmFwIiwgIm9uQ3JlYXRlIjogIkAgdGFncy5mb3JtQWRkcmVzcyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGUgPyAnY2hlY2tfYm94JyA6ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7IiwgIm9uQ2xpY2siOiAiQCBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlID0gIWxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGU7IHRhZ3MuZm9ybUFkZHJlc3MgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90U25hcFN0YXRlID8gJ2NoZWNrX2JveCcgOiAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOyIsICJhYkVudmlyb25tZW50TWVudVNvcnRPcmRlciI6IDh9LAp7ImFiRW52aXJvbm1lbnRHYXRlIjogInRlc3RzIiwgImxhYmVsIjogInJlY29yZCB0ZXN0IiwgImZvcm1BZGRyZXNzIjogInNjaWVuY2UiLCAib25LZXlEb3duIjogIkAgIiwgIm9uS2V5VXAiOiAiQCAiLCAib25DbGljayI6ICJAIGxldCBzaGlmdENoZWNrID0gb3MuZ2V0SW5wdXRTdGF0ZSgna2V5Ym9hcmQnLCAnU2hpZnQnKTtsZXQgY3VycmVudEluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpO3Nob3V0KCdhYlJlY29yZFRlc3QnKTtzaG91dCgnYWJNZW51UmVmcmVzaCcpOyIsICJhYkVudmlyb25tZW50TWVudVNvcnRPcmRlciI6IDl9LAp7ImFiRW52aXJvbm1lbnRHYXRlIjogInRlc3RzIiwgImxhYmVsIjogInJlY29yZCB0cmFjZSIsICJmb3JtQWRkcmVzcyI6ICJ0aW1lbGluZSIsICJvbktleURvd24iOiAiQCAiLCAib25LZXlVcCI6ICJAICIsICJvbkNsaWNrIjogIkAgbGV0IHNoaWZ0Q2hlY2sgPSBvcy5nZXRJbnB1dFN0YXRlKCdrZXlib2FyZCcsICdTaGlmdCcpO2xldCBjdXJyZW50SW5zdCA9IG9zLmdldEN1cnJlbnRJbnN0KCk7c2hvdXQoJ2FiUmVjb3JkVHJhY2UnKTtzaG91dCgnYWJNZW51UmVmcmVzaCcpOyIsICJhYkVudmlyb25tZW50TWVudVNvcnRPcmRlciI6IDEwfSwKeyJvbkNyZWF0ZSI6ICJAIHRhZ3MubGFiZWwgPSAncGVybWFuZW50bHkgZGVsZXRlICcgKyBsaW5rcy5yZW1lbWJlci50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgJyB2JyArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJDb3JlVmVyc2lvbiArICcuJyArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJDb3JlSXRlcmF0aW9uOyIsICJmb3JtQWRkcmVzcyI6ICJkZWxldGVfZm9yZXZlciIsICJjb2xvciI6ICIjRDkzMDMwIiwgIm9uQ2xpY2siOiAiQCBsZXQgYWxsQm90cyA9IGdldEJvdHMoJ3NwYWNlJywgJ3NoYXJlZCcpO2Rlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7Zm9yIChsZXQgaSA9IDA7IGkgPCBhbGxCb3RzLmxlbmd0aDsgaSsrKXtpZiAoYWxsQm90c1tpXS50YWdzLnN5c3RlbSkge2lmIChhbGxCb3RzW2ldLnRhZ3Muc3lzdGVtLmluY2x1ZGVzKCdhYicpKXtkZXN0cm95KGFsbEJvdHNbaV0pO319fSIsICJhYkVudmlyb25tZW50TWVudVNvcnRPcmRlciI6IDEwMH0KXScBBGJvdHMkZGNhNWQ5ODctYzRkOC00NmU0LWI2MGMtZGFhN2IyZjRkZGFkAScAjvWYgAz7hwEGc3lzdGVtAgQAjvWYgAz8hwEaYWIuaW50ZXJmYWNlLm1hbmlmZXN0YXRpb24nAI71mIAM+4cBBGZvcm0CBACO9ZiADJeIAQdub3RoaW5nKACO9ZiADPuHAQthYkludGVyZmFjZQF4JwCO9ZiADPuHAQtkZXNjcmlwdGlvbgIEAI71mIAMoIgBOFRoaXMgc2tpbGwgY29udHJvbHMgdGhlIGFjdHVhbCBib3QgZm9yIHRoZSBhYiBpbnRlcmZhY2UuJwCO9ZiADPuHAQVsZWFybgIEAI71mIAM2YgBKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAI71mIAM+4cBD29uUG9ydGFsQ2hhbmdlZAIEAI71mIAMgIkBwgVAaWYgKCFsaW5rcy5yZW1lbWJlci50YWdzLmFiQXdha2VTdGF0ZSB8fCB0aGF0LnBvcnRhbCA9PSAidGFnUG9ydGFsIikKewogICAgcmV0dXJuOwp9CgpsZXQgcG9ydGFsQXJyYXkgPSBbIm1pbmlHcmlkUG9ydGFsIiwgImdyaWRQb3J0YWwiLCAibWFwUG9ydGFsIiwgIm1pbmlNYXBQb3J0YWwiLCAibGVmdFdyaXN0UG9ydGFsIiwgInJpZ2h0V3Jpc3RQb3J0YWwiXTsKCmlmIChwb3J0YWxBcnJheS5pbmRleE9mKHRoYXQucG9ydGFsKSAhPSAtMSAmJiB0aGF0LmRpbWVuc2lvbikKewogICAgdGhpc0JvdC5hYk1hbmlmZXN0Qm90KHtkaW1lbnNpb246IHRoYXQuZGltZW5zaW9uLCBwb3NpdGlvbjp7eDowLHk6MH19KTsKfQplbHNlIGlmIChwb3J0YWxBcnJheS5pbmRleE9mKHRoYXQucG9ydGFsKSA9PSAtMSAmJiAhdGhhdC5kaW1lbnNpb24gJiYgdGhhdC5wb3J0YWwgIT0gIm1lbnVQb3J0YWwiKQp7CiAgICBsZXQgc3VtbW9uRGltZW5zaW9uID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsIDogY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbDsKCiAgICB0aGlzQm90LmFiTWFuaWZlc3RCb3Qoe2RpbWVuc2lvbjogc3VtbW9uRGltZW5zaW9uLCBwb3NpdGlvbjp7eDowLHk6MH19KTsKfQplbHNlIGlmICh0aGF0LnBvcnRhbCAhPSAibWVudVBvcnRhbCIpCnsKICAgIGRlc3Ryb3kobGlua3MuYWJCb3QpOwp9JwCO9ZiADPuHAQhyZW1lbWJlcgIEAI71mIAMw44BKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAI71mIAM+4cBDWFiTWFuaWZlc3RCb3QCBACO9ZiADOqOAbIPQGlmICh0YWdzLmFiQm90KQp7CiAgICBkZXN0cm95KGxpbmtzLmFiQm90KTsKfQoKbGV0IGFiID0ge307CgphYi5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwphYi5jb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3I7CmFiLmZvcm1PcGFjaXR5ID0gIjAuMzMiOwphYi5sYWJlbCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlTGFiZWw7CmFiLmxhYmVsUG9zaXRpb24gPSAiZnJvbnQiOwphYi5sYWJlbENvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKYWIubGFiZWxTaXplID0gMC42MTsKYWIub25DbGljayA9ICJAIGxpbmtzLm1hbmFnZXIuYWJDbGljaygpOyI7CmFiLmRpbWVuc2lvbiA9IHRoYXQuZGltZW5zaW9uOwphYlt0aGF0LmRpbWVuc2lvbl0gPSB0cnVlOwphYlt0aGF0LmRpbWVuc2lvbiArICJYIl0gPSB0aGF0LnBvc2l0aW9uLng7CmFiW3RoYXQuZGltZW5zaW9uICsgIlkiXSA9IHRoYXQucG9zaXRpb24ueTsKYWIuc3Ryb2tlQ29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwphYi5saW5lQ29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwphYi5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKYWIuYW5pbWF0ZUJvdCA9IGBAIGNvbnN0IHJvdFogPSB0YWdzLmRpbWVuc2lvbiArICJSb3RhdGlvbloiOwpsZXQgdGFyZ2V0U2NhbGUgPSAwLjY1OwoKaWYgKHRhZ3Muc2NhbGUgPD0gMC42NTEpCnsKICAgIHRhcmdldFNjYWxlID0gMC45NTsKfQoKYXdhaXQgYW5pbWF0ZVRhZyh0aGlzQm90LAp7CiAgICBmcm9tVmFsdWU6IHsKICAgICAgICBbcm90Wl06IDAsCiAgICAgICAgc2NhbGU6IHRhZ3Muc2NhbGUKICAgIH0sCiAgICB0b1ZhbHVlOiB7CiAgICAgICAgW3JvdFpdOiA2LjMsCiAgICAgICAgc2NhbGU6IHRhcmdldFNjYWxlCiAgICB9LAogICAgZWFzaW5nOiB7CiAgICAgICAgdHlwZTogInNpbnVzb2lkYWwiLAogICAgICAgIG1vZGU6ICJpbm91dCIKICAgIH0sCiAgICBkdXJhdGlvbjogMgp9KS5jYXRjaChlID0+IHt9KTsKYDsKYWIub25DcmVhdGUgPSBgQCB0aGlzQm90LmFuaW1hdGVCb3QoKTsKCm1hc2tzLmludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4gdGhpc0JvdC5hbmltYXRlQm90KCksIDIwMDApOwpgOwphYi5vbkRlc3Ryb3kgPSBgQApjbGVhckludGVydmFsKHRhZ3MuaW50ZXJ2YWwpOwoKc2hvdXQoImFiTWVudVJlZnJlc2giKTsKYDsKYWIuZHJhZ2dhYmxlID0gZmFsc2U7CmFiLnNjYWxlID0gMC45OwoKbGV0IGFiTWFuaWZlc3RlZCA9IGF3YWl0IGNyZWF0ZShhYik7CgppZiAobGlua3MucmVtZW1iZXIudGFncy5hYlNlY29uZGFyeUxhYmVsKQp7CiAgICBsZXQgYWJMYWJlbEJvdCA9IHt9OwoKICAgIGFiTGFiZWxCb3Quc3BhY2UgPSAidGVtcExvY2FsIjsKICAgIGFiTGFiZWxCb3RbdGhhdC5kaW1lbnNpb25dID0gdHJ1ZTsKICAgIGFiTGFiZWxCb3RbdGhhdC5kaW1lbnNpb24gKyAiWiJdID0gLTE7CiAgICBhYkxhYmVsQm90LmNyZWF0b3IgPSBhYk1hbmlmZXN0ZWQuaWQ7CiAgICBhYkxhYmVsQm90LnRyYW5zZm9ybWVyID0gYWJNYW5pZmVzdGVkLmlkOwogICAgYWJMYWJlbEJvdC5wb2ludGFibGUgPSBmYWxzZTsKICAgIGFiTGFiZWxCb3QuY29sb3IgPSAiY2xlYXIiOwogICAgYWJMYWJlbEJvdC5sYWJlbCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJTZWNvbmRhcnlMYWJlbDsKICAgIGFiTGFiZWxCb3QubGFiZWxQb3NpdGlvbiA9ICJsZWZ0IjsKICAgIGFiTGFiZWxCb3QubGFiZWxTaXplID0gMC43OwogICAgYWJMYWJlbEJvdC5sYWJlbENvbG9yID0gYWJNYW5pZmVzdGVkLnRhZ3MubGFiZWxDb2xvcjsKCiAgICBjcmVhdGUoYWJMYWJlbEJvdCk7Cn0KCm1hc2tzLmFiQm90ID0gIvCflJciICsgYWJNYW5pZmVzdGVkLmlkOwoKbGlua3MucmVtZW1iZXIubWFza3MuYWJBY3RpdmVEaW1lbnNpb24gPSB0aGF0LmRpbWVuc2lvbjsnAI71mIAM+4cBD2FiTWFuaWZlc3RTdGF0ZQIEAI71mIAMmZ4BBkFzbGVlcCcAjvWYgAz7hwEcYWJNYW5pZmVzdFN0YXRlQXNsZWVwT25FbnRlcgIEAI71mIAMoJ4Bb0BkZXN0cm95KGxpbmtzLmFiQm90KTsKCm1hc2tzLmFiQm90ID0gbnVsbDsKCnNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgpsaW5rcy5yZW1lbWJlci50YWdzLmFiQXdha2VTdGF0ZSA9IGZhbHNlOycAjvWYgAz7hwELb25HcmlkQ2xpY2sCBACO9ZiADJCfAfYQQGlmICghbGlua3MucmVtZW1iZXIudGFncy5hYkF3YWtlU3RhdGUpCnsKICAgIHJldHVybjsKfQoKc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmNvbnN0IHNoaWZ0Q2hlY2sgPSBvcy5nZXRJbnB1dFN0YXRlKCJrZXlib2FyZCIsICJTaGlmdCIpOwoKaWYgKHNoaWZ0Q2hlY2sgJiYgdGFncy5hYkJvdCkKewogICAgaWYgKGxpbmtzLmFiQm90LnRhZ3MuYXJtKQogICAgewogICAgICAgIGRlc3Ryb3kobGlua3MuYWJCb3QubGlua3MuYXJtKTsKCiAgICAgICAgbGlua3MuYWJCb3QubWFza3MubGluZVRvID0gbnVsbDsKICAgIH0KICAgIAogICAgbGV0IGFybSA9IHt9OwoKICAgIGFybS5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwogICAgYXJtW3RoYXQuZGltZW5zaW9uXSA9IHRydWU7CiAgICBhcm1bdGhhdC5kaW1lbnNpb24gKyAiWCJdID0gdGhhdC5wb3NpdGlvbi54OwogICAgYXJtW3RoYXQuZGltZW5zaW9uICsgIlkiXSA9IHRoYXQucG9zaXRpb24ueTsKICAgIGFybS5kaW1lbnNpb24gPSB0aGF0LmRpbWVuc2lvbjsKICAgIGFybS5zY2FsZSA9IDAuOTsKICAgIGFybS5zY2FsZVogPSAwLjAxOwogICAgYXJtLmNvbG9yID0gImNsZWFyIjsKICAgIGFybS5zdHJva2VDb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7CiAgICBhcm0ubGluZUNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKICAgIGFybS5saW5lVG8gPSBsaW5rcy5hYkJvdC5pZDsKICAgIGFybS5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKICAgIGFybS5vbkNsaWNrID0gYEAgZGVzdHJveSh0aGlzQm90KTsKCiAgICBsaW5rcy5tYW5hZ2VyLmFiTWFuaWZlc3RCb3Qoe2RpbWVuc2lvbjogdGFncy5kaW1lbnNpb24sIHBvc2l0aW9uOnt4OnRhZ3NbdGFncy5kaW1lbnNpb24gKyAiWCJdLHk6dGFnc1t0YWdzLmRpbWVuc2lvbiArICJZIl19fSk7YDsKCiAgICBsZXQgbmV3QXJtID0gYXdhaXQgY3JlYXRlKGFybSk7CgogICAgbGlua3MuYWJCb3QubWFza3MuYXJtID0gIvCflJciICsgbmV3QXJtLmlkOwoKICAgIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiR3JpZEZvY3VzID0ge2RpbWVuc2lvbjogdGhhdC5kaW1lbnNpb24sIHBvc2l0aW9uOiB7eDogdGhhdC5wb3NpdGlvbi54LCB5OiB0aGF0LnBvc2l0aW9uLnl9fTsKCiAgICB0aGlzQm90LmFiQ2xpY2soe21lbnU6ICJncmlkIn0pOwoKICAgIHJldHVybjsKfQoKbGV0IGZvb3RwcmludCA9IHt9OwoKZm9vdHByaW50LnNwYWNlID0gInRlbXBMb2NhbCI7CmZvb3RwcmludFt0aGF0LmRpbWVuc2lvbl0gPSB0cnVlOwpmb290cHJpbnQuZGltZW5zaW9uID0gdGhhdC5kaW1lbnNpb247CmZvb3RwcmludFt0aGF0LmRpbWVuc2lvbiArICJYIl0gPSB0aGF0LnBvc2l0aW9uLng7CmZvb3RwcmludFt0aGF0LmRpbWVuc2lvbiArICJZIl0gPSB0aGF0LnBvc2l0aW9uLnk7CmZvb3RwcmludC5zY2FsZVogPSAwLjAxOwpmb290cHJpbnQub25DbGljayA9IGBAIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gZmFsc2U7CgpsaW5rcy5tYW5hZ2VyLmFiTWFuaWZlc3RCb3QodGFncy5wb3NpdGlvbkluZm8pOwpgOwpmb290cHJpbnQucG9zaXRpb25JbmZvID0gdGhhdDsKZm9vdHByaW50LmNvbG9yID0gImNsZWFyIjsKZm9vdHByaW50LnN0cm9rZUNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKZm9vdHByaW50LmRyYWdnYWJsZSA9IGZhbHNlOwpmb290cHJpbnQubWFuYWdlciA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7CmZvb3RwcmludC5vbkNyZWF0ZSA9IGBAIHNldFRpbWVvdXQoKCkgPT4gZGVzdHJveSh0aGlzQm90KSwgODAwKTsKCiAgICBhd2FpdCBhbmltYXRlVGFnKHRoaXNCb3QsIHsKICAgICAgICBmcm9tVmFsdWU6IHsKICAgICAgICAgICAgc2NhbGVYOiAwLjEsCiAgICAgICAgICAgIHNjYWxlWTogMC4xCiAgICAgICAgfSwKICAgICAgICB0b1ZhbHVlOiB7CiAgICAgICAgICAgIHNjYWxlWDogMS4xLAogICAgICAgICAgICBzY2FsZVk6IDEuMQogICAgICAgIH0sCiAgICAgICAgZHVyYXRpb246IDAuNSwKICAgICAgICBlYXNpbmc6IHsKICAgICAgICAgICAgdHlwZTogImVsYXN0aWMiLAogICAgICAgICAgICBtb2RlOiAib3V0IgogICAgICAgIH0KICAgIH0pLmNhdGNoKGUgPT4ge30pOwpgOwoKY3JlYXRlKGZvb3RwcmludCk7JwCO9ZiADPuHAQRtZW51AgQAjvWYgAyBsAEo8J+Ul2IzMGM2YzVkLWE0ZjctNDI2Ni1iYTM4LTM5M2RjOTVlMWVjYicAjvWYgAz7hwEHYWJDbGljawIEAI71mIAMqLAB3wlAaWYgKCFsaW5rcy5hYkJvdCkKewogICAgcmV0dXJuOwp9Cgpjb25zdCBtZW51VHlwZSA9IHRoYXQgPyB0aGF0Lm1lbnUgOiAiY29yZSI7CmNvbnN0IHN0YXRlID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiU2hpZnQiKTsKCmlmIChsaW5rcy5hYkJvdC50YWdzLmludGVydmFsIHx8IHN0YXRlKQp7CiAgICBjb25zdCBhYk1lbnVCb3RzID0gZ2V0Qm90cygiYWJNZW51IiwgdHJ1ZSk7CgogICAgd2hpc3BlcihhYk1lbnVCb3RzLCAiYWJNZW51UmVmcmVzaCIpOwogICAgCiAgICBjbGVhckludGVydmFsKGxpbmtzLmFiQm90LnRhZ3MuaW50ZXJ2YWwpOwoKICAgIGxpbmtzLmFiQm90Lm1hc2tzLmludGVydmFsID0gbnVsbDsKCiAgICBjbGVhckFuaW1hdGlvbnMobGlua3MuYWJCb3QpOwoKICAgIGNvbnN0IHJvdFogPSBsaW5rcy5hYkJvdC50YWdzLmRpbWVuc2lvbiArICJSb3RhdGlvbloiOwoKICAgIGlmIChzdGF0ZSAmJiBtZW51VHlwZSA9PSAiY29yZSIpCiAgICB7CiAgICAgICAgbGlua3MubWVudS5hYkVudmlyb25tZW50TWVudSgpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGxpbmtzLm1lbnUuYWJPcGVuTWVudShtZW51VHlwZSk7CiAgICB9CgogICAgYXdhaXQgYW5pbWF0ZVRhZyhsaW5rcy5hYkJvdCwKICAgIHsKICAgICAgICBmcm9tVmFsdWU6IHsKICAgICAgICAgICAgW3JvdFpdOiBsaW5rcy5hYkJvdC50YWdzW3JvdFpdLAogICAgICAgICAgICBzY2FsZTogbGlua3MuYWJCb3QudGFncy5zY2FsZQogICAgICAgIH0sCiAgICAgICAgdG9WYWx1ZTogewogICAgICAgICAgICBbcm90Wl06IDAsCiAgICAgICAgICAgIHNjYWxlOiAwLjkKICAgICAgICB9LAogICAgICAgIGVhc2luZzogewogICAgICAgICAgICB0eXBlOiAic2ludXNvaWRhbCIsCiAgICAgICAgICAgIG1vZGU6ICJpbm91dCIKICAgICAgICB9LAogICAgICAgIGR1cmF0aW9uOiAwLjUKICAgIH0pLmNhdGNoKGUgPT4ge30pOwp9CmVsc2UKewogICAgbGlua3MuYWJCb3QuYW5pbWF0ZUJvdCgpOwoKICAgIGxpbmtzLmFiQm90Lm1hc2tzLmxpbmVUbyA9IG51bGw7CgogICAgaWYgKGxpbmtzLmFiQm90LnRhZ3MuYXJtKQogICAgewogICAgICAgIGRlc3Ryb3kobGlua3MuYWJCb3QubGlua3MuYXJtKTsKICAgIH0KCiAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKICAgIGxpbmtzLmFiQm90Lm1hc2tzLmludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4gbGlua3MuYWJCb3QuYW5pbWF0ZUJvdCgpLCAyMDAwKTsKfScAjvWYgAz7hwEbYWJNYW5pZmVzdFN0YXRlQXdha2VPbkVudGVyAgQAjvWYgAyIugH0AUBsaW5rcy5yZW1lbWJlci50YWdzLmFiQXdha2VTdGF0ZSA9IHRydWU7CgpsZXQgZGltZW5zaW9uID0gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsIDogY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbDsKCmlmICghZGltZW5zaW9uKQp7CiAgICByZXR1cm47Cn0KCnRoaXNCb3QuYWJNYW5pZmVzdEJvdCh7ZGltZW5zaW9uOiBkaW1lbnNpb24sIHBvc2l0aW9uOiB7eDogMCwgeTogMH19KTsnAI71mIAM+4cBDG9uQW55Qm90RHJhZwIEAI71mIAM/bsB0wdAaWYgKHRoYXQuYm90ICE9IGxpbmtzLmFiQm90KSByZXR1cm47CgppZiAobGlua3MuYWJCb3QudGFncy5hcm0pCnsKICAgIGRlc3Ryb3kobGlua3MuYWJCb3QubGlua3MuYXJtKTsKfQoKaWYgKCF0aGF0LmJvdC50YWdzLmludGVydmFsKQp7CiAgICB0aGlzQm90LmFiQ2xpY2soKTsKfQoKbGV0IHN0YXRlID0gb3MuZ2V0SW5wdXRTdGF0ZSgia2V5Ym9hcmQiLCAiU2hpZnQiKTsKbGV0IGFybSA9IHt9OwoKYXJtLnNwYWNlID0gInRlbXBMb2NhbCI7CmFybVt0aGF0LmZyb20uZGltZW5zaW9uXSA9IHRydWU7CmFybS5jcmVhdG9yID0gbGlua3MuYWJCb3QuaWQ7CmFybS5kaW1lbnNpb24gPSB0aGF0LmZyb20uZGltZW5zaW9uOwphcm0uc2NhbGUgPSAwLjk7CmFybS5zY2FsZVogPSAwLjAxOwphcm0uY29sb3IgPSAiY2xlYXIiOwphcm0uc3Ryb2tlQ29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwphcm0ubGluZUNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKYXJtLmxpbmVUbyA9IHRoYXQuYm90LmlkOwphcm0ubWFuYWdlciA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7CmFybS5vbkNsaWNrID0gYEAgZGVzdHJveSh0aGlzQm90KTsKCmxpbmtzLm1hbmFnZXIuYWJNYW5pZmVzdEJvdCh7ZGltZW5zaW9uOiB0YWdzLmRpbWVuc2lvbiwgcG9zaXRpb246e3g6dGFnc1t0YWdzLmRpbWVuc2lvbiArICJYIl0seTp0YWdzW3RhZ3MuZGltZW5zaW9uICsgIlkiXX19KTtgOwoKaWYgKHN0YXRlKQp7CiAgICBhcm0ubXVsdGlTZWxlY3QgPSB0cnVlOwogICAgYXJtLmZvcm0gPSAic3BoZXJlIjsKICAgIGFybS5jb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlU3Ryb2tlQ29sb3I7Cn0KCmxldCBuZXdBcm0gPSBhd2FpdCBjcmVhdGUoYXJtKTsKCmxpbmtzLmFiQm90Lm1hc2tzLmFybSA9ICLwn5SXIiArIG5ld0FybS5pZDsKCm9zLnJlcGxhY2VEcmFnQm90KG5ld0FybSk7JwCO9ZiADPuHARFvbkFueUJvdERyb3BFbnRlcgIEAI71mIAMzcMBuQdAaWYgKCF0YWdzLmFiQm90KSByZXR1cm47CmlmIChsaW5rcy5hYkJvdC5saW5rcy5hcm0gIT0gdGhhdC5kcmFnQm90KSByZXR1cm47CgppZiAobGlua3MuYWJCb3QubGlua3MuYXJtLnRhZ3MubXVsdGlTZWxlY3QpCnsKICAgIGlmIChBcnJheS5pc0FycmF5KGxpbmtzLmFiQm90LnRhZ3MubGluZVRvKSkKICAgIHsKICAgICAgICBsaW5rcy5hYkJvdC5tYXNrcy5saW5lVG8ucHVzaCh0aGF0LnRvLmJvdC5pZCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbGlua3MuYWJCb3QubWFza3MubGluZVRvID0gW3RoYXQudG8uYm90LmlkXTsKICAgIH0KCiAgICBsZXQgbmV3TGluazsKCiAgICBpZiAoIWxpbmtzLmFiQm90LmxpbmtzLmFybS50YWdzLnNlbGVjdGVkQm90cykKICAgIHsKICAgICAgICBuZXdMaW5rID0gZ2V0TGluayh0aGF0LnRvLmJvdCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbGV0IHByZXZpb3VzTGlua0JvdHMgPSBsaW5rcy5hYkJvdC5saW5rcy5hcm0ubGlua3Muc2VsZWN0ZWRCb3RzOwoKICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocHJldmlvdXNMaW5rQm90cykpCiAgICAgICAgewogICAgICAgICAgICBwcmV2aW91c0xpbmtCb3RzID0gW3ByZXZpb3VzTGlua0JvdHNdCiAgICAgICAgfQoKICAgICAgICBwcmV2aW91c0xpbmtCb3RzLnB1c2godGhhdC50by5ib3QpOwoKICAgICAgICBuZXdMaW5rID0gZ2V0TGluayhwcmV2aW91c0xpbmtCb3RzKTsKICAgIH0KCiAgICBsaW5rcy5hYkJvdC5saW5rcy5hcm0udGFncy5zZWxlY3RlZEJvdHMgPSBuZXdMaW5rOwp9CmVsc2UKewogICAgbGlua3MuYWJCb3QubGlua3MuYXJtLm1hc2tzLnN0cm9rZUNvbG9yID0gImNsZWFyIjsKICAgIGxpbmtzLmFiQm90LmxpbmtzLmFybS5tYXNrcy5saW5lVG8gPSBmYWxzZTsKCiAgICBsaW5rcy5hYkJvdC5tYXNrcy5saW5lVG8gPSB0aGF0LnRvLmJvdC5pZDsKfScAjvWYgAz7hwEQb25BbnlCb3REcm9wRXhpdAIEAI71mIAMh8sBmwJAaWYgKCF0YWdzLmFiQm90KSByZXR1cm47CmlmIChsaW5rcy5hYkJvdC5saW5rcy5hcm0gIT0gdGhhdC5kcmFnQm90KSByZXR1cm47CgppZiAoIWxpbmtzLmFiQm90LmxpbmtzLmFybS50YWdzLm11bHRpU2VsZWN0KQp7CiAgICBsaW5rcy5hYkJvdC5saW5rcy5hcm0ubWFza3Muc3Ryb2tlQ29sb3IgPSBudWxsOwogICAgbGlua3MuYWJCb3QubGlua3MuYXJtLm1hc2tzLmxpbmVUbyA9IG51bGw7CgogICAgbGlua3MuYWJCb3QubWFza3MubGluZVRvID0gbGlua3MuYWJCb3QubGlua3MuYXJtLmlkOwp9JwCO9ZiADPuHAQxvbkFueUJvdERyb3ACBACO9ZiADKPNAZkGQGlmICghdGFncy5hYkJvdCkgcmV0dXJuOwppZiAoIWxpbmtzLmFiQm90KSByZXR1cm47CmlmICghbGlua3MuYWJCb3QudGFncy5hcm0pIHJldHVybjsKaWYgKGxpbmtzLmFiQm90LmxpbmtzLmFybSAhPSB0aGF0LmRyYWdCb3QpIHJldHVybjsKCmlmIChsaW5rcy5hYkJvdC5saW5rcy5hcm0udGFncy5tdWx0aVNlbGVjdCkKewogICAgbGlua3MucmVtZW1iZXIubWFza3MuYWJNdWx0aXBsZUJvdEZvY3VzID0gbGlua3MuYWJCb3QubGlua3MuYXJtLnRhZ3Muc2VsZWN0ZWRCb3RzOwoKICAgIHRoaXNCb3QuYWJDbGljayh7bWVudTogIm11bHRpcGxlQm90In0pOwoKICAgIGRlc3Ryb3kobGlua3MuYWJCb3QubGlua3MuYXJtKTsKfQplbHNlIGlmICh0aGF0LnRvLmJvdCkKewogICAgaWYgKHRoYXQudG8uYm90ID09IGxpbmtzLmFiQm90KQogICAgewogICAgICAgIGxpbmtzLm1lbnUuYWJFbnZpcm9ubWVudE1lbnUoKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYkJvdEZvY3VzID0gIvCflJciICsgdGhhdC50by5ib3QuaWQ7CgogICAgICAgIHRoaXNCb3QuYWJDbGljayh7bWVudTogImJvdCJ9KTsKICAgIH0KCiAgICBkZXN0cm95KGxpbmtzLmFiQm90LmxpbmtzLmFybSk7Cn0KZWxzZQp7CiAgICBsaW5rcy5yZW1lbWJlci5tYXNrcy5hYkdyaWRGb2N1cyA9IHtkaW1lbnNpb246IHRoYXQudG8uZGltZW5zaW9uLCBwb3NpdGlvbjoge3g6IHRoYXQudG8ueCwgeTogdGhhdC50by55fX07CgogICAgdGhpc0JvdC5hYkNsaWNrKHttZW51OiAiZ3JpZCJ9KTsKfScAjvWYgAz7hwEIYWJJZ25vcmUCBACO9ZiADLvTAQR0cnVlKACO9ZiADPuHAQxhYkJvdFZlcnNpb24BfYABJwCO9ZiADPuHAQNhc2sCBACO9ZiADMHTASjwn5SXZWM4NWMxZDYtOWYxYS00MGQ0LTgyZTEtNWJkNjgwMzQ5YzI3JwCO9ZiADPuHAQlhc2tCdXR0b24CBACO9ZiADOjTAdkFQGlmICghbGlua3MucmVtZW1iZXIudGFncy5hYkF3YWtlU3RhdGUpCnsKICAgIHJldHVybjsKfQoKbGV0IGFiTWVudUJ1dHRvbiA9IHt9OwoKYWJNZW51QnV0dG9uLmFiTWVudSA9IHRydWU7CmFiTWVudUJ1dHRvbi5yZW1lbWJlciA9IGxpbmtzLm1lbnUudGFncy5yZW1lbWJlcjsKYWJNZW51QnV0dG9uLm1hbmlmZXN0YXRpb24gPSBsaW5rcy5tZW51LnRhZ3MubWFuaWZlc3RhdGlvbjsKYWJNZW51QnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CmFiTWVudUJ1dHRvbi5iYXNlU2tpbGwgPSAi8J+UlyIgKyBsaW5rcy5hc2suaWQ7CmFiTWVudUJ1dHRvbi5sYWJlbCA9IGxpbmtzLmFzay50YWdzLmFiQ29yZU1lbnVMYWJlbDsKYWJNZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gbGlua3MuYXNrLnRhZ3MuYWJDb3JlTWVudUljb247CmFiTWVudUJ1dHRvbi5vbkNyZWF0ZSA9IGxpbmtzLmFzay50YWdzLmFiQ29yZU1lbnVPbkdlbmVyYXRlOwphYk1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gbGlua3MuYXNrLnRhZ3MuYWJDb3JlTWVudVNvcnRPcmRlcjsKYWJNZW51QnV0dG9uLmNvbG9yID0gbGlua3MuYXNrLnRhZ3MuYWJDb3JlTWVudUNvbG9yID8gbGlua3MuYXNrLnRhZ3MuYWJDb3JlTWVudUNvbG9yIDogbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKGFiTWVudUJ1dHRvbik7JwCO9ZiADPuHAQlhYkJvdENoYXQCBACO9ZiADMDZAcELQGlmICghbGlua3MuYWJCb3QgJiYgIXRoYXQuYm90KQp7CiAgICByZXR1cm47Cn0KCmNvbnN0IGJvdEJhc2UgPSB0aGF0LmJvdCA/IHRoYXQuYm90OiBsaW5rcy5hYkJvdDsKY29uc3QgZGltZW5zaW9uID0gIXRoYXQuYm90ID8gYm90QmFzZS50YWdzLmRpbWVuc2lvbiA6IHRoYXQuZGltZW5zaW9uID8gdGhhdC5kaW1lbnNpb24gOiBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsOwpjb25zdCBtZXNzYWdlID0gdGhhdC5tZXNzYWdlOwpjb25zdCBtZXNzYWdlVGltZSA9IHRoYXQudGltZSA/IHRoYXQudGltZSAqIDEwMDAgOiAxNjAwOyAKY29uc3QgbWVzc2FnZUJvdCA9IHt9OwoKbWVzc2FnZUJvdC5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwptZXNzYWdlQm90LnRyYW5zZm9ybWVyID0gYm90QmFzZS5pZDsKbWVzc2FnZUJvdC5mb3JtID0gInNwcml0ZSI7Cm1lc3NhZ2VCb3QuY29sb3IgPSAiIzAwMDAwMCI7Cm1lc3NhZ2VCb3QubGFiZWwgPSBtZXNzYWdlOwptZXNzYWdlQm90LmxhYmVsQ29sb3IgPSAiI2ZmZmZmZiI7Cm1lc3NhZ2VCb3QubGFiZWxTaXplID0gMTsKbWVzc2FnZUJvdC5zY2FsZVggPSBtZXNzYWdlLmxlbmd0aCAvIDUgPiAxMCA/IDEwIDogbWVzc2FnZS5sZW5ndGggPCAxMCA/IDIgOiBtZXNzYWdlLmxlbmd0aCAvIDU7Cm1lc3NhZ2VCb3Quc2NhbGVZID0gKG1lc3NhZ2UubGVuZ3RoIC8gNTApID4gMSA/IE1hdGgucm91bmQobWVzc2FnZS5sZW5ndGggLyA1MCkgOiAxLjMzOwptZXNzYWdlQm90LnNjYWxlWiA9IDAuMTsKbWVzc2FnZUJvdC5vcmllbnRhdGlvbk1vZGUgPSAiYmlsbGJvYXJkIjsKbWVzc2FnZUJvdFtkaW1lbnNpb25dID0gdHJ1ZTsKbWVzc2FnZUJvdC5kaW1lbnNpb24gPSBkaW1lbnNpb247Cm1lc3NhZ2VCb3RbZGltZW5zaW9uICsgIlgiXSA9IDA7Cm1lc3NhZ2VCb3RbZGltZW5zaW9uICsgIlkiXSA9IDA7Cm1lc3NhZ2VCb3RbZGltZW5zaW9uICsgIloiXSA9IGJvdEJhc2UudGFncy5zY2FsZSA/IGJvdEJhc2UudGFncy5zY2FsZSAvIDIgKyAyIDogMjsKbWVzc2FnZUJvdC5vbkZhZGUgPSBgQCBhd2FpdCBhbmltYXRlVGFnKHRoaXNCb3QsIHsKICAgIGZyb21WYWx1ZTogewogICAgICAgIGZvcm1PcGFjaXR5OiAxLAogICAgICAgIGxhYmVsT3BhY2l0eTogMSwKICAgICAgICBbdGFncy5kaW1lbnNpb24gKyAiWiJdOiB0YWdzW3RhZ3MuZGltZW5zaW9uICsgIloiXQogICAgfSwKICAgIHRvVmFsdWU6IHsKICAgICAgICBmb3JtT3BhY2l0eTogMCwKICAgICAgICBsYWJlbE9wYWNpdHk6IDAsCiAgICAgICAgW3RhZ3MuZGltZW5zaW9uICsgIloiXTogdGFnc1t0YWdzLmRpbWVuc2lvbiArICJaIl0gKyA1CiAgICB9LAogICAgZHVyYXRpb246IDMKfSkuY2F0Y2goe30pOwoKZGVzdHJveSh0aGlzQm90KTtgOwoKY29uc3QgYWN0aXZlTWVzc2FnZSA9IGNyZWF0ZShtZXNzYWdlQm90KTsKCnNldFRpbWVvdXQoKCk9PiBhY3RpdmVNZXNzYWdlLm9uRmFkZSgpLCBtZXNzYWdlVGltZSk7AA=="}]}