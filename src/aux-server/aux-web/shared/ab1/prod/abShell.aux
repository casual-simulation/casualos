{"version":2,"updates":[{"id":0,"timestamp":1694179577973,"update":"AZgB/8j5IQAnAQRib3RzJDAyODM2NWE0LTAzNmYtNDFkMC05YWYxLTcxNWFkNGYyYWE3YQEnAP/I+SEABnN5c3RlbQIEAP/I+SEBEWFiLnNoZWxsLnJlZ3VsYXRlJwD/yPkhAARmb3JtAgQA/8j5IRMHbm90aGluZycA/8j5IQAMb25BbnlCb3REcmFnAgQA/8j5IRu7AUAvL2NvbnRyb2xzIGdyaWQgc25hcAppZiAobGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGUpCnsKICAgIG9zLmFkZERyb3BTbmFwKCJncmlkIik7Cn0KCi8vY29udHJvbHMgYm90IHNuYXAKaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGUpCnsKICAgIG9zLmFkZERyb3BTbmFwKCJmYWNlIik7Cn0nAP/I+SEACHJlbWVtYmVyAgQA/8j5IdcBKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAP/I+SEACGFiSWdub3JlAgQA/8j5If4BBHRydWUoAP/I+SEADGFiQm90VmVyc2lvbgF9PScA/8j5IQAHYWJTaGVsbAIEAP/I+SGEAgR0cnVlJwEEYm90cyQzNGMzYzIxMC01YmYxLTQ5Y2YtYjE1MS1lZTJkMDdmMGU2NzMBJwD/yPkhiQIGc3lzdGVtAgQA/8j5IYoCD2FiLnNoZWxsLmNyZWF0ZScA/8j5IYkCBGZvcm0CBAD/yPkhmgIHbm90aGluZycA/8j5IYkCC2Rlc2NyaXB0aW9uAgQA/8j5IaICPUJvdCB1c2VkIHRvIGNyZWF0ZS9tYW5pZmVzdCBib3RzIGludG8gYW4gYWN0dWFsIHNjZW5lL3BvcnRhbC4nAP/I+SGJAgxhYkNyZWF0ZUJvdHMCBAD/yPkh4AKAGkAvL0RFViBOT1RFOiBORUVEIFRPIFVOREVSU1RBTkQgV0hBVCBUTyBETyBJRiBBTiBBUlJBWSBJUyBHSVZFTgoKLy9jaGVja3MgZm9yIGluaXRpYWwgYm9vdCBib29sZWFuCmxldCBpbml0aWFsQm9vdCA9IHRoYXQuaW5pdGlhbEJvb3Q7Ci8vYm90cyB0byBiZSBnZW5lcmF0ZWQKbGV0IGJvdERhdGEgPSB0aGF0LmJvdHM7Ci8vd2hlcmUgZGlkIHRoZSBkYXRhIGNvbWUgZnJvbSAob3B0aW9uYWwpCmxldCBvcmlnaW4gPSB0aGF0Lm9yaWdpbjsKLy92ZXJzaW9uIG9mIHRoZSBkYXRhIChvcHRpb25hbCkKbGV0IHZlcnNpb24gPSB0aGF0LnZlcnNpb247Ci8vaWRNYXAgYW5kIG5ld0JvdHMgYXJlIHVzZWQgdG8gbWFuYWdlIHRoZSBpbmNvbWluZyBib3QgZGF0YQpsZXQgaWRNYXAgPSBuZXcgTWFwKCk7CmxldCBuZXdCb3RzID0gW107CgovL3RoaXMgbG9vcCBjcmVhdGVzIHRoZSBuZXcgYm90cyBhbmQgdGhlbiBwYWNrYWdlcyB0aGVtIGZvciBhZGRpdGlvbmFsIHByb2Nlc3NpbmcsIHdoaWxlIGFkZGluZyBhbnkgbmVlZGVkIGFkZGl0aW9uYWwgdGFncwpmb3IgKGNvbnN0IHByb3BlcnR5IGluIGJvdERhdGEpCnsKICAgIGNvbnN0IG5ld0JvdCA9IGJvdERhdGFbcHJvcGVydHldOwogICAgY29uc3QgYm90VG90YWwgPSBPYmplY3Qua2V5cyhib3REYXRhKS5sZW5ndGg7CiAgICBjb25zdCBhYklET3JpZ2luID0ge2FiSURPcmlnaW46IG9yaWdpbn07CiAgICBjb25zdCBhYkdyaWRGb2N1cyA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXM7CgogICAgaWYgKG5ld0JvdC50YWdzKSAKICAgIHsKICAgICAgICBpZiAobmV3Qm90LnRhZ3MuY3JlYXRvcikgCiAgICAgICAgewogICAgICAgICAgICBhYklET3JpZ2luLm9sZENyZWF0b3IgPSBuZXdCb3QudGFncy5jcmVhdG9yOwogICAgICAgIH0KCiAgICAgICAgbGV0IHRhcmdldFBvc2l0aW9uOwoKICAgICAgICB0cnkgCiAgICAgICAgewogICAgICAgICAgICBpZiAoYm90VG90YWwgPCAyICYmIGFiR3JpZEZvY3VzKSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGV0IHRhcmdldERpbWVuc2lvbiA9IGFiR3JpZEZvY3VzLmRpbWVuc2lvbjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGFyZ2V0UG9zaXRpb24gPSB7IFt0YXJnZXREaW1lbnNpb25dOiB0cnVlLCBbdGFyZ2V0RGltZW5zaW9uICsgIlgiXTogYWJHcmlkRm9jdXMucG9zaXRpb24ueCwgW3RhcmdldERpbWVuc2lvbiArICJZIl06IGFiR3JpZEZvY3VzLnBvc2l0aW9uLnkgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGV0IGIgPSBjcmVhdGUobmV3Qm90LnRhZ3MsIHRhcmdldFBvc2l0aW9uLCBhYklET3JpZ2luKTsKCiAgICAgICAgICAgIGlkTWFwLnNldChwcm9wZXJ0eSwgYi5pZCk7CiAgICAgICAgICAgIG5ld0JvdHMucHVzaChiKTsKCiAgICAgICAgICAgIGlmIChiLnRhZ3MuY3JlYXRvciA9PSB0aGlzQm90LmlkKSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgYi50YWdzLmNyZWF0b3IgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNhdGNoIChlcnJvcikgCiAgICAgICAgewogICAgICAgICAgICBjb25zb2xlLmxvZygiaW52YWxpZCBib3QiLCBlcnJvcik7CiAgICAgICAgfQogICAgfQogICAgZWxzZSAKICAgIHsKICAgICAgICBjb25zb2xlLmxvZygic2tpcHBlZCBib3Q6ICIgKyBuZXdCb3QpOwogICAgfQp9CgovL2FycmF5IG9mIHRhZyByZWxhdGlvbnNoaXBzIHRvIGJlIHByZXNlcnZlZApsZXQgbGlua1RhZ3MgPSBbImxpbmsiLCAiY3JlYXRvciIsICJjb25maWdCb3QiLCAibGluZVRvIiwgInRyYW5zZm9ybWVyIl07CgovL3RoaXMgbG9vcCBjb250YWlucyB0aGUgbG9naWMgZm9yIHByZXNlcnZpbmcgdGhlIGxpbmtUYWdzCmZvciAobGV0IG5ld0JvdCBvZiBuZXdCb3RzKSAKewogICAgZm9yIChsZXQgdGFnIG9mIGxpbmtUYWdzKSAKICAgIHsKICAgICAgICBsZXQgdmFsdWUgPSBuZXdCb3QudGFnc1t0YWddOwoKICAgICAgICBpZiAodGFnID09ICJjcmVhdG9yIikgCiAgICAgICAgewogICAgICAgICAgICB2YWx1ZSA9IG5ld0JvdC50YWdzLm9sZENyZWF0b3I7CiAgICAgICAgICAgIG5ld0JvdC50YWdzLm9sZENyZWF0b3IgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgdXBkYXRlQm90TGlua3MobmV3Qm90LCBpZE1hcCk7CgogICAgICAgIGlmICh2YWx1ZSkgCiAgICAgICAgewogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsZXQgbmV3VmFsdWUgPSB2YWx1ZS5tYXAoaWQgPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiBpZE1hcC5nZXQoaWQpIHx8IGlkOwogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBuZXdCb3QucmF3W3RhZ10gPSBuZXdWYWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdJRCA9IGlkTWFwLmdldCh2YWx1ZSk7CgogICAgICAgICAgICAgICAgaWYgKG5ld0lEKSAKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBuZXdCb3QucmF3W3RhZ10gPSBuZXdJRDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKLy90b2FzdHMgZm9yIGhhdGNoZXMsIGJ1dCBvbmx5IG9uIGJ1aWxkZXIKaWYgKGNvbmZpZ0JvdC50YWdzLmFiU2lsZW50TW9kZSA9PSBudWxsICYmICFjb25maWdCb3QudGFncy5waCAmJiBidWlsZGVyVmVyc2lvbiA9PSAiYnVpbGRlciIpIAp7CiAgICBvcy50b2FzdCgiaGF0Y2hlZCAiICsgb3JpZ2luICsgIiB2IiArIHZlcnNpb24pOwp9CgovL2FkZGl0aW9uYWwgaGF0Y2ggZGF0YQpjb25maWdCb3QudGFncy5sYXN0RWdnSGF0Y2hlZCA9IG9yaWdpbjsKCi8vaW5pdGlhbCBib290IGxvZ2ljCmlmIChpbml0aWFsQm9vdCkgCnsKICAgIGxldCBwcmVoYXRjaCA9IGF3YWl0IHNob3V0KCJvblByZUhhdGNoIiwgeyBhYjogb3JpZ2luIH0pWzBdOwoKICAgIGlmICghcHJlaGF0Y2gpIAogICAgewogICAgICAgIGFiSW5zdE1lbW9yeS50YWdzLmJhc2VBQiA9IG9yaWdpbjsKICAgIH0KICAgIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCID0gb3JpZ2luOwp9CgovL29uRWdnSGF0Y2ggZm9yIGFsbCBqdXN0IGhhdGNoZWQgYm90cwp3aGlzcGVyKG5ld0JvdHMsICJvbkVnZ0hhdGNoIiwge2FiOiBvcmlnaW4sIHZlcnNpb246IHZlcnNpb259KTsKCi8vb25BYkFkZGVkIGZvciBhbGwgYm90cyBpbiB0aGUgZXhwZXJpZW5jZQpzaG91dCgib25BYkFkZGVkIiwge2FiOiBvcmlnaW4sIHZlcnNpb246IHZlcnNpb259KTsnAP/I+SGJAghyZW1lbWJlcgIEAP/I+SHhHCjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwD/yPkhiQIJb25BYkFkZGVkAgQA/8j5IYgdckAvL3Nob3V0KCJvbkFiQWRkZWQiLCB7YWI6IG9yaWdpbiwgdmVyc2lvbjogdmVyc2lvbn0pOwoKY29uc29sZS5sb2coImFiOiAiICsgdGhhdC5hYiwgInZlcnNpb246ICIgKyB0aGF0LnZlcnNpb24pOycA/8j5IYkCCGFiSWdub3JlAgQA/8j5IfsdBHRydWUoAP/I+SGJAgxhYkJvdFZlcnNpb24BfT0nAP/I+SGJAgdhYlNoZWxsAgQA/8j5IYEeBHRydWUnAQRib3RzJDc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZgEnAP/I+SGGHgZzeXN0ZW0CBAD/yPkhhx4OYWIuc2hlbGwuc3RvcmUnAP/I+SGGHgRmb3JtAgQA/8j5IZYeB25vdGhpbmcnAP/I+SGGHgtkZXNjcmlwdGlvbgIEAP/I+SGeHj9UaGlzIHNraWxsIGlzIG1lYW50IHRvIGJlIGEgY29uZmlndXJhYmxlIG1lYW5zIHRvIHB1Ymxpc2ggZGF0YS4nAP/I+SGGHg9hYlB1Ymxpc2hSZWNvcmQCBAD/yPkh3h7RA0BsZXQgcmVjb3JkRGF0YSA9IHRoYXQuZGF0YTsKbGV0IHJlY29yZE5hbWUgPSB0aGF0LnJlY29yZE5hbWU7CmxldCB1cGRhdGVQb2xpY3kgPSBjb25maWdCb3QudGFncy5zZWFjdXJlQUIgPyBbY29uZmlnQm90LmlkXSA6IHRoYXQudXBkYXRlUG9saWN5ID8gdGhhdC51cGRhdGVQb2xpY3kgOiBudWxsOwpsZXQgZW5kcG9pbnQgPSB0aGF0LmVuZHBvaW50ID8gdGhhdC5lbmRwb2ludCA6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJFbmRwb2ludDsKCmlmICghcmVjb3JkRGF0YSkKewogICAgcmV0dXJuICJubyBkYXRhIHN1cHBsaWVkIjsKfQoKcmVjb3JkRGF0YSA9IGF3YWl0IG9zLnJlY29yZERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYlJlY29yZEtleSwgcmVjb3JkTmFtZSwgcmVjb3JkRGF0YSwge2VuZHBvaW50OiBlbmRwb2ludCwgdXBkYXRlUG9saWN5OiB1cGRhdGVQb2xpY3l9KTsKCnJldHVybiByZWNvcmREYXRhOycA/8j5IYYeDWFiUHVibGlzaEZpbGUCBAD/yPkhsCKDA0BsZXQgZmlsZSA9IHRoYXQuZmlsZTsKbGV0IGZpbGVOYW1lID0gdGhhdC5maWxlTmFtZTsKbGV0IG1pbWVUeXBlID0gdGhhdC5taW1lVHlwZTsKbGV0IHJlY29yZEtleSA9IHRoYXQucmVjb3JkS2V5ID8gdGhhdC5yZWNvcmRLZXkgOiBsaW5rcy5yZW1lbWJlci50YWdzLmFiUmVjb3JkS2V5OwoKaWYgKCFmaWxlKQp7CiAgICByZXR1cm4gIm5vIGZpbGUgc3VwcGxpZWQiOwp9CgpsZXQgZmlsZVVwbG9hZCA9IGF3YWl0IG9zLnJlY29yZEZpbGUobGlua3MucmVtZW1iZXIudGFncy5hYlJlY29yZEtleSwgZmlsZSwge2Rlc2NyaXB0aW9uOiBmaWxlTmFtZSwgbWltZVR5cGU6IG1pbWVUeXBlfSwgbGlua3MucmVtZW1iZXIudGFncy5hYkVuZHBvaW50KTsKCnJldHVybiBmaWxlVXBsb2FkOycA/8j5IYYeEGFiQ29yZU1lbnVBY3Rpb24CBAD/yPkhtCUxQC8vc2V0IHVwIHRoZSBwdWJsaXNoIG1lbnUKdGhpc0JvdC5vblN0b3JlTWVudSgpOycA/8j5IYYeC29uU3RvcmVNZW51AgQA/8j5IeYl4jlAbGV0IHBvc3NpYmxlUHVibGlzaEJvdCA9IGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXM7CgpzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmxpbmtzLm1lbnUubWFza3Mub25HcmlkQ2xpY2sgPSAiQCBzaG91dCgnYWJNZW51UmVmcmVzaCcpOyBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsiOwoKY29uc3QgdXVhYiA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MudXVhYiA/IHRydWUgOiBmYWxzZTsKCmxldCBtZW51QnV0dG9uID0ge307CgptZW51QnV0dG9uLmFiTWVudSA9IHRydWU7Cm1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gOTsKbWVudUJ1dHRvbi5hYk1lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwptZW51QnV0dG9uLmxhYmVsID0gImRvd25sb2FkIjsKbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJnZXRfYXBwIjsKbWVudUJ1dHRvbi5jb2xvciA9ICIjNTVFNjc5IjsKbWVudUJ1dHRvbi5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKbWVudUJ1dHRvbi5tYW5pZmVzdGF0aW9uID0gdGFncy5tYW5pZmVzdGF0aW9uOwptZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLmFiRG93bmxvYWQoKTtgOwoKLy9jcmVhdGUgZG93bmxvYWQgYnV0dG9uCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwoKaWYgKCF1dWFiKQp7CiAgICBtZW51QnV0dG9uLmxhYmVsID0gInB1Ymxpc2ggYWIiOyAKICAgIG1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gMTsKICAgIG1lbnVCdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAiY2VudGVyIjsKICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSBudWxsOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggMHB4IDBweCIsICJtYXJnaW4tdG9wIjogIjZweCJ9YDsKICAgIG1lbnVCdXR0b24uY29sb3IgPSAiIzkwOEJGQyI7CiAgICBtZW51QnV0dG9uLnBvaW50YWJsZSA9IGZhbHNlOwogICAgbWVudUJ1dHRvbi5vbkNsaWNrID0gbnVsbDsKICAgIG1lbnVCdXR0b24uc2NhbGVZID0gMC43NTsKICAgIAogICAgLy9jcmVhdGUgcHVibGlzaCBsYWJlbCBidXR0b24KICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwoKICAgIG1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gMTsKICAgIG1lbnVCdXR0b24ubGFiZWwgPSAiZW5jcnlwdCI7CiAgICBtZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImxlZnQiOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjBweCAwcHggMHB4IDBweCIsICJtYXJnaW4tdG9wIjogIjBweCJ9YDsKICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAiY2hlY2tfYm94X291dGxpbmVfYmxhbmsiOwogICAgbWVudUJ1dHRvbi5lbmNyeXB0U3RhdGUgPSBmYWxzZTsKICAgIG1lbnVCdXR0b24uY29sb3IgPSAiIzkwOEJGQyI7CiAgICBtZW51QnV0dG9uLnNjYWxlWSA9IDE7CiAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBpZih0YWdzLmVuY3J5cHRTdGF0ZSkKICAgIHsKICAgICAgICB0YWdzLmVuY3J5cHRTdGF0ZSA9IGZhbHNlOwogICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgICAgIGNvbmZpZ0JvdC50YWdzLmVuY3J5cHRpb24gPSBudWxsOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHRhZ3MuZW5jcnlwdFN0YXRlID0gdHJ1ZTsKICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveCc7CiAgICAgICAgY29uZmlnQm90LnRhZ3MuZW5jcnlwdGlvbiA9IHRydWU7CiAgICB9YDsKCiAgICAvL2NyZWF0ZSBlbmNyeXB0IGJ1dHRvbgogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7CgogICAgbWVudUJ1dHRvbi5hYk1lbnUgPSBudWxsOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggOXB4IDlweCIsICJtYXJnaW4tdG9wIjogIjZweCJ9YDsKICAgIG1lbnVCdXR0b24uZGltZW5zaW9uID0gImFiTWVudSI7CiAgICBtZW51QnV0dG9uLm9uS2V5RG93biA9IGBACiAgICAgICAgaWYgKHRoYXQua2V5c1swXSA9PSAiU2hpZnQiKQogICAgICAgIHsKICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSB0cnVlOwogICAgICAgIH1gOwogICAgbWVudUJ1dHRvbi5vbktleVVwID0gYEAKICAgICAgICBpZiAodGhhdC5rZXlzWzBdID09ICJTaGlmdCIpCiAgICAgICAgewogICAgICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IGZhbHNlOwogICAgICAgIH1gOwogICAgbWVudUJ1dHRvbi5hYk1lbnVTb3J0T3JkZXIgPSAtMTsKICAgIG1lbnVCdXR0b24uYnV0dG9uU3RhdGUgPSAiYXV0b21hdGljIjsKICAgIG1lbnVCdXR0b24uY29sb3IgPSAiIzkwOEJGQyI7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImNoZWNrX2JveCI7CiAgICBtZW51QnV0dG9uLmxhYmVsID0gImF1dG9tYXRpYyB2ZXJzaW9uIjsKICAgIG1lbnVCdXR0b24ub25DbGljayA9IGBACiAgICAgICAgaWYodGFncy5idXR0b25TdGF0ZSA9PSAnYXV0b21hdGljJykKICAgICAgICB7CiAgICAgICAgICAgIHRhZ3MuYnV0dG9uU3RhdGUgPSAnbWFudWFsJzsKICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnZlcnNpb25EZWZpbmVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgdGFncy5idXR0b25TdGF0ZSA9ICdhdXRvbWF0aWMnOwogICAgICAgICAgICB0YWdzLmxhYmVsID0gJ2F1dG9tYXRpYyB2ZXJzaW9uJzsKICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3gnOwogICAgICAgICAgICBjb25maWdCb3QudGFncy52ZXJzaW9uRGVmaW5lZCA9IG51bGw7CiAgICAgICAgfWA7CgogICAgLy9jcmVhdGUgdmVyc2lvbiBidXR0b24KICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwp9CgptZW51QnV0dG9uLmRpbWVuc2lvbiA9IG51bGw7Cm1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKbWVudUJ1dHRvbi5vbktleURvd24gPSBudWxsOwptZW51QnV0dG9uLm9uS2V5VXAgPSBudWxsOwptZW51QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IDI7Cm1lbnVCdXR0b24uYnV0dG9uU3RhdGUgPSBudWxsOwptZW51QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwptZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImVnZyI7CgppZiAodXVhYikKewogICAgbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9ICJxcl9jb2RlX3NjYW5uZXIiOwogICAgbWVudUJ1dHRvbi5vbkNsaWNrID0gYEAKICAgICAgICB0cnkKICAgICAgICB7CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnV1YWJTY2FuID0gdHJ1ZTsKCiAgICAgICAgICAgIG9zLm9wZW5RUkNvZGVTY2FubmVyKCk7CgogICAgICAgICAgICBvcy50b2FzdCgicGxlYXNlIHNjYW4geW91ciBwcmFjdGljZSBwZXJtaXQiKTsKICAgICAgICB9CiAgICAgICAgY2F0Y2gKICAgICAgICB7CiAgICAgICAgICAgIG9zLnRvYXN0KCJxciBjb2RlIHNjYW4gbm90IHN1cHBvcnRlZCBvbiB0aGlzIGRldmljZSIpOwoKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MudXVhYlNjYW4gPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CiAgICBgOwogICAgbWVudUJ1dHRvbi5sYWJlbCA9ICJwdWJsaXNoIGFiIjsKfQplbHNlCnsKICAgIG1lbnVCdXR0b24ubWVudUl0ZW1TdHlsZSA9IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICIwcHggMHB4IDlweCA5cHgiLCAibWFyZ2luLXRvcCI6ICIwcHgifWA7CiAgICBtZW51QnV0dG9uLmZvcm0gPSAiaW5wdXQiOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVNob3dTdWJtaXRXaGVuRW1wdHkgPSB0cnVlOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVRleHQgPSAhbGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1cyA/IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCIDogbGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1cy5pZDsKICAgIG1lbnVCdXR0b24udGFyZ2V0Qm90ID0gZ2V0TGluayhwb3NzaWJsZVB1Ymxpc2hCb3QpOwogICAgbWVudUJ1dHRvbi5vblN1Ym1pdCA9IGBAIGNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2ggPSB0cnVlOyAgIAoKICAgICAgICBpZiAodGhhdC50ZXh0ID09IG51bGwgJiYgbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIgJiYgIWxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXMpCiAgICAgICAgewogICAgICAgICAgICB0aGF0LnRleHQgPSBsaW5rcy5yZW1lbWJlci50YWdzLmJhc2VBQjsKICAgICAgICB9CgogICAgICAgIGlmICh0aGF0LnRleHQpCiAgICAgICAgewogICAgICAgICAgICBsaW5rcy5tYW5hZ2VyLmFiUHVibGlzaEFCKHthYjogdGhhdC50ZXh0LCBtYW51YWxQdWJsaXNoOiB0cnVlLCBib3Q6IGxpbmtzLnRhcmdldEJvdH0pOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBvcy50b2FzdCgiYWIgbm90IHNwZWNpZmllZCIpOwoKICAgICAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICAgICAgICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwogICAgICAgIH0KICAgIGA7Cn0KCi8vY3JlYXRlIHB1Ymxpc2ggYnV0dG9uCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwoKaWYgKGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXMpCnsKICAgIG1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gODsKICAgIG1lbnVCdXR0b24uZm9ybSA9IG51bGw7CiAgICBtZW51QnV0dG9uLm1lbnVJdGVtU3R5bGUgPSBg8J+nrCB7ImJvcmRlci1yYWRpdXMiOiAiOXB4IDlweCA5cHggOXB4IiwgIm1hcmdpbi10b3AiOiAiNnB4In1gOwogICAgbWVudUJ1dHRvbi5sYWJlbCA9ICJjb3B5IHRvIGNsaXBib2FyZCI7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gImZpbGVfY29weSI7CiAgICBtZW51QnV0dG9uLmNvbG9yID0gIiM1NUU2NzkiOwogICAgbWVudUJ1dHRvbi50YXJnZXRCb3QgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQm90Rm9jdXM7CiAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBsZXQgc2VsZWN0ZWRCb3QgPSBsaW5rcy50YXJnZXRCb3Q7CiAgICBsZXQgcHJlcHBlZEJvdCA9IEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkQm90KTsKICAgIGxldCBzdGF0ZSA9IHt9CgogICAgc3RhdGVbYWJJbnN0TWVtb3J5LnRhZ3MuYWJGb2N1c0RhdGFdID0gc2VsZWN0ZWRCb3Q7CgogICAgbGV0IG5ld0ZpbGUgPSB7fQogICAgbmV3RmlsZS52ZXJzaW9uID0gMTsKICAgIG5ld0ZpbGUuc3RhdGUgPSBzdGF0ZTsKCiAgICB2YXIgZm9ybWF0dGVkRmlsZSA9IEpTT04uc3RyaW5naWZ5KG5ld0ZpbGUpOwoKICAgIG9zLnNldENsaXBib2FyZChmb3JtYXR0ZWRGaWxlKTsKCiAgICBvcy50b2FzdCgiYm90IGNvcGllZCB0byBjbGlwYm9hcmQiKTsKCiAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwogICAgYDsKICAgIAogICAgLy9jcmVhdGUgIGNvcHkgdG8gY2xpcGJvYXJkIGJ1dHRvbgogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24obWVudUJ1dHRvbik7Cn0KZWxzZSBpZiAoIXV1YWIpCnsKICAgIG1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gMTA7CiAgICBtZW51QnV0dG9uLmZvcm0gPSBudWxsOwogICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggOXB4IDlweCIsICJtYXJnaW4tdG9wIjogIjNweCJ9YDsKICAgIG1lbnVCdXR0b24ubGFiZWwgPSAic2NhbiI7CiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gInFyX2NvZGVfc2Nhbm5lciI7CiAgICBtZW51QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwogICAgbWVudUJ1dHRvbi5vbkNsaWNrID0gYEAgY29uZmlnQm90LnRhZ3MucHVibGlzaFNjYW4gPSB0cnVlOyBvcy5vcGVuUVJDb2RlU2Nhbm5lcigpO2A7CgogICAgLy9jcmVhdGUgIHNjYW4gYnV0dG9uCiAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKCiAgICAvL05FRUQgVE8gVVBEQVRFCiAgICBpZiAoY29uZmlnQm90LnRhZ3MuZ2lnKQogICAgewogICAgICAgIG1lbnVCdXR0b24uYWJNZW51U29ydE9yZGVyID0gLTU7CiAgICAgICAgbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0gYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggOXB4IDlweCIsICJtYXJnaW4tdG9wIjogIjZweCJ9YDsKICAgICAgICBtZW51QnV0dG9uLmxhYmVsID0gInN1Ym1pdCBnaWciOwogICAgICAgIG1lbnVCdXR0b24uZm9ybUFkZHJlc3MgPSAic2VuZCI7CiAgICAgICAgbWVudUJ1dHRvbi5jb2xvciA9ICIjOTA4QkZDIjsKICAgICAgICBtZW51QnV0dG9uLm9uQ2xpY2sgPSBgQCBzaG91dCgiYWJDb2xsYWJTdWJtaXQiKTtgOwoKICAgICAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKICAgIH0KfQoKbGV0IGhvc3RCdXR0b24gPSB7fTsKCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRCkKewogICAgaG9zdEJ1dHRvbi5sYWJlbCA9ICJqb2luIGNvZGU6ICIgKyBsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRC5zdWJzdHJpbmcoMCwzKSArICItIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElELnN1YnN0cmluZygzKTsKfQplbHNlCnsKICAgIGhvc3RCdXR0b24ubGFiZWwgPSAiZ2VuZXJhdGUgam9pbiBjb2RlIjsKfQoKaG9zdEJ1dHRvbi5hYk1lbnUgPSB0cnVlOwpob3N0QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IDUwOwpob3N0QnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7Cmhvc3RCdXR0b24uZm9ybUFkZHJlc3MgPSAiZ3JvdXBfYWRkIjsKaG9zdEJ1dHRvbi5jb2xvciA9ICIjOTA4QkZDIjsKaG9zdEJ1dHRvbi5sZWFybiA9IHRhZ3MubGVhcm47Cmhvc3RCdXR0b24ucmVtZW1iZXIgPSB0YWdzLnJlbWVtYmVyOwpob3N0QnV0dG9uLm9uQ2xpY2sgPSBgQCBsaW5rcy5sZWFybi5hYkNyZWF0ZUhvc3QodGhpc0JvdCk7CgppZiAoIWxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEKQp7CiAgICB0YWdzLmxhYmVsID0gJ2dlbmVyYXRpbmcgY29kZSBub3cnOwp9YDsKCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKGhvc3RCdXR0b24pOy8vZ2VuZXJhdGUgYSBob3N0IGJ1dHRvbicA/8j5IYYeDmFiQ29yZU1lbnVJY29uAgQA/8j5IblfCWlvc19zaGFyZScA/8j5IYYeD2FiQ29yZU1lbnVMYWJlbAIEAP/I+SHDXwVzaGFyZScA/8j5IYYeE2FiQ29yZU1lbnVTb3J0T3JkZXICBAD/yPkhyV8BMycA/8j5IYYeCHJlbWVtYmVyAgQA/8j5IctfKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAP/I+SGGHgthYlB1Ymxpc2hBQgIEAP/I+SHyX/MrQC8vc2hvdXQoImFiUHVibGlzaEFCIiwge2FiOiAiIiwga2V5OiAiIiwgdGFyZ2V0OiAiIn0pOwphYi5sb2coImFiIHB1Ymxpc2giKTsKCmxldCBwcm9ncmVzc0J1dHRvbjsKCnNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgovL2NsZWFyIGFiIGJ1aWxkZXIKaWYgKGxpbmtzLm1hbmlmZXN0YXRpb24pCnsKICAgIGlmIChsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KQogICAgewogICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICB9Cn0KCi8vcHJvZ3Jlc3MgYmFyIGZvciBtYW51YWwgcHVibGlzaGluZyBjb25maXJtYXRpb24KaWYgKGNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2gpCnsKICAgIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7CgogICAgbGV0IG1lbnVCdXR0b24gPSB7fTsKCiAgICBtZW51QnV0dG9uLmFiTWVudSA9IHRydWU7CiAgICBtZW51QnV0dG9uLnRyYWNrTnVtID0gLTE7CiAgICBtZW51QnV0dG9uLm9uQ3JlYXRlID0gYEAKICAgIGlmICh0YWdzLnRyYWNrTnVtID09IDIpCiAgICB7CiAgICAgICAgdGFncy50cmFja051bSA9IDA7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgdGFncy50cmFja051bSsrOwogICAgfQoKICAgIHRhZ3MubGFiZWwgPSB0YWdzWyJsYWJlbCIrdGFncy50cmFja051bV07CiAgICB0YWdzLmZvcm1BZGRyZXNzID0gdGFnc1siZm9ybSIrdGFncy50cmFja051bV07CgogICAgc2V0VGltZW91dCgoKSA9PiB3aGlzcGVyKHRoaXNCb3QsICJvbkNyZWF0ZSIpLCA1MDApO2A7CiAgICBtZW51QnV0dG9uLmxhYmVsMCA9ICJ1cGxvYWRpbmcuIjsKICAgIG1lbnVCdXR0b24ubGFiZWwxID0gInVwbG9hZGluZy4uIjsKICAgIG1lbnVCdXR0b24ubGFiZWwyID0gInVwbG9hZGluZy4uLiI7CiAgICBtZW51QnV0dG9uLmZvcm0wID0gImhvdXJnbGFzc19ib3R0b20iOwogICAgbWVudUJ1dHRvbi5mb3JtMSA9ICJob3VyZ2xhc3NfdG9wIjsKICAgIG1lbnVCdXR0b24uZm9ybTIgPSAiaG91cmdsYXNzX2JvdHRvbSI7CiAgICBtZW51QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwogICAgbWVudUJ1dHRvbi5vbkRlc3Ryb3kgPSAiQCBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7IjsKCiAgICBwcm9ncmVzc0J1dHRvbiA9IGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwp9CgovL2FiIHZhcmlhYmxlcwpsZXQgYWJJRCA9IHRoYXQuYWI7CmxldCBrZXkgPSB0aGF0LmtleTsKbGV0IHRhcmdldCA9IHRoYXQudGFyZ2V0ID8gdGhhdC50YXJnZXQgOiB0aGF0LmJvdDsKbGV0IHJldHVyblR5cGUgPSB0aGF0LnJldHVyblR5cGU7CmxldCBzdGF0ZSA9IHt9OwpsZXQgZm9ybWF0dGVkRmlsZSA9IHt9OwoKLy90aGlzIGxvZ2ljIGZvcm1hdHMgdGhlIHNwZWNpZmllZCBib3RzIGFuZCBwYWNrYWdlcyB0aGVtIGZvciBwdWJsaXNoaW5nCmlmICghQXJyYXkuaXNBcnJheSh0YXJnZXQpICYmIHRhcmdldCAhPSBudWxsICYmIHRhcmdldCAhPSB1bmRlZmluZWQpCnsKCn0KZWxzZSBpZiAoIXRhcmdldCB8fCB0YXJnZXQubGVuZ3RoIDwgMSkKewogICAgdGFyZ2V0ID0gZ2V0Qm90cyhieU1vZCh7c3BhY2U6ICJzaGFyZWQiLCBhYklnbm9yZTogbnVsbH0pKTsKCiAgICBpZiAodGFyZ2V0Lmxlbmd0aCA8IDEpCiAgICB7CiAgICAgICAgb3MudG9hc3QoIk5vIGJvdHMgZm91bmQgdG8gcHVibGlzaCIpOwoKICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQp9CgovL3RoaXMgbG9naWMgaGFuZGxlcyBnZW5lcmF0aW5nIGEga2V5IGZvciBlbmNyeXB0aW9uIChvcHRpb25hbCkKaWYgKGNvbmZpZ0JvdC50YWdzLmVuY3J5cHRpb24pCnsKICAgIGxldCBrZXlDaGVjazsKCiAgICBjb25maWdCb3QudGFncy5lbmNyeXB0aW9uID0gbnVsbDsKCiAgICBrZXkgPSBhd2FpdCBvcy5zaG93SW5wdXQoIiIsIHsKICAgICAgICB0eXBlOiAnc2VjcmV0JywKICAgICAgICB0aXRsZTogJ2VudGVyIGEgc2VjcmV0IGtleScKICAgIH0pOwoKICAgIGlmIChrZXkpCiAgICB7CiAgICAgICAga2V5Q2hlY2sgPSBhd2FpdCBvcy5zaG93SW5wdXQoIiIsIHsKICAgICAgICAgICAgdHlwZTogJ3NlY3JldCcsCiAgICAgICAgICAgIHRpdGxlOiAnY29uZmlybSBzZWNyZXQga2V5JwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChrZXkgIT0ga2V5Q2hlY2spIHsKICAgICAgICBpZiAoIWtleUNoZWNrKQogICAgICAgIHsKICAgICAgICAgICAgb3MudG9hc3QoIm5vIGtleSBlbnRlcmVkIik7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIG9zLnRvYXN0KCJrZXlzIGRvIG5vdCBtYXRjaCIpOwogICAgICAgIH0KCiAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CgogICAgICAgIHJldHVybjsKICAgIH0KfQoKLy9mb3JtYXR0aW5nIGJvdHMgZm9yIGZpbGUgc3RvcmFnZQppZiAoQXJyYXkuaXNBcnJheSh0YXJnZXQpKSAKewogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0YXJnZXQubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgY3VycmVudEJvdElEID0gdGFyZ2V0W2ldLmlkOwogICAgICAgIGxldCBjdXJyZW50Qm90ID0gdGFyZ2V0W2ldOwogICAgICAgIAogICAgICAgIHN0YXRlW2N1cnJlbnRCb3RJRF0gPSBjdXJyZW50Qm90OwogICAgfQp9CmVsc2UgCnsKICAgIHN0YXRlW3RhcmdldC5pZF0gPSB0YXJnZXQ7Cn0KCi8vY2hlY2tzIGZvciBwcmV2aW91cyBlZ2dzIGFuZCByZXR1cm5zIGRhdGEgZm9yIHByZXZpb3VzbHkgcHVibGlzaGVkIGFiJ3MKbGV0IGVnZ0NoZWNrID0gYXdhaXQgdGhpc0JvdC5hYlByZXZpb3VzRWdnQ2hlY2soe2FiSUQ6IGFiSUR9KTsKCi8vYWRkaXRpb25hbCBmaWxlIGRhdGEKZm9ybWF0dGVkRmlsZS52ZXJzaW9uID0gMTsKZm9ybWF0dGVkRmlsZS5zaWduYXR1cmUgPSBlZ2dDaGVjay5zaWduYXR1cmU7CmZvcm1hdHRlZEZpbGUuc3RhdGUgPSBzdGF0ZTsKCi8vYWN0dWFsIGVuY3J5cHRpb24gaWYgY2hvc2VuCmlmIChrZXkpIAp7CiAgICBmb3JtYXR0ZWRGaWxlID0gSlNPTi5zdHJpbmdpZnkoZm9ybWF0dGVkRmlsZSk7CgogICAgZm9ybWF0dGVkRmlsZSA9IGNyeXB0by5lbmNyeXB0KGtleSwgZm9ybWF0dGVkRmlsZSk7Cn0KCi8vcHVibGlzaCB0aGUgZmlsZQpsZXQgcHVibGlzaEZpbGUgPSBhd2FpdCB0aGlzQm90LmFiUHVibGlzaEZpbGUoe2ZpbGU6IGZvcm1hdHRlZEZpbGUsIGZpbGVOYW1lOiBhYklEfSk7CgovL2dhdGhlciBhZGRpb25hbCBlZ2cgZGF0YQplZ2dDaGVjay5lZ2dEYXRhLmVnZ1ZlcnNpb25IaXN0b3J5LnB1c2gocHVibGlzaEZpbGUudXJsKTsKZWdnQ2hlY2suZWdnRGF0YS5tYXhWZXJzaW9uID0gZWdnQ2hlY2suZWdnRGF0YS5lZ2dWZXJzaW9uSGlzdG9yeS5sZW5ndGg7CmVnZ0NoZWNrLmVnZ0RhdGEudGFyZ2V0VmVyc2lvbiA9IGVnZ0NoZWNrLmVnZ0RhdGEuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RoOwoKLy9wdWJsaXNoIGVnZy9hYiByZWNvcmQKbGV0IHB1Ymxpc2hSZWNvcmQgPSBhd2FpdCB0aGlzQm90LmFiUHVibGlzaFJlY29yZCh7ZGF0YTogZWdnQ2hlY2suZWdnRGF0YSwgcmVjb3JkTmFtZTogYWJJRH0pOwpsZXQgc2l0ZU9yaWdpbiA9IG5ldyBVUkwoY29uZmlnQm90LnRhZ3MudXJsKS5vcmlnaW47CgovL3B1Ymxpc2hpbmcgc2hvdXQKc2hvdXQoIm9uQUJQdWJsaXNoZWQiLCB7c3VjY2VzczogcHVibGlzaEZpbGUuc3VjY2VzcywgYWI6IGFiSUQsIGZpbGVBZGRyZXNzOiBwdWJsaXNoRmlsZS51cmx9KQoKLy9zZW5kIGRhdGEgYW5kIGZvcm1hdCB1cmwgaWYgZGF0YSBzdWNjZXNzZnVsbHkgc2VudAppZiAocHVibGlzaFJlY29yZC5zdWNjZXNzKQp7CiAgICBsZXQgZ2lnQUIgPSBjb25maWdCb3QudGFncy5hYiB8fCBjb25maWdCb3QudGFncy5hdXRvTG9hZCB8fCBjb25maWdCb3QudGFncy5hdXhDb2RlOwogICAgbGV0IGdpZ0tleSA9IGdpZ0FCID8gZ2lnQUIuc3Vic3RyaW5nKDcpIDogIm5vbmUiOwogICAgbGV0IGdpZ0Zvcm1hdCA9ICJjb2xsYWJfIjsKICAgIGxldCBnaWdGb3JtYXRDaGVjayA9IGFiSUQuaW5jbHVkZXMoZ2lnRm9ybWF0KTsKCiAgICBpZiAoZ2lnRm9ybWF0Q2hlY2sgJiYga2V5ID09IGdpZ0tleSAmJiBrZXkpIAogICAgewogICAgICAgIGxldCBjb2xsYWJVUkwgPSBzaXRlT3JpZ2luICsgIi8/YWI9IiArIGFiSUQgKyAiJmtleT0iICsga2V5OwoKICAgICAgICBzaG91dCgiYWJTdWJtaXRDb2xsYWIiLCB7IHVybDogY29sbGFiVVJMIH0pCiAgICB9CiAgICBlbHNlIGlmIChrZXkgJiYgY29uZmlnQm90LnRhZ3MubWFudWFsUHVibGlzaCkgCiAgICB7CiAgICAgICAgb3Muc2V0Q2xpcGJvYXJkKHNpdGVPcmlnaW4gKyAiLz9hYj0iICsgYWJJRCArICIma2V5PSIgKyBrZXkpOwoKICAgICAgICBvcy50b2FzdCgidXJsIGNvcGllZCB0byBjbGlwYm9hcmQiKTsKICAgIH0KICAgIGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2gpCiAgICB7CiAgICAgICAgb3Muc2V0Q2xpcGJvYXJkKHNpdGVPcmlnaW4gKyAiLz9hYj0iICsgYWJJRCk7CgogICAgICAgIG9zLnRvYXN0KCJ1cmwgY29waWVkIHRvIGNsaXBib2FyZCIpOwogICAgfQoKICAgIGlmIChrZXkpIAogICAgewogICAgICAgIHdlYmhvb2sucG9zdCgiaHR0cHM6Ly9xbmhjYTJzN2ljLmV4ZWN1dGUtYXBpLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tL3NsYWNrL1QwMjlBUDRDUS9CMDFLTlRCODIwMS9nQ09QbHFRSHNSUDN0Qks5UFlISkJtTnAiLCB7ICJ0ZXh0IjogYFBSSVZBVEUgJHthYklEfSB2JHtlZ2dDaGVjay5lZ2dEYXRhLmVnZ1ZlcnNpb25IaXN0b3J5Lmxlbmd0aH0gcmVjb3JkICR7cHVibGlzaEZpbGUuc2hhMjU2SGFzaH1gIH0sIGBPcmlnaW46ICR7c2l0ZU9yaWdpbn1gKTsKICAgIH0KICAgIGVsc2UgCiAgICB7CiAgICAgICAgd2ViaG9vay5wb3N0KCJodHRwczovL3FuaGNhMnM3aWMuZXhlY3V0ZS1hcGkudXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vc2xhY2svVDAyOUFQNENRL0IwMUtOVEI4MjAxL2dDT1BscVFIc1JQM3RCSzlQWUhKQm1OcCIsIHsgInRleHQiOiBgJHthYklEfSB2JHtlZ2dDaGVjay5lZ2dEYXRhLmVnZ1ZlcnNpb25IaXN0b3J5Lmxlbmd0aH0gcmVjb3JkICR7cHVibGlzaEZpbGUuc2hhMjU2SGFzaH1gIH0sIGBPcmlnaW46ICR7c2l0ZU9yaWdpbn1gKTsKICAgIH0KCiAgICB0cnkgCiAgICB7CiAgICAgICAgYXdhaXQgYW5hbHl0aWNzLnJlY29yZEV2ZW50KCdhYl9lZ2dfcHVibGlzaCcsIHsgYWI6IGFiSUQsIHZlcnNpb246IGVnZ0NoZWNrLmVnZ0RhdGEuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RoIH0pOwogICAgfQogICAgY2F0Y2ggKGUpIAogICAgewogICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgfQp9CmVsc2UKewogICAgY29uc29sZS5sb2cocHVibGlzaFJlY29yZCk7Cn0KCi8vY2xlYXIgcHJvZ3Jlc3MgYmFyCmlmIChwcm9ncmVzc0J1dHRvbikKewogICAgZGVzdHJveShwcm9ncmVzc0J1dHRvbik7Cn0KCmNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2ggPSBudWxsOwoKcmV0dXJuIHB1Ymxpc2hSZWNvcmQ7JwD/yPkhhh4IYWJJZ25vcmUCBAD/yPkh5osBBHRydWUnAP/I+SGGHgphYkRvd25sb2FkAgQA/8j5IeuLAdsDQC8vZG93bmxvYWQgYm90cyAoZWl0aGVyIHNlbGVjdGVkIG9yIGFsbCBleHBlcmllbmNlKQpsZXQgZG93bmxvYWRCb3RzOwoKaWYgKGxpbmtzLnJlbWVtYmVyLmxpbmtzLmFiQm90Rm9jdXMpCnsKICAgIGRvd25sb2FkQm90cyA9IFtsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzXTsKCiAgICBhYi5sb2coImRvd25sb2FkaW5nIGJvdCIpOwp9CmVsc2UKewogICAgZG93bmxvYWRCb3RzID0gZ2V0Qm90cyhieU1vZCh7ImFiSWdub3JlIjogbnVsbCwgImFiMUlnbm9yZSI6IG51bGwsICJzcGFjZSI6ICJzaGFyZWQifSkpOwoKICAgIGFiLmxvZygiZG93bmxvYWRpbmcgaW5zdCIpOwp9CgpsZXQgY3VycmVudEluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpOwoKb3MuZG93bmxvYWRCb3RzKGRvd25sb2FkQm90cywgY3VycmVudEluc3QpOwoKc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOycA/8j5IYYeDW1hbmlmZXN0YXRpb24CBAD/yPkhx48BKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAP/I+SGGHgRtZW51AgQA/8j5Ie6PASjwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwD/yPkhhh4SYWJQcmV2aW91c0VnZ0NoZWNrAgQA/8j5IZWQAeENQC8vdGhpcyBmdW5jdGlvbiBjaGVja3MgZm9yIHByZXZpb3VzIGVnZ3MgYXQgYSBzcGVjaWZpZWQgYWIsIHJldHVybmluZyBhbnkgZGF0YSB0aGF0IGl0IGZpbmRzCmNvbnN0IGFiSUQgPSB0aGF0LmFiSUQ7CgpsZXQgZWdnSGlzdG9yeTsKbGV0IGVnZ0lEOwpsZXQgdGFyZ2V0VmVyc2lvbk51bTsKbGV0IGxhc3RIYXNoOwpsZXQgbWF4VmVyc2lvbk51bTsKbGV0IHJlY29yZExvb2t1cCA9IGF3YWl0IG9zLmdldERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYlJlY29yZEtleSwgYWJJRCwgImh0dHBzOi8vcHVibGljb3MubGluay8iKS5jYXRjaChlID0+IHt9KTsKCmlmIChyZWNvcmRMb29rdXAuc3VjY2VzcykgCnsKICAgIGVnZ0hpc3RvcnkgPSByZWNvcmRMb29rdXAuZGF0YS5lZ2dWZXJzaW9uSGlzdG9yeTsKICAgIGVnZ0lEID0gcmVjb3JkTG9va3VwLmRhdGEuZWdnSUQ7CiAgICB0YXJnZXRWZXJzaW9uTnVtID0gZWdnSGlzdG9yeS5sZW5ndGggKyAxOwogICAgbGFzdEhhc2ggPSBlZ2dIaXN0b3J5W3RhcmdldFZlcnNpb25OdW0gLSAxXTsKICAgIG1heFZlcnNpb25OdW0gPSBlZ2dIaXN0b3J5Lmxlbmd0aCArIDE7Cn0gCmVsc2UgCnsKICAgIGVnZ0hpc3RvcnkgPSBbXTsKICAgIGVnZ0lEID0gdXVpZCgpOwogICAgdGFyZ2V0VmVyc2lvbk51bSA9IDE7CiAgICBsYXN0SGFzaCA9ICJub25lIjsKICAgIG1heFZlcnNpb25OdW0gPSAxOwp9CgppZiAoY29uZmlnQm90LnRhZ3MudmVyc2lvbkRlZmluZWQpIAp7CiAgICBjb25zdCBkZWZpbmVkVmVyc2lvbiA9IGF3YWl0IG9zLnNob3dJbnB1dChtYXhWZXJzaW9uTnVtLCB7CiAgICAgICAgdGl0bGU6ICdzZXQgZGVmYXVsdCB2ZXJzaW9uJywKICAgICAgICBwbGFjZWhvbGRlcjogYDEgdG8gJHttYXhWZXJzaW9uTnVtfSAobGVhdmUgYXMgJHttYXhWZXJzaW9uTnVtfSBmb3IgbGF0ZXN0KWAKICAgIH0pOwoKICAgIHRhcmdldFZlcnNpb25OdW0gPSBkZWZpbmVkVmVyc2lvbjsKICAgIGNvbmZpZ0JvdC50YWdzLnZlcnNpb25EZWZpbmVkID0gbnVsbDsKfQplbHNlIGlmIChjb25maWdCb3QudGFncy50YXJnZXRWZXJzaW9uKSAKewogICAgdGFyZ2V0VmVyc2lvbk51bSA9IGNvbmZpZ0JvdC50YWdzLnRhcmdldFZlcnNpb247CiAgICBjb25maWdCb3QudGFncy50YXJnZXRWZXJzaW9uID0gbnVsbDsKfQoKbGV0IGVnZyA9IHt9OwoKZWdnLmVnZ1ZlcnNpb25IaXN0b3J5ID0gZWdnSGlzdG9yeTsKZWdnLmVnZ0Zvcm1hdFZlcnNpb24gPSBlZ2dJRDsKZWdnLnRhcmdldFZlcnNpb24gPSB0YXJnZXRWZXJzaW9uTnVtOwplZ2cubWF4VmVyc2lvbiA9IG1heFZlcnNpb25OdW07CmVnZy5sYWJlbCA9ICJ2Iit0YXJnZXRWZXJzaW9uTnVtOwplZ2cuYWJJRCA9IGFiSUQ7CgpsZXQgc2lnbmF0dXJlID0ge307CmxldCBkYXRlID0gbmV3IERhdGUoKTsKbGV0IHRpbWUgPSBkYXRlLmdldFRpbWUoKTsKCnNpZ25hdHVyZS5wcmV2aW91c0hhc2ggPSBsYXN0SGFzaDsKc2lnbmF0dXJlLmFiVmVyc2lvbiA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJDb3JlVmVyc2lvbisiLiIrbGlua3MucmVtZW1iZXIudGFncy5hYkNvcmVJdGVyYXRpb247CnNpZ25hdHVyZS5lZ2dWZXJzaW9uID0gdGFncy5lZ2dVVUlEOwpzaWduYXR1cmUuZWdnVmVyc2lvbk51bSA9IHRhZ3Mub3ZvVmVyc2lvbjsKc2lnbmF0dXJlLnRpbWVTdGFtcCA9IHRpbWU7CnNpZ25hdHVyZS5jYXN1YWxPU1ZlcnNpb24gPSBbb3MudmVyc2lvbigpXTsKCnJldHVybiB7c2lnbmF0dXJlOiBzaWduYXR1cmUsIGVnZ0RhdGE6IGVnZ307KAD/yPkhhh4MYWJCb3RWZXJzaW9uAX09JwD/yPkhhh4PYWJCb3RNZW51QWN0aW9uAgQA/8j5IfidATFALy9zZXQgdXAgdGhlIHB1Ymxpc2ggbWVudQp0aGlzQm90Lm9uU3RvcmVNZW51KCk7JwD/yPkhhh4OYWJCb3RNZW51TGFiZWwCBAD/yPkhqp4BBXNoYXJlJwD/yPkhhh4NYWJCb3RNZW51SWNvbgIEAP/I+SGwngEJaW9zX3NoYXJlJwD/yPkhhh4SYWJCb3RNZW51U29ydE9yZGVyAgQA/8j5IbqeAQEzJwD/yPkhhh4FbGVhcm4CBAD/yPkhvJ4BKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAP/I+SGGHg1hYlB1Ymxpc2hVVUFCAgQA/8j5IeOeAecPQGNvbmZpZ0JvdC50YWdzLnV1YWJTY2FuID0gbnVsbDsKCmxldCB1dWFiQ29uZmlnID0gYXdhaXQgbGlua3Muc2VhcmNoLm9uTG9va3VwQUJFZ2dzKHthYklEOiBjb25maWdCb3QudGFncy51dWFiLCByZXR1cm5UeXBlOiAiZGF0YSJ9KTsKCmxldCBwaW4gPSBhd2FpdCBvcy5zaG93SW5wdXQobnVsbCx7CiAgICB0aXRsZTogImVudGVyIHBpbiIsCiAgICB0eXBlOiAic2VjcmV0Igp9KTsKCmlmIChwaW4pCnsKICAgIGxldCBwaCA9IGNyeXB0by5zaGEyNTYocGluKS5zdWJzdHJpbmcoMCw0KTsKCiAgICBpZiAocGggPT0gY29uZmlnQm90LnRhZ3MucGgpCiAgICB7CiAgICAgICAgbGV0IHJlY29yZEtleTsKICAgICAgICBsZXQgZWdnRGF0YUNoZWNrOwogICAgICAgIGxldCBlZ2dEYXRhOwoKICAgICAgICBmb3IgKHRhZyBpbiB1dWFiQ29uZmlnLnN0YXRlKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKHRhZykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmVjb3JkS2V5ID0gdXVhYkNvbmZpZy5zdGF0ZVt0YWddLnRhZ3MucmVjb3JkS2V5OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGhhdCkKICAgICAgICB7CiAgICAgICAgICAgIGVnZ0RhdGFDaGVjayA9IGF3YWl0IG9zLmdldERhdGEocmVjb3JkS2V5LCB0aGF0LnRhcmdldFJlY29yZCwgbGlua3MucmVtZW1iZXIudGFncy5hYkVuZHBvaW50KTsKCiAgICAgICAgICAgIGlmIChlZ2dEYXRhQ2hlY2suc3VjY2VzcykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKGVnZ0RhdGFDaGVjay5kYXRhLmVnZ3MpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBlZ2dEYXRhID0gSlNPTi5wYXJzZShlZ2dEYXRhQ2hlY2suZGF0YS5lZ2dzKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlZ2dEYXRhLmxlbmd0aCA+PSAxMikKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3MudG9hc3QoInByYWN0aWNlIHBlcm1pdCBmdWxsIik7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvdXQoImFiUmVmcmVzaCIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXRjaAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coImVnZyBkYXRhIG5vdCByZWFkYWJsZSIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgZWdnRGF0YSA9IFtdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGxpbmtzLnJlbWVtYmVyLm1hc2tzLmFiUmVjb3JkS2V5ID0gcmVjb3JkS2V5OwoKICAgICAgICBjb25maWdCb3QudGFncy5tYW51YWxQdWJsaXNoID0gdHJ1ZTsKCiAgICAgICAgdGhpc0JvdC5hYlB1Ymxpc2hBQih7YWI6IGNvbmZpZ0JvdC50YWdzLmFiLCBrZXk6IGNvbmZpZ0JvdC50YWdzLmtleX0pOwoKICAgICAgICBlZ2dEYXRhLnB1c2goY29uZmlnQm90LnRhZ3MuYWIpOwoKICAgICAgICBlZ2dEYXRhVG9QdWJsaXNoID0ge2VnZ3M6IEpTT04uc3RyaW5naWZ5KGVnZ0RhdGEpfTsKCiAgICAgICAgYXdhaXQgb3MucmVjb3JkRGF0YShyZWNvcmRLZXksIHRoYXQudGFyZ2V0UmVjb3JkLCBlZ2dEYXRhVG9QdWJsaXNoLCBsaW5rcy5yZW1lbWJlci50YWdzLmFiRW5kcG9pbnQpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGF3YWl0IG9zLnRvYXN0KCJwaW4gZG9lcyBub3QgbWF0Y2giLCAyKTsKCiAgICAgICAgc2hvdXQoImFiUmVmcmVzaCIpOwogICAgfQp9CmVsc2UKewogICAgYXdhaXQgb3MudG9hc3QoIm5vIHBpbiBnaXZlbiIsIDIpOwoKICAgIHNob3V0KCJhYlJlZnJlc2giKTsKCiAgICByZXR1cm4KfScA/8j5IYYeC2FiUVJQdWJsaXNoAgQA/8j5IcuuAe8EQGNvbmZpZ0JvdC50YWdzLnB1Ymxpc2hTY2FuID0gbnVsbDsKCmxldCBzY2FubmVkVVJMOwoKdHJ5IAp7CiAgICBzY2FubmVkVVJMID0gbmV3IFVSTCh0aGF0KTsKfQpjYXRjaCAoZSkgewogICAgc2hvdXQoImFiUHVibGlzaEFCIiwge2FiOiB0aGF0fSk7CgogICAgdGhpc0JvdC5hYlB1Ymxpc2hBQih7YWI6IHRoYXR9KTsKCiAgICByZXR1cm47Cn0KCmlmIChzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5nZXQoInBoIikpIAp7CiAgICBsZXQgdGFyZ2V0UmVjb3JkID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJpbnN0Iik7CgogICAgY29uZmlnQm90LnRhZ3MudXVhYiA9IHNjYW5uZWRVUkwuc2VhcmNoUGFyYW1zLmdldCgiYWIiKTsKICAgIGNvbmZpZ0JvdC50YWdzLnBoID0gc2Nhbm5lZFVSTC5zZWFyY2hQYXJhbXMuZ2V0KCJwaCIpOwogICAgY29uZmlnQm90LnRhZ3MuYWIgPSB1dWlkKCk7CiAgICBjb25maWdCb3QudGFncy5rZXkgPSBzY2FubmVkVVJMLnNlYXJjaFBhcmFtcy5nZXQoInBoIik7CgogICAgdGhpc0JvdC5hYlB1Ymxpc2hVVUFCKHt0YXJnZXRSZWNvcmQ6IHRhcmdldFJlY29yZH0pOwp9CmVsc2UgCnsKICAgIG9zLnRvYXN0KCJ1bnN1cHBvcnRlZCB1cmwgZm9ybWF0Iik7Cn0nAP/I+SGGHgZzZWFyY2gCBAD/yPkhu7MBKPCflJdkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUnAP/I+SGGHgdhYlNoZWxsAgQA/8j5IeKzAQR0cnVlJwEEYm90cyRkODM3MTQ0NC05MTU4LTQ0MzYtOGZjNy04NGNjOTFiN2Y1MjUBJwD/yPkh57MBBnN5c3RlbQIEAP/I+SHoswEPYWIuc2hlbGwuc2VhcmNoJwD/yPkh57MBBGZvcm0CBAD/yPkh+LMBB25vdGhpbmcnAP/I+SHnswEOYWJSZXRyaWV2ZUZpbGUCBAD/yPkhgLQBggFALy9wdWxsIGRvd24gZmlsZSBkYXRhCmlmICghdGhhdC51cmwpCnsKICAgIHJldHVybiAibm8gZmlsZSB1cmwgc3VwcGxpZWQiOwp9CgpsZXQgZGF0YSA9IGF3YWl0IG9zLmdldEZpbGUodGhhdC51cmwpOwoKcmV0dXJuIGRhdGE7JwD/yPkh57MBEGFiUmV0cmlldmVSZWNvcmQCBAD/yPkhg7UBhANALy9yZXRyaWV2ZSBzcGVjaWZpZWQgcmVjb3JkCmxldCByZWNvcmROYW1lID0gdGhhdC5yZWNvcmROYW1lOwpsZXQgcmVjb3JkS2V5ID0gdGhhdC5yZWNvcmRLZXkgPyB0aGF0LnJlY29yZEtleSA6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSZWNvcmRLZXk7CmxldCByZWNvcmRFbmRwb2ludCA9IHRoYXQucmVjb3JkRW5kcG9pbnQgPyB0aGF0LnJlY29yZEVuZHBvaW50IDogImh0dHBzOi8vcHVibGljb3MubGluayI7CgppZiAoIXJlY29yZE5hbWUpCnsKICAgIHJldHVybiAibm8gcmVjb3JkIG5hbWUgc3VwcGxpZWQiOwp9CgpsZXQgZ2V0UmVjb3JkID0gYXdhaXQgb3MuZ2V0RGF0YShyZWNvcmRLZXksIHJlY29yZE5hbWUsIHJlY29yZEVuZHBvaW50KTsKCnJldHVybiBnZXRSZWNvcmQ7JwD/yPkh57MBCHJlbWVtYmVyAgQA/8j5IYi4ASjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwD/yPkh57MBDW1hbmlmZXN0YXRpb24CBAD/yPkhr7gBKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAP/I+SHnswEOb25Mb29rdXBBQkVnZ3MCBAD/yPkh1rgBlyBALy9zaG91dCgib25Mb29rdXBBQkVnZ3MiLCB7YWJJRDogYWJJRCwga2V5OiBrZXksIGF1dG9IYXRjaDogYm9vbGVhbiwgcmV0dXJuVHlwZTogZGF0YS9udWxsfSk7CmFiLmxvZygiYWIgYWIgbG9hZCAiICsgdGhhdCk7CgovL2NsZWFyIGFiLTEKaWYgKGxpbmtzLm1hbmlmZXN0YXRpb24pCnsKICAgIGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOwp9CgovL2NvbnN0YW50cyBpbiByZWdhcmRzIHRvIHRoZSBhYiB0byBiZSBsb29rZWQgdXAKY29uc3QgYWJJRCA9IHRoYXQuYWJJRDsKY29uc3QgaW5pdGlhbEJvb3QgPSB0aGF0LmluaXRpYWxCb290Owpjb25zdCBhdXRvSGF0Y2ggPSB0aGF0LmF1dG9IYXRjaDsKY29uc3QgZ2V0UmVjb3JkID0gYXdhaXQgb3MuZ2V0RGF0YShsaW5rcy5yZW1lbWJlci50YWdzLmFiUmVjb3JkS2V5LCBhYklELCBsaW5rcy5yZW1lbWJlci50YWdzLmFiRW5kcG9pbnQpOwoKLy92YXJpYWJsZXMgZm9yIGVnZy9hYiBoYXRjaGluZwpsZXQgcmV0dXJuVHlwZSA9IHRoYXQucmV0dXJuVHlwZTsKbGV0IGtleSA9IHRoYXQua2V5OwpsZXQgbmV3RWdnOwoKLy90aGlzIGxvZ2ljIGhhbmRsZXMgdGhlIHJldHJpZXZlZCBkYXRhLCBzZWFyY2hlcyBhZ2FpbiBpZiBub25lIGNhbWUgdGhyb3VnLCBvciBzZXRzIHVwIGEgY29sbGFiIGZvciBnaWdzCmlmICghZ2V0UmVjb3JkLnN1Y2Nlc3MgJiYgY29uZmlnQm90LnRhZ3MuZ2lnKQp7CiAgICAvL2dyYWIgdGhlIGNvbGxhYiBib3QgaWYgbm9uZSBleGlzdHMKICAgIGxldCBjb2xsYWJCb3QgPSBnZXRCb3QoImFiSURPcmlnaW4iLCAiY29sbGFiU2V0dXAiKTsKCiAgICBpZiAoIWNvbGxhYkJvdCkKICAgIHsKICAgICAgICB0aGlzQm90Lm9uTG9va3VwQUJFZ2dzKHthYklEOiAiY29sbGFiU2V0dXAiLCBhdXRvSGF0Y2g6IHRydWV9KTsKICAgIH0KfQplbHNlIGlmICghZ2V0UmVjb3JkLnN1Y2Nlc3MpCnsKICAgIC8vY2hlY2sgb2xkIHN5c3RlbXMgZm9yIHRoZSByZWNvcmQvZmlsZQogICAgY29uc29sZS5sb2coZ2V0UmVjb3JkLCAiY2hlY2tpbmcgb2xkIFNUTSIpOwoKICAgIGxldCBmaWxlbmFtZWhhc2ggPSBjcnlwdG8uc2hhMjU2KGFiSUQpOwogICAgbGV0IGZpbGV1cmxoYXNoID0gImF1eF8iICsgZmlsZW5hbWVoYXNoICsgJy5hdXgnOwogICAgbGV0IHRhcmdldFVSTCA9ICJodHRwczovL2J1aWxkZXItc3RtLWZpbGVzLnMzLmFtYXpvbmF3cy5jb20vIiArIGZpbGV1cmxoYXNoOwogICAgbGV0IG8gPSB7fTsKICAgIG8ubWV0aG9kID0gIkdFVCI7CiAgICBvLnVybCA9IHRhcmdldFVSTDsKCiAgICB0cnkgCiAgICB7CiAgICAgICAgbGV0IGx0bVJlc3BvbnNlID0gYXdhaXQgd2ViaG9vayhvKTsKCiAgICAgICAgbmV3RWdnID0gbHRtUmVzcG9uc2UuZGF0YS5zdGF0ZTsKCiAgICAgICAgZm9yIChjb25zdCBwcm9wZXJ0eSBpbiBuZXdFZ2cpCiAgICAgICAgewogICAgICAgICAgICBjb25zdCBuZXdNT0QgPSBuZXdFZ2dbcHJvcGVydHldOwoKICAgICAgICAgICAgbmV3RWdnID0gbmV3TU9EOwogICAgICAgIH0KICAgIH0gCiAgICBjYXRjaCAoZSkgCiAgICB7CgogICAgICAgIG9zLnRvYXN0KGBubyBkYXRhIGZvdW5kIGluICR7YWJJRH1gKTsKCiAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgcmV0dXJuICJhYklEIG5vdCBmb3VuZCI7CiAgICB9Cn0KZWxzZQp7CiAgICAvL3BhY2thZ2UgdGhlIHJlY29yZCBkYXRhCiAgICBuZXdFZ2cgPSBnZXRSZWNvcmQuZGF0YTsKfQoKLy90aGlzIGxvZ2ljIHBhcnNlcyB0aGUgZGF0YSBkZXBlbmRhbnQgb24gaG93IGl0IHdhcyBhY2Nlc3NlZC9nYWluZWQKaWYgKHJldHVyblR5cGUgPT0gImRhdGEiICYmIGdldFJlY29yZC5zdWNjZXNzKQp7CiAgICBsZXQgdmVyc2lvbiA9IGdldFJlY29yZC5kYXRhLnRhcmdldFZlcnNpb24gLSAxOwoKICAgIGlmICh0aGF0LmFiVmVyc2lvbikKICAgIHsKICAgICAgICBpZiAoIWlzTmFOKHRoYXQuYWJWZXJzaW9uKSkKICAgICAgICB7CiAgICAgICAgICAgIHZlcnNpb24gPSB0aGF0LmFiVmVyc2lvbiAtIDE7CiAgICAgICAgfQogICAgfQoKICAgIGxldCBlZ2dEYXRhVVJMID0gZ2V0UmVjb3JkLmRhdGEuZWdnVmVyc2lvbkhpc3RvcnlbdmVyc2lvbl07CiAgICBsZXQgcmV0dXJuRGF0YSA9IGF3YWl0IG9zLmdldEZpbGUoZWdnRGF0YVVSTCk7CgogICAgcmV0dXJuIHJldHVybkRhdGE7Cn0KZWxzZSBpZiAocmV0dXJuVHlwZSA9PSAiZGF0YSIpCnsKICAgIGxldCB2ZXJzaW9uQXJyYXkgPSBKU09OLnBhcnNlKG5ld0VnZy5lZ2dWZXJzaW9uSGlzdG9yeSk7CiAgICBsZXQgZmlsZVVVSUQgPSB2ZXJzaW9uQXJyYXlbbmV3RWdnLm1heFZlcnNpb24gLSAxXTsKICAgIGxldCBmaWxlbmFtZWhhc2hMVE0gPSBjcnlwdG8uc2hhMjU2KGZpbGVVVUlEKTsKICAgIGxldCBmaWxldXJsaGFzaExUTSA9ICJhdXhfIiArIGZpbGVuYW1laGFzaExUTSArICcuYXV4JzsKICAgIGxldCB0YXJnZXRMVE1VUkwgPSAiaHR0cHM6Ly9idWlsZGVyLWx0bS1maWxlcy5zMy5hbWF6b25hd3MuY29tLyIgKyBmaWxldXJsaGFzaExUTTsKICAgIGxldCBvID0ge307CiAgICBvLm1ldGhvZCA9ICJHRVQiOwogICAgby51cmwgPSB0YXJnZXRMVE1VUkw7CgogICAgZmlsZUdldCA9IGF3YWl0IHdlYmhvb2sobyk7CgogICAgaWYgKGZpbGVHZXQuc3RhdHVzICE9IDIwMCkKICAgIHsKICAgICAgICBvcy50b2FzdCgibm8gZmlsZSBmb3VuZCIpOwoKICAgICAgICBzaG91dCgiYWJSZWZyZXNoIik7CgogICAgICAgIHJldHVybjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBmaWxlR2V0ID0gZmlsZUdldC5kYXRhOwogICAgfQoKICAgIHJldHVybiBmaWxlR2V0Owp9CgovL2FiIHNwZWNpZmljIHZhcmlhYmxlcyBmb3IgdW5kZXJzdGFuZGluZyBpZiBhIHBvc2l0aW9uIGlzIHNwZWNpZmllZApsZXQgY3VycmVudERpbTsKbGV0IHNwYWNlTW9kOwpsZXQgZGltZW5zaW9uWDsKbGV0IGRpbWVuc2lvblk7CmxldCBkaW1Nb2Q7CgovL2hhbmRsZSBkaW1lbnNpb24gaWRlbnRpZmljYXRpb24KaWYgKGxpbmtzLm1hbmlmZXN0YXRpb24pCnsKICAgIGlmIChsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KQogICAgewogICAgICAgIGNvbnN0IGFiQm90ID0gbGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdDsKCiAgICAgICAgY3VycmVudERpbSA9IGFiQm90LnRhZ3MuZGltZW5zaW9uOwogICAgfQp9CmVsc2UKewogICAgY3VycmVudERpbSA9IG9zLmdldEN1cnJlbnREaW1lbnNpb24oKTsKfQoKLy9jaGVja3MgZm9yIGdyaWQgZm9jdXMKaWYgKCFsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzKSAKewogICAgZGltZW5zaW9uWCA9IG51bGw7CiAgICBkaW1lbnNpb25ZID0gbnVsbDsKfQplbHNlCnsKICAgIGxldCBoYXRjaFBvaW50ID0gbGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRGb2N1czsKCiAgICBjdXJyZW50RGltID0gaGF0Y2hQb2ludC5kaW1lbnNpb247CiAgICBkaW1lbnNpb25YID0gaGF0Y2hQb2ludC5wb3NpdGlvbi54OwogICAgZGltZW5zaW9uWSA9IGhhdGNoUG9pbnQucG9zaXRpb24ueTsKICAgIHNwYWNlTW9kID0ge3NwYWNlOiAic2hhcmVkIn07Cn0KCi8vdGhpcyBsb2dpYyBoYW5kbGVzIGxvZ2ljIGFyb3VuZCBhdXRvSGF0Y2ggdnMgbWFudWFsIGhhdGNoaW5nCmlmICghYXV0b0hhdGNoICYmIGNvbmZpZ0JvdC50YWdzLmFiID09IG51bGwpCnsKICAgIGRpbU1vZCA9IHtbY3VycmVudERpbV06IHRydWUsIFtjdXJyZW50RGltKyJYIl06IGRpbWVuc2lvblgsIFtjdXJyZW50RGltKyJZIl06IGRpbWVuc2lvblksIGRpbWVuc2lvbjogY3VycmVudERpbX07Cn0KZWxzZQp7CiAgICBpZiAoY29uZmlnQm90LnRhZ3Mua2V5ICYmICF0aGF0LmtleSkKICAgIHsKICAgICAgICBrZXkgPSBjb25maWdCb3QudGFncy5rZXkKICAgIH0KCiAgICBkaW1Nb2QgPSB7YXV0b0hhdGNoOiB0cnVlLCBrZXk6IGtleX07Cn0KCi8vY2FsbCBmb3Igb3ZvIHdpdGggaW5mb3JtYXRpb24gcHJvdmlkZWQKdGhpc0JvdC5tYW5pZmVzdE92byh7YWJJRDogYWJJRCwgZGltTW9kOiBkaW1Nb2QsIHNwYWNlTW9kOiBzcGFjZU1vZCwgZWdnRGF0YTogbmV3RWdnLCBpbml0aWFsQm9vdDogaW5pdGlhbEJvb3R9KTsnAP/I+SHnswELbWFuaWZlc3RPdm8CBAD/yPkh7tgB5wpALy9lZ2cgdmlzdWFsaXphdGlvbgpzaG91dCgiYWJNZW51UmVzZXQiKTsKCmlmIChsaW5rcy5tYW5pZmVzdGF0aW9uKQp7CiAgICBpZiAobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCkKICAgIHsKICAgICAgICBkZXN0cm95KGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpOwogICAgfQp9CgppZiAobGlua3Mub3ZvQm90KQp7CiAgICBkZXN0cm95KGxpbmtzLm92b0JvdCk7Cn0KCmxldCBzcGFjZU1vZCA9IHRoYXQuc3BhY2VNb2Q7CmxldCBkaW1Nb2QgPSB0aGF0LmRpbU1vZDsKbGV0IGVnZ0RhdGEgPSB0aGF0LmVnZ0RhdGE7CmxldCBlZ2dNb2QgPSB7fTsKCmVnZ01vZC5zcGFjZSA9ICJ0ZW1wTG9jYWwiOwplZ2dNb2QuaW5pdGlhbFRpbWVyID0gdHJ1ZTsKZWdnTW9kLmFiSUQgPSB0aGF0LmFiSUQ7CmVnZ01vZC5pbml0aWFsQm9vdCA9IHRoYXQuaW5pdGlhbEJvb3Q7CmVnZ01vZC5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKZWdnTW9kLm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLmludGVyYWN0T3ZvKCk7YDsKZWdnTW9kLm9uQ3JlYXRlID0gYEAgaWYgKHRhZ3MuYXV0b0hhdGNoKQp7CiAgICBsaW5rcy5tYW5hZ2VyLmhhdGNoT3ZvKHRoaXNCb3QpOwp9CmVsc2UKewogICAgdGFncy5wcm9ncmVzc0JhciA9IDA7IAoKICAgIHNldFRpbWVvdXQoKCkgPT4ge3doaXNwZXIodGhpc0JvdCwgImVnZ1RpbWVyIik7fSwgNzUpOwp9YDsKZWdnTW9kLmZvcm0gPSAiZWdnIjsKZWdnTW9kLnByb2dyZXNzQmFyQ29sb3IgPSAiI0JGNUU2NiI7CmVnZ01vZC5wcm9ncmVzc0JhckJhY2tncm91bmRDb2xvciA9ICIjNTkyOTg5IjsKZWdnTW9kLmxhYmVsU2l6ZSA9IDAuNTsKZWdnTW9kLmxhYmVsQ29sb3IgPSAiIzQwNDA0MCI7CmVnZ01vZC5vblBvaW50ZXJFbnRlciA9ICJAIG9zLnRvYXN0KHRhZ3MuYWJJRCArICcgdicrdGFncy50YXJnZXRWZXJzaW9uKTsiOwplZ2dNb2QubGFiZWxQb3NpdGlvbiA9ICJmcm9udCI7CmVnZ01vZC5vcmllbnRhdGlvbk1vZGUgPSAiYmlsbGJvYXJkRnJvbnQiOwplZ2dNb2Qub25EZXN0cm95ID0gYEAgbGlua3MubWFuYWdlci5tYXNrcy5vdm9Cb3QgPSBudWxsO2A7CmVnZ01vZC5lZ2dUaW1lciA9IGBAIGlmICh0YWdzLnByb2dyZXNzQmFyIDwgMSkgCnsKICAgIHRhZ3MucHJvZ3Jlc3NCYXIgKz0gMC4xOwoKICAgIHNldFRpbWVvdXQoKCkgPT4ge3doaXNwZXIodGhpc0JvdCwgImVnZ1RpbWVyIik7fSwgNzUpOwp9CmVsc2UKewogICAgdGhpc0JvdC5vbkNsaWNrKCk7CiAgICAKICAgIHRhZ3MucHJvZ3Jlc3NCYXIgPSBudWxsOwp9YDsKCmxldCBvdm8gPSBjcmVhdGUoZWdnRGF0YSwgZWdnTW9kLCBkaW1Nb2QsIHNwYWNlTW9kKTsKCm1hc2tzLm92b0JvdCA9ICLwn5SXIiArIG92by5pZDsnAP/I+SHnswEJb25LZXlEb3duAgQA/8j5IdLjAdoFQC8vaGlkZGVuIHZlcnNpb24gYnV0dG9uIGZvciBoYXRjaCBtZW51CmlmICghbGlua3Mub3ZvQm90IHx8IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWwgIT0gIm92byIpCnsKICAgIHJldHVybjsKfQoKaWYgKHRoYXQua2V5cyA9PSAiU2hpZnQiKQp7CiAgICBsZXQgdmVyc2lvbkJ1dHRvbiA9IHt9OwoKICAgIHZlcnNpb25CdXR0b24ub3ZvID0gdHJ1ZTsKICAgIHZlcnNpb25CdXR0b24ub3ZvU29ydE9yZGVyID0gLTE7CiAgICB2ZXJzaW9uQnV0dG9uLm1heFZlcnNpb24gPSBsaW5rcy5vdm9Cb3QudGFncy5tYXhWZXJzaW9uOwogICAgdmVyc2lvbkJ1dHRvbi5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKICAgIHZlcnNpb25CdXR0b24ubGFiZWwgPSAiY2hhbmdlIGVnZyB2ZXJzaW9uIjsKICAgIHZlcnNpb25CdXR0b24ubGFiZWxBbGlnbm1lbnQgPSAiY2VudGVyIjsKICAgIHZlcnNpb25CdXR0b24ub3ZvTWVudVJlc2V0ID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwogICAgdmVyc2lvbkJ1dHRvbi5jb2xvciA9ICIjRkZGRkZGIjsKICAgIHZlcnNpb25CdXR0b24ub25LZXlVcCA9ICJAIGlmKHRoYXQua2V5cyA9PSAnU2hpZnQnKXtkZXN0cm95KHRoaXNCb3QpfTsiOwogICAgdmVyc2lvbkJ1dHRvbi5vbkNsaWNrID0gIkAgbGlua3MubWFuYWdlci5jaGFuZ2VPdm9WZXJzaW9uKCk7IjsKCiAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbih2ZXJzaW9uQnV0dG9uKTsKfScA/8j5IeezAQhoYXRjaE92bwIEAP/I+SGr6QHqDkAvL2xvZ2ljIGZvciBoYXRjaGluZyBvZiBhbiBhYgpzaG91dCgnb3ZvTWVudVJlc2V0Jyk7CgovL2RhdGEgaW4gcmVnYXJkcyB0byB3aGF0IGFiIGlzIGdvaW5nIHRvIGJlIGhhdGNoZWQKY29uc3Qgb3ZvID0gdGhhdDsKCi8vaGF0Y2ggc3BlY2lmaWMgdmFyaWFibGVzCmxldCBpbml0aWFsQm9vdCA9IG92by50YWdzLmluaXRpYWxCb290OwpsZXQgdGFyZ2V0VmVyc2lvbiA9IGNvbmZpZ0JvdC50YWdzLmFiVmVyc2lvbiAmJiBjb25maWdCb3QudGFncy5hYiA9PSBvdm8udGFncy5hYklEID8gY29uZmlnQm90LnRhZ3MuYWJWZXJzaW9uIDogb3ZvLnRhZ3MudGFyZ2V0VmVyc2lvbjsKbGV0IHZlcnNpb25BcnJheSA9IG92by50YWdzLmVnZ1ZlcnNpb25IaXN0b3J5OwpsZXQgZmlsZVVSTCA9IHZlcnNpb25BcnJheVt0YXJnZXRWZXJzaW9uIC0gMV07CmxldCBrZXkgPSBvdm8udGFncy5rZXkgPyBvdm8udGFncy5rZXkgOiBjb25maWdCb3QudGFncy5rZXk7CmxldCBmaWxlR2V0OwoKLy9hY3R1YWwgZmlsZSByZXRyaWV2YWwKdHJ5CnsKICAgIGZpbGVHZXQgPSBhd2FpdCBvcy5nZXRGaWxlKGZpbGVVUkwpOwp9CmNhdGNoIChlcnJvcikKewogICAgLy9vbGQgc3lzdGVtIGNoZWNrCiAgICBjb25zb2xlLmxvZygiY2hlY2tpbmcgb2xkIExUTSIsIGVycm9yKTsKCiAgICB2ZXJzaW9uQXJyYXkgPSBKU09OLnBhcnNlKG92by50YWdzLmVnZ1ZlcnNpb25IaXN0b3J5KTsKCiAgICBsZXQgZmlsZVVVSUQgPSB2ZXJzaW9uQXJyYXlbb3ZvLnRhZ3MudGFyZ2V0VmVyc2lvbiAtIDFdOwogICAgbGV0IGZpbGVuYW1laGFzaCA9IGNyeXB0by5zaGEyNTYoZmlsZVVVSUQpOwogICAgbGV0IGZpbGV1cmxoYXNoID0gImF1eF8iICsgZmlsZW5hbWVoYXNoICsgJy5hdXgnOwogICAgbGV0IHRhcmdldFVSTCA9ICJodHRwczovL2J1aWxkZXItbHRtLWZpbGVzLnMzLmFtYXpvbmF3cy5jb20vIiArIGZpbGV1cmxoYXNoOwogICAgbGV0IG8gPSB7fTsKICAgIAogICAgby5tZXRob2QgPSAiR0VUIjsKICAgIG8udXJsID0gdGFyZ2V0VVJMOwoKICAgIGZpbGVHZXQgPSBhd2FpdCB3ZWJob29rKG8pOwoKICAgIGlmIChmaWxlR2V0LnN0YXR1cyAhPSAyMDApCiAgICB7CiAgICAgICAgb3MudG9hc3QoIm5vIGZpbGUgZm91bmQiKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGZpbGVHZXQgPSBmaWxlR2V0LmRhdGE7CiAgICB9Cn0KCi8vaGFuZGxpbmcgZm9yIGVuY3J5cHRlZCBhYiBmaWxlCmlmIChjcnlwdG8uaXNFbmNyeXB0ZWQoZmlsZUdldCkpCnsKICAgIGlmICgha2V5KQogICAgewogICAgICAgIGtleSA9IGF3YWl0IG9zLnNob3dJbnB1dCgnJywgewogICAgICAgICAgICB0eXBlOiAnc2VjcmV0JywKICAgICAgICAgICAgdGl0bGU6ICdFbnRlciBrZXknCiAgICAgICAgfSk7CiAgICB9CgogICAgdHJ5CiAgICB7CiAgICAgICAgZmlsZUdldCA9IGNyeXB0by5kZWNyeXB0KGtleSwgZmlsZUdldCk7CiAgICB9CiAgICBjYXRjaCAoZXJyb3IpCiAgICB7CiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpCgogICAgICAgIG9zLnRvYXN0KCJrZXkgZG9lcyBub3QgbWF0Y2ggZmlsZSIpOwoKICAgICAgICByZXR1cm47CiAgICB9CiAgIAogICAgZmlsZUdldCA9IEpTT04ucGFyc2UoZmlsZUdldCk7CgogICAgZmlsZUdldCA9IGZpbGVHZXQuc3RhdGU7Cn0KZWxzZQp7CiAgICBmaWxlR2V0ID0gZmlsZUdldC5zdGF0ZTsKfQoKLy9jbGVhbiB1cApkZXN0cm95KG92byk7CgovL2dlbmVyYXRlIGJvdHMgYmFzZWQgb24gdGhlIGZpbGUgcmV0cmlldmVkCmxpbmtzLmNyZWF0ZS5hYkNyZWF0ZUJvdHMoe2JvdHM6IGZpbGVHZXQsIG9yaWdpbjogb3ZvLnRhZ3MuYWJJRCwgdmVyc2lvbjogdGFyZ2V0VmVyc2lvbiwgaW5pdGlhbEJvb3Q6IGluaXRpYWxCb290fSk7JwD/yPkh57MBC2ludGVyYWN0T3ZvAgQA/8j5IZb4AY4HQC8vbWFudWFsIGhhdGNoIG1lbnUKY29uc3Qgb3ZvQm90ID0gdGhhdCA/IHRoYXQgOiBsaW5rcy5vdm9Cb3Q7CgppZiAoIW92b0JvdCkKewogICAgcmV0dXJuOwp9CgpzaG91dCgib3ZvTWVudVJlc2V0Iik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJvdm8iOwoKbWFza3Mub25HcmlkQ2xpY2sgPSBgQCBzaG91dCgib3ZvTWVudVJlc2V0Iik7YDsKbWFza3Mub3ZvTWVudVJlc2V0ID0gYEAgbWFza3Mub25HcmlkQ2xpY2sgPSBudWxsOwptYXNrcy5vdm9NZW51UmVzZXQgPSBudWxsOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSBudWxsOwpgOwoKbGV0IGVnZ01lbnVCdXR0b24gPSB7fTsKCm9zLnR3ZWVuVG8ob3ZvQm90LCAxNSw0NSw0NSwgNSk7CgplZ2dNZW51QnV0dG9uLm92byA9IHRydWU7CmVnZ01lbnVCdXR0b24ubWFuYWdlciA9ICLwn5SXIiArIHRoaXNCb3QuaWQ7CmVnZ01lbnVCdXR0b24ub3ZvQm90ID0gIvCflJciICsgb3ZvQm90LmlkOwplZ2dNZW51QnV0dG9uLnRhcmdldFZlcnNpb24gPSBvdm9Cb3QudGFncy50YXJnZXRWZXJzaW9uOwplZ2dNZW51QnV0dG9uLmxhYmVsID0gImhhdGNoICIgKyBvdm9Cb3QudGFncy5hYklEICsgIiB2IiArIG92b0JvdC50YWdzLnRhcmdldFZlcnNpb24gKyAiIG9mICIgKyBvdm9Cb3QudGFncy5tYXhWZXJzaW9uOwplZ2dNZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImNlbnRlciI7CmVnZ01lbnVCdXR0b24ub3ZvTWVudVJlc2V0ID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwplZ2dNZW51QnV0dG9uLmNvbG9yID0gIiNGRkZGRkYiOwplZ2dNZW51QnV0dG9uLm9uQ2xpY2sgPSAiQCBsaW5rcy5tYW5hZ2VyLmhhdGNoT3ZvKGxpbmtzLm92b0JvdCk7IjsKCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKGVnZ01lbnVCdXR0b24pOycA/8j5IeezAQZjcmVhdGUCBAD/yPkhof8BKPCflJczNGMzYzIxMC01YmYxLTQ5Y2YtYjE1MS1lZTJkMDdmMGU2NzMnAP/I+SHnswEQY2hhbmdlT3ZvVmVyc2lvbgIEAP/I+SHI/wHKAkAvL2xvZ2ljIGZvciB2ZXJzaW9uIGNoYW5naW5nIHdoZW4gbWFudWFsbHkgaGF0Y2hpbmcgYW4gYWIKY29uc3Qgb3ZvQm90ID0gbGlua3Mub3ZvQm90OwoKbGV0IG5ld1ZlcnNpb24gPSBhd2FpdCBvcy5zaG93SW5wdXQob3ZvQm90LnRhZ3MudGFyZ2V0VmVyc2lvbiwgewogICAgcGxhY2Vob2xkZXI6ICJlbnRlciBhIHZlcnNpb24gZnJvbSAxIHRvICIgKyBvdm9Cb3QudGFncy5tYXhWZXJzaW9uCn0pOwoKb3ZvQm90LnRhZ3MudGFyZ2V0VmVyc2lvbiA9IG5ld1ZlcnNpb247Cm92b0JvdC50YWdzLmxhYmVsID0gJ3YnKyBuZXdWZXJzaW9uOwoKc2hvdXQoIm92b01lbnVSZXNldCIpOycA/8j5IeezAQRtZW51AgQA/8j5IZOCAijwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwD/yPkh57MBCGFiSWdub3JlAgQA/8j5IbqCAgR0cnVlKAD/yPkh57MBDGFiQm90VmVyc2lvbgF9PScA/8j5IeezAQdhYlNoZWxsAgQA/8j5IcCCAgR0cnVlJwD/yPkh57MBDGFiMUxUTVNlYXJjaAIEAP/I+SHFggJQQC8vc3VwcG9ydCBvbGQgc3ludGF4CmxldCBzZWFyY2ggPSB0aGlzQm90Lm9uTG9va3VwQUJFZ2dzKHRoYXQpOwoKcmV0dXJuIHNlYXJjaDsnAQRib3RzJGY4NjAyODc4LWMyZWYtNDhiZC04NWEwLThkNjM1MWViNDEyMAEnAP/I+SGWgwIGc3lzdGVtAgQA/8j5IZeDAg5hYi5zaGVsbC5pbnB1dCcA/8j5IZaDAgRmb3JtAgQA/8j5IaaDAgdub3RoaW5nJwD/yPkhloMCCW9uS2V5RG93bgIEAP/I+SGugwJtQC8vYWxsb3cgcHVsbGluZyB1cCBjaGF0IGluIGJ1aWxkZXIgdmVyc2lvbgppZiAodGhhdC5rZXlzID09ICJgIiAmJiBidWlsZGVyVmVyc2lvbikKewogICAgb3Muc2hvd0NoYXQoIj4iKTsKfScA/8j5IZaDAgZvbkNoYXQCBAD/yPkhnIQCkBhALy9ub3Qgc3VwcG9ydGVkIG91dHNpZGUgb2YgYnVpbGRlciB2ZXJzaW9uCmlmICghYnVpbGRlclZlcnNpb24pCnsKICAgIHJldHVybjsKfQoKLy90aGlzIGxvb3AgaWRlbnRpZmllcyBwb3NzaWJsZSBhYiBzcGVjaWZpYyBtZXNzYWdlcywgYW5kIGNhbGxzIGEgc2V0IGxpc3Qgb2YgY29tbWFuZHMKaWYgKHRoYXQubWVzc2FnZVswXSA9PSAiLiIpIAp7CiAgICBvcy5oaWRlQ2hhdCgpOwoKICAgIHN3aXRjaCAodGhhdC5tZXNzYWdlKQogICAgewogICAgICAgIGNhc2UgJy5kb3dubG9hZEFCJzoKICAgICAgICAgICAgY2hhbmdlU3RhdGUobGlua3MubWFuaWZlc3RhdGlvbiwgIkFzbGVlcCIsICJhYk1hbmlmZXN0U3RhdGUiKTsKCiAgICAgICAgICAgIGNvbnN0IGdyb3VwID0gYXdhaXQgb3Muc2hvd0lucHV0KCJncm91cCIpOwoKICAgICAgICAgICAgaWYgKGdyb3VwID09ICJhYkNvcmUiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmFiQ29yZUl0ZXJhdGlvbisrOwogICAgICAgICAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5pbml0aWFsQm9vdCA9IHRydWU7CiAgICAgICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmNvcmVBQiA9IG51bGw7CiAgICAgICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRCA9IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IGFiR3JvdXAgPSBnZXRCb3RzKGdyb3VwKTsKCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWJHcm91cC5sZW5ndGg7IGkrKykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgYWJHcm91cFtpXS50YWdzLmFiQm90VmVyc2lvbisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBvcy5kb3dubG9hZEJvdHNBc0luaXRpYWx6YXRpb25VcGRhdGUoYWJHcm91cCwgZ3JvdXApOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAubG9hZFNraWxsYDoKICAgICAgICAgICAgbGV0IHNraWxsID0gYXdhaXQgb3Muc2hvd0lucHV0KCJza2lsbCIpOwoKICAgICAgICAgICAgbGlua3MubGVhcm4uYWJBZGFwdChza2lsbCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC5zeXN0ZW1gOgogICAgICAgICAgICBjb25maWdCb3QudGFncy5zeXN0ZW1Qb3J0YWwgPSB0cnVlOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLnNoZWV0YDoKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3Muc2hlZXRQb3J0YWwgPSAhY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsID8gY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbCA6IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbDsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC5tZW51U2hlZXRgOgogICAgICAgICAgICBjb25maWdCb3QudGFncy5zaGVldFBvcnRhbCA9IGNvbmZpZ0JvdC50YWdzLm1lbnVQb3J0YWw7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAuZG93bmxvYWRgOgogICAgICAgICAgICBvcy5kb3dubG9hZEJvdHMoZ2V0Qm90cyhieU1vZCh7c3BhY2U6ICJzaGFyZWQiLCBhYklnbm9yZTogbnVsbH0pKSwgY29uZmlnQm90LnRhZ3MuaW5zdCk7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAudXBsb2FkYDoKICAgICAgICAgICAgb3Muc2hvd1VwbG9hZEF1eEZpbGUoKTsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC5zbGVlcGA6CiAgICAgICAgICAgIGNoYW5nZVN0YXRlKGxpbmtzLm1hbmlmZXN0YXRpb24sICJBc2xlZXAiLCAiYWJNYW5pZmVzdFN0YXRlIik7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAuLmA6CiAgICAgICAgICAgIGNoYW5nZVN0YXRlKGxpbmtzLm1hbmlmZXN0YXRpb24sICJBd2FrZSIsICJhYk1hbmlmZXN0U3RhdGUiKTsKCiAgICAgICAgICAgIGF3YWl0IHRoaXNCb3QuYWJBZGFwdCgiYWJJbnRlcmZhY2UiKTsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJy5sb2cnOgogICAgICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MudGFnUG9ydGFsID09IGFiLmlkICsgIi5hYkxvZyIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWwgPSBudWxsOwogICAgICAgICAgICAgICAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbFNwYWNlID0gbnVsbDsKCiAgICAgICAgICAgICAgICB0YWdQb3J0YWxCb3QubWFza3MudGFnUG9ydGFsQW5jaG9yUG9pbnQgPSBudWxsOwoKICAgICAgICAgICAgICAgIG9zLmhpZGVDaGF0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb25maWdCb3QubWFza3MudGFnUG9ydGFsID0gYWIuaWQgKyAiLmFiTG9nIjsKICAgICAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWxTcGFjZSA9ICJ0ZW1wTG9jYWwiOwoKICAgICAgICAgICAgICAgIHRhZ1BvcnRhbEJvdC5tYXNrcy50YWdQb3J0YWxBbmNob3JQb2ludCA9ICJ0b3AiOwoKICAgICAgICAgICAgICAgIG9zLnNob3dDaGF0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnLmhpZGVMb2cnOgogICAgICAgICAgICBjb25maWdCb3QubWFza3MudGFnUG9ydGFsID0gbnVsbDsKICAgICAgICAgICAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbFNwYWNlID0gbnVsbDsKCiAgICAgICAgICAgIHRhZ1BvcnRhbEJvdC5tYXNrcy50YWdQb3J0YWxBbmNob3JQb2ludCA9IG51bGw7CgogICAgICAgICAgICBvcy5oaWRlQ2hhdCgpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBsZXQgbWVzc2FnZSA9IHRoYXQubWVzc2FnZTsKICAgICAgICAgICAgbGV0IGV4ZWN1dGFibGUgPSBtZXNzYWdlLnNsaWNlKDEpOwoKICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIG9zLnJ1bihleGVjdXRhYmxlKTsgIAogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIChlKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgICAgfQogICAgfQp9JwD/yPkhloMCC2Rlc2NyaXB0aW9uAgQA/8j5Ia2cAkJUaGlzIGlzIG1lYW50IHRvIGhhbmRsZSBhbnkgbm9uZSBtZW51IHJlbGF0ZWQgaW5wdXRzL2ludGVyYWN0aW9ucy4nAP/I+SGWgwIMb25GaWxlVXBsb2FkAgQA/8j5IfCcAvMXQC8vZmlsdGVyIG91dCB0aW1lcyB3aGVuIGZpbGUgbG9hZGluZyBpcyBub3QgYWxsb3dlZAppZiAoIWJ1aWxkZXJWZXJzaW9uIHx8IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJMaXN0ZW5pbmdGb3JGaWxlVXBsb2FkcyAhPT0gdHJ1ZSkKewogICAgcmV0dXJuOwp9CgovL3ZhcmlvdXMgZmlsZSBzcGVjaWZpYyB2YXJpYWJsZXMKbGV0IGZpbGVFeHRlbnNpb24gPSB0aGF0LmZpbGUubmFtZS5zcGxpdCgnLicpLnBvcCgpOwpsZXQgZmlsZU5hbWUgPSB0aGF0LmZpbGUubmFtZS5zcGxpdCgnLicpLnNoaWZ0KCk7CmxldCBzaXplID0gdGhhdC5maWxlLnNpemU7CmxldCBtaW1lVHlwZTsKbGV0IGJvdEluZm8gPSB7fTsKCi8vaGFyZCBsaW1pdCBiYXNlZCBvbiBmaWxlIHNpemUKaWYgKHNpemUgPiAyMDAwMDAwMDApCnsKICBvcy50b2FzdCgibWF4aW11bSBmaWxlIHNpemUgZXhjZWVkZWQgKDIwMCBtYikiKTsKCiAgcmV0dXJuOwp9CgovL3RoaXMgc3dpdGNoIGhhbmRsZXMgcG9zc2libGUgZmlsZXMgZXh0ZW5zaW9ucywgd2hpbGUgcmVqZWN0aW5nIGFueSBpdCBkb2VzIG5vdCByZWNvZ25pemUKc3dpdGNoKGZpbGVFeHRlbnNpb24pCnsKICBjYXNlICdqcGcnOgogIGNhc2UgJ2pwZWcnOgogIGNhc2UgJ3dlYnAnOgogIGNhc2UgJ2dpZic6CiAgY2FzZSAncG5nJzoKICAgIG1pbWVUeXBlID0gImltYWdlLyIgKyBmaWxlRXh0ZW5zaW9uOwogICAgYm90SW5mby5mb3JtID0gInNwcml0ZSI7CiAgICBicmVhazsKICBjYXNlICdzdmcnOgogICAgbWltZVR5cGUgPSAiaW1hZ2Uvc3ZnK3htbCI7CiAgICBib3RJbmZvLmZvcm0gPSAic3ByaXRlIjsKICAgIGJyZWFrOwogIGNhc2UgJ2dsYic6CiAgY2FzZSAnZ2x0Zic6CiAgICBtaW1lVHlwZSA9ICJ0ZXh0L3htbCI7CiAgICBib3RJbmZvLmZvcm0gPSAibWVzaCI7CiAgICBib3RJbmZvLmZvcm1TdWJ0eXBlID0gImdsdGYiOwogICAgYnJlYWs7CiAgY2FzZSAnYXV4JzoKICBjYXNlICdwZGYnOgogICAgbGV0IGJvdERhdGEgPSBmaWxlRXh0ZW5zaW9uID09ICIuYXV4IiA/IEpTT04ucGFyc2UodGhhdC5maWxlLmRhdGEpLnN0YXRlIDogb3MucGFyc2VCb3RzRnJvbURhdGEodGhhdC5maWxlLmRhdGEpOwoKICAgIGxpbmtzLmNyZWF0ZS5hYkNyZWF0ZUJvdHMoe2JvdHM6IGJvdERhdGEsIG9yaWdpbjogZmlsZU5hbWV9KTsKCiAgICByZXR1cm47Ci8vICAgY2FzZSAncGRmJzoKLy8gICAgIGJyZWFrOwogIGNhc2UgJ21wMyc6CiAgICBtaW1lVHlwZSA9ICdhdWRpby9tcGVnJzsKICAgIGJvdEluZm8ub25DbGljayA9ICJAIG9zLnBsYXlTb3VuZCh0YWdzLmZvcm1BZGRyZXNzKTsiOwogICAgYm90SW5mby5sYWJlbCA9ICJDbGljayB0byBQbGF5IjsKICAgIGJyZWFrOwogIGNhc2UgJ21wNCc6CiAgICBtaW1lVHlwZSA9ICd2aWRlby9tcDQnOwogICAgYm90SW5mby5mb3JtID0gImlmcmFtZSI7CiAgICBib3RJbmZvLmZvcm1TdWJ0eXBlID0gInNyYyI7CiAgICBicmVhazsKICBkZWZhdWx0OgogICAgbGV0IHJlc3VsdCA9IG5ldyBFcnJvcigidW5oYW5kbGVkIGZpbGUgdHlwZTogIiArIGZpbGVFeHRlbnNpb24pOwogICAgb3MudG9hc3QoImZpbGUgdHlwZSBub3Qgc3VwcG9ydGVkIik7CiAgICBjb25zb2xlLndhcm4ocmVzdWx0KQogICAgcmV0dXJuIHJlc3VsdDsKfQoKLy90aGUgZm9sbG93aW5nIHZhcmlhYmxlcyBhbmQgb2JqZWN0cyBzZXQgdXAgYSBsb2FkaW5nIGJhciBidXR0b24KY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmxldCB1cGxvYWRSZXN1bHQ7CmxldCBtZW51QnV0dG9uID0ge307CgptZW51QnV0dG9uLmFiTWVudSA9IHRydWU7Cm1lbnVCdXR0b24udHJhY2tOdW0gPSAtMTsKbWVudUJ1dHRvbi5vbkNyZWF0ZSA9IGBACiAgICBpZiAodGFncy50cmFja051bSA9PSAyKQogICAgewogICAgICAgIHRhZ3MudHJhY2tOdW0gPSAwOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHRhZ3MudHJhY2tOdW0rKzsKICAgIH0KCiAgICB0YWdzLmxhYmVsID0gdGFnc1sibGFiZWwiK3RhZ3MudHJhY2tOdW1dOwogICAgdGFncy5mb3JtQWRkcmVzcyA9IHRhZ3NbImZvcm0iK3RhZ3MudHJhY2tOdW1dOwoKICAgIHNldFRpbWVvdXQoKCkgPT4gd2hpc3Blcih0aGlzQm90LCAib25DcmVhdGUiKSwgNTAwKTtgOwptZW51QnV0dG9uLmxhYmVsMCA9ICJ1cGxvYWRpbmcuIjsKbWVudUJ1dHRvbi5sYWJlbDEgPSAidXBsb2FkaW5nLi4iOwptZW51QnV0dG9uLmxhYmVsMiA9ICJ1cGxvYWRpbmcuLi4iOwptZW51QnV0dG9uLmZvcm0wID0gImhvdXJnbGFzc19ib3R0b20iOwptZW51QnV0dG9uLmZvcm0xID0gImhvdXJnbGFzc190b3AiOwptZW51QnV0dG9uLmZvcm0yID0gImhvdXJnbGFzc19ib3R0b20iOwptZW51QnV0dG9uLmNvbG9yID0gIiM5MDhCRkMiOwptZW51QnV0dG9uLm9uRGVzdHJveSA9ICJAIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsiOwoKcHJvZ3Jlc3NCdXR0b24gPSBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKCi8vdGhpcyBpcyB0aGUgYWN0dWFsIHVwbG9hZCBmdW5jdGlvbmFsaXR5CnVwbG9hZFJlc3VsdCA9IGF3YWl0IGxpbmtzLnN0b3JlLmFiUHVibGlzaEZpbGUoe2ZpbGU6IHRoYXQuZmlsZS5kYXRhLCBmaWxlTmFtZTogZmlsZU5hbWUsIG1pbWVUeXBlOiBtaW1lVHlwZX0pOwoKLy9pZiB0aGUgZmlsZSBzaG91bGQgYmUgaW5jbHVkZWQgYXMgYSBib3Qgd2l0aCBhIGxpbmssIHRoaXMgbG9naWMgaGFuZGxlcyB0aGF0CmlmIChPYmplY3Qua2V5cyhib3RJbmZvKS5sZW5ndGggPiAwKQp7CiAgICBib3RJbmZvW2NvbmZpZ0JvdC50YWdzLmdyaWRQb3J0YWxdID0gdHJ1ZTsKICAgIGJvdEluZm8uZm9ybUFkZHJlc3MgPSB1cGxvYWRSZXN1bHQudXJsID8gdXBsb2FkUmVzdWx0LnVybCA6IHVwbG9hZFJlc3VsdC5leGlzdGluZ0ZpbGVVcmw7CgogICAgY3JlYXRlKGJvdEluZm8pOwp9CgovL2NsZWFyIHRoZSBwcm9ncmVzcyBiYXIgYnV0dG9uCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsKCmRlc3Ryb3kocHJvZ3Jlc3NCdXR0b24pOwoKcmV0dXJuIHVwbG9hZFJlc3VsdDsnAP/I+SGWgwIFbGVhcm4CBAD/yPkh5LQCKPCflJc2NjU3Yjg2NS1lOTgzLTQ0MDEtOWZjOS1mNTQxOGQxOGE3ZjcnAP/I+SGWgwIIcmVtZW1iZXICBAD/yPkhi7UCKPCflJdlNTM4MGE2Yi04YjRkLTRhOGItOGIwNC01OGUxZWIwM2U1ZTcnAP/I+SGWgwINbWFuaWZlc3RhdGlvbgIEAP/I+SGytQIo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcA/8j5IZaDAghhYklnbm9yZQIEAP/I+SHZtQIEdHJ1ZSgA/8j5IZaDAgxhYkJvdFZlcnNpb24BfT0nAP/I+SGWgwIGY3JlYXRlAgQA/8j5Id+1Aijwn5SXMzRjM2MyMTAtNWJmMS00OWNmLWIxNTEtZWUyZDA3ZjBlNjczJwD/yPkhloMCBXN0b3JlAgQA/8j5IYa2Aijwn5SXNzZhZjA0OTEtMzkxOS00OTg0LWFhODItMjJjNzQyZjQyNjNmJwD/yPkhloMCBG1lbnUCBAD/yPkhrbYCKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAP/I+SGWgwIHYWJTaGVsbAIEAP/I+SHUtgIEdHJ1ZQA="}]}