{"version":2,"updates":[{"id":0,"timestamp":1737495593512,"update":"AeIB3v7i4AwAJwEEYm90cyQwMjgzNjVhNC0wMzZmLTQxZDAtOWFmMS03MTVhZDRmMmFhN2EBJwDe/uLgDAAGc3lzdGVtAgQA3v7i4AwBDWFiLnNoZWxsLmdyaWQnAN7+4uAMAARmb3JtAgQA3v7i4AwPB25vdGhpbmcnAN7+4uAMAAxvbkFueUJvdERyYWcCBADe/uLgDBe7AUAvL2NvbnRyb2xzIGdyaWQgc25hcAppZiAobGlua3MucmVtZW1iZXIudGFncy5hYkdyaWRTbmFwU3RhdGUpCnsKICAgIG9zLmFkZERyb3BTbmFwKCJncmlkIik7Cn0KCi8vY29udHJvbHMgYm90IHNuYXAKaWYgKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RTbmFwU3RhdGUpCnsKICAgIG9zLmFkZERyb3BTbmFwKCJmYWNlIik7Cn0nAN7+4uAMAAhyZW1lbWJlcgIEAN7+4uAM0wEo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycA3v7i4AwACGFiSWdub3JlAgQA3v7i4Az6AQR0cnVlJwDe/uLgDAAHYWJTaGVsbAIEAN7+4uAM/wEEdHJ1ZScA3v7i4AwACWFiVmVyc2lvbgIEAN7+4uAMhAIUOS42NS4xLjE3Mzc0OTU1OTM1MTAnAN7+4uAMAAVmb2N1cwIEAN7+4uAMmQKsBEAvL3Nob3V0KCJmb2N1cyIsIHtib3Q6IGJvdCwgcG9zaXRpb246e3g6IHgsIHk6IHl9fSk7Cgpjb25zdCBmb2N1c1R5cGUgPSB0aGF0LmJvdCA/ICJib3QiIDogInBvc2l0aW9uIjsKY29uc3QgZHVyYXRpb24gPSB0aGF0LmR1cmF0aW9uOwpjb25zdCB6b29tID0gdGhhdC56b29tID8/IGNvbmZpZ0JvdC50YWdzLm1hcFBvcnRhbCA/IDIwMDAgOiAxMDsKY29uc3Qgcm90YXRpb24gPSB0aGF0LnJvdGF0aW9uID8/IHt4OiA0NSwgeTogNDV9Owpjb25zdCBlYXNpbmcgPSB0aGF0LmVhc2luZyA/PyB7dHlwZTogImxpbmVhciIsIG1vZGU6ICJpbm91dCJ9Owpjb25zdCBmb2N1c09wdGlvbnMgPSB7CiAgICB6b29tOiB6b29tLAogICAgcm90YXRpb246IHJvdGF0aW9uLAogICAgZWFzaW5nOiBlYXNpbmcsCiAgICBkdXJhdGlvbjogZHVyYXRpb24KfTsKCmlmIChmb2N1c1R5cGUgPT0gImJvdCIpCnsKICAgIGF3YWl0IG9zLmZvY3VzT24odGhhdC5ib3QsIGZvY3VzT3B0aW9ucyk7Cn0KZWxzZQp7CiAgICBhd2FpdCBvcy5mb2N1c09uKHRoYXQucG9zaXRpb24sIGZvY3VzT3B0aW9ucyk7Cn0nAQRib3RzJDI0YjdlNjZmLTBkNWItNDA2NC1iZjQ4LWI1NjJiOWU2ZTNlYgEnAN7+4uAMxgYHQXBwLmNzcwIEAN7+4uAMxwaRFjpyb290IHsKICAtLWFiLWNvbnNvbGUtYmc6ICNmOGY5ZmE7CiAgLS1vbi1hYi1jb25zb2xlLWJnOiAjMjEyNTI5OwogIC0tYWItY29uc29sZS1oZWlnaHQ6IDMzdmg7Cn0KLyogRGFyayBtb2RlIHN1cHBvcnQgKi8KQG1lZGlhIChwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyaykgewogIDpyb290IHsKICAgIC0tYWItY29uc29sZS1iZzogIzIxMjUyOTsKICAgIC0tb24tYWItY29uc29sZS1iZzogI2Y4ZjlmYTsKICB9Cn0KCi5hYi1jb25zb2xlLWJ0biB7CiAgY3Vyc29yOiBwb2ludGVyOwogIGNvbG9yOiBpbmhlcml0OwogIGxldHRlci1zcGFjaW5nOiBpbmhlcml0OwogIGxpbmUtaGVpZ2h0OiBpbmhlcml0OwogIHRleHQtdHJhbnNmb3JtOiBpbmhlcml0OwogIHRleHQtaW5kZW50OiBpbmhlcml0OwogIHRleHQtc2hhZG93OiBpbmhlcml0OwogIGJhY2tncm91bmQtY29sb3I6IGluaGVyaXQ7CiAgbWFyZ2luOiBpbmhlcml0OwogIHBhZGRpbmctYmxvY2s6IGluaGVyaXQ7CiAgcGFkZGluZy1pbmxpbmU6IGluaGVyaXQ7CiAgYm9yZGVyOiBub25lOwogIHRyYW5zZm9ybTogc2NhbGUoMS4yKTsKfQoKLmFiLWNvbnNvbGUgewogIHdpZHRoOiAxMDB2dzsKICBtYXgtaGVpZ2h0OiB2YXIoLS1hYi1jb25zb2xlLWhlaWdodCk7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogIHBhZGRpbmc6IDA7CiAgY29sb3I6IHZhcigtLW9uLWFiLWNvbnNvbGUtYmcpOwogIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50OwogIGJhY2tkcm9wLWZpbHRlcjogYmx1cigxMHB4KSBicmlnaHRuZXNzKDIwMCUpOwogIGFuaW1hdGlvbi1uYW1lOiBzbGlkZS1hcHAtaW47CiAgYW5pbWF0aW9uLWR1cmF0aW9uOiAwLjVzOwogIG92ZXJmbG93LXk6IGhpZGRlbjsKICB6LWluZGV4OiAxOwp9CgouYWItY29uc29sZTo6YWZ0ZXIgewogIGNvbnRlbnQ6ICIiOwogIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWFiLWNvbnNvbGUtYmcpOwogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB0b3A6IDA7CiAgbGVmdDogMDsKICByaWdodDogMDsKICBib3R0b206IDA7CiAgb3BhY2l0eTogMC45OwogIHotaW5kZXg6IDA7Cn0KCkBrZXlmcmFtZXMgc2xpZGUtYXBwLWluIHsKICBmcm9tIHsKICAgIGFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllciguNiwwLC43OSwxLjAzKTsKICAgIC8qIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgxMTAlKTsgKi8KICAgIC8qIGhlaWdodDogMHB4OyAqLwogICAgLyogbWluLWhlaWdodDogMHB4OyAqLwogICAgbWF4LWhlaWdodDogMHB4OwogIH0KCiAgdG8gewogICAgbWF4LWhlaWdodDogdmFyKC0tYWItY29uc29sZS1oZWlnaHQpOwogICAgLyogbWluLWhlaWdodDogdmFyKC0tYWItY29uc29sZS1oZWlnaHQpOyAqLwogIH0KfQoKLmFiLWNvbnNvbGUgPiBkaXYgewogIHotaW5kZXg6IDE7CiAgcG9zaXRpb246IHJlbGF0aXZlCn0KCi5hYi1jb25zb2xlLXRvcC1iYXIgewogIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWFiLWNvbnNvbGUtYmcpOwogIHdpZHRoOiAxMDAlOwogIHRleHQtYWxpZ246IGNlbnRlcjsKICB1c2VyLXNlbGVjdDogbm9uZTsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAganVzdGlmeS1jb250ZW50OiBlbmQ7CiAgcGFkZGluZzogMC41cmVtOwp9CgouYWItY29uc29sZS1sb2cgewogIG92ZXJmbG93LXk6IGF1dG87CiAgZmxleC1ncm93OiAxOwogIGRpc3BsYXk6IGZsZXg7CiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbi1yZXZlcnNlOwogIG1pbi1oZWlnaHQ6IDI0cHg7CiAgcGFkZGluZzogMCAxcmVtOwogIGN1cnNvcjogcG9pbnRlcjsKfQoKLmFiLWNvbnNvbGUtY29udGVudCB7CiAgY3Vyc29yOiBpbml0aWFsOwp9CgouYWItY29uc29sZS1tZXNzYWdlLWNvbnRhaW5lciB7CiAgbWFyZ2luOiAwLjVyZW0gMDsKfQouYWItY29uc29sZS1tZXNzYWdlIHsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOiByb3c7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBnYXA6IDhweDsKfQoKLmFiLWNvbnNvbGUtc3BhY2VyIHsKICBmbGV4LXNocmluazogMDsKICBmbGV4LWdyb3c6IDE7Cn0KCi5hYi1jb25zb2xlLWNvbnRlbnQgewogIG1heC13aWR0aDogODB2dzsKICBib3JkZXItcmFkaXVzOiAwLjI1cmVtOwogIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWFiLWNvbnNvbGUtYmcpOwogIGNvbG9yOiB2YXIoLS1vbi1hYi1jb25zb2xlLWJnKTsKICBwYWRkaW5nOiAwLjVyZW0gMXJlbTsKfQoKLmFiLWNvbnNvbGUtdGltZXN0YW1wIHsKICBvcGFjaXR5OiAwLjY7Cn0KCi5jb25zb2xlLXNlbmQtYnRuIHsKICBtYXJnaW46IDAgIWltcG9ydGFudDsKICBwYWRkaW5nOiAwIDFyZW0gIWltcG9ydGFudDsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1hYi1jb25zb2xlLWJnKTsKICBib3JkZXItcmFkaXVzOiA0cHg7Cn0KCi5jb25zb2xlLXNlbmQtYnRuID4gc3BhbiB7CiAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDNweCkKfQoKLmFiLWNvbnNvbGUtaW5wdXQtY29udGFpbmVyIHsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOiByb3c7CiAgZ2FwOiAwLjc1cmVtOwogIG1hcmdpbjogMC41cmVtIDFyZW07CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKfQoKLmFiLWNvbnNvbGUtaW5wdXQtY29udGFpbmVyID4gaW5wdXQgewogIGJhY2tncm91bmQ6IHZhcigtLWFiLWNvbnNvbGUtYmcpOwogIGNvbG9yOiB2YXIoLS1vbi1hYi1jb25zb2xlLWJnKTsKICBmbGV4LWdyb3c6IDE7CiAgb3V0bGluZTogbm9uZTsKICBib3JkZXI6IG5vbmU7CiAgcGFkZGluZzogMXJlbTsKICBib3JkZXItcmFkaXVzOiA0cHg7Cn0nAN7+4uAMxgYGZ2V0QXBwAgQA3v7i4AzZHKIgQGNvbnN0IHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSwgdXNlTWVtbywgdXNlUmVmIH0gPSBvcy5hcHBIb29rcwpjb25zdCBUb3BCYXIgPSB0aGlzQm90LlRvcEJhcigpOwpjb25zdCBNZXNzYWdlID0gdGhpc0JvdC5NZXNzYWdlKCk7Cgpjb25zdCBBcHAgPSAoKSA9PiB7CiAgICBjb25zdCBbcG9pbnRlckRvd25Qb3MsIHNldFBvaW50ZXJEb3duUG9zXSA9IHVzZVN0YXRlKHt4OiAtMSwgeTogLTF9KTsKICAgIGNvbnN0IFtjb25zb2xlTG9nLCBzZXRDb25zb2xlTG9nXSA9IHVzZVN0YXRlKFtdKTsKICAgIGNvbnN0IFtzaG93Q2hhdCwgc2V0U2hvd0NoYXRdID0gdXNlU3RhdGUodGFncy5zaG93Q2hhdElucHV0KTsKICAgIGNvbnN0IFt1c2VySW5wdXQsIHNldFVzZXJJbnB1dF0gPSB1c2VTdGF0ZSgnJyk7CiAgICBjb25zdCBbc2hvd0FsbCwgc2V0U2hvd0FsbF0gPSB1c2VTdGF0ZShmYWxzZSk7CiAgICBjb25zdCBpbnB1dFJlZiA9IHVzZVJlZigpOwoKICAgIGNvbnN0IHVwZGF0ZUxvZyA9ICgpID0+IHsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzQm90Lm1hc2tzLmhpc3RvcnkpKSB7CiAgICAgICAgICAgIGNvbnN0IF9oaXN0b3J5ID0gWyAuLi4gdGhpc0JvdC5tYXNrcy5oaXN0b3J5IF07CiAgICAgICAgICAgIF9oaXN0b3J5LnNvcnQoIChhLCBiKSA9PiBuZXcgRGF0ZShhLnRpbWVzdGFtcCkgPCBuZXcgRGF0ZShiLnRpbWVzdGFtcCkgPyAxIDogLTEgKTsKCiAgICAgICAgICAgIHNldENvbnNvbGVMb2coX2hpc3RvcnkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNldENvbnNvbGVMb2coW10pOwogICAgICAgIH0KICAgIH0KCiAgICB1c2VFZmZlY3QoKCkgPT4gewogICAgICAgIHRoaXNCb3QudmFycy51cGRhdGVMb2cgPSB1cGRhdGVMb2c7CiAgICAgICAgdGhpc0JvdC52YXJzLnNldFNob3dBbGwgPSBzZXRTaG93QWxsOwoKICAgICAgICB1cGRhdGVMb2coKTsKCiAgICAgICAgcmV0dXJuICgoKSA9PiB7CiAgICAgICAgICAgIHRoaXNCb3QudmFycy51cGRhdGVMb2cgPSBudWxsOwogICAgICAgICAgICB0aGlzQm90LnZhcnMuc2V0U2hvd0FsbCA9IG51bGw7CiAgICAgICAgfSk7CiAgICB9LCBbXSk7CgogICAgdXNlRWZmZWN0KCgpID0+IHsKICAgICAgICBpZiAoaW5wdXRSZWYuY3VycmVudCkgaW5wdXRSZWYuY3VycmVudC5mb2N1cygpOwogICAgfSwgW3Nob3dDaGF0XSk7CgogICAgY29uc3QgaGFuZGxlUG9pbnRlckRvd24gPSAoZSkgPT4gewogICAgICAgIHNldFBvaW50ZXJEb3duUG9zKHsKICAgICAgICAgICAgeDogZS5jbGllbnRYLAogICAgICAgICAgICB5OiBlLmNsaWVudFksCiAgICAgICAgfSkKICAgIH0KCiAgICBjb25zdCBoYW5kbGVQb2ludGVyVXAgPSAoZSkgPT4gewogICAgICAgIGNvbnN0IGRpZmZYID0gTWF0aC5hYnMoZS5jbGllbnRYIC0gcG9pbnRlckRvd25Qb3MueCk7CiAgICAgICAgY29uc3QgZGlmZlkgPSBNYXRoLmFicyhlLmNsaWVudFkgLSBwb2ludGVyRG93blBvcy55KTsKCiAgICAgICAgaWYgKGRpZmZYIDwgNSAmJiBkaWZmWSA8IDUpIHsKICAgICAgICAgICAgc2V0U2hvd0FsbChzID0+ICFzKTsKICAgICAgICB9CgogICAgICAgIHNldFBvaW50ZXJEb3duUG9zKHt4OiAtMSwgeTogLTF9KTsKICAgIH0KCiAgICBjb25zdCBoYW5kbGVTdWJtaXQgPSAoKSA9PiB7CiAgICAgICAgaWYgKHVzZXJJbnB1dCkgewogICAgICAgICAgICB3aGlzcGVyKGdldEJvdCgnc3lzdGVtJywgJ2FiLmFjdGlvbi5hc2snKSwgJ2FiQ29yZU1lbnVBY3Rpb24nLCB1c2VySW5wdXQpCiAgICAgICAgICAgIHNldFVzZXJJbnB1dCgnJyk7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJpbnB1dFJlZjoiLCBpbnB1dFJlZi5jdXJyZW50KTsKICAgICAgICAgICAgaWYgKGlucHV0UmVmLmN1cnJlbnQpIGlucHV0UmVmLmN1cnJlbnQudmFsdWUgPSAnJzsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuICg8PgogICAgICAgIDxzdHlsZT57dGFnc1snQXBwLmNzcyddfTwvc3R5bGU+CgogICAgICAgIDxkaXYKICAgICAgICAgICAgaWQ9ImFiLWNvbnNvbGUiCiAgICAgICAgICAgIGNsYXNzTmFtZT0iYWItY29uc29sZSIKICAgICAgICAgICAgb25Qb2ludGVyRW50ZXI9ewogICAgICAgICAgICAgICAgKCkgPT4gZ3JpZFBvcnRhbEJvdC5tYXNrcy5wb3J0YWxab29tYWJsZSA9IGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgb25Qb2ludGVyTGVhdmU9eyhlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoZS5jdXJyZW50VGFyZ2V0LmlkID09ICJhYi1jb25zb2xlIil7CiAgICAgICAgICAgICAgICAgICAgZ3JpZFBvcnRhbEJvdC5tYXNrcy5wb3J0YWxab29tYWJsZSA9IHRydWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfX0KICAgICAgICA+CiAgICAgICAgICAgIHt0YWdzLnNob3dUb3BCYXIgJiYgPFRvcEJhciAvPn0KCiAgICAgICAgICAgIDxkaXYKICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0iYWItY29uc29sZS1sb2ciCiAgICAgICAgICAgICAgICBvblBvaW50ZXJEb3duPXtoYW5kbGVQb2ludGVyRG93bn0KICAgICAgICAgICAgICAgIG9uUG9pbnRlclVwPXtoYW5kbGVQb2ludGVyVXB9CiAgICAgICAgICAgID4KICAgICAgICAgICAgICAgIHsvKiBNZXNzYWdlIGhpc3RvcnkgKi8gQXJyYXkuaXNBcnJheShjb25zb2xlTG9nKQogICAgICAgICAgICAgICAgPyBzaG93QWxsCiAgICAgICAgICAgICAgICAgICAgPyBjb25zb2xlTG9nLm1hcCgobSwgaSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW0gfHwgIW0udGltZXN0YW1wIHx8ICFtLm1lc3NhZ2UpIHsgcmV0dXJuIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxNZXNzYWdlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wPXttLnRpbWVzdGFtcH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlPXttLm1lc3NhZ2V9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5PXtgbWVzc2FnZS0ke2l9YH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgICAgICAgICAgICl9KQogICAgICAgICAgICAgICAgICAgIDogPE1lc3NhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wPXtjb25zb2xlTG9nWzBdPy50aW1lc3RhbXB9CiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U9e2NvbnNvbGVMb2dbMF0/Lm1lc3NhZ2V9CiAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgIDogPD48Lz59CgogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICB7c2hvd0NoYXQgJiYKICAgICAgICAgICAgICAgIDxkaXYKICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9ImFiLWNvbnNvbGUtaW5wdXQtY29udGFpbmVyIgogICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICAgIDxpbnB1dAogICAgICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj0iYXNrIGFiLTEiCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXtlID0+IHNldFVzZXJJbnB1dChlLnRhcmdldC52YWx1ZSl9CiAgICAgICAgICAgICAgICAgICAgICAgIG9uS2V5RG93bj17ZSA9PiB7IGlmIChlLmtleSA9PT0gJ0VudGVyJykgaGFuZGxlU3VibWl0KCkgfX0KICAgICAgICAgICAgICAgICAgICAgICAgcmVmPXtpbnB1dFJlZn0KICAgICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24KICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSJhYi1jb25zb2xlLWJ0biBjb25zb2xlLXNlbmQtYnRuIG1kLWljb24gbWQtaWNvbi1mb250IgogICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXtoYW5kbGVTdWJtaXR9CiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6ICc0MHB4JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAnNDhweCcsCiAgICAgICAgICAgICAgICAgICAgICAgIH19CiAgICAgICAgICAgICAgICAgICAgPnNlbmQ8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2Pn0KICAgICAgICA8L2Rpdj4KICAgIDwvPikKfQoKcmV0dXJuIEFwcAonAN7+4uAMxgYLaGlkZUNvbnNvbGUCBADe/uLgDPw8nwFAdmFyIGN1cnJlbnRWZXIgPSBtYXNrcy5jb25zb2xlVmVyc2lvbiA/PyAwOwphd2FpdCBvcy51bnJlZ2lzdGVyQXBwKGBhYi1jb25zb2xlLSR7Y3VycmVudFZlcn1gKTsKbWFza3Mub3BlbiA9IGZhbHNlOwpncmlkUG9ydGFsQm90Lm1hc2tzLnBvcnRhbFpvb21hYmxlID0gbnVsbDsnAN7+4uAMxgYDbG9nAgQA3v7i4AycPtIDQGNvbnN0IG1lc3NhZ2UgPSBTdHJpbmcodGhhdCkKCi8vIENyZWF0ZSBsb2NhbCBjb3B5IG9mIGhpc3RvcnkgbWFzawp2YXIgX2hpc3RvcnkgPSB0aGlzQm90Lm1hc2tzLmhpc3RvcnkKCi8vIFB1c2ggbWVzc2FnZSBpZiB0aGUgbWFzayBleGlzdGVkCmlmICggQXJyYXkuaXNBcnJheShfaGlzdG9yeSkgKSB7CiAgICBfaGlzdG9yeS51bnNoaWZ0KHsKICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksCiAgICAgICAgbWVzc2FnZQogICAgfSkKCi8vIEluaXRpYWxpemUgdGhlIGFycmF5IGlmIGl0IGRpZG4ndAp9IGVsc2UgewogICAgX2hpc3RvcnkgPSBbewogICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSwKICAgICAgICBtZXNzYWdlCiAgICB9XQp9Cgp0aGlzQm90Lm1hc2tzLmhpc3RvcnkgPSBbIC4uLl9oaXN0b3J5IF0KaWYgKHRoaXNCb3QudmFycy51cGRhdGVMb2cpIHRoaXNCb3QudmFycy51cGRhdGVMb2coKScA3v7i4AzGBgtzaG93Q29uc29sZQIEAN7+4uAM70HtA0BpZiAobWFza3Mub3BlbikgeyByZXR1cm4gfTsKCmNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWwgPSBudWxsOwpjb25maWdCb3QubWFza3MudGFnUG9ydGFsU3BhY2UgPSBudWxsOwoKLy8gVW5yZWdpc3RlciBpbiBjYXNlIGl0IHdhcyBhbHJlYWR5IG9wZW4KdmFyIGN1cnJlbnRWZXIgPSBtYXNrcy5jb25zb2xlVmVyc2lvbiA/PyAwOwphd2FpdCBvcy51bnJlZ2lzdGVyQXBwKGBhYi1jb25zb2xlLSR7Y3VycmVudFZlcn1gKTsKCmN1cnJlbnRWZXIgKz0gMTsKbWFza3MuY29uc29sZVZlcnNpb24gPSBjdXJyZW50VmVyOwovLyBHZXQsIHJlZ2lzdGVyLCBhbmQgY29tcGlsZSB0aGUgYXBwCmNvbnN0IEFwcCA9IHRoaXNCb3QuZ2V0QXBwKCk7CmF3YWl0IG9zLnJlZ2lzdGVyQXBwKGBhYi1jb25zb2xlLSR7Y3VycmVudFZlcn1gLCB0aGlzQm90KTsKb3MuY29tcGlsZUFwcChgYWItY29uc29sZS0ke2N1cnJlbnRWZXJ9YCwgPEFwcCAvPik7Cm1hc2tzLm9wZW4gPSB0cnVlOwonAN7+4uAMxgYGc3lzdGVtAgQA3v7i4AzdRRBhYi5zaGVsbC5jb25zb2xlJwDe/uLgDMYGDXRvZ2dsZUNvbnNvbGUCBADe/uLgDO5FlgFAaWYgKG1hc2tzLm9wZW4pIHsKICAgIHdoaXNwZXIodGhpc0JvdCwgImhpZGVDb25zb2xlIik7CiAgICBtYXNrcy5vcGVuID0gZmFsc2U7Cn0gZWxzZSB7CiAgICB3aGlzcGVyKHRoaXNCb3QsICJzaG93Q29uc29sZSIpOwogICAgbWFza3Mub3BlbiA9IHRydWU7Cn0nAN7+4uAMxgYEZm9ybQIEAN7+4uAMhUcHbm90aGluZycA3v7i4AzGBgdhYlNoZWxsAgQA3v7i4AyNRwR0cnVlJwDe/uLgDMYGCmFiSURPcmlnaW4CBADe/uLgDJJHFWFiQ29uc29sZSB1cGRhdGUgNy0xNicA3v7i4AzGBgZUb3BCYXICBADe/uLgDKhH8wRAY29uc3Qgb2Zmc2V0ID0gOApjb25zdCBpbml0aWFsSGVpZ2h0ID0gMjU2CmNvbnN0IGRyYWdJbnRlcnZhbCA9IDI1Cgpjb25zdCBCdXR0b25zQmFyID0gKCkgPT4gewoKICAgIGNvbnN0IGhhbmRsZUNsb3NlID0gKCkgPT4gewogICAgICAgIHNob3V0KCdoaWRlQ29uc29sZScpOwogICAgfQoKICAgIHJldHVybiAoPD4KICAgICAgICA8ZGl2CiAgICAgICAgICAgIGNsYXNzTmFtZT0iYWItY29uc29sZS10b3AtYmFyIgogICAgICAgID4KCiAgICAgICAgICAgIDxidXR0b24KICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0iYWItY29uc29sZS1idG4gbWQtaWNvbiBtZC1pY29uLWZvbnQiCiAgICAgICAgICAgICAgICBvbkNsaWNrPXtoYW5kbGVDbG9zZX0KICAgICAgICAgICAgICAgIHN0eWxlPXt7CiAgICAgICAgICAgICAgICAgICAgdG9wOiAiOHB4IiwKICAgICAgICAgICAgICAgICAgICByaWdodDogIjhweCIsCiAgICAgICAgICAgICAgICAgICAgekluZGV4OiAyLAogICAgICAgICAgICAgICAgfX0KICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgY2xvc2UKICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgIAogICAgICAgIDwvZGl2PgogICAgPC8+KQp9CgpyZXR1cm4gQnV0dG9uc0JhcgonAN7+4uAMxgYNc2hvd0NoYXRJbnB1dAIEAN7+4uAMnEwFZmFsc2UnAN7+4uAMxgYKc2hvd1RvcEJhcgIEAN7+4uAMokwEdHJ1ZScA3v7i4AzGBglhYlZlcnNpb24CBADe/uLgDKdMFDkuNjUuMS4xNzM3NDk1NTkzNTEwJwDe/uLgDMYGEnNldEFiRXhwYW5kQ29uc29sZQIEAN7+4uAMvEyXAkBjb25zb2xlLmxvZyh0aGlzQm90LnZhcnMuc2V0U2hvd0FsbCkKaWYgKHR5cGVvZiB0aGlzQm90LnZhcnMuc2V0U2hvd0FsbCAhPT0gJ2Z1bmN0aW9uJykgewogICAgcmV0dXJuOwp9CgppZiAodGhhdCA9PT0gdW5kZWZpbmVkKSB7CiAgICB0aGlzQm90LnZhcnMuc2V0U2hvd0FsbChzID0+ICFzKTsKfSBlbHNlIGlmICh0aGF0ID09IHRydWUpIHsKICAgIHRoaXNCb3QudmFycy5zZXRTaG93QWxsKHRydWUpOwp9IGVsc2UgewogICAgdGhpc0JvdC52YXJzLnNldFNob3dBbGwoZmFsc2UpOwp9CicA3v7i4AzGBghhYklnbm9yZQIEAN7+4uAM1E4EdHJ1ZScA3v7i4AzGBgdNZXNzYWdlAgQA3v7i4AzZToMPQGNvbnN0IHsgdXNlU3RhdGUsIHVzZU1lbW8gfSA9IG9zLmFwcEhvb2tzCmNvbnN0IFRvcEJhciA9IHRoaXNCb3QuVG9wQmFyKCkKCmNvbnN0IE1lc3NhZ2UgPSAoeyB0aW1lc3RhbXAsIG1lc3NhZ2UgfSkgPT4gewogICAgY29uc3QgW25hbWUsIHNldE5hbWVdID0gdXNlU3RhdGUoJycpOwogICAgY29uc3QgW3Nob3dUaW1lLCBzZXRTaG93VGltZV0gPSB1c2VTdGF0ZShmYWxzZSk7CiAgICBjb25zdCB0aW1lVGV4dCA9IHVzZU1lbW8oCiAgICAgICAgKCkgPT4gewogICAgICAgICAgICBpZiAoIXRpbWVzdGFtcCkgeyByZXR1cm4gfQogICAgICAgICAgICByZXR1cm4gdGltZXN0YW1wLnRvTG9jYWxlU3RyaW5nKAogICAgICAgICAgICAgICAgICAgJ2VuLXVzJywge3RpbWVTdHlsZTogJ21lZGl1bSd9KX0sCiAgICAgICAgW3RpbWVzdGFtcF0KICAgICk7CiAgICBjb25zdCBtZXNzYWdlVGV4dCA9IHVzZU1lbW8oKCkgPT4gewogICAgICAgIGlmICghbWVzc2FnZSkgeyByZXR1cm4gfQoKICAgICAgICBpZiAobWVzc2FnZS5pbmNsdWRlcygnOiAnKSkgewogICAgICAgICAgICBjb25zdCBfbWVzc2FnZVRleHQgPSBtZXNzYWdlLnNwbGl0KCc6ICcpOwogICAgICAgICAgICBjb25zdCBfbmFtZSA9IF9tZXNzYWdlVGV4dC5zaGlmdCgpOwogICAgICAgICAgICBzZXROYW1lKF9uYW1lKTsKICAgICAgICAgICAgcmV0dXJuIF9tZXNzYWdlVGV4dC5qb2luKCc6ICcpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBtZXNzYWdlCiAgICAgICAgfQogICAgfSwgW21lc3NhZ2VdKTsKCiAgICBpZiAoIXRpbWVzdGFtcCB8fCAhbWVzc2FnZSkgeyByZXR1cm4gPD48Lz4gfQoKICAgIHJldHVybiAoCiAgICAgICAgPGRpdgogICAgICAgICAgICBjbGFzc05hbWU9ImFiLWNvbnNvbGUtbWVzc2FnZS1jb250YWluZXIiCiAgICAgICAgICAgIG9uUG9pbnRlckVudGVyPXsoKSA9PiBzZXRTaG93VGltZSh0cnVlKX0KICAgICAgICAgICAgb25Qb2ludGVyTGVhdmU9eygpID0+IHNldFNob3dUaW1lKGZhbHNlKX0KICAgICAgICA+CiAgICAgICAgICAgIDxkaXYKICAgICAgICAgICAgICAgIHN0eWxlPXtuYW1lID09PSAndXNlcicgJiYge3RleHRBbGlnbjogJ3JpZ2h0J319CiAgICAgICAgICAgID4KICAgICAgICAgICAgICAgIHtuYW1lfQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImFiLWNvbnNvbGUtbWVzc2FnZSIgc3R5bGU9e3sKICAgICAgICAgICAgICAgIGZsZXhEaXJlY3Rpb246IG1lc3NhZ2Uuc3RhcnRzV2l0aCgndXNlcicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/ICdyb3cnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6ICdyb3ctcmV2ZXJzZScKICAgICAgICAgICAgfX0+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYWItY29uc29sZS1zcGFjZXIiCiAgICAgICAgICAgICAgICAgICAgc3R5bGU9e3sKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dEFsaWduOiBuYW1lID09PSAndXNlcicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/ICdyaWdodCcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6ICdsZWZ0JywKICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogc2hvd1RpbWUgPyAwLjYgOiAwCiAgICAgICAgICAgICAgICAgICAgfX0KICAgICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgICAgICB7dGltZVRleHR9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJhYi1jb25zb2xlLWNvbnRlbnQiPgogICAgICAgICAgICAgICAgICAgIHttZXNzYWdlVGV4dH0KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICkKfQoKcmV0dXJuIE1lc3NhZ2U7JwEEYm90cyQzNGMzYzIxMC01YmYxLTQ5Y2YtYjE1MS1lZTJkMDdmMGU2NzMBJwDe/uLgDN1dBnN5c3RlbQIEAN7+4uAM3l0PYWIuc2hlbGwuY3JlYXRlJwDe/uLgDN1dBGZvcm0CBADe/uLgDO5dB25vdGhpbmcnAN7+4uAM3V0LZGVzY3JpcHRpb24CBADe/uLgDPZdPUJvdCB1c2VkIHRvIGNyZWF0ZS9tYW5pZmVzdCBib3RzIGludG8gYW4gYWN0dWFsIHNjZW5lL3BvcnRhbC4nAN7+4uAM3V0MYWJDcmVhdGVCb3RzAgQA3v7i4Ay0XtQhQC8vREVWIE5PVEU6IE5FRUQgVE8gVU5ERVJTVEFORCBXSEFUIFRPIERPIElGIEFOIEFSUkFZIElTIEdJVkVOCgovL2NoZWNrcyBmb3IgaW5pdGlhbCBib290IGJvb2xlYW4KbGV0IGluaXRpYWxCb290ID0gdGhhdC5pbml0aWFsQm9vdDsKLy9ib3RzIHRvIGJlIGdlbmVyYXRlZApsZXQgYm90RGF0YSA9IHRoYXQuYm90czsKLy93aGVyZSBkaWQgdGhlIGRhdGEgY29tZSBmcm9tIChvcHRpb25hbCkKbGV0IG9yaWdpbiA9IHRoYXQub3JpZ2luOwovL3doYXQgc3R1ZGlvIGlzIHRoaXMgZGF0YSBmcm9tIChvcHRpb25hbCkKY29uc3Qgc3R1ZGlvID0gdGhhdC5zdHVkaW8KLy92ZXJzaW9uIG9mIHRoZSBkYXRhIChvcHRpb25hbCkKbGV0IHZlcnNpb24gPSB0aGF0LnZlcnNpb247Ci8vaWRNYXAgYW5kIG5ld0JvdHMgYXJlIHVzZWQgdG8gbWFuYWdlIHRoZSBpbmNvbWluZyBib3QgZGF0YQpsZXQgaWRNYXAgPSBuZXcgTWFwKCk7CmxldCBuZXdCb3RzID0gW107CgovL3RoaXMgbG9vcCBjcmVhdGVzIHRoZSBuZXcgYm90cyBhbmQgdGhlbiBwYWNrYWdlcyB0aGVtIGZvciBhZGRpdGlvbmFsIHByb2Nlc3NpbmcsIHdoaWxlIGFkZGluZyBhbnkgbmVlZGVkIGFkZGl0aW9uYWwgdGFncwpmb3IgKGNvbnN0IHByb3BlcnR5IGluIGJvdERhdGEpCnsKICAgIGNvbnN0IG5ld0JvdCA9IGJvdERhdGFbcHJvcGVydHldOwogICAgY29uc3QgYm90VG90YWwgPSBPYmplY3Qua2V5cyhib3REYXRhKS5sZW5ndGg7CiAgICBjb25zdCBhYklET3JpZ2luID0ge2FiSURPcmlnaW46IG9yaWdpbiwgYWJJRFN0dWRpbzogdGhhdC5zdHVkaW99OwogICAgY29uc3QgYWJHcmlkRm9jdXMgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzOwoKICAgIGlmIChuZXdCb3QudGFncykgCiAgICB7CiAgICAgICAgaWYgKG5ld0JvdC50YWdzLmNyZWF0b3IpIAogICAgICAgIHsKICAgICAgICAgICAgYWJJRE9yaWdpbi5vbGRDcmVhdG9yID0gbmV3Qm90LnRhZ3MuY3JlYXRvcjsKICAgICAgICB9CgogICAgICAgIGxldCB0YXJnZXRQb3NpdGlvbjsKCiAgICAgICAgdHJ5IAogICAgICAgIHsKICAgICAgICAgICAgaWYgKChib3RUb3RhbCA8IDIgfHwgYm90VG90YWwgPCAzICYmIGJvdERhdGEuYWJYUEJvdCAhPSBudWxsKSAmJiBhYkdyaWRGb2N1cykgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxldCB0YXJnZXREaW1lbnNpb24gPSBhYkdyaWRGb2N1cy5kaW1lbnNpb247CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRhcmdldFBvc2l0aW9uID0geyBbdGFyZ2V0RGltZW5zaW9uXTogdHJ1ZSwgW3RhcmdldERpbWVuc2lvbiArICJYIl06IGFiR3JpZEZvY3VzLnBvc2l0aW9uLngsIFt0YXJnZXREaW1lbnNpb24gKyAiWSJdOiBhYkdyaWRGb2N1cy5wb3NpdGlvbi55IH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCBiID0gY3JlYXRlKG5ld0JvdC50YWdzLCB0YXJnZXRQb3NpdGlvbiwgYWJJRE9yaWdpbik7CgogICAgICAgICAgICBpZE1hcC5zZXQoYm90RGF0YVtwcm9wZXJ0eV0uaWQsIGIuaWQpOwogICAgICAgICAgICBuZXdCb3RzLnB1c2goYik7CgogICAgICAgICAgICBpZiAoYi50YWdzLmNyZWF0b3IgPT0gdGhpc0JvdC5pZCkgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGIudGFncy5jcmVhdG9yID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjYXRjaCAoZXJyb3IpIAogICAgICAgIHsKICAgICAgICAgICAgY29uc29sZS5sb2coImludmFsaWQgYm90IiwgZXJyb3IpOwogICAgICAgIH0KICAgIH0KICAgIGVsc2UgCiAgICB7CiAgICAgICAgY29uc29sZS5sb2coInNraXBwZWQgYm90OiAiICsgbmV3Qm90KTsKICAgIH0KfQoKLy9hcnJheSBvZiB0YWcgcmVsYXRpb25zaGlwcyB0byBiZSBwcmVzZXJ2ZWQKbGV0IGxpbmtUYWdzID0gWyJsaW5rIiwgImNyZWF0b3IiLCAiY29uZmlnQm90IiwgImxpbmVUbyIsICJ0cmFuc2Zvcm1lciJdOwoKLy90aGlzIGxvb3AgY29udGFpbnMgdGhlIGxvZ2ljIGZvciBwcmVzZXJ2aW5nIHRoZSBsaW5rVGFncwpmb3IgKGxldCBuZXdCb3Qgb2YgbmV3Qm90cykgCnsKICAgIGZvciAobGV0IHRhZyBvZiBsaW5rVGFncykgCiAgICB7CiAgICAgICAgbGV0IHZhbHVlID0gbmV3Qm90LnRhZ3NbdGFnXTsKCiAgICAgICAgaWYgKHRhZyA9PSAiY3JlYXRvciIpIAogICAgICAgIHsKICAgICAgICAgICAgdmFsdWUgPSBuZXdCb3QudGFncy5vbGRDcmVhdG9yOwogICAgICAgICAgICBuZXdCb3QudGFncy5vbGRDcmVhdG9yID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIHVwZGF0ZUJvdExpbmtzKG5ld0JvdCwgaWRNYXApOwoKICAgICAgICBpZiAodmFsdWUpIAogICAgICAgIHsKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGV0IG5ld1ZhbHVlID0gdmFsdWUubWFwKGlkID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaWRNYXAuZ2V0KGlkKSB8fCBpZDsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgbmV3Qm90LnJhd1t0YWddID0gbmV3VmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29uc3QgbmV3SUQgPSBpZE1hcC5nZXQodmFsdWUpOwoKICAgICAgICAgICAgICAgIGlmIChuZXdJRCkgCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbmV3Qm90LnJhd1t0YWddID0gbmV3SUQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCi8vdG9hc3RzIGZvciBoYXRjaGVzLCBidXQgb25seSBvbiBidWlsZGVyCmlmIChjb25maWdCb3QudGFncy5hYlNpbGVudE1vZGUgPT0gbnVsbCAmJiAhY29uZmlnQm90LnRhZ3MucGggJiYgYnVpbGRlclZlcnNpb24gPT0gImJ1aWxkZXIiKSAKewogICAgb3MudG9hc3QoImhhdGNoZWQgIiArIG9yaWdpbiArICIgdiIgKyB2ZXJzaW9uKTsKfQoKaWYgKG9yaWdpbikKewogICAgbGV0IGFiRWdnID0ge307CgogICAgYWJFZ2cuYWIgPSB0cnVlOwogICAgYWJFZ2cuYWJFZ2cgPSB0cnVlOwogICAgLy9hYkVnZy5zcGFjZSA9ICJsb2NhbCI7CiAgICBhYkVnZy5hYklnbm9yZSA9IHRydWU7CiAgICBhYkVnZy5vcmlnaW5fYWIgPSBvcmlnaW47CiAgICBhYkVnZy5vcmlnaW5fdmVyc2lvbiA9IHZlcnNpb247CiAgICBhYkVnZy5vcmlnaW5fcmVjb3JkID0gdGhhdC5yZWNvcmQ7CiAgICBhYkVnZy5vcmlnaW5fc3R1ZGlvID0gc3R1ZGlvOwogICAgYWJFZ2cuZm9ybSA9ICJlZ2ciOwogICAgYWJFZ2cuY29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yOwogICAgYWJFZ2cubGFiZWxDb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlTGFiZWxDb2xvcjsKICAgIGFiRWdnLmxhYmVsID0gb3JpZ2luICsgIiB2IiArIHZlcnNpb247CiAgICBhYkVnZy5hYlggPSBnZXRCb3RzKCJhYiIpLmxlbmd0aCAqIDEuNTsKCiAgICBjcmVhdGUoYWJFZ2cpOwp9CgovL2FkZGl0aW9uYWwgaGF0Y2ggZGF0YQpjb25maWdCb3QudGFncy5sYXN0RWdnSGF0Y2hlZCA9IG9yaWdpbjsKCi8vY2hlY2sgYW5kIGV4ZWN1dGUgb25QcmVIYXRjaCBjb2RlCmZvciAoY29uc3QgaGF0Y2hpbmdCb3Qgb2YgbmV3Qm90cykKewogICAgaWYgKGhhdGNoaW5nQm90LnRhZ3Mub25QcmVIYXRjaCkKICAgIHsKICAgICAgICB0cnkKICAgICAgICB7CiAgICAgICAgICAgIGF3YWl0IGhhdGNoaW5nQm90Lm9uUHJlSGF0Y2goe2FiOiBvcmlnaW4sIHZlcnNpb246IHZlcnNpb259KTsKICAgICAgICB9CiAgICAgICAgY2F0Y2gKICAgICAgICB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBvblByZUhhdGNoIG5vdCB2YWxpZCBvbiBib3QgJHtoYXRjaGluZ0JvdC5pZH1gKTsKICAgICAgICB9CiAgICB9Cn0KCi8vaW5pdGlhbCBib290IGxvZ2ljIFdIQVQgSVMgVEhJUz8/PwppZiAoaW5pdGlhbEJvb3QpIAp7CiAgICBsaW5rcy5yZW1lbWJlci50YWdzLmJhc2VBQiA9IG9yaWdpbjsKfQoKLy9vbkVnZ0hhdGNoIGZvciBhbGwganVzdCBoYXRjaGVkIGJvdHMKd2hpc3BlcihuZXdCb3RzLCAib25FZ2dIYXRjaCIsIHthYjogb3JpZ2luLCB2ZXJzaW9uOiB2ZXJzaW9uLCBpbnN0OiBhYi50YWdzLmFiSW5zdCwgZWdnUGFyYW1ldGVyczogdGhhdC5lZ2dQYXJhbWV0ZXJzfSk7CgovL29uQWJBZGRlZCBmb3IgYWxsIGJvdHMgaW4gdGhlIGV4cGVyaWVuY2UKc3VwZXJTaG91dCgib25BYkFkZGVkIiwge2FiOiBvcmlnaW4sIHZlcnNpb246IHZlcnNpb24sIGluc3Q6IGFiLnRhZ3MuYWJJbnN0fSk7CgpyZXR1cm47JwDe/uLgDN1dCHJlbWVtYmVyAgQA3v7i4AyJgAEo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycA3v7i4AzdXQlvbkFiQWRkZWQCBADe/uLgDLCAAZQBQC8vc2hvdXQoIm9uQWJBZGRlZCIsIHthYjogb3JpZ2luLCB2ZXJzaW9uOiB2ZXJzaW9ufSk7Cgpjb25zb2xlLmxvZyhhYlJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiAiICsgdGhhdC5hYiwgInZlcnNpb246ICIgKyB0aGF0LnZlcnNpb24pOycA3v7i4AzdXQhhYklnbm9yZQIEAN7+4uAMxYEBBHRydWUnAN7+4uAM3V0HYWJTaGVsbAIEAN7+4uAMyoEBBHRydWUnAN7+4uAM3V0JYWJWZXJzaW9uAgQA3v7i4AzPgQEUOS42NS4xLjE3Mzc0OTU1OTM1MTAnAQRib3RzJDc2YWYwNDkxLTM5MTktNDk4NC1hYTgyLTIyYzc0MmY0MjYzZgEnAN7+4uAM5IEBBnN5c3RlbQIEAN7+4uAM5YEBDmFiLnNoZWxsLnN0b3JlJwDe/uLgDOSBAQRmb3JtAgQA3v7i4Az0gQEHbm90aGluZycA3v7i4AzkgQELZGVzY3JpcHRpb24CBADe/uLgDPyBAT9UaGlzIHNraWxsIGlzIG1lYW50IHRvIGJlIGEgY29uZmlndXJhYmxlIG1lYW5zIHRvIHB1Ymxpc2ggZGF0YS4nAN7+4uAM5IEBD2FiUHVibGlzaFJlY29yZAIEAN7+4uAMvIIBsgZAYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsKCmxldCBwdWJsaWNGYWNpbmcgPSB0aGF0LnB1YmxpY0ZhY2luZzsKbGV0IHJlY29yZERhdGEgPSB0aGF0LmRhdGE7CmxldCByZWNvcmROYW1lID0gdGhhdC5yZWNvcmROYW1lOwpsZXQgZW5kcG9pbnQgPSB0aGF0LmVuZHBvaW50ID8gdGhhdC5lbmRwb2ludCA6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJFbmRwb2ludDsKbGV0IHVzZXJSZWNvcmQgPSBjb25maWdCb3QudGFncy5zZWxlY3RlZF9zdHVkaW9JRCA/PyBhdXRoQm90LmlkOwoKaWYgKCFyZWNvcmREYXRhKQp7CiAgICByZXR1cm4gIm5vIGRhdGEgc3VwcGxpZWQiOwp9CgppZiAocHVibGljRmFjaW5nKQp7CiAgICByZWNvcmREYXRhID0gYXdhaXQgb3MucmVjb3JkRGF0YSh1c2VyUmVjb3JkLCByZWNvcmROYW1lLCByZWNvcmREYXRhLCB7ZW5kcG9pbnQ6IGVuZHBvaW50LCBtYXJrZXJzOiBbInB1YmxpY1JlYWQiXX0pOwp9CmVsc2UKeyAgICAKICAgIHJlY29yZERhdGEgPSBhd2FpdCBvcy5yZWNvcmREYXRhKHVzZXJSZWNvcmQsIHJlY29yZE5hbWUsIHJlY29yZERhdGEsIHtlbmRwb2ludDogZW5kcG9pbnQsIG1hcmtlcnM6IFtyZWNvcmROYW1lXX0pOwp9CgppZiAocmVjb3JkRGF0YS5zdWNjZXNzKQp7CiAgICBhYi5sb2coYWJSZW1lbWJlci50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogZGF0YSByZWNvcmRlZCB0byAiICsgdXNlclJlY29yZCk7Cn0KZWxzZQp7CiAgICBhYi5sb2coYWJSZW1lbWJlci50YWdzLmFiQnVpbGRlcklkZW50aXR5ICsgIjogZGF0YSBmYWlsZWQgdG8gcmVjb3JkIik7Cn0KCnJldHVybiByZWNvcmREYXRhOycA3v7i4AzkgQENYWJQdWJsaXNoRmlsZQIEAN7+4uAM74gB2QVAYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsKCmxldCBmaWxlID0gdGhhdC5maWxlOwpsZXQgZmlsZU5hbWUgPSB0aGF0LmZpbGVOYW1lOwpsZXQgbWltZVR5cGUgPSB0aGF0Lm1pbWVUeXBlOwpsZXQgdXNlclJlY29yZCA9IGNvbmZpZ0JvdC50YWdzLnNlbGVjdGVkX3N0dWRpb0lEID8/IGF1dGhCb3QuaWQ7CgppZiAoIWZpbGUpCnsKICAgIHJldHVybiAibm8gZmlsZSBzdXBwbGllZCI7Cn0KCmxldCBmaWxlVXBsb2FkID0gYXdhaXQgb3MucmVjb3JkRmlsZSh1c2VyUmVjb3JkLCBmaWxlLCB7ZGVzY3JpcHRpb246IGZpbGVOYW1lLCBtaW1lVHlwZTogbWltZVR5cGV9KTsKICAgIAppZiAoIWZpbGVVcGxvYWQuc3VjY2VzcykgCnsKICAgIGF3YWl0IG9zLmdyYW50SW5zdEFkbWluUGVybWlzc2lvbih1c2VyUmVjb3JkKTsKCiAgICBmaWxlVXBsb2FkID0gYXdhaXQgb3MucmVjb3JkRmlsZSh1c2VyUmVjb3JkLCBmaWxlLCB7ZGVzY3JpcHRpb246IGZpbGVOYW1lLCBtaW1lVHlwZTogbWltZVR5cGV9KTsKfQoKaWYgKGZpbGVVcGxvYWQuc3VjY2VzcykKewogICAgYWIubG9nKGFiUmVtZW1iZXIudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IGZpbGUgcmVjb3JkZWQgdG8gIiArIHVzZXJSZWNvcmQpOwp9CmVsc2UKewogICAgYWIubG9nKGFiUmVtZW1iZXIudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IGZpbGUgZmFpbGVkIHRvIHJlY29yZCIpOwp9CgpyZXR1cm4gZmlsZVVwbG9hZDsnAN7+4uAM5IEBEGFiQ29yZU1lbnVBY3Rpb24CBADe/uLgDMmOAU1AYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsKCi8vc2V0IHVwIHRoZSBwdWJsaXNoIG1lbnUKdGhpc0JvdC5vblN0b3JlTWVudSgpOycA3v7i4AzkgQELb25TdG9yZU1lbnUCBADe/uLgDJePAY6JAUBjb25zdCB0YXJnZXRCb3RzID0gWy4uLm5ldyBTZXQobGlua3MucmVtZW1iZXIubGlua3MuYWJNdWx0aXBsZUJvdEZvY3VzKV07CmNvbnN0IHBvc3NpYmxlUHVibGlzaEJvdCA9IHRhcmdldEJvdHM/Lmxlbmd0aCA+IDAgPyB0YXJnZXRCb3RzIDogbGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1cyA/IFtsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzXSA6IFtdOwpjb25zdCBiYXNlQUIgPSAhbGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1cyA/IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCOiBsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzLmlkOwpjb25zdCBiYXNlQm90cyA9IGdldEJvdHMoYnlNb2Qoe2FiSURPcmlnaW46IGJhc2VBQiwgc3BhY2U6ICJzaGFyZWQiLCBhYklnbm9yZTogbnVsbH0pKTsKY29uc3Qgbm9uQUJCb3RzID0gZ2V0Qm90cyhieU1vZCh7YWJJRE9yaWdpbjogbnVsbCwgc3BhY2U6ICJzaGFyZWQiLCBhYklnbm9yZTogbnVsbH0pKTsKCnNob3V0KCJhYk1lbnVSZWZyZXNoIik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYk1lbnUiOwoKbGlua3MubWVudS5tYXNrcy5vbkdyaWRDbGljayA9ICJAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOyI7Cgpjb25zdCBkZWZhdWx0cyA9IHsKICAgIGFiTWVudTogdHJ1ZSwKICAgIGFiTWVudVJlZnJlc2g6ICJAIGRlc3Ryb3kodGhpc0JvdCk7IiwKICAgIGNvbG9yOiBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yLAogICAgbWFuYWdlcjogIvCflJciICsgdGhpc0JvdC5pZCwKICAgIG1hbmlmZXN0YXRpb246IHRhZ3MubWFuaWZlc3RhdGlvbiwKICAgIHJlbWVtYmVyOiB0YWdzLnJlbWVtYmVyLAogICAgbWVudUl0ZW1TdHlsZTogYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjBweCIsICJtYXJnaW4tdG9wIjogIjBweCJ9YAp9CgovLyBDcmVhdGUgZG93bmxvYWQgYnV0dG9uCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHsKICAgIC4uLmRlZmF1bHRzLAogICAgYWJNZW51U29ydE9yZGVyOiA5LAogICAgbGFiZWw6ICJkb3dubG9hZCIsCiAgICBtZW51SXRlbVN0eWxlOiBg8J+nrCB7ImJvcmRlci1yYWRpdXMiOiAiOXB4IDlweCA5cHggOXB4IiwgIm1hcmdpbi10b3AiOiAiM3B4In1gLAogICAgZm9ybUFkZHJlc3M6ICJnZXRfYXBwIiwKICAgIHBvc3NpYmxlQm90OiBnZXRMaW5rKHBvc3NpYmxlUHVibGlzaEJvdCksCiAgICBvbkNsaWNrOiBgQCBsaW5rcy5tYW5hZ2VyLmFiRG93bmxvYWQoe2Jhc2VBQjogbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIsIHBvc3NpYmxlQm90czogbGlua3MucG9zc2libGVCb3R9KTtgCn0pOwoKaWYgKCFhdXRoQm90KSAKewogICAgLy8gQ3JlYXRlIGxvZ2luIG1lc3NhZ2UKICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHsKICAgICAgICAuLi5kZWZhdWx0cywKICAgICAgICBhYk1lbnVTb3J0T3JkZXI6IDksCiAgICAgICAgbGFiZWw6ICJwbGVhc2Ugc2lnbiBpbiB0byBhY2Nlc3Mgc2hhcmUgZmVhdHVyZXMiLAogICAgICAgIGZvcm1BZGRyZXNzOiAibG9jayIsCiAgICAgICAgb25DbGljazogYEAgb3MucmVxdWVzdEF1dGhCb3QoKWAKICAgIH0pOwoKICAgIHJldHVybjsKfQplbHNlIGlmIChhdXRoQm90LnRhZ3Muc3Vic2NyaXB0aW9uVGllciA9PSAiRnJlZVBsYXkiKSAKewogICAgLy8gQ3JlYXRlIHVwZ3JhZGUgc3Vic2NyaXB0aW9uIGJ1dHRvbgogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oewogICAgICAgIC4uLmRlZmF1bHRzLAogICAgICAgIGxhYmVsOiAicGxlYXNlIHVwZ3JhZGUgeW91ciBzdWJzY3JpcHRpb24gdG8gYWNjZXNzIHNoYXJlIGZlYXR1cmVzIiwKICAgICAgICBmb3JtQWRkcmVzczogImxvY2siCiAgICB9KTsKCiAgICByZXR1cm47Cn0KCgpsZXQgdXNlclN0dWRpb3MgPSBjb25maWdCb3QudGFncy51c2VyX3N0dWRpb3M7CgppZiAoIXVzZXJTdHVkaW9zKSAKewogICAgdXNlclN0dWRpb3MgPSBhd2FpdCBvcy5saXN0VXNlclN0dWRpb3MoKTsKfQoKaWYgKHVzZXJTdHVkaW9zLnN1Y2Nlc3MpIAp7CiAgICBjb25zdCBhY3RpdmVTdHVkaW8gPSB1c2VyU3R1ZGlvcy5zdHVkaW9zLmZpbmRJbmRleChzdHVkaW8gPT4gc3R1ZGlvLnN0dWRpb0lkID09IGNvbmZpZ0JvdC50YWdzLnNlbGVjdGVkX3N0dWRpb0lEKTsKCiAgICBsZXQgYmFzZVN0dWRpbyA9IGF1dGhCb3QuaWQ7CgogICAgaWYgKGJhc2VTdHVkaW8gPT0gYXV0aEJvdC5pZCkgCiAgICB7CiAgICAgICAgYmFzZVN0dWRpbyA9ICJwbGF5ZXIiOwogICAgfQoKICAgIGlmIChhY3RpdmVTdHVkaW8gPT0gLTEgJiYgYmFzZVN0dWRpbyAhPSAicGxheWVyIikgCiAgICB7CiAgICAgICAgY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQgPSBiYXNlU3R1ZGlvOwogICAgfQoKICAgIGlmIChjb25maWdCb3QudGFncy5zdHVkaW8gJiYgIWFjdGl2ZVN0dWRpbykgCiAgICB7CiAgICAgICAgY29uc3Qgc3R1ZGlvTWF0Y2ggPSB1c2VyU3R1ZGlvcy5zdHVkaW9zLmZpbmRJbmRleChzdHVkaW8gPT4gc3R1ZGlvLnN0dWRpb0lkID09IGNvbmZpZ0JvdC50YWdzLnN0dWRpbykKCiAgICAgICAgaWYgKHN0dWRpb01hdGNoICE9IC0xKSB7CiAgICAgICAgICAgIGJhc2VTdHVkaW8gPSBiYXNlU3R1ZGlvOwogICAgICAgIH0KICAgIH0KCiAgICBjb25zdCBzdHVkaW9MYWJlbCA9IGFjdGl2ZVN0dWRpbyA9PSAtMSA/IGJhc2VTdHVkaW8gOiB1c2VyU3R1ZGlvcy5zdHVkaW9zW2FjdGl2ZVN0dWRpb10uZGlzcGxheU5hbWU7CgogICAgLy8gQ3JlYXRlIHN0dWRpbyBzZWxlY3QgYnV0dG9uCiAgICBjb25zdCBzdHVkaW9EaXNwbGF5QnV0dG9uID0gbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oewogICAgICAgIC4uLmRlZmF1bHRzLAogICAgICAgIGxhYmVsOiAic3R1ZGlvPSIgKyBzdHVkaW9MYWJlbCwKICAgICAgICBhYk1lbnVTb3J0T3JkZXI6IDEuNSwKICAgICAgICBzdHVkaW9JbmZvcm1hdGlvbjogdXNlclN0dWRpb3MsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJpbnZlbnRvcnlfMiIsCiAgICAgICAgb25DbGljazogYEAgbGlua3MubWFuYWdlci5zdHVkaW9TZWxlY3QodGFncy5zdHVkaW9JbmZvcm1hdGlvbik7YAogICAgfSk7CgogICAgbWFza3Muc3R1ZGlvU2VsZWN0QnV0dG9uID0gZ2V0TGluayhzdHVkaW9EaXNwbGF5QnV0dG9uKTsKfQoKY29uc3QgdG90YWxCb3RDb3VudCA9IHBvc3NpYmxlUHVibGlzaEJvdC5sZW5ndGggPiAwID8gcG9zc2libGVQdWJsaXNoQm90Lmxlbmd0aCA6IGJhc2VCb3RzLmxlbmd0aCArIG5vbkFCQm90cy5sZW5ndGg7CgovLyBDcmVhdGUgcHVibGlzaCBsYWJlbCBidXR0b24KY29uc3QgbGFiZWxCb3QgPSBhd2FpdCBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbih7CiAgICAuLi5kZWZhdWx0cywKICAgIGxhYmVsOiBgcHVibGlzaCBwYXR0ZXJuICR7YmFzZUJvdHMubGVuZ3RoID4gMCA/ICIiIDogImFzICJ9JHtiYXNlQUJ9ICgke3RvdGFsQm90Q291bnR9IGJvdCR7YmFzZUJvdHMubGVuZ3RoICsgbm9uQUJCb3RzLmxlbmd0aCA9PSAxID8gIiIgOiAicyJ9KWAsCiAgICB0b3RhbEJvdHM6IGJhc2VCb3RzLmxlbmd0aCArIG5vbkFCQm90cy5sZW5ndGgsCiAgICBhYk1lbnVTb3J0T3JkZXI6IDEsCiAgICBsYWJlbEFsaWdubWVudDogImNlbnRlciIsCiAgICBmb3JtQWRkcmVzczogbnVsbCwKICAgIG1lbnVJdGVtU3R5bGU6IGDwn6esIHsiYm9yZGVyLXJhZGl1cyI6ICI5cHggOXB4IDBweCAwcHgiLCAibWFyZ2luLXRvcCI6ICIzcHgifWAsCiAgICBzaGlmdFN0YXRlOiBmYWxzZSwKICAgIG9uQ2xpY2s6IGBAIGNvbnN0IG1lbnVCb3RzID0gZ2V0Qm90cygnYWJNZW51U29ydE9yZGVyJyk7CgogICAgICAgIGlmICh0YWdzLnNoaWZ0U3RhdGUpCiAgICAgICAgewogICAgICAgICAgICB3aGlzcGVyKG1lbnVCb3RzLCAib25LZXlVcCIsIHtrZXlzOiBbIlNoaWZ0Il19KTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgd2hpc3BlcihtZW51Qm90cywgIm9uS2V5RG93biIsIHtrZXlzOiBbIlNoaWZ0Il19KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdGFncy5zaGlmdFN0YXRlID0gIXRhZ3Muc2hpZnRTdGF0ZTtgLAogICAgc2NhbGVZOiAiYXV0byIsCiAgICBhYlNlbGVjdFRpdGxlVXBkYXRlOiBgQCBsZXQgdG90YWxCb3RzID0gY29uZmlnQm90LnRhZ3MuYWJFeGNsdWRlVW5jbGFpbWVkID8gdGhhdC5hYkJvdHMgOiB0aGF0LmFiQm90cyArIHRoYXQubm9uQUJCb3RzOwoKICAgIGNvbnN0IHRvdGFsQm90VmFyID0gdG90YWxCb3RzID09IDEgPyAiIGJvdCkiIDogIiBib3RzKSI7CiAgICBjb25zdCBib3RWYXIgPSB0aGF0Lm5vbkFCQm90cz8ubGVuZ3RoICA9PSAxID8gIiBib3QpIiA6ICIgYm90cykiOwoKICAgIGlmICh0aGF0LmFiID09ICJuZXcgcGF0dGVybiIpCiAgICB7CiAgICAgICAgbGlua3MucmVtZW1iZXIubWFza3MuYmFzZUFCID0gbnVsbDsKCiAgICAgICAgaWYgKGdldEJvdCgiYWJJRE9yaWdpbiIsIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCKSkKICAgICAgICB7CiAgICAgICAgICAgIGNvbnN0IGFiQm90cyA9IGdldEJvdHMoYnlNb2Qoe2FiSURPcmlnaW46IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCLCBzcGFjZTogInNoYXJlZCIsIGFiSWdub3JlOiBudWxsfSkpLmxlbmd0aDsKCiAgICAgICAgICAgIHRhZ3MubGFiZWwgPSAicHVibGlzaCAiICsgbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIgKyAiICgiICsgYWJCb3RzICsgIiBib3RzKSI7CgogICAgICAgICAgICB0YWdzLnRvdGFsQm90cyA9IGFiQm90czsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgdGFncy5sYWJlbCA9ICJwdWJsaXNoIHBhdHRlcm4gYXMgIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCICsgIiAoIiArIHRvdGFsQm90cyArIHRvdGFsQm90VmFyICsgIikiOwoKICAgICAgICAgICAgdGFncy50b3RhbEJvdHMgPSB0b3RhbEJvdHM7CiAgICAgICAgfSAgIAogICAgfQogICAgZWxzZQogICAgeyAgIAogICAgICAgIHRhZ3MubGFiZWwgPSAicHVibGlzaCAiICsgdGhhdC5hYiArICIgKCIgKyB0b3RhbEJvdHMgKyB0b3RhbEJvdFZhciArICIpIjs7CgogICAgICAgIHRhZ3MudG90YWxCb3RzID0gdG90YWxCb3RzOwogICAgfWAKfSk7CgovLyBDcmVhdGUgZW5jcnlwdCBidXR0b24KbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oewogICAgLi4uZGVmYXVsdHMsCiAgICBhYk1lbnU6IG51bGwsCiAgICBhYk1lbnVTb3J0T3JkZXI6IDIsCiAgICBkaW1lbnNpb246ICJhYk1lbnUiLAogICAgbGFiZWw6ICJlbmNyeXB0IiwKICAgIGZvcm1BZGRyZXNzOiAiY2hlY2tfYm94X291dGxpbmVfYmxhbmsiLAogICAgZW5jcnlwdFN0YXRlOiBmYWxzZSwKICAgIG9uS2V5RG93bjogYEAgaWYgKHRoYXQua2V5c1swXSA9PSAiU2hpZnQiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IHRydWU7CiAgICAgICAgICAgIH1gLAogICAgb25LZXlVcDogYEAgaWYgKHRoYXQua2V5c1swXSA9PSAiU2hpZnQiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IGZhbHNlOwogICAgICAgICAgICB9YCwKICAgIG9uQ2xpY2s6IGBAIGlmKHRhZ3MuZW5jcnlwdFN0YXRlKQogICAgICAgIHsKICAgICAgICAgICAgdGFncy5lbmNyeXB0U3RhdGUgPSBmYWxzZTsKICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3hfb3V0bGluZV9ibGFuayc7CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLmVuY3J5cHRpb24gPSBudWxsOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICB0YWdzLmVuY3J5cHRTdGF0ZSA9IHRydWU7CiAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94JzsKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MuZW5jcnlwdGlvbiA9IHRydWU7CiAgICAgICAgfWAsCn0pOwoKbGV0IGFiQnV0dG9uOwoKaWYgKHBvc3NpYmxlUHVibGlzaEJvdD8ubGVuZ3RoIDwgMSkKewogICAgLy8gQ3JlYXRlIGluY2x1ZGVCb3RzIGJ1dHRvbgogICAgYWJCdXR0b24gPSBhd2FpdCBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbih7CiAgICAgICAgLi4uZGVmYXVsdHMsCiAgICAgICAgYWJNZW51OiBudWxsLAogICAgICAgIGRpbWVuc2lvbjogJ2FiTWVudScsCiAgICAgICAgYWJNZW51U29ydE9yZGVyOiAxLjUyLAogICAgICAgIGFiU2VsZWN0aW9uQnV0dG9uOiB0cnVlLAogICAgICAgIGxhYmVsOiBiYXNlQm90cy5sZW5ndGggPiAwICYmIGJhc2VBQiAhPSB1bmRlZmluZWQgPyBgc2VsZWN0ZWQgcGF0dGVybjogJHtiYXNlQUJ9ICgke2Jhc2VCb3RzLmxlbmd0aH0gYm90JHtiYXNlQm90cy5sZW5ndGggPT0gMSA/ICIiIDogInMifSlgIDogYG5ldyBwYXR0ZXJuICgke25vbkFCQm90cy5sZW5ndGh9IGJvdCR7bm9uQUJCb3RzLmxlbmd0aCA9PSAxID8gIiIgOiAicyJ9KWAsCiAgICAgICAgZm9ybUFkZHJlc3M6ICdlZ2cnLAogICAgICAgIG9uS2V5RG93bjogYEAgaWYgKHRoYXQua2V5c1swXSA9PSAiU2hpZnQiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IHRydWU7CiAgICAgICAgICAgIH1gLAogICAgICAgIG9uS2V5VXA6IGBAIGlmICh0aGF0LmtleXNbMF0gPT0gIlNoaWZ0IikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSBmYWxzZTsKICAgICAgICAgICAgfWAsCiAgICAgICAgb25DbGljazogYEAgbGlua3MubWFuYWdlci5hYlB1Ymxpc2hTZWxlY3QoKTtgLAogICAgICAgIGFiU2VsZWN0VGl0bGVVcGRhdGU6IGBAIGNvbnN0IGJvdFZhck5vbiA9IHRoYXQubm9uQUJCb3RzICA9PSAxID8gIiBib3QpIiA6ICIgYm90cykiOwogICAgICAgIGNvbnN0IGJvdFZhckFCID0gdGhhdC5hYkJvdHMgID09IDEgPyAiIGJvdCkiIDogIiBib3RzKSI7CgogICAgICAgIGlmICh0aGF0LmFiID09ICJuZXcgcGF0dGVybiIpCiAgICAgICAgewogICAgICAgICAgICB0YWdzLmxhYmVsID0gdGhhdC5hYiArICIgKCIgKyB0aGF0Lm5vbkFCQm90cyArIGJvdFZhck5vbjsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgdGFncy5sYWJlbCA9ICJzZWxlY3RlZCBwYXR0ZXJuOiAiICsgdGhhdC5hYiArICIgKCIgKyB0aGF0LmFiQm90cyArIGJvdFZhckFCOwogICAgICAgIH1gCiAgICB9KTsKfQoKaWYgKG5vbkFCQm90cy5sZW5ndGggPiAwICYmIHBvc3NpYmxlUHVibGlzaEJvdD8ubGVuZ3RoIDwgMSkKewogICAgLy9pY2x1ZGUgbmV3IGJvdHMKICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHsKICAgICAgICAuLi5kZWZhdWx0cywKICAgICAgICBhYk1lbnU6IG51bGwsCiAgICAgICAgYWJNZW51U29ydE9yZGVyOiAxLjUzLAogICAgICAgIGFiQnV0dG9uOiBnZXRMaW5rKGFiQnV0dG9uKSwKICAgICAgICBsYWJlbEJvdDogZ2V0TGluayhsYWJlbEJvdCksCiAgICAgICAgZGltZW5zaW9uOiAiYWJNZW51IiwKICAgICAgICBsYWJlbDogYGluY2x1ZGUgbmV3ICgke25vbkFCQm90cy5sZW5ndGh9IGJvdCR7bm9uQUJCb3RzLmxlbmd0aCA9PSAxID8gIiIgOiAicyJ9KWAsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJjaGVja19ib3giLAogICAgICAgIHVuY2xhaW1lZFN0YXRlOiBmYWxzZSwKICAgICAgICBvbktleURvd246IGBAIGlmICh0aGF0LmtleXNbMF0gPT0gIlNoaWZ0IikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSB0cnVlOwoKICAgICAgICAgICAgICAgIGNvbnN0IGxhYmVsQ2hlY2sgPSBsaW5rcy5hYkJ1dHRvbi50YWdzLmxhYmVsOwoKICAgICAgICAgICAgICAgIGlmIChsYWJlbENoZWNrLmluY2x1ZGVzKCduZXcgcGF0dGVybicpKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG1hc2tzW3RhZ3MuZGltZW5zaW9uXSA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG1hc2tzW3RhZ3MuZGltZW5zaW9uXSA9IG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1gLAogICAgICAgIG9uS2V5VXA6IGBAIGlmICh0aGF0LmtleXNbMF0gPT0gIlNoaWZ0IikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSBmYWxzZTsKICAgICAgICAgICAgfWAsCiAgICAgICAgb25DbGljazogYEAgY29uc3QgYWJCb3RzID0gZ2V0Qm90cyhieU1vZCh7YWJJRE9yaWdpbjogbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIsIHNwYWNlOiAic2hhcmVkIiwgYWJJZ25vcmU6IG51bGx9KSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZih0YWdzLnVuY2xhaW1lZFN0YXRlKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb25zdCBub25BQkJvdHMgPSBnZXRCb3RzKGJ5TW9kKHthYklET3JpZ2luOiBudWxsLCBzcGFjZTogInNoYXJlZCIsIGFiSWdub3JlOiBudWxsfSkpOwoKICAgICAgICAgICAgICAgIHRhZ3MudW5jbGFpbWVkU3RhdGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94JzsKICAgICAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLmFiRXhjbHVkZVVuY2xhaW1lZCA9IG51bGw7CgogICAgICAgICAgICAgICAgbGlua3MubGFiZWxCb3QuYWJTZWxlY3RUaXRsZVVwZGF0ZSh7YWI6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCLCBhYkJvdHM6IGFiQm90cy5sZW5ndGgsIG5vbkFCQm90czogbm9uQUJCb3RzLmxlbmd0aH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGFncy51bmNsYWltZWRTdGF0ZSA9IHRydWU7CiAgICAgICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gJ2NoZWNrX2JveF9vdXRsaW5lX2JsYW5rJzsKCiAgICAgICAgICAgICAgICBjb25maWdCb3QudGFncy5hYkV4Y2x1ZGVVbmNsYWltZWQgPSB0cnVlOwoKICAgICAgICAgICAgICAgIGxpbmtzLmxhYmVsQm90LmFiU2VsZWN0VGl0bGVVcGRhdGUoe2FiOiBsaW5rcy5yZW1lbWJlci50YWdzLmJhc2VBQiwgYWJCb3RzOiBhYkJvdHMubGVuZ3RoLCBub25BQkJvdHM6IDB9KTsKICAgICAgICAgICAgfWAsCiAgICAgICAgYWJTZWxlY3RUaXRsZVVwZGF0ZTogYEAgY29uc3QgYm90VmFyID0gdGhhdC5ub25BQkJvdHMgPT0gMSA/ICIgYm90KSIgOiAiIGJvdHMpIjsKICAgICAgICAKICAgICAgICAgICAgdGFncy5sYWJlbCA9ICJpbmNsdWRlIG5ldyAoIiArIHRoYXQubm9uQUJCb3RzICsgYm90VmFyOwoKICAgICAgICAgICAgY29uc3QgbGFiZWxDaGVjayA9IHRoYXQuYWI7CgogICAgICAgICAgICBpZighbGFiZWxDaGVjay5pbmNsdWRlcygnbmV3IHBhdHRlcm4nKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbWFza3NbdGFncy5kaW1lbnNpb25dID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIG1hc2tzW3RhZ3MuZGltZW5zaW9uXSA9IGZhbHNlOwogICAgICAgICAgICB9YAogICAgfSk7Cn0KCi8vIENyZWF0ZSBwdWJsaWMgYnV0dG9uCmlmIChhdXRoQm90LnRhZ3MucHJpdmFjeUZlYXR1cmVzLmFsbG93UHVibGljRGF0YSkgCnsKICAgIGNvbmZpZ0JvdC50YWdzLnB1YmxpY0ZhY2luZyA9IGZhbHNlOwoKICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHsKICAgICAgICAuLi5kZWZhdWx0cywKICAgICAgICBhYk1lbnVTb3J0T3JkZXI6IDIsCiAgICAgICAgbGFiZWw6ICJpc1B1YmxpYyIsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJjaGVja19ib3hfb3V0bGluZV9ibGFuayIsCiAgICAgICAgcHVibGljU3RhdGU6IGZhbHNlLAogICAgICAgIG9uQ2xpY2s6IGBAIGlmKHRhZ3MucHVibGljU3RhdGUpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRhZ3MucHVibGljU3RhdGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRhZ3MuZm9ybUFkZHJlc3MgPSAnY2hlY2tfYm94X291dGxpbmVfYmxhbmsnOwogICAgICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MucHVibGljRmFjaW5nID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRhZ3MucHVibGljU3RhdGUgPSB0cnVlOwogICAgICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9ICdjaGVja19ib3gnOwogICAgICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MucHVibGljRmFjaW5nID0gdHJ1ZTsKICAgICAgICAgICAgfWAKICAgIH0pOwp9CgovLyBDcmVhdGUgdmVyc2lvbiBzZWxlY3QgYnV0dG9uCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKHsKICAgIC4uLmRlZmF1bHRzLAogICAgYWJNZW51OiBudWxsLAogICAgZGltZW5zaW9uOiAnYWJNZW51JywKICAgIGFiTWVudVNvcnRPcmRlcjogMS41MSwKICAgIGxhYmVsOiAndmVyc2lvbkZsYWc9Y3VycmVudCcsCiAgICBmb3JtQWRkcmVzczogJ2FsdF9yb3V0ZScsCiAgICBzaG93VmVyc2lvblNlbGVjdG9yOiBgQCB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IG51bGw7YCwKICAgIGhpZGVWZXJzaW9uU2VsZWN0b3I6IGBAIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gdHJ1ZTtgLAogICAgb25LZXlEb3duOiBgQCBpZiAodGhhdC5rZXlzWzBdID09ICJTaGlmdCIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gdHJ1ZTsKICAgICAgICAgICAgfWAsCiAgICBvbktleVVwOiBgQCBpZiAodGhhdC5rZXlzWzBdID09ICJTaGlmdCIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gZmFsc2U7CiAgICAgICAgICAgIH1gLAogICAgb25DbGljazogYEAgc2hvdXQoJ3Nob3dWZXJzaW9uU2VsZWN0b3InKTtgLAogICAgdmVyc2lvbk9wdGlvbkNsaWNrOiBgQAogICAgICAgICAgICB0YWdzLmxhYmVsID0gJ3ZlcnNpb25GbGFnPScgKyB0aGF0OwogICAgICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IHRydWU7CiAgICAgICAgYCwKfSk7CgovLyBDdXJyZW50IFZlcnNpb24KbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oewogICAgLi4uZGVmYXVsdHMsCiAgICBhYk1lbnU6IG51bGwsCiAgICBsYWJlbDogJ2N1cnJlbnQnLAogICAgZGltZW5zaW9uOiAnYWJNZW51JywKICAgIGFiTWVudVNvcnRPcmRlcjogMS41MSwKICAgIGZvcm1BZGRyZXNzOiAncmFkaW9fYnV0dG9uX2NoZWNrZWQnLAogICAgc2hvd1ZlcnNpb25TZWxlY3RvcjogYEAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSB0cnVlO2AsCiAgICBoaWRlVmVyc2lvblNlbGVjdG9yOiBgQCB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IG51bGw7YCwKICAgIG9uS2V5VXA6IGBAIGlmICh0aGF0LmtleXNbMF0gPT0gIlNoaWZ0IikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSBmYWxzZTsKICAgICAgICAgICAgfWAsCiAgICBvbkNsaWNrOiBgQAogICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gJ3JhZGlvX2J1dHRvbl9jaGVja2VkJzsKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MudmVyc2lvbkRlZmluZWQgPSBudWxsOwogICAgICAgICAgICBzaG91dCgndmVyc2lvbk9wdGlvbkNsaWNrJywgdGFncy5sYWJlbCk7CiAgICAgICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gbnVsbDsKICAgICAgICBgLAogICAgdmVyc2lvbk9wdGlvbkNsaWNrOiBgQCBpZiAodGhhdCA9PSB0YWdzLmxhYmVsKSB7IHJldHVybjsgfQogICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gJ3JhZGlvX2J1dHRvbl91bmNoZWNrZWQnOwogICAgICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IG51bGw7CiAgICAgICAgYAp9KTsKCi8vIEZlZWRiYWNrIFZlcnNpb24KbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oewogICAgLi4uZGVmYXVsdHMsCiAgICBhYk1lbnU6IG51bGwsCiAgICBsYWJlbDogJ2ZlZWRiYWNrJywKICAgIGRpbWVuc2lvbjogJ2FiTWVudScsCiAgICBhYk1lbnVTb3J0T3JkZXI6IDEuNTExLAogICAgZm9ybUFkZHJlc3M6ICdyYWRpb19idXR0b25fdW5jaGVja2VkJywKICAgIHNob3dWZXJzaW9uU2VsZWN0b3I6IGBAIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gdHJ1ZTtgLAogICAgaGlkZVZlcnNpb25TZWxlY3RvcjogYEAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSBudWxsO2AsCiAgICBvbktleVVwOiBgQCBpZiAodGhhdC5rZXlzWzBdID09ICJTaGlmdCIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRhZ3NbdGFncy5kaW1lbnNpb25dID0gZmFsc2U7CiAgICAgICAgICAgIH1gLAogICAgb25DbGljazogYEAKICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9ICdyYWRpb19idXR0b25fY2hlY2tlZCc7CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnZlcnNpb25EZWZpbmVkID0gJ2ZlZWRiYWNrJzsKICAgICAgICAgICAgc2hvdXQoJ3ZlcnNpb25PcHRpb25DbGljaycsIHRhZ3MubGFiZWwpOwogICAgICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IG51bGw7CiAgICAgICAgYCwKICAgIHZlcnNpb25PcHRpb25DbGljazogYEAgaWYgKHRoYXQgPT0gdGFncy5sYWJlbCkgeyByZXR1cm47IH0KICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9ICdyYWRpb19idXR0b25fdW5jaGVja2VkJzsKICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSBudWxsOwogICAgICAgIGAKfSk7CgovLyBTdGFibGUgVmVyc2lvbgpsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbih7CiAgICAuLi5kZWZhdWx0cywKICAgIGFiTWVudTogbnVsbCwKICAgIGxhYmVsOiAnc3RhYmxlJywKICAgIGRpbWVuc2lvbjogJ2FiTWVudScsCiAgICBhYk1lbnVTb3J0T3JkZXI6IDEuNTEyLAogICAgZm9ybUFkZHJlc3M6ICdyYWRpb19idXR0b25fdW5jaGVja2VkJywKICAgIC8vbWVudUl0ZW1TdHlsZTogYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjAgMCA4cHggOHB4In1gLAogICAgc2hvd1ZlcnNpb25TZWxlY3RvcjogYEAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSB0cnVlO2AsCiAgICBoaWRlVmVyc2lvblNlbGVjdG9yOiBgQCB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IG51bGw7YCwKICAgIG9uS2V5VXA6IGBAIGlmICh0aGF0LmtleXNbMF0gPT0gIlNoaWZ0IikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSBmYWxzZTsKICAgICAgICAgICAgfWAsCiAgICBvbkNsaWNrOiBgQAogICAgICAgICAgICB0YWdzLmZvcm1BZGRyZXNzID0gJ3JhZGlvX2J1dHRvbl9jaGVja2VkJzsKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MudmVyc2lvbkRlZmluZWQgPSAnc3RhYmxlJzsKICAgICAgICAgICAgc2hvdXQoJ3ZlcnNpb25PcHRpb25DbGljaycsIHRhZ3MubGFiZWwpOwogICAgICAgICAgICB0YWdzW3RhZ3MuZGltZW5zaW9uXSA9IG51bGw7CiAgICAgICAgYCwKICAgIHZlcnNpb25PcHRpb25DbGljazogYEAgaWYgKHRoYXQgPT0gdGFncy5sYWJlbCkgeyByZXR1cm47IH0KICAgICAgICAgICAgdGFncy5mb3JtQWRkcmVzcyA9ICdyYWRpb19idXR0b25fdW5jaGVja2VkJzsKICAgICAgICAgICAgdGFnc1t0YWdzLmRpbWVuc2lvbl0gPSBudWxsOwogICAgICAgIGAKfSk7CgovLyBDcmVhdGUgcHVibGlzaCBidXR0b24KbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oewogICAgLi4uZGVmYXVsdHMsCiAgICBhYk1lbnVTb3J0T3JkZXI6IDQsCiAgICBmb3JtQWRkcmVzczogImVnZyIsCiAgICBtZW51SXRlbVN0eWxlOiBg8J+nrCB7ImJvcmRlci1yYWRpdXMiOiAiMHB4IDBweCA5cHggOXB4IiwgIm1hcmdpbi10b3AiOiAiMHB4In1gLAogICAgZm9ybTogImlucHV0IiwKICAgIGxhYmVsQm90OiBnZXRMaW5rKGxhYmVsQm90KSwKICAgIG9uSW5wdXRUeXBpbmc6IGBAIGxpbmtzLmxhYmVsQm90LnRhZ3MubGFiZWwgPSAncHVibGlzaCBwYXR0ZXJuIGFzICcgKyB0aGF0LnRleHQgKyAnICgnICsgbGlua3MubGFiZWxCb3QudGFncy50b3RhbEJvdHMgKyAnIGJvdCcgKyAobGlua3MubGFiZWxCb3QudGFncy50b3RhbEJvdHMgPT0gMSA/ICcpJyA6ICdzKScpO2AsCiAgICBtZW51SXRlbVNob3dTdWJtaXRXaGVuRW1wdHk6IHRydWUsCiAgICB0YXJnZXRCb3Q6IGdldExpbmsocG9zc2libGVQdWJsaXNoQm90KSwKICAgIG1lbnVJdGVtVGV4dDogYmFzZUFCLAogICAgb25TdWJtaXQ6IGBACiAgICAgICAgICAgIGlmICh0aGF0LnRleHQgPT0gbnVsbCAmJiBsaW5rcy5yZW1lbWJlci50YWdzLmJhc2VBQiAmJiAhbGlua3MucmVtZW1iZXIubGlua3MuYWJCb3RGb2N1cykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGhhdC50ZXh0ID0gbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IHRhcmdldFN0dWRpbyA9IGNvbmZpZ0JvdC50YWdzLnNlbGVjdGVkX3N0dWRpb0lEID8/IGF1dGhCb3QuaWQ7CiAgICAgICAgICAgIGNvbnN0IGNvbmZpcm1QdXNoID0gYXdhaXQgb3Muc2hvd0NvbmZpcm0oewogICAgICAgICAgICAgICAgdGl0bGU6ICJjb25maXJtIHB1Ymxpc2giLAogICAgICAgICAgICAgICAgY29udGVudDogInB1Ymxpc2ggIiArIHRoYXQudGV4dCArICIgdG8gIiArIHRhcmdldFN0dWRpbyArICI/IiwKICAgICAgICAgICAgICAgIGNvbmZpcm1UZXh0OiAicHVibGlzaCIsCiAgICAgICAgICAgICAgICBjYW5jZWxUZXh0OiAiY2FuY2VsIgogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmICghY29uZmlybVB1c2gpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uZmlnQm90LnRhZ3MubWFudWFsUHVibGlzaCA9IHRydWU7CgogICAgICAgICAgICBpZiAodGhhdC50ZXh0KQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsaW5rcy5tYW5hZ2VyLmFiUHVibGlzaEFCKHthYjogdGhhdC50ZXh0LCBtYW51YWxQdWJsaXNoOiB0cnVlLCBib3Q6IGxpbmtzLnRhcmdldEJvdCwgYmFzZUFCOiBsaW5rcy5yZW1lbWJlci50YWdzLmJhc2VBQn0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgb3MudG9hc3QoImFiIG5vdCBzcGVjaWZpZWQiKTsKICAgICAgICAgICAgfQogICAgICAgIGAsCiAgICBhYlNlbGVjdFRpdGxlVXBkYXRlOiBgQCAKICAgIGlmICh0aGF0LmFiID09ICJuZXcgcGF0dGVybiIpCiAgICB7CiAgICAgICAgbGlua3MucmVtZW1iZXIubWFza3MuYmFzZUFCID0gbnVsbDsKCiAgICAgICAgdGFncy5tZW51SXRlbVRleHQgPSBsaW5rcy5yZW1lbWJlci50YWdzLmJhc2VBQjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICB0YWdzLm1lbnVJdGVtVGV4dCA9IHRoYXQuYWI7CiAgICB9YAp9KTsKCmlmIChsaW5rcy5yZW1lbWJlci5saW5rcy5hYkJvdEZvY3VzKSAKewogICAgLy8gQ3JlYXRlIGNvcHkgdG8gY2xpcGJvYXJkIGJ1dHRvbgogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oewogICAgICAgIC4uLmRlZmF1bHRzLAogICAgICAgIGFiTWVudVNvcnRPcmRlcjogOCwKICAgICAgICBtZW51SXRlbVN0eWxlOiBg8J+nrCB7ImJvcmRlci1yYWRpdXMiOiAiOXB4IDlweCA5cHggOXB4IiwgIm1hcmdpbi10b3AiOiAiM3B4In1gLAogICAgICAgIGxhYmVsOiAiY29weSB0byBjbGlwYm9hcmQiLAogICAgICAgIGZvcm1BZGRyZXNzOiAiZmlsZV9jb3B5IiwKICAgICAgICB0YXJnZXRCb3Q6IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCb3RGb2N1cywKICAgICAgICBvbkNsaWNrOiBgQCBsZXQgc2VsZWN0ZWRCb3QgPSBsaW5rcy50YXJnZXRCb3Q7CiAgICAgICAgICAgIGxldCBwcmVwcGVkQm90ID0gSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRCb3QpOwogICAgICAgICAgICBsZXQgc3RhdGUgPSB7fQoKICAgICAgICAgICAgc3RhdGVbYWJJbnN0TWVtb3J5LnRhZ3MuYWJGb2N1c0RhdGFdID0gc2VsZWN0ZWRCb3Q7CgogICAgICAgICAgICBsZXQgbmV3RmlsZSA9IHt9CiAgICAgICAgICAgIG5ld0ZpbGUudmVyc2lvbiA9IDE7CiAgICAgICAgICAgIG5ld0ZpbGUuc3RhdGUgPSBzdGF0ZTsKCiAgICAgICAgICAgIHZhciBmb3JtYXR0ZWRGaWxlID0gSlNPTi5zdHJpbmdpZnkobmV3RmlsZSk7CiAgICAgICAgICAgIG9zLnNldENsaXBib2FyZChmb3JtYXR0ZWRGaWxlKTsKCiAgICAgICAgICAgIG9zLnRvYXN0KCJib3QgY29waWVkIHRvIGNsaXBib2FyZCIpOwoKICAgICAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKICAgICAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CiAgICAgICAgYCwKICAgIH0pOwp9CmVsc2UgCnsKICAgIC8vIENyZWF0ZSBzY2FuIGJ1dHRvbgogICAgbGlua3MubWVudS5hYkNyZWF0ZU1lbnVCdXR0b24oewogICAgICAgIC4uLmRlZmF1bHRzLAogICAgICAgIGFiTWVudVNvcnRPcmRlcjogMTAsCiAgICAgICAgbWVudUl0ZW1TdHlsZTogYPCfp6wgeyJib3JkZXItcmFkaXVzIjogIjlweCA5cHggOXB4IDlweCIsICJtYXJnaW4tdG9wIjogIjNweCJ9YCwKICAgICAgICBsYWJlbDogInNjYW4gdG8gcHVibGlzaCIsCiAgICAgICAgZm9ybUFkZHJlc3M6ICJxcl9jb2RlX3NjYW5uZXIiLAogICAgICAgIG9uQ2xpY2s6IGBAIGNvbmZpZ0JvdC50YWdzLnB1Ymxpc2hTY2FuID0gdHJ1ZTsgb3Mub3BlblFSQ29kZVNjYW5uZXIoKTtgLAogICAgfSk7Cn0KCmxldCBob3N0QnV0dG9uID0gewogICAgYWJNZW51OiB0cnVlLAogICAgYWJNZW51U29ydE9yZGVyOiA1MCwKICAgIGFiTWVudVJlZnJlc2g6ICJAIGRlc3Ryb3kodGhpc0JvdCk7IiwKICAgIGZvcm1BZGRyZXNzOiAiZ3JvdXBfYWRkIiwKICAgIGNvbG9yOiBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yLAogICAgbGVhcm46IHRhZ3MubGVhcm4sCiAgICBvbkNsaWNrOiBgQCBsaW5rcy5sZWFybi5hYkNyZWF0ZUhvc3QodGhpc0JvdCk7CiAgICBpZiAoIWxpbmtzLnJlbWVtYmVyLnRhZ3MuaG9zdElEKQogICAgewogICAgICAgIHRhZ3MubGFiZWwgPSAnZ2VuZXJhdGluZyBjb2RlIG5vdyc7CiAgICB9YCwKfTsKCmlmIChsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRCkgCnsKICAgIGhvc3RCdXR0b24ubGFiZWwgPSAiam9pbiBjb2RlOiAiICsgbGlua3MucmVtZW1iZXIudGFncy5ob3N0SUQuc3Vic3RyaW5nKDAsIDMpICsgIi0iICsgbGlua3MucmVtZW1iZXIudGFncy5ob3N0SUQuc3Vic3RyaW5nKDMpOwp9CmVsc2UgCnsKICAgIGhvc3RCdXR0b24ubGFiZWwgPSAiZ2VuZXJhdGUgam9pbiBjb2RlIjsKfQoKaWYgKGNvbmZpZ0JvdC50YWdzLnN0YXRpY0luc3QgPT0gdW5kZWZpbmVkKQp7CiAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihob3N0QnV0dG9uKTsvL2dlbmVyYXRlIGEgaG9zdCBidXR0b24KfScA3v7i4AzkgQEOYWJDb3JlTWVudUljb24CBADe/uLgDJaYAglpb3Nfc2hhcmUnAN7+4uAM5IEBD2FiQ29yZU1lbnVMYWJlbAIEAN7+4uAMoJgCBXNoYXJlJwDe/uLgDOSBARNhYkNvcmVNZW51U29ydE9yZGVyAgQA3v7i4AymmAIBMycA3v7i4AzkgQEIcmVtZW1iZXICBADe/uLgDKiYAijwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwDe/uLgDOSBAQthYlB1Ymxpc2hBQgIEAN7+4uAMz5gCsTFALy9zaG91dCgiYWJQdWJsaXNoQUIiLCB7YWI6ICIiLCBrZXk6ICIiLCB0YXJnZXQ6ICIifSk7CmlmICh0aGF0LmFiLmluZGV4T2YoIiAiKSAhPSAtMSB8fCB0aGF0LmFiLmluZGV4T2YoJyInKSAhPSAtMSkKewogICAgb3MudG9hc3QoInBhdHRlcm4gbmFtZXMgbWF5IG5vdCBjb250YWluIHNwYWNlcyBvciBxdW90YWlvbiBtYXJrcywgcGxlYXNlIHRyeSBhZ2Fpbi4iKTsKCiAgICByZXR1cm47Cn0KCmFiLmxvZyhhYlJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBwdWJsaXNoaW5nICIgKyB0aGF0LmFiKTsKCmxldCBwcm9ncmVzc0J1dHRvbjsKCnNob3V0KCJhYk1lbnVSZWZyZXNoIik7CgovL2NsZWFyIGFiIGJ1aWxkZXIKaWYgKGxpbmtzLm1hbmlmZXN0YXRpb24pCnsKICAgIGlmIChsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KQogICAgewogICAgICAgIGRlc3Ryb3kobGlua3MubWFuaWZlc3RhdGlvbi5saW5rcy5hYkJvdCk7CiAgICB9Cn0KCi8vcHJvZ3Jlc3MgYmFyIGZvciBtYW51YWwgcHVibGlzaGluZyBjb25maXJtYXRpb24KaWYgKGNvbmZpZ0JvdC50YWdzLm1hbnVhbFB1Ymxpc2gpCnsKICAgIHByb2dyZXNzQnV0dG9uID0gYXdhaXQgbGlua3MuaW5wdXQuYWJQcm9ncmVzc0JhcihgdXBsb2FkaW5nICR7dGhhdC5hYn1gKTsKfQoKLy9hYiB2YXJpYWJsZXMKbGV0IGFiSUQgPSB0aGF0LmFiOwpsZXQga2V5ID0gdGhhdC5rZXk7CmxldCB0YXJnZXQgPSB0aGF0LnRhcmdldCA/IHRoYXQudGFyZ2V0IDogdGhhdC5ib3Q7CmxldCByZXR1cm5UeXBlID0gdGhhdC5yZXR1cm5UeXBlOwpsZXQgcHVibGljRmFjaW5nID0gdGhhdC5wdWJsaWNGYWNpbmcgPz8gY29uZmlnQm90LnRhZ3MucHVibGljRmFjaW5nOwpsZXQgc3RhdGUgPSB7fTsKbGV0IGZvcm1hdHRlZEZpbGUgPSB7fTsKCmNvbmZpZ0JvdC50YWdzLnB1YmxpY0ZhY2luZyA9IG51bGw7CgovL3RoaXMgbG9naWMgZm9ybWF0cyB0aGUgc3BlY2lmaWVkIGJvdHMgYW5kIHBhY2thZ2VzIHRoZW0gZm9yIHB1Ymxpc2hpbmcKaWYgKCFBcnJheS5pc0FycmF5KHRhcmdldCkgJiYgdGFyZ2V0ICE9IG51bGwgJiYgdGFyZ2V0ICE9IHVuZGVmaW5lZCkKewoKfQplbHNlIGlmICghdGFyZ2V0IHx8IHRhcmdldC5sZW5ndGggPCAxKQp7CiAgICBjb25zdCBiYXNlQUIgPSB0aGF0LmJhc2VBQiA/PyBsaW5rcy5yZW1lbWJlci50YWdzLmJhc2VBQjsKCiAgICBpZiAoY29uZmlnQm90LnRhZ3MuYWJFeGNsdWRlVW5jbGFpbWVkICYmIGNvbmZpZ0JvdC50YWdzLnNlbGVjdGVkQUIpCiAgICB7CiAgICAgICAgdGFyZ2V0ID0gZ2V0Qm90cyhieU1vZCh7c3BhY2U6ICJzaGFyZWQiLCBhYklnbm9yZTogbnVsbCwgYWJJRE9yaWdpbjogYWJJRH0pKTsKCiAgICAgICAgY29uZmlnQm90LnRhZ3MuYWJFeGNsdWRlVW5jbGFpbWVkID0gbnVsbDsKICAgIH0KICAgIGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnNlbGVjdGVkQUIgJiYgZ2V0Qm90KCJhYklET3JpZ2luIiwgYmFzZUFCKSkKICAgIHsKICAgICAgICBjb25zdCBlZ2dCb3RzID0gZ2V0Qm90cyhieU1vZCh7c3BhY2U6ICJzaGFyZWQiLCBhYklnbm9yZTogbnVsbCwgYWJJRE9yaWdpbjogY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRBQn0pKTsKICAgICAgICBjb25zdCBuZXdCb3RzID0gZ2V0Qm90cyhieU1vZCh7c3BhY2U6ICJzaGFyZWQiLCBhYklnbm9yZTogbnVsbCwgYWJJRE9yaWdpbjogbnVsbH0pKTsKCiAgICAgICAgdGFyZ2V0ID0gWy4uLmVnZ0JvdHMsIC4uLm5ld0JvdHNdOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHRhcmdldCA9IGdldEJvdHMoYnlNb2Qoe3NwYWNlOiAic2hhcmVkIiwgYWJJZ25vcmU6IG51bGx9KSk7CiAgICB9CgogICAgc2V0VGFnKHRhcmdldCwgImFiSURPcmlnaW4iLCBhYklEKTsKCiAgICBjb25maWdCb3QudGFncy5zZWxlY3RlZEFCID0gbnVsbDsKCiAgICBpZiAodGFyZ2V0Lmxlbmd0aCA8IDEpCiAgICB7CiAgICAgICAgb3MudG9hc3QoIk5vIGJvdHMgZm91bmQgdG8gcHVibGlzaCIpOwoKICAgICAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKICAgICAgICBsaW5rcy5tYW5pZmVzdGF0aW9uLmFiQ2xpY2soKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQp9CgovL3RoaXMgbG9naWMgaGFuZGxlcyBnZW5lcmF0aW5nIGEga2V5IGZvciBlbmNyeXB0aW9uIChvcHRpb25hbCkKaWYgKGNvbmZpZ0JvdC50YWdzLmVuY3J5cHRpb24pCnsKICAgIGxldCBrZXlDaGVjazsKCiAgICBjb25maWdCb3QudGFncy5lbmNyeXB0aW9uID0gbnVsbDsKCiAgICBrZXkgPSBhd2FpdCBvcy5zaG93SW5wdXQoIiIsIHsKICAgICAgICB0eXBlOiAnc2VjcmV0JywKICAgICAgICB0aXRsZTogJ2VudGVyIGEgc2VjcmV0IGtleScKICAgIH0pOwoKICAgIGlmIChrZXkpCiAgICB7CiAgICAgICAga2V5Q2hlY2sgPSBhd2FpdCBvcy5zaG93SW5wdXQoIiIsIHsKICAgICAgICAgICAgdHlwZTogJ3NlY3JldCcsCiAgICAgICAgICAgIHRpdGxlOiAnY29uZmlybSBzZWNyZXQga2V5JwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChrZXkgIT0ga2V5Q2hlY2spIHsKICAgICAgICBpZiAoIWtleUNoZWNrKQogICAgICAgIHsKICAgICAgICAgICAgb3MudG9hc3QoIm5vIGtleSBlbnRlcmVkIik7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIG9zLnRvYXN0KCJrZXlzIGRvIG5vdCBtYXRjaCIpOwogICAgICAgIH0KCiAgICAgICAgc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCiAgICAgICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7CgogICAgICAgIHJldHVybjsKICAgIH0KfQoKLy9mb3JtYXR0aW5nIGJvdHMgZm9yIGZpbGUgc3RvcmFnZQppZiAoQXJyYXkuaXNBcnJheSh0YXJnZXQpKSAKewogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0YXJnZXQubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgY3VycmVudEJvdElEID0gdGFyZ2V0W2ldLmlkOwogICAgICAgIGxldCBjdXJyZW50Qm90ID0gdGFyZ2V0W2ldOwogICAgICAgIAogICAgICAgIHN0YXRlW2N1cnJlbnRCb3RJRF0gPSBjdXJyZW50Qm90OwogICAgfQp9CmVsc2UgCnsKICAgIHN0YXRlW3RhcmdldC5pZF0gPSB0YXJnZXQ7Cn0KCi8vY2hlY2tzIGZvciBwcmV2aW91cyBlZ2dzIGFuZCByZXR1cm5zIGRhdGEgZm9yIHByZXZpb3VzbHkgcHVibGlzaGVkIGFiJ3MKbGV0IGVnZ0NoZWNrID0gYXdhaXQgdGhpc0JvdC5hYlByZXZpb3VzRWdnQ2hlY2soe2FiSUQ6IGFiSUR9KTsKCi8vYWRkIHhwIGJvdCBoZXJlCmNvbnN0IHhwVmVyc2lvbkJvdCA9IHt9OwoKeHBWZXJzaW9uQm90LnNwYWNlID0gInNoYXJlZCI7CnhwVmVyc2lvbkJvdC5pZCA9ICJhYlhQQm90IjsKeHBWZXJzaW9uQm90LnRhZ3MgPSB7fTsKeHBWZXJzaW9uQm90LnRhZ3MuZm9ybSA9ICJub3RoaW5nIjsKeHBWZXJzaW9uQm90LnRhZ3Muc3lzdGVtID0gImFiLnBhdHRlcm4uYWJYUEJvdCI7CnhwVmVyc2lvbkJvdC50YWdzLmF1dGhvcklEID0gYXV0aEJvdC5pZDsKeHBWZXJzaW9uQm90LnRhZ3MudmVyc2lvbiA9IGVnZ0NoZWNrLmVnZ0RhdGEubWF4VmVyc2lvbjsKeHBWZXJzaW9uQm90LnRhZ3MueHAgPSBsaW5rcy5sZWFybi50YWdzLmFiWFA7CnhwVmVyc2lvbkJvdC50YWdzLnNpZ25hdHVyZSA9IGVnZ0NoZWNrLnNpZ25hdHVyZTsKeHBWZXJzaW9uQm90LnRhZ3MuYWJJZ25vcmUgPSB0cnVlOwoKc3RhdGUuYWJYUEJvdCA9IHhwVmVyc2lvbkJvdDsKCi8vYWRkaXRpb25hbCBmaWxlIGRhdGEKZm9ybWF0dGVkRmlsZS52ZXJzaW9uID0gMTsKZm9ybWF0dGVkRmlsZS5zaWduYXR1cmUgPSBlZ2dDaGVjay5zaWduYXR1cmU7CmZvcm1hdHRlZEZpbGUuc3RhdGUgPSBzdGF0ZTsKCi8vYWN0dWFsIGVuY3J5cHRpb24gaWYgY2hvc2VuCmlmIChrZXkpIAp7CiAgICBmb3JtYXR0ZWRGaWxlID0gSlNPTi5zdHJpbmdpZnkoZm9ybWF0dGVkRmlsZSk7CgogICAgZm9ybWF0dGVkRmlsZSA9IGNyeXB0by5lbmNyeXB0KGtleSwgZm9ybWF0dGVkRmlsZSk7Cn0KCi8vcHVibGlzaCB0aGUgZmlsZQpsZXQgcHVibGlzaEZpbGUgPSBhd2FpdCB0aGlzQm90LmFiUHVibGlzaEZpbGUoe2ZpbGU6IGZvcm1hdHRlZEZpbGUsIGZpbGVOYW1lOiBhYklEfSk7CgovL2dhdGhlciBhZGRpb25hbCBlZ2cgZGF0YQpjb25zdCBhaVBlcm1pdENoZWNrID0gYXdhaXQgb3MuZ2V0RGF0YShhdXRoQm90LmlkLCAiYWlfcGVybWl0Iik7CmNvbnN0IGFpUGVybWl0SUQgPSBhaVBlcm1pdENoZWNrLnN1Y2Nlc3MgPyBhaVBlcm1pdENoZWNrLmRhdGEucGVybWl0SUQgOiBmYWxzZTsKCmVnZ0NoZWNrLmVnZ0RhdGEuYWlQZXJtaXQgPSBhaVBlcm1pdElEOwplZ2dDaGVjay5lZ2dEYXRhLmVnZ1ZlcnNpb25IaXN0b3J5LnB1c2gocHVibGlzaEZpbGUudXJsKTsKZWdnQ2hlY2suZWdnRGF0YS5tYXhWZXJzaW9uID0gZWdnQ2hlY2suZWdnRGF0YS5lZ2dWZXJzaW9uSGlzdG9yeS5sZW5ndGg7CmVnZ0NoZWNrLmVnZ0RhdGEudGFyZ2V0VmVyc2lvbiA9IGVnZ0NoZWNrLmVnZ0RhdGEuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RoOwoKLy9wdWJsaXNoIGVnZy9hYiByZWNvcmQKbGV0IHB1Ymxpc2hSZWNvcmQgPSBhd2FpdCB0aGlzQm90LmFiUHVibGlzaFJlY29yZCh7ZGF0YTogZWdnQ2hlY2suZWdnRGF0YSwgcmVjb3JkTmFtZTogYWJJRCwgcHVibGljRmFjaW5nOiBwdWJsaWNGYWNpbmd9KTsKbGV0IHNpdGVPcmlnaW4gPSBuZXcgVVJMKGNvbmZpZ0JvdC50YWdzLnVybCkub3JpZ2luOwoKLy9wdWJsaXNoaW5nIHNob3V0CnN1cGVyU2hvdXQoIm9uQUJQdWJsaXNoZWQiLCB7c3VjY2VzczogcHVibGlzaEZpbGUuc3VjY2VzcywgYWI6IGFiSUQsIGZpbGVBZGRyZXNzOiBwdWJsaXNoRmlsZS51cmx9KTsvL1JFTU9WRSBUSElTIEVWRU5UVUFMTFkKc3VwZXJTaG91dCgib25BYlB1Ymxpc2hlZCIsIHtzdWNjZXNzOiBwdWJsaXNoRmlsZS5zdWNjZXNzLCBhYjogYWJJRCwgZmlsZUFkZHJlc3M6IHB1Ymxpc2hGaWxlLnVybH0pOwoKY29uc3Qgc3R1ZGlvTGluayA9IGNvbmZpZ0JvdC50YWdzLnNlbGVjdGVkX3N0dWRpb0lEID8/IGF1dGhCb3QuaWQ7CgovL3NlbmQgZGF0YSBhbmQgZm9ybWF0IHVybCBpZiBkYXRhIHN1Y2Nlc3NmdWxseSBzZW50CmlmIChwdWJsaXNoUmVjb3JkLnN1Y2Nlc3MpCnsKICAgIGNvbnN0IGJpb3MgPSBwdWJsaWNGYWNpbmcgPyAiZnJlZSUyMGluc3QiIDogImxvY2FsJTIwaW5zdCI7CiAgICBjb25zdCBpbnN0VHlwZSA9IHB1YmxpY0ZhY2luZyA/ICJmcmVlIiA6ICJsb2NhbCIKCiAgICBzZXRUYWdNYXNrKGxpbmtzLmxlYXJuLCAiYWJYUCIsICIwIiwgImxvY2FsIik7CgogICAgaWYgKGtleSAmJiBjb25maWdCb3QudGFncy5tYW51YWxQdWJsaXNoKSAKICAgIHsKICAgICAgICBvcy5zZXRDbGlwYm9hcmQoc2l0ZU9yaWdpbiArICIvP3BhdHRlcm49IiArIGFiSUQgKyAiJmtleT0iICsga2V5ICsgIiZzdHVkaW89IiArIHN0dWRpb0xpbmsgKyAiJmJpb3M9IiArIGJpb3MpOwogICAgICAgIAogICAgICAgIG9zLnRvYXN0KGBlbmNyeXB0ZWQgZGF0YSB3aXRoIGEgJHtpbnN0VHlwZX0gaW5zdCB1cmwgY29waWVkIHRvIGNsaXBib2FyZGApOwogICAgfQogICAgZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MubWFudWFsUHVibGlzaCkKICAgIHsKICAgICAgICBvcy5zZXRDbGlwYm9hcmQoc2l0ZU9yaWdpbiArICIvP3BhdHRlcm49IiArIGFiSUQgKyAiJnN0dWRpbz0iICsgc3R1ZGlvTGluayArICImYmlvcz0iICsgYmlvcyk7CgogICAgICAgIG9zLnRvYXN0KGAke2luc3RUeXBlfSBpbnN0IHVybCBjb3BpZWQgdG8gY2xpcGJvYXJkYCk7CiAgICB9CgogICAgdHJ5IAogICAgewogICAgICAgIGF3YWl0IGFuYWx5dGljcy5yZWNvcmRFdmVudCgnYWJfZWdnX3B1Ymxpc2gnLCB7IGFiOiBhYklELCB2ZXJzaW9uOiBlZ2dDaGVjay5lZ2dEYXRhLmVnZ1ZlcnNpb25IaXN0b3J5Lmxlbmd0aCB9KTsKICAgIH0KICAgIGNhdGNoIChlKSAKICAgIHsKICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgIH0KfQplbHNlCnsKICAgIGlmICghY29uZmlnQm90LnRhZ3MuYWJTaWxlbnRNb2RlKQogICAgewogICAgICAgIG9zLnRvYXN0KCJwdWJsaXNoaW5nIGZhaWxlZCwgcGxlYXNlIHRyeSBhZ2FpbiIpOwogICAgfQoKICAgIGFiLmxvZyhhYlJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBwdWJsaXNoaW5nIGZhaWxlZCIpOwogICAgCiAgICBjb25zb2xlLmxvZyhwdWJsaXNoUmVjb3JkKTsKfQoKLy9jbGVhciBwcm9ncmVzcyBiYXIKaWYgKHByb2dyZXNzQnV0dG9uKQp7CiAgICBkZXN0cm95KHByb2dyZXNzQnV0dG9uKTsKfQoKY29uZmlnQm90LnRhZ3MubWFudWFsUHVibGlzaCA9IG51bGw7CgpyZXR1cm4gcHVibGlzaFJlY29yZDsnAN7+4uAM5IEBCGFiSWdub3JlAgQA3v7i4AyBygIEdHJ1ZScA3v7i4AzkgQEKYWJEb3dubG9hZAIEAN7+4uAMhsoCuwZALy9kb3dubG9hZCBib3RzIChlaXRoZXIgc2VsZWN0ZWQgb3IgYWxsIGV4cGVyaWVuY2UpCmxldCBkb3dubG9hZEJvdHM7Cgpjb25zb2xlLmxvZygiZG93bmxvYWQiLCB0aGF0KTsKCmlmIChBcnJheS5pc0FycmF5KHRoYXQucG9zc2libGVCb3RzKSkKewogICAgaWYgKHRoYXQucG9zc2libGVCb3RzLmxlbmd0aCA+IDApCiAgICB7CiAgICAgICAgZG93bmxvYWRCb3RzID0gdGhhdC5wb3NzaWJsZUJvdHM7CgogICAgICAgIGFiLmxvZyhhYlJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBkb3dubG9hZGluZyBib3RzIik7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgZG93bmxvYWRCb3RzID0gZ2V0Qm90cyhieU1vZCh7ImFiSWdub3JlIjogbnVsbCwgInNwYWNlIjogInNoYXJlZCJ9KSk7CgogICAgICAgIGFiLmxvZyhhYlJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBkb3dubG9hZGluZyBpbnN0Iik7CiAgICB9ICAgIAp9CmVsc2UKewoKCiAgICBkb3dubG9hZEJvdHMgPSBbdGhhdC5wb3NzaWJsZUJvdHNdOwoKICAgIGFiLmxvZyhhYlJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiBkb3dubG9hZGluZyBib3QiKTsKfQoKaWYgKCFBcnJheS5pc0FycmF5KGRvd25sb2FkQm90cykpCnsKICAgIGRvd25sb2FkQm90cyA9IFtkb3dubG9hZEJvdHNdOwp9CgpsZXQgY3VycmVudEluc3QgPSBvcy5nZXRDdXJyZW50SW5zdCgpOwoKb3MuZG93bmxvYWRCb3RzKGRvd25sb2FkQm90cywgY3VycmVudEluc3QpOwoKc2hvdXQoImFiTWVudVJlZnJlc2giKTsKCmxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOycA3v7i4AzkgQENbWFuaWZlc3RhdGlvbgIEAN7+4uAMwtACKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAN7+4uAM5IEBBG1lbnUCBADe/uLgDOnQAijwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwDe/uLgDOSBARJhYlByZXZpb3VzRWdnQ2hlY2sCBADe/uLgDJDRAtkPQC8vdGhpcyBmdW5jdGlvbiBjaGVja3MgZm9yIHByZXZpb3VzIGVnZ3MgYXQgYSBzcGVjaWZpZWQgYWIsIHJldHVybmluZyBhbnkgZGF0YSB0aGF0IGl0IGZpbmRzCmNvbnN0IGFiSUQgPSB0aGF0LmFiSUQ7Cgphd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwoKbGV0IGVnZ0hpc3Rvcnk7CmxldCBlZ2dJRDsKbGV0IHRhcmdldFZlcnNpb25OdW07CmxldCBsYXN0SGFzaDsKbGV0IG1heFZlcnNpb25OdW07CmxldCBzdGFibGVWZXJzaW9uOwpsZXQgZmVlZGJhY2tWZXJzaW9uOwpsZXQgcHJldmlvdXNYUDsKbGV0IHVzZXJSZWNvcmQgPSBjb25maWdCb3QudGFncy5zZWxlY3RlZF9zdHVkaW9JRCA/IGNvbmZpZ0JvdC50YWdzLnNlbGVjdGVkX3N0dWRpb0lEIDogY29uZmlnQm90LnRhZ3Muc3R1ZGlvID8gY29uZmlnQm90LnRhZ3Muc3R1ZGlvIDogYXV0aEJvdC5pZDsKbGV0IHJlY29yZExvb2t1cCA9IGF3YWl0IG9zLmdldERhdGEodXNlclJlY29yZCwgYWJJRCkuY2F0Y2goZSA9PiB7fSk7CgppZiAocmVjb3JkTG9va3VwLnN1Y2Nlc3MpIAp7CiAgICBlZ2dIaXN0b3J5ID0gcmVjb3JkTG9va3VwLmRhdGEuZWdnVmVyc2lvbkhpc3Rvcnk7CiAgICBlZ2dJRCA9IHJlY29yZExvb2t1cC5kYXRhLmVnZ0lEOwogICAgcHJldmlvdXNYUCA9IHJlY29yZExvb2t1cC5kYXRhLnhwID8/IDA7CiAgICB0YXJnZXRWZXJzaW9uTnVtID0gZWdnSGlzdG9yeS5sZW5ndGggKyAxOwogICAgbGFzdEhhc2ggPSBlZ2dIaXN0b3J5W3RhcmdldFZlcnNpb25OdW0gLSAxXTsKICAgIHN0YWJsZVZlcnNpb24gPSByZWNvcmRMb29rdXAuZGF0YS5zdGFibGVWZXJzaW9uOwogICAgZmVlZGJhY2tWZXJzaW9uID0gcmVjb3JkTG9va3VwLmRhdGEuZmVlZGJhY2tWZXJzaW9uOwogICAgbWF4VmVyc2lvbk51bSA9IGVnZ0hpc3RvcnkubGVuZ3RoICsgMTsKfSAKZWxzZSAKewogICAgZWdnSGlzdG9yeSA9IFtdOwogICAgZWdnSUQgPSB1dWlkKCk7CiAgICB0YXJnZXRWZXJzaW9uTnVtID0gMTsKICAgIGxhc3RIYXNoID0gIm5vbmUiOwogICAgbWF4VmVyc2lvbk51bSA9IDE7CiAgICBwcmV2aW91c1hQID0gMDsKfQoKaWYgKGNvbmZpZ0JvdC50YWdzLnZlcnNpb25EZWZpbmVkID09ICJmZWVkYmFjayIpIAp7CiAgICBmZWVkYmFja1ZlcnNpb24gPSBlZ2dIaXN0b3J5Lmxlbmd0aCArIDE7Cn0KZWxzZSBpZiAoY29uZmlnQm90LnRhZ3MudmVyc2lvbkRlZmluZWQgPT0gInN0YWJsZSIpCnsKICAgIHN0YWJsZVZlcnNpb24gPSBlZ2dIaXN0b3J5Lmxlbmd0aCArIDE7Cn0KCmNvbmZpZ0JvdC50YWdzLnZlcnNpb25EZWZpbmVkID0gbnVsbDsKCmxldCBlZ2cgPSB7fTsKCmVnZy5lZ2dWZXJzaW9uSGlzdG9yeSA9IGVnZ0hpc3Rvcnk7CmVnZy5lZ2dGb3JtYXRWZXJzaW9uID0gZWdnSUQ7CmVnZy50YXJnZXRWZXJzaW9uID0gdGFyZ2V0VmVyc2lvbk51bTsKZWdnLm1heFZlcnNpb24gPSBtYXhWZXJzaW9uTnVtOwplZ2cubGFiZWwgPSAidiIrdGFyZ2V0VmVyc2lvbk51bTsKZWdnLnN0YWJsZVZlcnNpb24gPSBzdGFibGVWZXJzaW9uOwplZ2cuZmVlZGJhY2tWZXJzaW9uID0gZmVlZGJhY2tWZXJzaW9uOwplZ2cuYWJJRCA9IGFiSUQ7CmVnZy54cCA9IGxpbmtzLmxlYXJuLnRhZ3MuYWJYUDsKCmxldCBzaWduYXR1cmUgPSB7fTsKbGV0IGRhdGUgPSBuZXcgRGF0ZSgpOwpsZXQgdGltZSA9IGRhdGUuZ2V0VGltZSgpOwoKc2lnbmF0dXJlLnByZXZpb3VzSGFzaCA9IGxhc3RIYXNoOwpzaWduYXR1cmUuYWJWZXJzaW9uID0gbGlua3MucmVtZW1iZXIudGFncy5hYkNvcmVWZXJzaW9uKyIuIitsaW5rcy5yZW1lbWJlci50YWdzLmFiQ29yZUl0ZXJhdGlvbjsKc2lnbmF0dXJlLmVnZ1ZlcnNpb24gPSB0YWdzLmVnZ1VVSUQ7CnNpZ25hdHVyZS5lZ2dWZXJzaW9uTnVtID0gdGFncy5vdm9WZXJzaW9uOwpzaWduYXR1cmUudGltZVN0YW1wID0gdGltZTsKc2lnbmF0dXJlLmNhc3VhbE9TVmVyc2lvbiA9IFtvcy52ZXJzaW9uKCldOwoKcmV0dXJuIHtzaWduYXR1cmU6IHNpZ25hdHVyZSwgZWdnRGF0YTogZWdnfTsnAN7+4uAM5IEBD2FiQm90TWVudUFjdGlvbgIEAN7+4uAM6uACTUBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwoKLy9zZXQgdXAgdGhlIHB1Ymxpc2ggbWVudQp0aGlzQm90Lm9uU3RvcmVNZW51KCk7JwDe/uLgDOSBAQ5hYkJvdE1lbnVMYWJlbAIEAN7+4uAMuOECBXNoYXJlJwDe/uLgDOSBAQ1hYkJvdE1lbnVJY29uAgQA3v7i4Ay+4QIJaW9zX3NoYXJlJwDe/uLgDOSBARJhYkJvdE1lbnVTb3J0T3JkZXICBADe/uLgDMjhAgMzLjUnAN7+4uAM5IEBBWxlYXJuAgQA3v7i4AzM4QIo8J+UlzY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNycA3v7i4AzkgQELYWJRUlB1Ymxpc2gCBADe/uLgDPPhAsYBQGNvbmZpZ0JvdC50YWdzLnB1Ymxpc2hTY2FuID0gbnVsbDsKCmxldCBzY2FubmVkVVJMOwoKdHJ5IAp7CiAgICBzY2FubmVkVVJMID0gbmV3IFVSTCh0aGF0KTsKfQpjYXRjaCAoZSkgCnsKICAgIHNob3V0KCJhYlB1Ymxpc2hBQiIsIHthYjogdGhhdH0pOwoKICAgIHRoaXNCb3QuYWJQdWJsaXNoQUIoe2FiOiB0aGF0fSk7CgogICAgcmV0dXJuOwp9JwDe/uLgDOSBAQZzZWFyY2gCBADe/uLgDLrjAijwn5SXZDgzNzE0NDQtOTE1OC00NDM2LThmYzctODRjYzkxYjdmNTI1JwDe/uLgDOSBAQdhYlNoZWxsAgQA3v7i4Azh4wIEdHJ1ZScA3v7i4AzkgQEMc3R1ZGlvU2VsZWN0AgQA3v7i4Azm4wKLC0AvL3Nob3V0KCJhYk1lbnVSZWZyZXNoIik7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9ICJhYlN0dWRpb01lbnUiOwoKbGlua3MubWVudS5tYXNrcy5vbkdyaWRDbGljayA9ICJAIHNob3V0KCdhYk1lbnVSZWZyZXNoJyk7IGxpbmtzLm1hbmlmZXN0YXRpb24uYWJDbGljaygpOyI7Cgpjb25zdCBzdHVkaW9zID0gdGhhdC5zdHVkaW9zOwpjb25zdCB0YXJnZXRTdHVkaW8gPSBjb25maWdCb3QudGFncy5zZWxlY3RlZF9zdHVkaW9JRCA/IGNvbmZpZ0JvdC50YWdzLnNlbGVjdGVkX3N0dWRpb0lEIDogY29uZmlnQm90LnRhZ3Muc3R1ZGlvID8gY29uZmlnQm90LnRhZ3Muc3R1ZGlvIDogYXV0aEJvdC5pZDsKY29uc3QgbWVudUJ1dHRvbiA9IHt9OwoKbWVudUJ1dHRvbi5hYlN0dWRpb01lbnUgPSB0cnVlOwptZW51QnV0dG9uLmFiTWVudVNvcnRPcmRlciA9IDA7Cm1lbnVCdXR0b24uYWJNZW51UmVmcmVzaCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbWVudUJ1dHRvbi5hYlN0dWRpb01lbnVSZWZyZXNoID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwptZW51QnV0dG9uLmxhYmVsID0gInBsYXllciBzdHVkaW8iOwptZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gdGFyZ2V0U3R1ZGlvID09IGF1dGhCb3QuaWQgPyAicmFkaW9fYnV0dG9uX2NoZWNrZWQiIDogInJhZGlvX2J1dHRvbl91bmNoZWNrZWQiOwptZW51QnV0dG9uLmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKbWVudUJ1dHRvbi5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKbWVudUJ1dHRvbi5zdHVkaW9JRCA9IGF1dGhCb3QuaWQ7Cm1lbnVCdXR0b24ub25DbGljayA9IGBAIGNvbmZpZ0JvdC50YWdzLnNlbGVjdGVkX3N0dWRpb0lEID0gdGFncy5zdHVkaW9JRDsKCmxpbmtzLm1hbmFnZXIubGlua3Muc3R1ZGlvU2VsZWN0QnV0dG9uLnRhZ3MubGFiZWwgPSB0YWdzLmxhYmVsOwoKc2hvdXQoImFiU3R1ZGlvTWVudVJlZnJlc2giKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7YDsKCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwoKZm9yIChsZXQgaSA9IDA7IGkgPCBzdHVkaW9zLmxlbmd0aDsgaSsrKQp7CiAgICBsZXQgYWN0aXZlU3R1ZGlvID0gc3R1ZGlvc1tpXTsKCiAgICBtZW51QnV0dG9uLmZvcm1BZGRyZXNzID0gdGFyZ2V0U3R1ZGlvID09IGFjdGl2ZVN0dWRpby5zdHVkaW9JZCA/ICJyYWRpb19idXR0b25fY2hlY2tlZCIgOiAicmFkaW9fYnV0dG9uX3VuY2hlY2tlZCI7CiAgICBtZW51QnV0dG9uLmxhYmVsID0gYWN0aXZlU3R1ZGlvLmRpc3BsYXlOYW1lOwogICAgbWVudUJ1dHRvbi5zdHVkaW9JRCA9IGFjdGl2ZVN0dWRpby5zdHVkaW9JZDsKCiAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbihtZW51QnV0dG9uKTsKfScA3v7i4AzkgQEOYWJQdWJsaXNoQXNrSUQCBADe/uLgDPDuAvQEQGxldCBwcm9ncmVzc0J1dHRvbiA9IGF3YWl0IGxpbmtzLmlucHV0LmFiUHJvZ3Jlc3NCYXIoYHB1Ymxpc2hpbmcgJHt0aGF0LmFza0lEfWApOwoKYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsKCmNvbnN0IHBhdHRlcm5JRCA9IHRoYXQucGF0dGVybklEOwpjb25zdCBzdHVkaW9JRCA9IHRoYXQuc3R1ZGlvSUQgPyB0aGF0LnN0dWRpb0lEIDogY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQgPyBjb25maWdCb3QudGFncy5zZWxlY3RlZF9zdHVkaW9JRCA6IGF1dGhCb3QuaWQ7CmNvbnN0IGFza0lEID0gImFza18iICsgdGhhdC5hc2tJRC5yZXBsYWNlQWxsKCItIiwgIiIpOwpjb25zdCBlbmRwb2ludCA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJFbmRwb2ludDsKY29uc3QgcHVibGlzaEFzayA9IGF3YWl0IG9zLnJlY29yZERhdGEobGlua3MucmVtZW1iZXIudGFncy5hYlJlY29yZEtleSwgYXNrSUQsIHtwYXR0ZXJuSUQ6IHBhdHRlcm5JRCwgc3R1ZGlvSUQ6IHN0dWRpb0lEfSwge2VuZHBvaW50OiBlbmRwb2ludCwgdXBkYXRlUG9saWN5OiBbYXV0aEJvdC5pZF19KTsKCmlmIChwcm9ncmVzc0J1dHRvbikKewogICAgZGVzdHJveShwcm9ncmVzc0J1dHRvbik7Cn0KCnJldHVybiBwdWJsaXNoQXNrOycA3v7i4AzkgQEFaW5wdXQCBADe/uLgDOXzAijwn5SXZjg2MDI4NzgtYzJlZi00OGJkLTg1YTAtOGQ2MzUxZWI0MTIwJwDe/uLgDOSBAQthYkVtYmVkTGluawIEAN7+4uAMjPQCpANAY29uc3QgYWIgPSB0aGF0ID8gdHJ1ZSA6IGZhbHNlOwpjb25zdCBlbWJlZExpbmsgPSBhYiA/ICJhYj0iICsgdGhhdCA6ICJpbnN0PSIgKyBjb25maWdCb3QudGFncy5pbnN0Owpjb25zdCBzaXRlT3JpZ2luID0gbmV3IFVSTChjb25maWdCb3QudGFncy51cmwpLm9yaWdpbjsKY29uc3QgZW1iZWRUZXh0ID0gYDwhRE9DVFlQRSBodG1sPgrCoMKgwqDCoDxodG1sPgrCoMKgwqDCoMKgwqDCoMKgPGhlYWQ+PC9oZWFkPgrCoMKgwqDCoMKgwqDCoMKgPGJvZHk+CsKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoDxpZnJhbWUgc3JjPSIke3NpdGVPcmlnaW4gKyAiLz8iICsgZW1iZWRMaW5rfSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iNDAwIiAvPgrCoMKgwqDCoMKgwqDCoMKgPC9ib2R5PgrCoMKgwqDCoDwvaHRtbD5gOwoKcmV0dXJuIGVtYmVkVGV4dDsnAN7+4uAM5IEBD2FiUGF0dGVyblVwZGF0ZQIEAN7+4uAMhfcC5wRALy9zaG91dCgiYWJQYXR0ZXJuVXBkYXRlIiwge2FiSUQ6IGFiSUQsIHN0dWRpbzpzdHVkaW8/LCBib3RzOiBib3RzP30pOwphd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwoKaWYgKCFhdXRoQm90KQp7CiAgICByZXR1cm47Cn0KCmNvbnN0IGFiSUQgPSB0aGF0LmFiSUQ7CmNvbnN0IHN0dWRpbyA9IHRoYXQuc3R1ZGlvID8gdGhhdC5zdHVkaW8gOiBjb25maWdCb3QudGFncy5zdHVkaW8gPyBjb25maWdCb3QudGFncy5zdHVkaW8gOiBhdXRoQm90LmlkOwpjb25zdCBhYk1hbmlmZXN0ID0gZ2V0Qm90KGJ5TW9kKHthYkVnZzogdHJ1ZSwgb3JpZ2luX2FiOiBhYklEfSkpOwoKaWYgKCFhYk1hbmlmZXN0KQp7CiAgICBzaG91dCgib25Mb29rdXBBQkVnZ3MiLCB7YWJJRDogYWJJRCwgcmVjb3JkS2V5OiBzdHVkaW8sIGF1dG9IYXRjaDogdHJ1ZX0pOwoKICAgIHJldHVybjsKfQoKY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQgPSBzdHVkaW87Cgpjb25zdCBhYkJvdHMgPSB0aGF0LmJvdHMgPz8gZ2V0Qm90cygiYWJJRE9yaWdpbiIsIGFiSUQpOwoKYXdhaXQgdGhpc0JvdC5hYlB1Ymxpc2hBQih7YWI6IGFiSUQsIHRhcmdldDogYWJCb3RzLCBwdWJsaWNGYWNpbmc6IHRydWV9KTsnAN7+4uAM5IEBF2FiTXVsdGlwbGVCb3RNZW51QWN0aW9uAgQA3v7i4Azt+wJNQGF3YWl0IG9zLnJlcXVlc3RBdXRoQm90KCk7CgovL3NldCB1cCB0aGUgcHVibGlzaCBtZW51CnRoaXNCb3Qub25TdG9yZU1lbnUoKTsnAN7+4uAM5IEBGmFiTXVsdGlwbGVCb3RNZW51U29ydE9yZGVyAgQA3v7i4Ay7/AIBMicA3v7i4AzkgQEVYWJNdWx0aXBsZUJvdE1lbnVJY29uAgQA3v7i4Ay9/AIJaW9zX3NoYXJlJwDe/uLgDOSBARZhYk11bHRpcGxlQm90TWVudUxhYmVsAgQA3v7i4AzH/AIFc2hhcmUnAN7+4uAM5IEBD2FiUHVibGlzaFNlbGVjdAIEAN7+4uAMzfwCiRNALy9zaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJQYXR0ZXJuTWVudSI7CgpsaW5rcy5tZW51Lm1hc2tzLm9uR3JpZENsaWNrID0gIkAgc2hvdXQoJ2FiTWVudVJlZnJlc2gnKTsgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7IjsKCmNvbnN0IGFsbEJvdHMgPSBnZXRCb3RzKCJhYklET3JpZ2luIik7CmNvbnN0IGFsbFBhdHRlcm5zID0gWyJuZXcgcGF0dGVybiJdOwoKYm90TG9vcDoKZm9yIChsZXQgaSA9IDA7IGkgPCBhbGxCb3RzLmxlbmd0aDsgaSsrKQp7CiAgICBjb25zdCBhY3RpdmVCb3QgPSBhbGxCb3RzW2ldOwoKICAgIGlmIChhY3RpdmVCb3QudGFncy5hYklnbm9yZSkKICAgIHsKICAgICAgICBjb250aW51ZSBib3RMb29wOwogICAgfQoKICAgIGNvbnN0IHBvc3NpYmxlUGF0dGVybiA9IGFjdGl2ZUJvdC50YWdzLmFiSURPcmlnaW47CgogICAgZm9yIChsZXQgaiA9IDA7IGogPCBhbGxQYXR0ZXJucy5sZW5ndGg7IGorKykKICAgIHsKICAgICAgICBjb25zdCBhY3RpdmVQYXR0ZXJuID0gYWxsUGF0dGVybnNbal07CgogICAgICAgIGlmIChhY3RpdmVQYXR0ZXJuID09IHBvc3NpYmxlUGF0dGVybiApCiAgICAgICAgewogICAgICAgICAgICBjb250aW51ZSBib3RMb29wOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChqID09IGFsbFBhdHRlcm5zLmxlbmd0aCAtIDEpCiAgICAgICAgewogICAgICAgICAgICBhbGxQYXR0ZXJucy5wdXNoKHBvc3NpYmxlUGF0dGVybik7CiAgICAgICAgfQogICAgfQp9Cgpjb25zdCB0YXJnZXRBQiA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYmFzZUFCOwpjb25zdCBtZW51QnV0dG9uID0ge307CgptZW51QnV0dG9uLmFiUGF0dGVybk1lbnUgPSB0cnVlOwptZW51QnV0dG9uLmFiUGF0dGVybk1lbnVTb3J0T3JkZXIgPSAwOwptZW51QnV0dG9uLmFiTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7Cm1lbnVCdXR0b24uYWJQYXR0ZXJuTWVudVJlZnJlc2ggPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7Cm1lbnVCdXR0b24uY29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZVN0cm9rZUNvbG9yOwptZW51QnV0dG9uLm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwptZW51QnV0dG9uLnJlbWVtYmVyID0gdGFncy5yZW1lbWJlcjsKbWVudUJ1dHRvbi5vbkNsaWNrID0gYEBjb25zdCB0b3RhbFBhdHRlcm5Cb3RzID0gZ2V0Qm90cyhieU1vZCh7YWJJRE9yaWdpbjogdGFncy5sYWJlbCwgc3BhY2U6ICJzaGFyZWQiLCBhYklnbm9yZTogbnVsbH0pKTsKY29uc3Qgbm9uUGF0dGVybkJvdHMgPSBnZXRCb3RzKGJ5TW9kKHthYklET3JpZ2luOiBudWxsLCBzcGFjZTogInNoYXJlZCIsIGFiSWdub3JlOiBudWxsfSkpOwoKc2hvdXQoImFiU2VsZWN0VGl0bGVVcGRhdGUiLCB7YWI6IHRhZ3MubGFiZWwsIGFiQm90czogdG90YWxQYXR0ZXJuQm90cy5sZW5ndGgsIG5vbkFCQm90czogbm9uUGF0dGVybkJvdHMubGVuZ3RofSk7CgpsaW5rcy5yZW1lbWJlci5tYXNrcy5iYXNlQUIgPSB0YWdzLmxhYmVsID09ICJuZXcgcGF0dGVybiIgPyBudWxsIDogdGFncy5sYWJlbDsKCmNvbmZpZ0JvdC50YWdzLnNlbGVjdGVkQUIgPSB0YWdzLmxhYmVsID09ICJuZXcgcGF0dGVybiIgPyBudWxsIDogdGFncy5sYWJlbDsKCnNob3V0KCJhYlBhdHRlcm5NZW51UmVmcmVzaCIpOwoKY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjtgOwoKYWxsUGF0dGVybnMuc29ydCgpOwoKZm9yIChsZXQgaSA9IDA7IGkgPCBhbGxQYXR0ZXJucy5sZW5ndGg7IGkrKykKewogICAgbGV0IGFjdGl2ZVBhdHRlcm5OYW1lID0gYWxsUGF0dGVybnNbaV07CgogICAgbWVudUJ1dHRvbi5mb3JtQWRkcmVzcyA9IHRhcmdldEFCID09IGFjdGl2ZVBhdHRlcm5OYW1lID8gInJhZGlvX2J1dHRvbl9jaGVja2VkIiA6ICJyYWRpb19idXR0b25fdW5jaGVja2VkIjsKICAgIG1lbnVCdXR0b24ubGFiZWwgPSBhY3RpdmVQYXR0ZXJuTmFtZTsKCiAgICBpZiAoYWN0aXZlUGF0dGVybk5hbWUgPT0gIm5ldyBwYXR0ZXJuIikKICAgIHsKICAgICAgICBtZW51QnV0dG9uLmFiUGF0dGVybk1lbnVTb3J0T3JkZXIgPSAtMTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBtZW51QnV0dG9uLmFiUGF0dGVybk1lbnVTb3J0T3JkZXIgPSBpOwogICAgfQoKICAgIGxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKG1lbnVCdXR0b24pOwp9CgppZiAoIWdldEJvdChieU1vZCh7YWJQYXR0ZXJuTWVudTogdHJ1ZSwgZm9ybUFkZHJlc3M6ICJyYWRpb19idXR0b25fY2hlY2tlZCJ9KSkpCnsKICAgIGNvbnN0IG5ld0JvdCA9IGdldEJvdChieU1vZCh7YWJQYXR0ZXJuTWVudTogdHJ1ZSwgbGFiZWw6ICJuZXcgcGF0dGVybiJ9KSk7CiAgICAKICAgIG5ld0JvdC50YWdzLmZvcm1BZGRyZXNzID0gInJhZGlvX2J1dHRvbl9jaGVja2VkIjsKfScA3v7i4AzkgQEJYWJWZXJzaW9uAgQA3v7i4AzVjwMUOS42NS4xLjE3Mzc0OTU1OTM1MTAnAQRib3RzJGQ4MzcxNDQ0LTkxNTgtNDQzNi04ZmM3LTg0Y2M5MWI3ZjUyNQEnAN7+4uAM6o8DBnN5c3RlbQIEAN7+4uAM648DD2FiLnNoZWxsLnNlYXJjaCcA3v7i4AzqjwMEZm9ybQIEAN7+4uAM+48DB25vdGhpbmcnAN7+4uAM6o8DDmFiUmV0cmlldmVGaWxlAgQA3v7i4AyDkAOCAUAvL3B1bGwgZG93biBmaWxlIGRhdGEKaWYgKCF0aGF0LnVybCkKewogICAgcmV0dXJuICJubyBmaWxlIHVybCBzdXBwbGllZCI7Cn0KCmxldCBkYXRhID0gYXdhaXQgb3MuZ2V0RmlsZSh0aGF0LnVybCk7CgpyZXR1cm4gZGF0YTsnAN7+4uAM6o8DEGFiUmV0cmlldmVSZWNvcmQCBADe/uLgDIaRA+wEQC8vcmV0cmlldmUgc3BlY2lmaWVkIHJlY29yZApsZXQgcmVjb3JkTmFtZSA9IHRoYXQucmVjb3JkTmFtZTsKCmxldCByZWNvcmRLZXkgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiUmVjb3JkS2V5OwoKaWYgKHRoYXQucmVjb3JkS2V5KQp7CiAgICByZWNvcmRLZXkgPSB0aGF0LnJlY29yZEtleTsKfQplbHNlIGlmIChhdXRoQm90KQp7CiAgICBpZiAoYXV0aEJvdC5pZCA9PSBjb25maWdCb3QudGFncy5zdHVkaW8pCiAgICB7CiAgICAgICAgcmVjb3JkS2V5ID0gYXV0aEJvdC5pZDsKCiAgICAgICAgYXdhaXQgb3MuZ3JhbnRJbnN0QWRtaW5QZXJtaXNzaW9uKHJlY29yZEtleSk7CiAgICB9Cn0KCmxldCByZWNvcmRFbmRwb2ludCA9IHRoYXQucmVjb3JkRW5kcG9pbnQgPyB0aGF0LnJlY29yZEVuZHBvaW50IDogbGlua3MucmVtZW1iZXIudGFncy5hYkVuZHBvaW50OwoKaWYgKCFyZWNvcmROYW1lKQp7CiAgICByZXR1cm4gIm5vIHJlY29yZCBuYW1lIHN1cHBsaWVkIjsKfQoKbGV0IGdldFJlY29yZCA9IGF3YWl0IG9zLmdldERhdGEocmVjb3JkS2V5LCByZWNvcmROYW1lLCByZWNvcmRFbmRwb2ludCk7CgovL0FERCBhZGRpdGlvbmFsIGVycm9yIGhhbmRsaW5nPwoKcmV0dXJuIGdldFJlY29yZDsnAN7+4uAM6o8DCHJlbWVtYmVyAgQA3v7i4AzzlQMo8J+Ul2U1MzgwYTZiLThiNGQtNGE4Yi04YjA0LTU4ZTFlYjAzZTVlNycA3v7i4AzqjwMNbWFuaWZlc3RhdGlvbgIEAN7+4uAMmpYDKPCflJdkY2E1ZDk4Ny1jNGQ4LTQ2ZTQtYjYwYy1kYWE3YjJmNGRkYWQnAN7+4uAM6o8DDm9uTG9va3VwQUJFZ2dzAgQA3v7i4AzBlgPAJUAvL3Nob3V0KCJvbkxvb2t1cEFCRWdncyIsIHthYklEOiBhYklELCBrZXk6IGtleSwgYXV0b0hhdGNoOiBib29sZWFuLCByZXR1cm5UeXBlOiBkYXRhL251bGx9KTsKYWIubG9nKGFiUmVtZW1iZXIudGFncy5hYkJ1aWxkZXJJZGVudGl0eSArICI6IGxvYWRpbmcgIiArIHRoYXQuYWJJRCk7CgovL2NsZWFyIGFiLTEKaWYgKGxpbmtzLm1hbmlmZXN0YXRpb24gJiYgY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCA9PSAiYWJNZW51IikKewogICAgbGlua3MubWFuaWZlc3RhdGlvbi5hYkNsaWNrKCk7Cn0KCmxldCBwcm9ncmVzc0J1dHRvbiA9IGF3YWl0IGxpbmtzLmlucHV0LmFiUHJvZ3Jlc3NCYXIoYGxvYWRpbmcgJHt0aGF0LmFiSUR9YCk7CgovL2NvbnN0YW50cyBpbiByZWdhcmRzIHRvIHRoZSBhYiB0byBiZSBsb29rZWQgdXAKY29uc3QgYWJJRCA9IHRoYXQuYWJJRDsKY29uc3QgaW5pdGlhbEJvb3QgPSB0aGF0LmluaXRpYWxCb290Owpjb25zdCBhdXRvSGF0Y2ggPSB0aGF0LmF1dG9IYXRjaDsKCi8vcmVjb3JkS2V5IGlzIHZhcmlhYmxlIGRlcGVuZGluZyBvbiBpZiBwdWJsaWMKbGV0IHJlY29yZEtleSA9IHRoYXQucmVjb3JkS2V5ID8/IGNvbmZpZ0JvdC50YWdzLnN0dWRpbzsKbGV0IHBvc3NpYmxlQXV0aCA9IGF1dGhCb3QgPyBhdXRoQm90IDogdHJ1ZTsKbGV0IGdldFJlY29yZCA9IGF3YWl0IG9zLmdldERhdGEocmVjb3JkS2V5LCBhYklEKTsKCi8vdmFyaWFibGVzIGZvciBlZ2cvYWIgaGF0Y2hpbmcKbGV0IHJldHVyblR5cGUgPSB0aGF0LnJldHVyblR5cGU7CmxldCBrZXkgPSB0aGF0LmtleTsKbGV0IG5ld0VnZzsKCi8vdGhpcyBsb2dpYyBoYW5kbGVzIHRoZSByZXRyaWV2ZWQgZGF0YSwgc2VhcmNoZXMgYWdhaW4gaWYgbm9uZSBjYW1lIHRocm91Z2gKaWYgKCFnZXRSZWNvcmQuc3VjY2VzcyAmJiBwb3NzaWJsZUF1dGguaWQgPT0gcmVjb3JkS2V5ICYmIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSZWNvcmRLZXkgJiYgZ2V0UmVjb3JkLmVycm9yQ29kZSAhPSAibm90X2F1dGhvcml6ZWQiKQp7CiAgICBnZXRSZWNvcmQgPSBhd2FpdCBvcy5nZXREYXRhKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSZWNvcmRLZXksIGFiSUQpOwp9CmVsc2UgaWYgKCFnZXRSZWNvcmQuc3VjY2VzcykKewogICAgaWYgKCFyZWNvcmRLZXkpCiAgICB7CiAgICAgICAgYXdhaXQgb3MucmVxdWVzdEF1dGhCb3QoKTsKCiAgICAgICAgcmVjb3JkS2V5ID0gYXV0aEJvdC5pZDsKICAgIH0KCiAgICBhd2FpdCBvcy5ncmFudEluc3RBZG1pblBlcm1pc3Npb24ocmVjb3JkS2V5KTsKCiAgICBnZXRSZWNvcmQgPSBhd2FpdCBvcy5nZXREYXRhKHJlY29yZEtleSwgYWJJRCk7Cn0KCmlmICghZ2V0UmVjb3JkLnN1Y2Nlc3MpCnsKICAgIG9zLnRvYXN0KGBubyBkYXRhIGZvdW5kIGluICR7YWJJRH1gKTsKCiAgICBzaG91dCgiYWJNZW51UmVmcmVzaCIpOwoKICAgIGlmIChwcm9ncmVzc0J1dHRvbikKICAgIHsKICAgICAgICBkZXN0cm95KHByb2dyZXNzQnV0dG9uKTsKICAgIH0KCiAgICByZXR1cm4ge3N1Y2Nlc3M6IGZhbHNlfTsKfQplbHNlCnsKICAgIGNvbnN0IHB1YmxpY1JlYWRUZXN0ID0gZ2V0UmVjb3JkLm1hcmtlcnMuaW5kZXhPZigicHVibGljUmVhZCIpOwogICAgY29uc3QgYXV0aG9yID0gYXdhaXQgb3MucmVxdWVzdEF1dGhCb3RJbkJhY2tncm91bmQoKTsKCiAgICBpZiAocHVibGljUmVhZFRlc3QgIT0gLTEgJiYgYXV0aG9yKQogICAgewogICAgICAgIGlmIChhdXRoQm90LnRhZ3MucHJpdmFjeUZlYXR1cmVzLmFsbG93UHVibGljRGF0YSkKICAgICAgICB7CiAgICAgICAgICAgIGNvbnN0IGVnZ0hhdGNoRXZlbnQgPSBhYklEOwogICAgICAgIAogICAgICAgICAgICBvcy5yZWNvcmRFdmVudChsaW5rcy5yZW1lbWJlci50YWdzLmFiUmVjb3JkS2V5LCBlZ2dIYXRjaEV2ZW50KTsKICAgICAgICB9CiAgICB9CgogICAgLy9wYWNrYWdlIHRoZSByZWNvcmQgZGF0YQogICAgbmV3RWdnID0gZ2V0UmVjb3JkLmRhdGE7Cn0KCmFiLmxvZyhhYlJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkgKyAiOiAiICsgdGhhdC5hYklEICsgIiBsb2FkZWQsIHZlcnNpb24gIiArIGdldFJlY29yZC5kYXRhLnRhcmdldFZlcnNpb24gKyAiIG9mICIgKyBnZXRSZWNvcmQuZGF0YS5tYXhWZXJzaW9uKTsKCi8vdGhpcyBsb2dpYyBwYXJzZXMgdGhlIGRhdGEgZGVwZW5kYW50IG9uIGhvdyBpdCB3YXMgYWNjZXNzZWQvZ2FpbmVkCmlmIChyZXR1cm5UeXBlID09ICJkYXRhIiAmJiBnZXRSZWNvcmQuc3VjY2VzcykKewogICAgbGV0IHZlcnNpb24gPSBnZXRSZWNvcmQuZGF0YS50YXJnZXRWZXJzaW9uIC0gMTsKCiAgICBpZiAodGhhdC5hYlZlcnNpb24pCiAgICB7CiAgICAgICAgaWYgKCFpc05hTih0aGF0LmFiVmVyc2lvbikpCiAgICAgICAgewogICAgICAgICAgICB2ZXJzaW9uID0gdGhhdC5hYlZlcnNpb24gLSAxOwogICAgICAgIH0KICAgIH0KCiAgICBsZXQgZWdnRGF0YVVSTCA9IGdldFJlY29yZC5kYXRhLmVnZ1ZlcnNpb25IaXN0b3J5W3ZlcnNpb25dOwogICAgbGV0IHJldHVybkRhdGEgPSBhd2FpdCBvcy5nZXRGaWxlKGVnZ0RhdGFVUkwpOwoKICAgIGlmIChwcm9ncmVzc0J1dHRvbikKICAgIHsKICAgICAgICBkZXN0cm95KHByb2dyZXNzQnV0dG9uKTsKICAgIH0KCiAgICByZXR1cm4gcmV0dXJuRGF0YTsKfQplbHNlIGlmIChyZXR1cm5UeXBlID09ICJkYXRhIikKewogICAgbGV0IHZlcnNpb25BcnJheSA9IEpTT04ucGFyc2UobmV3RWdnLmVnZ1ZlcnNpb25IaXN0b3J5KTsKICAgIGxldCBmaWxlVVVJRCA9IHZlcnNpb25BcnJheVtuZXdFZ2cubWF4VmVyc2lvbiAtIDFdOwogICAgbGV0IGZpbGVuYW1laGFzaExUTSA9IGNyeXB0by5zaGEyNTYoZmlsZVVVSUQpOwogICAgbGV0IGZpbGV1cmxoYXNoTFRNID0gImF1eF8iICsgZmlsZW5hbWVoYXNoTFRNICsgJy5hdXgnOwogICAgbGV0IHRhcmdldExUTVVSTCA9ICJodHRwczovL2J1aWxkZXItbHRtLWZpbGVzLnMzLmFtYXpvbmF3cy5jb20vIiArIGZpbGV1cmxoYXNoTFRNOwogICAgbGV0IG8gPSB7fTsKICAgIG8ubWV0aG9kID0gIkdFVCI7CiAgICBvLnVybCA9IHRhcmdldExUTVVSTDsKCiAgICBmaWxlR2V0ID0gYXdhaXQgd2ViaG9vayhvKTsKCiAgICBpZiAocHJvZ3Jlc3NCdXR0b24pCiAgICB7CiAgICAgICAgZGVzdHJveShwcm9ncmVzc0J1dHRvbik7CiAgICB9CgogICAgaWYgKGZpbGVHZXQuc3RhdHVzICE9IDIwMCkKICAgIHsKICAgICAgICBvcy50b2FzdCgibm8gZmlsZSBmb3VuZCIpOwoKICAgICAgICBzaG91dCgiYWJSZWZyZXNoIik7CgogICAgICAgIHJldHVybiB7c3VjY2VzczogZmFsc2V9OwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGZpbGVHZXQgPSBmaWxlR2V0LmRhdGE7CiAgICB9CgogICAgcmV0dXJuIGZpbGVHZXQ7Cn0KCi8vYWIgc3BlY2lmaWMgdmFyaWFibGVzIGZvciB1bmRlcnN0YW5kaW5nIGlmIGEgcG9zaXRpb24gaXMgc3BlY2lmaWVkCmxldCBjdXJyZW50RGltOwpsZXQgc3BhY2VNb2Q7CmxldCBkaW1lbnNpb25YOwpsZXQgZGltZW5zaW9uWTsKbGV0IGRpbU1vZDsKCi8vaGFuZGxlIGRpbWVuc2lvbiBpZGVudGlmaWNhdGlvbgppZiAobGlua3MubWFuaWZlc3RhdGlvbikKewogICAgaWYgKGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpCiAgICB7CiAgICAgICAgY29uc3QgYWJCb3QgPSBsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90OwoKICAgICAgICBjdXJyZW50RGltID0gYWJCb3QudGFncy5kaW1lbnNpb247CiAgICB9Cn0KZWxzZQp7CiAgICBjdXJyZW50RGltID0gb3MuZ2V0Q3VycmVudERpbWVuc2lvbigpOwp9CgovL2NoZWNrcyBmb3IgZ3JpZCBmb2N1cwppZiAoIWxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJHcmlkRm9jdXMpIAp7CiAgICBkaW1lbnNpb25YID0gbnVsbDsKICAgIGRpbWVuc2lvblkgPSBudWxsOwp9CmVsc2UKewogICAgbGV0IGhhdGNoUG9pbnQgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiR3JpZEZvY3VzOwoKICAgIGN1cnJlbnREaW0gPSBoYXRjaFBvaW50LmRpbWVuc2lvbjsKICAgIGRpbWVuc2lvblggPSBoYXRjaFBvaW50LnBvc2l0aW9uLng7CiAgICBkaW1lbnNpb25ZID0gaGF0Y2hQb2ludC5wb3NpdGlvbi55OwogICAgc3BhY2VNb2QgPSB7c3BhY2U6ICJzaGFyZWQifTsKfQoKLy90aGlzIGxvZ2ljIGhhbmRsZXMgbG9naWMgYXJvdW5kIGF1dG9IYXRjaCB2cyBtYW51YWwgaGF0Y2hpbmcKaWYgKCFhdXRvSGF0Y2ggJiYgY29uZmlnQm90LnRhZ3MucGF0dGVybiA9PSBudWxsKQp7CiAgICBkaW1Nb2QgPSB7W2N1cnJlbnREaW1dOiB0cnVlLCBbY3VycmVudERpbSsiWCJdOiBkaW1lbnNpb25YLCBbY3VycmVudERpbSsiWSJdOiBkaW1lbnNpb25ZLCBkaW1lbnNpb246IGN1cnJlbnREaW19Owp9CmVsc2UKewogICAgaWYgKGNvbmZpZ0JvdC50YWdzLmtleSAmJiAhdGhhdC5rZXkpCiAgICB7CiAgICAgICAga2V5ID0gY29uZmlnQm90LnRhZ3Mua2V5CiAgICB9CgogICAgZGltTW9kID0ge2F1dG9IYXRjaDogdHJ1ZSwga2V5OiBrZXl9Owp9CgovL2NhbGwgZm9yIG92byB3aXRoIGluZm9ybWF0aW9uIHByb3ZpZGVkCmF3YWl0IHRoaXNCb3QubWFuaWZlc3RPdm8oe2FiSUQ6IGFiSUQsIHN0dWRpbzogcmVjb3JkS2V5LCBkaW1Nb2Q6IGRpbU1vZCwgc3BhY2VNb2Q6IHNwYWNlTW9kLCBlZ2dEYXRhOiBuZXdFZ2csIGluaXRpYWxCb290OiBpbml0aWFsQm9vdCwgZWdnUGFyYW1ldGVyczogdGhhdC5lZ2dQYXJhbWV0ZXJzfSk7CgppZiAocHJvZ3Jlc3NCdXR0b24pCnsKICAgIGRlc3Ryb3kocHJvZ3Jlc3NCdXR0b24pOwp9CgpyZXR1cm4ge3N1Y2Nlc3M6IHRydWV9OycA3v7i4AzqjwMLbWFuaWZlc3RPdm8CBADe/uLgDIK8A5UNQC8vZWdnIHZpc3VhbGl6YXRpb24Kc2hvdXQoImFiTWVudVJlc2V0Iik7CgppZiAobGlua3MubWFuaWZlc3RhdGlvbikKewogICAgaWYgKGxpbmtzLm1hbmlmZXN0YXRpb24ubGlua3MuYWJCb3QpCiAgICB7CiAgICAgICAgZGVzdHJveShsaW5rcy5tYW5pZmVzdGF0aW9uLmxpbmtzLmFiQm90KTsKICAgIH0KfQoKaWYgKGxpbmtzLm92b0JvdCkKewogICAgZGVzdHJveShsaW5rcy5vdm9Cb3QpOwp9CgpsZXQgc3BhY2VNb2QgPSB0aGF0LnNwYWNlTW9kOwpsZXQgZGltTW9kID0gdGhhdC5kaW1Nb2Q7CmxldCBlZ2dEYXRhID0gdGhhdC5lZ2dEYXRhOwpsZXQgZWdnUGFyYW1ldGVycyA9IHRoYXQuZWdnUGFyYW1ldGVyczsKbGV0IGVnZ01vZCA9IHt9OwoKZWdnTW9kLnNwYWNlID0gInRlbXBMb2NhbCI7CmVnZ01vZC5pbml0aWFsVGltZXIgPSB0cnVlOwplZ2dNb2QuYWJJRCA9IHRoYXQuYWJJRDsKZWdnTW9kLnN0dWRpbyA9IHRoYXQuc3R1ZGlvOwplZ2dNb2QuaW5pdGlhbEJvb3QgPSB0aGF0LmluaXRpYWxCb290OwplZ2dNb2QuZWdnUGFyYW1ldGVycyA9IGVnZ1BhcmFtZXRlcnM7CmVnZ01vZC5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKZWdnTW9kLm9uQ2xpY2sgPSBgQCBsaW5rcy5tYW5hZ2VyLmludGVyYWN0T3ZvKCk7YDsKZWdnTW9kLm9uQ3JlYXRlID0gYGA7CmVnZ01vZC5mb3JtID0gImVnZyI7CmVnZ01vZC5jb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3I7CmVnZ01vZC5sYWJlbENvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VMYWJlbENvbG9yOwplZ2dNb2QucHJvZ3Jlc3NCYXJDb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQWNjZW50Q29sb3I7CmVnZ01vZC5wcm9ncmVzc0JhckJhY2tncm91bmRDb2xvciA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCYXNlQ29sb3I7CmVnZ01vZC5sYWJlbFNpemUgPSAwLjU7CmVnZ01vZC5vblBvaW50ZXJFbnRlciA9ICJAIG9zLnRvYXN0KHRhZ3MuYWJJRCArICcgdicrdGFncy50YXJnZXRWZXJzaW9uKTsiOwplZ2dNb2QubGFiZWxQb3NpdGlvbiA9ICJmcm9udCI7CmVnZ01vZC5vcmllbnRhdGlvbk1vZGUgPSAiYmlsbGJvYXJkRnJvbnQiOwplZ2dNb2Qub25EZXN0cm95ID0gYEAgbGlua3MubWFuYWdlci5tYXNrcy5vdm9Cb3QgPSBudWxsO2A7CmVnZ01vZC5lZ2dUaW1lciA9IGBAIGlmICh0YWdzLnByb2dyZXNzQmFyIDwgMSkgCnsKICAgIHRhZ3MucHJvZ3Jlc3NCYXIgKz0gMC4xOwoKICAgIHNldFRpbWVvdXQoKCkgPT4ge3doaXNwZXIodGhpc0JvdCwgImVnZ1RpbWVyIik7fSwgNzUpOwp9CmVsc2UKewogICAgdGhpc0JvdC5vbkNsaWNrKCk7CiAgICAKICAgIHRhZ3MucHJvZ3Jlc3NCYXIgPSBudWxsOwp9YDsKCmxldCBvdm8gPSBhd2FpdCBjcmVhdGUoZWdnRGF0YSwgZWdnTW9kLCBkaW1Nb2QsIHNwYWNlTW9kKTsKCmlmIChvdm8udGFncy5hdXRvSGF0Y2gpCnsKICAgIGF3YWl0IHRoaXNCb3QuaGF0Y2hPdm8ob3ZvKTsKfQplbHNlCnsKICAgIG92by50YWdzLnByb2dyZXNzQmFyID0gMDsgCiAgICAKICAgIGNvbmZpZ0JvdC50YWdzLnZlcnNpb24gPSBvdm8udGFncy5tYXhWZXJzaW9uOwoKICAgIHNldFRpbWVvdXQoKCkgPT4ge3doaXNwZXIob3ZvLCAiZWdnVGltZXIiKTt9LCA3NSk7Cn0KCm1hc2tzLm92b0JvdCA9ICLwn5SXIiArIG92by5pZDsKCnJldHVybjsnAN7+4uAM6o8DCW9uS2V5RG93bgIEAN7+4uAMlMkDggZALy9oaWRkZW4gdmVyc2lvbiBidXR0b24gZm9yIGhhdGNoIG1lbnUKaWYgKCFsaW5rcy5vdm9Cb3QgfHwgY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbCAhPSAiYWJPdm9NZW51IikKewogICAgcmV0dXJuOwp9CgppZiAodGhhdC5rZXlzID09ICJTaGlmdCIpCnsKICAgIGxldCB2ZXJzaW9uQnV0dG9uID0ge307CgogICAgdmVyc2lvbkJ1dHRvbi5hYk92b01lbnUgPSB0cnVlOwogICAgdmVyc2lvbkJ1dHRvbi5vdm9Tb3J0T3JkZXIgPSAtMTsKICAgIHZlcnNpb25CdXR0b24ubWF4VmVyc2lvbiA9IGxpbmtzLm92b0JvdC50YWdzLm1heFZlcnNpb247CiAgICB2ZXJzaW9uQnV0dG9uLm1hbmFnZXIgPSAi8J+UlyIgKyB0aGlzQm90LmlkOwogICAgdmVyc2lvbkJ1dHRvbi5sYWJlbCA9ICJjaGFuZ2UgZWdnIHZlcnNpb24iOwogICAgdmVyc2lvbkJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJjZW50ZXIiOwogICAgdmVyc2lvbkJ1dHRvbi5vdm9NZW51UmVzZXQgPSAiQCBkZXN0cm95KHRoaXNCb3QpOyI7CiAgICB2ZXJzaW9uQnV0dG9uLmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VBY2NlbnRDb2xvcjsKICAgIHZlcnNpb25CdXR0b24ub25LZXlVcCA9ICJAIGlmKHRoYXQua2V5cyA9PSAnU2hpZnQnKXtkZXN0cm95KHRoaXNCb3QpfTsiOwogICAgdmVyc2lvbkJ1dHRvbi5vbkNsaWNrID0gIkAgbGlua3MubWFuYWdlci5jaGFuZ2VPdm9WZXJzaW9uKCk7IjsKCiAgICBsaW5rcy5tZW51LmFiQ3JlYXRlTWVudUJ1dHRvbih2ZXJzaW9uQnV0dG9uKTsKfScA3v7i4AzqjwMIaGF0Y2hPdm8CBADe/uLgDJXPA6kUQC8vbG9naWMgZm9yIGhhdGNoaW5nIG9mIGFuIGFiCnNob3V0KCdvdm9NZW51UmVzZXQnKTsKCi8vZGF0YSBpbiByZWdhcmRzIHRvIHdoYXQgYWIgaXMgZ29pbmcgdG8gYmUgaGF0Y2hlZApjb25zdCBvdm8gPSB0aGF0OwoKLy9oYXRjaCBzcGVjaWZpYyB2YXJpYWJsZXMKbGV0IGluaXRpYWxCb290ID0gb3ZvLnRhZ3MuaW5pdGlhbEJvb3Q7CmxldCB0YXJnZXRWZXJzaW9uID0gb3ZvLnRhZ3Muc3RhYmxlVmVyc2lvbiA/PyBvdm8udGFncy50YXJnZXRWZXJzaW9uOwoKaWYgKChjb25maWdCb3QudGFncy5hYlZlcnNpb24gfHwgY29uZmlnQm90LnRhZ3MucGF0dGVyblZlcnNpb24pICYmIChvdm8udGFncy5hYklEID09IGNvbmZpZ0JvdC50YWdzLnBhdHRlcm4gfHwgb3ZvLnRhZ3MuYWJJRCA9PSBjb25maWdCb3QudGFncy5hYikpCnsKICAgIHRhcmdldFZlcnNpb24gPSBjb25maWdCb3QudGFncy5hYlZlcnNpb24gPz8gY29uZmlnQm90LnRhZ3MucGF0dGVyblZlcnNpb247Cn0KCi8vdGFyZ2V0ZWQgdmVyc2lvbnMKaWYgKGNvbmZpZ0JvdC50YWdzLnZlcnNpb24gJiYgKG92by50YWdzLmFiSUQgPT0gY29uZmlnQm90LnRhZ3MucGF0dGVybiB8fCBvdm8udGFncy5hYklEID09IGNvbmZpZ0JvdC50YWdzLmFiIHx8ICFpc05hTihjb25maWdCb3QudGFncy52ZXJzaW9uKSkpCnsKICAgIGlmIChjb25maWdCb3QudGFncy52ZXJzaW9uID09ICJmZWVkYmFjayIpCiAgICB7CiAgICAgICAgdGFyZ2V0VmVyc2lvbiA9IG92by50YWdzLmZlZWRiYWNrVmVyc2lvbjsKICAgIH0KICAgIGVsc2UgaWYgKGNvbmZpZ0JvdC50YWdzLnZlcnNpb24gPT0gImN1cnJlbnQiKQogICAgewogICAgICAgIHRhcmdldFZlcnNpb24gPSBvdm8udGFncy5lZ2dWZXJzaW9uSGlzdG9yeS5sZW5ndGg7CiAgICB9CiAgICBlbHNlIGlmICghaXNOYU4oY29uZmlnQm90LnRhZ3MudmVyc2lvbikpCiAgICB7CiAgICAgICAgdGFyZ2V0VmVyc2lvbiA9IGNvbmZpZ0JvdC50YWdzLnZlcnNpb24KICAgIH0KCiAgICBjb25maWdCb3QudGFncy52ZXJzaW9uID0gbnVsbDsKfQoKaWYgKGlzTmFOKHRhcmdldFZlcnNpb24pKQp7CiAgICB0YXJnZXRWZXJzaW9uID0gb3ZvLnRhZ3MuZWdnVmVyc2lvbkhpc3RvcnkubGVuZ3RoOwp9CgpsZXQgdmVyc2lvbkFycmF5ID0gb3ZvLnRhZ3MuZWdnVmVyc2lvbkhpc3Rvcnk7CmxldCBmaWxlVVJMID0gdmVyc2lvbkFycmF5W3RhcmdldFZlcnNpb24gLSAxXTsKbGV0IGtleSA9IG92by50YWdzLmtleSA/IG92by50YWdzLmtleSA6IGNvbmZpZ0JvdC50YWdzLmtleTsKbGV0IGZpbGVHZXQ7CgovL2FjdHVhbCBmaWxlIHJldHJpZXZhbAp0cnkKewogICAgZmlsZUdldCA9IGF3YWl0IG9zLmdldEZpbGUoZmlsZVVSTCk7Cn0KY2F0Y2ggKGVycm9yKQp7CiAgICBjb25zb2xlLmxvZyhlcnJvcik7CgogICAgb3MudG9hc3QoIm5vIGZpbGUgZm91bmQiKTsKCiAgICByZXR1cm47Cn0KCi8vaGFuZGxpbmcgZm9yIGVuY3J5cHRlZCBhYiBmaWxlCmlmIChjcnlwdG8uaXNFbmNyeXB0ZWQoZmlsZUdldCkpCnsKICAgIGlmICgha2V5KQogICAgewogICAgICAgIGtleSA9IGF3YWl0IG9zLnNob3dJbnB1dCgnJywgewogICAgICAgICAgICB0eXBlOiAnc2VjcmV0JywKICAgICAgICAgICAgdGl0bGU6ICdFbnRlciBrZXknCiAgICAgICAgfSk7CiAgICB9CgogICAgdHJ5CiAgICB7CiAgICAgICAgZmlsZUdldCA9IGNyeXB0by5kZWNyeXB0KGtleSwgZmlsZUdldCk7CiAgICB9CiAgICBjYXRjaCAoZXJyb3IpCiAgICB7CiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpCgogICAgICAgIG9zLnRvYXN0KCJrZXkgZG9lcyBub3QgbWF0Y2ggZmlsZSIpOwoKICAgICAgICByZXR1cm47CiAgICB9CiAgIAogICAgZmlsZUdldCA9IEpTT04ucGFyc2UoZmlsZUdldCk7CgogICAgZmlsZUdldCA9IGZpbGVHZXQuc3RhdGU7Cn0KZWxzZQp7CiAgICBmaWxlR2V0ID0gZmlsZUdldC5zdGF0ZTsKfQoKLy9jbGVhbiB1cApkZXN0cm95KG92byk7CgovL3RvYXN0IGlmIG5vdCBvbiBzdGFibGUKaWYob3ZvLnRhZ3Muc3RhYmxlVmVyc2lvbiAhPSB0YXJnZXRWZXJzaW9uICYmICFjb25maWdCb3QudGFncy5hYlNpbGVudCkKewogICAgaWYgKG92by50YWdzLmZlZWRiYWNrVmVyc2lvbiA9PSB0YXJnZXRWZXJzaW9uKQogICAgewogICAgICAgIG9zLnRvYXN0KCJsb2FkaW5nIGZlZWRiYWNrIHZlcnNpb24gb2YgIiArIG92by50YWdzLmFiSUQpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIG9zLnRvYXN0KCJsb2FkaW5nIHZlcnNpb24gIiArIHRhcmdldFZlcnNpb24gKyAiIG9mICIgKyBvdm8udGFncy5lZ2dWZXJzaW9uSGlzdG9yeS5sZW5ndGggKyAiIG9mICIgKyBvdm8udGFncy5hYklEKTsKICAgIH0KfQoKLy9nZW5lcmF0ZSBib3RzIGJhc2VkIG9uIHRoZSBmaWxlIHJldHJpZXZlZCAqSEVSRSoKYXdhaXQgbGlua3MuY3JlYXRlLmFiQ3JlYXRlQm90cyh7Ym90czogZmlsZUdldCwgb3JpZ2luOiBvdm8udGFncy5hYklELCBzdHVkaW86IG92by50YWdzLnN0dWRpbywgdmVyc2lvbjogdGFyZ2V0VmVyc2lvbiwgaW5pdGlhbEJvb3Q6IGluaXRpYWxCb290LCBlZ2dQYXJhbWV0ZXJzOiBvdm8udGFncy5lZ2dQYXJhbWV0ZXJzfSk7CgpyZXR1cm47JwDe/uLgDOqPAwtpbnRlcmFjdE92bwIEAN7+4uAMv+MDsAdALy9tYW51YWwgaGF0Y2ggbWVudQpjb25zdCBvdm9Cb3QgPSB0aGF0ID8gdGhhdCA6IGxpbmtzLm92b0JvdDsKCmlmICghb3ZvQm90KQp7CiAgICByZXR1cm47Cn0KCnNob3V0KCJvdm9NZW51UmVzZXQiKTsKCmNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiT3ZvTWVudSI7CgptYXNrcy5vbkdyaWRDbGljayA9IGBAIHNob3V0KCJvdm9NZW51UmVzZXQiKTtgOwptYXNrcy5vdm9NZW51UmVzZXQgPSBgQCBtYXNrcy5vbkdyaWRDbGljayA9IG51bGw7Cm1hc2tzLm92b01lbnVSZXNldCA9IG51bGw7Cgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7CmA7CgpsZXQgZWdnTWVudUJ1dHRvbiA9IHt9OwoKb3MudHdlZW5Ubyhvdm9Cb3QsIDE1LDQ1LDQ1LCA1KTsKCmVnZ01lbnVCdXR0b24uYWJPdm9NZW51ID0gdHJ1ZTsKZWdnTWVudUJ1dHRvbi5tYW5hZ2VyID0gIvCflJciICsgdGhpc0JvdC5pZDsKZWdnTWVudUJ1dHRvbi5vdm9Cb3QgPSAi8J+UlyIgKyBvdm9Cb3QuaWQ7CmVnZ01lbnVCdXR0b24uY29sb3IgPSBsaW5rcy5yZW1lbWJlci50YWdzLmFiQmFzZUNvbG9yOwplZ2dNZW51QnV0dG9uLnRhcmdldFZlcnNpb24gPSBvdm9Cb3QudGFncy50YXJnZXRWZXJzaW9uOwplZ2dNZW51QnV0dG9uLmxhYmVsID0gImhhdGNoICIgKyBvdm9Cb3QudGFncy5hYklEICsgIiB2IiArIG92b0JvdC50YWdzLnRhcmdldFZlcnNpb24gKyAiIG9mICIgKyBvdm9Cb3QudGFncy5tYXhWZXJzaW9uOwplZ2dNZW51QnV0dG9uLmxhYmVsQWxpZ25tZW50ID0gImNlbnRlciI7CmVnZ01lbnVCdXR0b24ub3ZvTWVudVJlc2V0ID0gIkAgZGVzdHJveSh0aGlzQm90KTsiOwplZ2dNZW51QnV0dG9uLm9uQ2xpY2sgPSAiQCBsaW5rcy5tYW5hZ2VyLmhhdGNoT3ZvKGxpbmtzLm92b0JvdCk7IjsKCmxpbmtzLm1lbnUuYWJDcmVhdGVNZW51QnV0dG9uKGVnZ01lbnVCdXR0b24pOycA3v7i4AzqjwMGY3JlYXRlAgQA3v7i4Azs6gMo8J+UlzM0YzNjMjEwLTViZjEtNDljZi1iMTUxLWVlMmQwN2YwZTY3MycA3v7i4AzqjwMQY2hhbmdlT3ZvVmVyc2lvbgIEAN7+4uAMk+sD8AJALy9sb2dpYyBmb3IgdmVyc2lvbiBjaGFuZ2luZyB3aGVuIG1hbnVhbGx5IGhhdGNoaW5nIGFuIGFiCmNvbnN0IG92b0JvdCA9IGxpbmtzLm92b0JvdDsKCmxldCBuZXdWZXJzaW9uID0gYXdhaXQgb3Muc2hvd0lucHV0KG92b0JvdC50YWdzLnRhcmdldFZlcnNpb24sIHsKICAgIHBsYWNlaG9sZGVyOiAiZW50ZXIgYSB2ZXJzaW9uIGZyb20gMSB0byAiICsgb3ZvQm90LnRhZ3MubWF4VmVyc2lvbgp9KTsKCm92b0JvdC50YWdzLnRhcmdldFZlcnNpb24gPSBuZXdWZXJzaW9uOwpvdm9Cb3QudGFncy5sYWJlbCA9ICd2JysgbmV3VmVyc2lvbjsKCmNvbmZpZ0JvdC50YWdzLnZlcnNpb24gPSBuZXdWZXJzaW9uOwoKc2hvdXQoIm92b01lbnVSZXNldCIpOycA3v7i4AzqjwMEbWVudQIEAN7+4uAMhO4DKPCflJdiMzBjNmM1ZC1hNGY3LTQyNjYtYmEzOC0zOTNkYzk1ZTFlY2InAN7+4uAM6o8DCGFiSWdub3JlAgQA3v7i4Ayr7gMEdHJ1ZScA3v7i4AzqjwMHYWJTaGVsbAIEAN7+4uAMsO4DBHRydWUnAN7+4uAM6o8DDGFiMUxUTVNlYXJjaAIEAN7+4uAMte4DM0AvL3N1cHBvcnQgb2xkIHN5bnRheAp0aGlzQm90Lm9uTG9va3VwQUJFZ2dzKHRoYXQpOycA3v7i4AzqjwMNb25Mb29rdXBBc2tJRAIEAN7+4uAM6e4D/gZAbGV0IHByb2dyZXNzQnV0dG9uID0gYXdhaXQgbGlua3MuaW5wdXQuYWJQcm9ncmVzc0JhcihgbG9va2luZyB1cCAke3RoYXQuYXNrSUR9YCk7Cgpjb25zdCBhc2tJRCA9ICJhc2tfIiArIHRoYXQuYXNrSUQ7CmNvbnN0IGVuZHBvaW50ID0gbGlua3MucmVtZW1iZXIudGFncy5hYkVuZHBvaW50OwpsZXQgbG9va3VwQXNrOyAKCnRyeQp7CiAgICBsb29rdXBBc2sgPSBhd2FpdCBvcy5nZXREYXRhKGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJSZWNvcmRLZXksIGFza0lELCBlbmRwb2ludCk7Cn0KY2F0Y2gKewogICAgbG9va3VwQXNrID0gYXdhaXQgb3MuZ2V0RGF0YShsaW5rcy5yZW1lbWJlci50YWdzLmFiUmVjb3JkS2V5LCB0aGF0LmFza0lELCBlbmRwb2ludCk7Cn0KCmlmIChsb29rdXBBc2suc3VjY2VzcyAmJiBsb29rdXBBc2suZGF0YS5wYXR0ZXJuSUQpCnsKICAgIGlmIChsb29rdXBBc2suZGF0YS5zdHVkaW9JRCA9PSAiQUIiKQogICAgewogICAgICAgIGF3YWl0IGxpbmtzLmxlYXJuLmFiQWRhcHQobG9va3VwQXNrLmRhdGEucGF0dGVybklEKTsKCiAgICAgICAgc2hvdXQoIm9uQUJJbml0aWFsaXplZCIpOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHRoaXNCb3Qub25Mb29rdXBBQkVnZ3Moe2FiSUQ6IGxvb2t1cEFzay5kYXRhLnBhdHRlcm5JRCwgcmVjb3JkS2V5OiBsb29rdXBBc2suZGF0YS5zdHVkaW9JRCwgYXV0b0hhdGNoOiB0cnVlfSk7ICAKICAgIH0KfQplbHNlIGlmIChsb29rdXBBc2suc3VjY2VzcyAmJiAhbG9va3VwQXNrLmRhdGEudXJsKQp7CiAgICBsb29rdXBBc2suc3VjY2VzcyA9ICFsb29rdXBBc2suc3VjY2VzczsKfQoKaWYgKHByb2dyZXNzQnV0dG9uKQp7CiAgICBkZXN0cm95KHByb2dyZXNzQnV0dG9uKTsKfQoKcmV0dXJuIGxvb2t1cEFzazsnAN7+4uAM6o8DBWlucHV0AgQA3v7i4Azo9QMo8J+Ul2Y4NjAyODc4LWMyZWYtNDhiZC04NWEwLThkNjM1MWViNDEyMCcA3v7i4AzqjwMFaGF0Y2gCBADe/uLgDI/2A8ABQC8vc2hvdXQoImhhdGNoIiwge2FiSUQ6IGFiSUQsIHJlY29yZEtleTogc3R1ZGlvLCBrZXk6IGtleSwgYXV0b0hhdGNoOiBib29sZWFuLCByZXR1cm5UeXBlOiBkYXRhL251bGwsIGVnZ1BhcmFtZXRlcnM6IGFyZ30pOwoKY29uc3QgbG9va1VwID0gYXdhaXQgdGhpc0JvdC5vbkxvb2t1cEFCRWdncyh0aGF0KTsKCnJldHVybiBsb29rVXA7JwDe/uLgDOqPAwlhYlZlcnNpb24CBADe/uLgDND3AxQ5LjY1LjEuMTczNzQ5NTU5MzUxMCcA3v7i4AzqjwMFbGVhcm4CBADe/uLgDOX3Ayjwn5SXNjY1N2I4NjUtZTk4My00NDAxLTlmYzktZjU0MThkMThhN2Y3JwEEYm90cyRmODYwMjg3OC1jMmVmLTQ4YmQtODVhMC04ZDYzNTFlYjQxMjABJwDe/uLgDIz4AwZzeXN0ZW0CBADe/uLgDI34Aw5hYi5zaGVsbC5pbnB1dCcA3v7i4AyM+AMEZm9ybQIEAN7+4uAMnPgDB25vdGhpbmcnAN7+4uAMjPgDCW9uS2V5RG93bgIEAN7+4uAMpPgDbUAvL2FsbG93IHB1bGxpbmcgdXAgY2hhdCBpbiBidWlsZGVyIHZlcnNpb24KaWYgKHRoYXQua2V5cyA9PSAiYCIgJiYgYnVpbGRlclZlcnNpb24pCnsKICAgIG9zLnNob3dDaGF0KCI+Iik7Cn0nAN7+4uAMjPgDBm9uQ2hhdAIEAN7+4uAMkvkDyh5ALy9ub3Qgc3VwcG9ydGVkIG91dHNpZGUgb2YgYnVpbGRlciB2ZXJzaW9uCmlmICghYnVpbGRlclZlcnNpb24pCnsKICAgIHJldHVybjsKfQoKLy90aGlzIGxvb3AgaWRlbnRpZmllcyBwb3NzaWJsZSBhYiBzcGVjaWZpYyBtZXNzYWdlcywgYW5kIGNhbGxzIGEgc2V0IGxpc3Qgb2YgY29tbWFuZHMKaWYgKHRoYXQubWVzc2FnZVswXSA9PSAiLiIpIAp7CiAgICBvcy5oaWRlQ2hhdCgpOwoKICAgIHN3aXRjaCAodGhhdC5tZXNzYWdlKQogICAgewogICAgICAgIGNhc2UgJy5kb3dubG9hZEFCJzoKICAgICAgICAgICAgY2hhbmdlU3RhdGUobGlua3MubWFuaWZlc3RhdGlvbiwgIkFzbGVlcCIsICJhYk1hbmlmZXN0U3RhdGUiKTsKCiAgICAgICAgICAgIGxldCBncm91cCA9IGF3YWl0IG9zLnNob3dJbnB1dCgiZ3JvdXAiKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IG1ham9yVmVyc2lvbiA9IGxpbmtzLmxlYXJuLnRhZ3MuYWJDb3JlTWFqb3JWZXJzaW9uOwogICAgICAgICAgICBjb25zdCBtaW5vclZlcnNpb24gPSBsaW5rcy5sZWFybi50YWdzLmFiQ29yZU1pbm9yVmVyc2lvbjsKICAgICAgICAgICAgY29uc3QgY29uZmlnVmVyc2lvbiA9IGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJDb25maWdWZXJzaW9uID8/IDA7CiAgICAgICAgICAgIGNvbnN0IGxhc3RVcGRhdGUgPSBEYXRlVGltZS51dGMoKS50czsKICAgICAgICAgICAgY29uc3QgYWJWZXJzaW9uID0gYCR7bWFqb3JWZXJzaW9ufS4ke21pbm9yVmVyc2lvbn0uJHtjb25maWdWZXJzaW9ufS4ke2xhc3RVcGRhdGV9YDsKCiAgICAgICAgICAgIGlmIChncm91cCA9PSAiYWJDb25maWciKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmFiQ29yZUl0ZXJhdGlvbisrOwogICAgICAgICAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5pbml0aWFsQm9vdCA9IHRydWU7CiAgICAgICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmNvcmVBQiA9IG51bGw7CiAgICAgICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmhvc3RJRCA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoZ3JvdXAgPT0gImFiQ29yZSIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxpbmtzLmxlYXJuLnRhZ3MuYWJJbnN0ID0gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgYWJHcm91cCA9IGdldEJvdHMoZ3JvdXApOwoKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhYkdyb3VwLmxlbmd0aDsgaSsrKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBhYkdyb3VwW2ldLnRhZ3MuYWJWZXJzaW9uID0gYWJWZXJzaW9uOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZ3JvdXAgPT0gImFiQ29yZSIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGdyb3VwID0gImFiMSI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIG9zLmRvd25sb2FkQm90c0FzSW5pdGlhbHphdGlvblVwZGF0ZShhYkdyb3VwLCBncm91cCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC5sb2FkU2tpbGxgOgogICAgICAgICAgICBsZXQgc2tpbGwgPSBhd2FpdCBvcy5zaG93SW5wdXQoInNraWxsIik7CgogICAgICAgICAgICBsaW5rcy5sZWFybi5hYkFkYXB0KHNraWxsKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLnN5c3RlbWA6CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnN5c3RlbVBvcnRhbCA9IHRydWU7CgogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAuc2hlZXRgOgogICAgICAgICAgICBjb25maWdCb3QudGFncy5zaGVldFBvcnRhbCA9ICFjb25maWdCb3QudGFncy5tYXBQb3J0YWwgPyBjb25maWdCb3QudGFncy5ncmlkUG9ydGFsIDogY29uZmlnQm90LnRhZ3MubWFwUG9ydGFsOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLm1lbnVTaGVldGA6CiAgICAgICAgICAgIGNvbmZpZ0JvdC50YWdzLnNoZWV0UG9ydGFsID0gY29uZmlnQm90LnRhZ3MubWVudVBvcnRhbDsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC5kb3dubG9hZGA6CiAgICAgICAgICAgIG9zLmRvd25sb2FkQm90cyhnZXRCb3RzKGJ5TW9kKHtzcGFjZTogInNoYXJlZCIsIGFiSWdub3JlOiBudWxsfSkpLCBvcy5nZXRDdXJyZW50SW5zdCgpKTsKCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgYC51cGxvYWRgOgogICAgICAgICAgICBvcy5zaG93VXBsb2FkQXV4RmlsZSgpOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBgLnNsZWVwYDoKICAgICAgICAgICAgY2hhbmdlU3RhdGUobGlua3MubWFuaWZlc3RhdGlvbiwgIkFzbGVlcCIsICJhYk1hbmlmZXN0U3RhdGUiKTsKCiAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gbnVsbDsKICAgICAgICAgICAgY29uZmlnQm90Lm1hc2tzLnRhZ1BvcnRhbCA9IG51bGw7CiAgICAgICAgICAgIGNvbmZpZ0JvdC5tYXNrcy50YWdQb3J0YWxTcGFjZSA9IG51bGw7CgogICAgICAgICAgICB0YWdQb3J0YWxCb3QubWFza3MudGFnUG9ydGFsQW5jaG9yUG9pbnQgPSBudWxsOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIGAuLmA6CiAgICAgICAgY2FzZSBgLndha2VgOgoKICAgICAgICAgICAgbGV0IHNraWxsQXJyYXkgPSBbImFiSW50ZXJmYWNlIiwgImFiQWN0aW9uIiwgImFiVGVzdHMiXTsKCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2tpbGxBcnJheS5sZW5ndGg7IGkrKykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgYXdhaXQgbGlua3MubGVhcm4uYWJBZGFwdChza2lsbEFycmF5W2ldKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYXdhaXQgb3Muc2xlZXAoMzAwKTsKCiAgICAgICAgICAgIC8va2VlcCBhYiBhd2FrZQogICAgICAgICAgICBsaW5rcy5yZW1lbWJlci50YWdzLmFiQXdha2VTdGF0ZSA9IHRydWU7CgogICAgICAgICAgICBpZiAoY29uZmlnQm90LnRhZ3MucGF0dGVybikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIgPSBjb25maWdCb3QudGFncy5wYXR0ZXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGlua3MucmVtZW1iZXIudGFncy5iYXNlQUIgPSB1dWlkKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNoYW5nZVN0YXRlKGxpbmtzLm1hbmlmZXN0YXRpb24sICJBd2FrZSIsICJhYk1hbmlmZXN0U3RhdGUiKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJy5sb2cnOgogICAgICAgICAgICBzaG91dCgidG9nZ2xlQ29uc29sZSIpCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGxldCBtZXNzYWdlID0gdGhhdC5tZXNzYWdlOwogICAgICAgICAgICBsZXQgZXhlY3V0YWJsZSA9IG1lc3NhZ2Uuc2xpY2UoMSk7CgogICAgICAgICAgICBpZiAobWVzc2FnZS5pbmRleE9mKCIuYXNrIikgPT0gLTEpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRyeQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG9zLnJ1bihleGVjdXRhYmxlKTsgIAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2ggKGUpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAobGlua3MuYXNrKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsaW5rcy5hc2suYWJDb3JlTWVudUFjdGlvbihtZXNzYWdlLnN1YnN0cmluZyg0KSk7CiAgICAgICAgICAgIH0KICAgIH0KfScA3v7i4AyM+AMLZGVzY3JpcHRpb24CBADe/uLgDN2XBEJUaGlzIGlzIG1lYW50IHRvIGhhbmRsZSBhbnkgbm9uZSBtZW51IHJlbGF0ZWQgaW5wdXRzL2ludGVyYWN0aW9ucy4nAN7+4uAMjPgDDG9uRmlsZVVwbG9hZAIEAN7+4uAMoJgE1xhALy9maWx0ZXIgb3V0IHRpbWVzIHdoZW4gZmlsZSBsb2FkaW5nIGlzIG5vdCBhbGxvd2VkCmlmICghYnVpbGRlclZlcnNpb24gfHwgbGlua3MucmVtZW1iZXIudGFncy5hYkxpc3RlbmluZ0ZvckZpbGVVcGxvYWRzICE9PSB0cnVlKQp7CiAgICByZXR1cm47Cn0KCi8vdmFyaW91cyBmaWxlIHNwZWNpZmljIHZhcmlhYmxlcwpsZXQgZmlsZUV4dGVuc2lvbiA9IHRoYXQuZmlsZS5uYW1lLnNwbGl0KCcuJykucG9wKCkudG9Mb3dlckNhc2UoKTsKbGV0IGZpbGVOYW1lID0gdGhhdC5maWxlLm5hbWUuc3BsaXQoJy4nKS5zaGlmdCgpOwpsZXQgc2l6ZSA9IHRoYXQuZmlsZS5zaXplOwpsZXQgbWltZVR5cGU7CmxldCBib3RJbmZvID0ge307CgovL2hhcmQgbGltaXQgYmFzZWQgb24gZmlsZSBzaXplCmlmIChzaXplID4gMjAwMDAwMDAwKQp7CiAgb3MudG9hc3QoIm1heGltdW0gZmlsZSBzaXplIGV4Y2VlZGVkICgyMDAgbWIpIik7CgogIHJldHVybjsKfQoKLy90aGlzIHN3aXRjaCBoYW5kbGVzIHBvc3NpYmxlIGZpbGVzIGV4dGVuc2lvbnMsIHdoaWxlIHJlamVjdGluZyBhbnkgaXQgZG9lcyBub3QgcmVjb2duaXplCnN3aXRjaChmaWxlRXh0ZW5zaW9uKQp7CiAgY2FzZSAnanBnJzoKICBjYXNlICdqcGVnJzoKICBjYXNlICd3ZWJwJzoKICBjYXNlICdnaWYnOgogIGNhc2UgJ3BuZyc6CiAgICBtaW1lVHlwZSA9ICJpbWFnZS8iICsgZmlsZUV4dGVuc2lvbjsKICAgIGJvdEluZm8uZm9ybSA9ICJzcHJpdGUiOwogICAgYnJlYWs7CiAgY2FzZSAnc3ZnJzoKICAgIG1pbWVUeXBlID0gImltYWdlL3N2Zyt4bWwiOwogICAgYm90SW5mby5mb3JtID0gInNwcml0ZSI7CiAgICBicmVhazsKICBjYXNlICdnbGInOgogIGNhc2UgJ2V4cic6CiAgY2FzZSAnZ2x0Zic6CiAgICBtaW1lVHlwZSA9ICJ0ZXh0L3htbCI7CiAgICBib3RJbmZvLmZvcm0gPSAibWVzaCI7CiAgICBib3RJbmZvLmZvcm1TdWJ0eXBlID0gImdsdGYiOwogICAgYnJlYWs7CiAgY2FzZSAnYXV4JzoKICBjYXNlICdwZGYnOgogICAgbGV0IGJvdERhdGEgPSBmaWxlRXh0ZW5zaW9uID09ICIuYXV4IiA/IEpTT04ucGFyc2UodGhhdC5maWxlLmRhdGEpLnN0YXRlIDogb3MucGFyc2VCb3RzRnJvbURhdGEodGhhdC5maWxlLmRhdGEpOwoKICAgIGxpbmtzLmNyZWF0ZS5hYkNyZWF0ZUJvdHMoe2JvdHM6IGJvdERhdGEsIG9yaWdpbjogZmlsZU5hbWV9KTsKCiAgICByZXR1cm47Ci8vICAgY2FzZSAncGRmJzoKLy8gICAgIGJyZWFrOwogIGNhc2UgJ21wMyc6CiAgICBtaW1lVHlwZSA9ICdhdWRpby9tcGVnJzsKICAgIGJvdEluZm8ub25DbGljayA9ICJAIG9zLnBsYXlTb3VuZCh0YWdzLmZvcm1BZGRyZXNzKTsiOwogICAgYm90SW5mby5sYWJlbCA9ICJDbGljayB0byBQbGF5IjsKICAgIGJyZWFrOwogIGNhc2UgJ21wNCc6CiAgICBtaW1lVHlwZSA9ICd2aWRlby9tcDQnOwogICAgYm90SW5mby5mb3JtID0gImlmcmFtZSI7CiAgICBib3RJbmZvLmZvcm1TdWJ0eXBlID0gInNyYyI7CiAgICBicmVhazsKICBjYXNlICdvdGYnOgogICAgbWltZVR5cGUgPSAnZm9udC9vdGYnOwogICAgYm90SW5mby5sYWJlbCA9ICJleGFtcGxlIjsKICAgIGJyZWFrOwogIGNhc2UgJ3dvZmYnOgogICAgbWltZVR5cGUgPSAnZm9udC93b2ZmJzsKICAgIGJvdEluZm8ubGFiZWwgPSAiZXhhbXBsZSI7CiAgICBicmVhazsKICBkZWZhdWx0OgogICAgbGV0IHJlc3VsdCA9IG5ldyBFcnJvcigidW5oYW5kbGVkIGZpbGUgdHlwZTogIiArIGZpbGVFeHRlbnNpb24pOwogICAgb3MudG9hc3QoImZpbGUgdHlwZSBub3Qgc3VwcG9ydGVkIik7CiAgICBjb25zb2xlLndhcm4ocmVzdWx0KQogICAgcmV0dXJuIHJlc3VsdDsKfQoKLy90aGUgZm9sbG93aW5nIHZhcmlhYmxlcyBhbmQgb2JqZWN0cyBzZXQgdXAgYSBsb2FkaW5nIGJhciBidXR0b24KY29uZmlnQm90Lm1hc2tzLm1lbnVQb3J0YWwgPSAiYWJNZW51IjsKCmxldCB1cGxvYWRSZXN1bHQ7CmxldCBwcm9ncmVzc0J1dHRvbiA9IGF3YWl0IHRoaXNCb3QuYWJQcm9ncmVzc0JhcihgdXBsb2FkaW5nYCk7Cgpjb25maWdCb3QudGFncy5zZWxlY3RlZF9zdHVkaW9JRCA9IGNvbmZpZ0JvdC50YWdzLnN0dWRpb0lEID8/IGNvbmZpZ0JvdC50YWdzLnN0dWRpbzsKCmlmICghY29uZmlnQm90LnRhZ3Muc2VsZWN0ZWRfc3R1ZGlvSUQpCnsKICBhd2FpdCBvcy5yZXF1ZXN0QXV0aEJvdCgpOwoKICBjb25maWdCb3QudGFncy5zZWxlY3RlZF9zdHVkaW9JRCA9IGF1dGhCb3QuaWQ7Cn0KCi8vdGhpcyBpcyB0aGUgYWN0dWFsIHVwbG9hZCBmdW5jdGlvbmFsaXR5CnVwbG9hZFJlc3VsdCA9IGF3YWl0IGxpbmtzLnN0b3JlLmFiUHVibGlzaEZpbGUoe2ZpbGU6IHRoYXQuZmlsZS5kYXRhLCBmaWxlTmFtZTogZmlsZU5hbWUsIG1pbWVUeXBlOiBtaW1lVHlwZX0pOwoKLy9pZiB0aGUgZmlsZSBzaG91bGQgYmUgaW5jbHVkZWQgYXMgYSBib3Qgd2l0aCBhIGxpbmssIHRoaXMgbG9naWMgaGFuZGxlcyB0aGF0CgppZiAobWltZVR5cGUuaW5jbHVkZXMoImZvbnQiKSkKewogICAgYm90SW5mb1tjb25maWdCb3QudGFncy5ncmlkUG9ydGFsXSA9IHRydWU7CiAgICBib3RJbmZvLmxhYmVsRm9udEFkZHJlc3MgPSB1cGxvYWRSZXN1bHQudXJsID8gdXBsb2FkUmVzdWx0LnVybCA6IHVwbG9hZFJlc3VsdC5leGlzdGluZ0ZpbGVVcmw7CgogICAgY3JlYXRlKGJvdEluZm8pOwp9CmVsc2UgaWYgKE9iamVjdC5rZXlzKGJvdEluZm8pLmxlbmd0aCA+IDApCnsKICAgIGJvdEluZm9bY29uZmlnQm90LnRhZ3MuZ3JpZFBvcnRhbF0gPSB0cnVlOwogICAgYm90SW5mby5mb3JtQWRkcmVzcyA9IHVwbG9hZFJlc3VsdC51cmwgPyB1cGxvYWRSZXN1bHQudXJsIDogdXBsb2FkUmVzdWx0LmV4aXN0aW5nRmlsZVVybDsKCiAgICBjcmVhdGUoYm90SW5mbyk7Cn0KCmNvbnN0IGNsaXBVUkwgPSB1cGxvYWRSZXN1bHQudXJsID8/IHVwbG9hZFJlc3VsdC5leGlzdGluZ0ZpbGVVcmw7Cgpvcy5zZXRDbGlwYm9hcmQoY2xpcFVSTCk7Cgpvcy50b2FzdCgiZmlsZSB1cmwgYWRkZWQgc2V0IHRvIGNsaXBib2FyZCIpOwoKLy9jbGVhciB0aGUgcHJvZ3Jlc3MgYmFyIGJ1dHRvbgpjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7CgppZiAocHJvZ3Jlc3NCdXR0b24pCnsKICBkZXN0cm95KHByb2dyZXNzQnV0dG9uKTsKfQoKcmV0dXJuIHVwbG9hZFJlc3VsdDsnAN7+4uAMjPgDBWxlYXJuAgQA3v7i4Az4sAQo8J+UlzY2NTdiODY1LWU5ODMtNDQwMS05ZmM5LWY1NDE4ZDE4YTdmNycA3v7i4AyM+AMIcmVtZW1iZXICBADe/uLgDJ+xBCjwn5SXZTUzODBhNmItOGI0ZC00YThiLThiMDQtNThlMWViMDNlNWU3JwDe/uLgDIz4Aw1tYW5pZmVzdGF0aW9uAgQA3v7i4AzGsQQo8J+Ul2RjYTVkOTg3LWM0ZDgtNDZlNC1iNjBjLWRhYTdiMmY0ZGRhZCcA3v7i4AyM+AMIYWJJZ25vcmUCBADe/uLgDO2xBAR0cnVlJwDe/uLgDIz4AwZjcmVhdGUCBADe/uLgDPKxBCjwn5SXMzRjM2MyMTAtNWJmMS00OWNmLWIxNTEtZWUyZDA3ZjBlNjczJwDe/uLgDIz4AwVzdG9yZQIEAN7+4uAMmbIEKPCflJc3NmFmMDQ5MS0zOTE5LTQ5ODQtYWE4Mi0yMmM3NDJmNDI2M2YnAN7+4uAMjPgDBG1lbnUCBADe/uLgDMCyBCjwn5SXYjMwYzZjNWQtYTRmNy00MjY2LWJhMzgtMzkzZGM5NWUxZWNiJwDe/uLgDIz4AwdhYlNoZWxsAgQA3v7i4AznsgQEdHJ1ZScA3v7i4AyM+AMNYWJQcm9ncmVzc0JhcgIEAN7+4uAM7LIE3whAaWYgKCFjb25maWdCb3QudGFncy5hYlNpbGVudE1vZGUpCnsKICAgIGNvbmZpZ0JvdC5tYXNrcy5tZW51UG9ydGFsID0gImFiTWVudSI7Cn0KCmxldCBsb2FkTGFiZWwgPSB0aGF0ID8/ICJ1cGRhdGluZyI7CmxldCBtZW51QnV0dG9uID0ge307CgptZW51QnV0dG9uLnNwYWNlID0gInRlbXBMb2NhbCI7Cm1lbnVCdXR0b24uYWJNZW51ID0gdHJ1ZTsKbWVudUJ1dHRvbi5tZW51SXRlbVN0eWxlID0geyAiYm9yZGVyLXJhZGl1cyI6IjhweCIsICJtYXJnaW4tdG9wIjoiM3B4In07Cm1lbnVCdXR0b24udHJhY2tOdW0gPSAtMTsKbWVudUJ1dHRvbi5vbkNyZWF0ZSA9IGBACiAgICBpZiAodGFncy50cmFja051bSA9PSAyKQogICAgewogICAgICAgIHRhZ3MudHJhY2tOdW0gPSAwOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHRhZ3MudHJhY2tOdW0rKzsKICAgIH0KCiAgICB0YWdzLmxhYmVsID0gdGFnc1sibGFiZWwiK3RhZ3MudHJhY2tOdW1dOwogICAgdGFncy5mb3JtQWRkcmVzcyA9IHRhZ3NbImZvcm0iK3RhZ3MudHJhY2tOdW1dOwoKICAgIHNldFRpbWVvdXQoKCkgPT4gd2hpc3Blcih0aGlzQm90LCAib25DcmVhdGUiKSwgNTAwKTtgOwptZW51QnV0dG9uLmxhYmVsMCA9IGxvYWRMYWJlbCArICIuIjsKbWVudUJ1dHRvbi5sYWJlbDEgPSBsb2FkTGFiZWwgKyAiLi4iOwptZW51QnV0dG9uLmxhYmVsMiA9IGxvYWRMYWJlbCArICIuLi4iOwptZW51QnV0dG9uLmZvcm0wID0gImhvdXJnbGFzc19ib3R0b20iOwptZW51QnV0dG9uLmZvcm0xID0gImhvdXJnbGFzc190b3AiOwptZW51QnV0dG9uLmZvcm0yID0gImhvdXJnbGFzc19ib3R0b20iOwptZW51QnV0dG9uLmNvbG9yID0gbGlua3MucmVtZW1iZXIudGFncy5hYkJhc2VTdHJva2VDb2xvcjsKbWVudUJ1dHRvbi5sYWJlbENvbG9yID0gImJsYWNrIjsKbWVudUJ1dHRvbi5sYWJlbEFsaWdubWVudCA9ICJjZW50ZXIiOwptZW51QnV0dG9uLmFiUHJvZ3Jlc3NSZXNldCA9ICJAIGRlc3Ryb3kodGhpc0JvdCk7IjsKbWVudUJ1dHRvbi5vbkRlc3Ryb3kgPSAiQCBjb25maWdCb3QubWFza3MubWVudVBvcnRhbCA9IG51bGw7IjsKCm1lbnVCdXR0b24gPSBjcmVhdGUobWVudUJ1dHRvbik7CgpyZXR1cm4gbWVudUJ1dHRvbjsnAN7+4uAMjPgDCW9uVGFwQ29kZQIEAN7+4uAMzLsEogJAY29uc3QgdGFwQ29kZSA9IHRoYXQ7Cgpzd2l0Y2ggKHRhcENvZGUpCnsKICAgIGNhc2UgIjMzNDIiOgogICAgICAgIG9zLnRvYXN0KCJ3YWtpbmcgIiArIGxpbmtzLnJlbWVtYmVyLnRhZ3MuYWJCdWlsZGVySWRlbnRpdHkpOwoKICAgICAgICB0aGlzQm90Lm9uQ2hhdCh7bWVzc2FnZTogIi4uIn0pOwogICAgICAgIGJyZWFrOwogICAgY2FzZSAiNDI0MiI6CiAgICAgICAgb3Muc2hvd0NoYXQoIj4iKTsKICAgICAgICBicmVhazsKICAgIGRlZmF1bHQ6CiAgICAgICAgLy9jb25zb2xlLmxvZyh0YXBDb2RlKTsKfScA3v7i4AyM+AMDYXNrAgQA3v7i4AzvvQQo8J+Ul2VjODVjMWQ2LTlmMWEtNDBkNC04MmUxLTViZDY4MDM0OWMyNycA3v7i4AyM+AMJYWJWZXJzaW9uAgQA3v7i4AyWvgQUOS42NS4xLjE3Mzc0OTU1OTM1MTAA"}]}